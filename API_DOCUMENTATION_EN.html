<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>foo_ui_webview2 API Documentation</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.5.0/github-markdown-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.0/marked.min.js"></script>
    <style>
        /* Custom code highlight colors - High Contrast */
        .hljs {
            background: #161b22 !important;
            color: #e6edf3 !important;
        }
        .hljs-comment,
        .hljs-quote { color: #8b949e !important; font-style: italic; }
        .hljs-keyword,
        .hljs-selector-tag { color: #ff7b72 !important; font-weight: 500; }
        .hljs-string,
        .hljs-attr { color: #a5d6ff !important; }
        .hljs-number,
        .hljs-literal { color: #79c0ff !important; }
        .hljs-variable,
        .hljs-template-variable { color: #ffa657 !important; }
        .hljs-function,
        .hljs-title { color: #d2a8ff !important; }
        .hljs-type,
        .hljs-class .hljs-title { color: #7ee787 !important; }
        .hljs-built_in { color: #ffa657 !important; }
        .hljs-params { color: #e6edf3 !important; }
        .hljs-property { color: #79c0ff !important; }
        .hljs-name { color: #7ee787 !important; }
        .hljs-punctuation { color: #c9d1d9 !important; }
        
        :root {
            --bg-color: #0d1117;
            --text-color: #e6edf3;
            --text-secondary: #9eabb8;
            --border-color: #30363d;
            --accent-color: #58a6ff;
            --code-bg: #161b22;
            --sidebar-width: 300px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.75;
            font-size: 15px;
            font-weight: 400;
            letter-spacing: 0.01em;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .container { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: #010409;
            border-right: 1px solid var(--border-color);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 20px 0;
        }
        .sidebar h1 {
            font-size: 20px;
            font-weight: 600;
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--border-color);
            color: #fff;
        }
        .sidebar h1 span { color: var(--accent-color); }
        .nav-section { padding: 15px 0; border-bottom: 1px solid var(--border-color); }
        .nav-section-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            color: #9eabb8;
            padding: 0 20px 10px;
            letter-spacing: 0.5px;
        }
        .nav-section a {
            display: block;
            padding: 8px 20px;
            color: var(--text-color);
            text-decoration: none;
            font-size: 15px;
            font-weight: 450;
            transition: all 0.15s;
        }
        .nav-section a:hover { background: #21262d; color: var(--accent-color); }
        .nav-section a.active { background: #1f6feb22; color: var(--accent-color); border-left: 2px solid var(--accent-color); }
        .api-count {
            background: #30363d;
            color: #9eabb8;
            font-size: 12px;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
        }
        
        /* Main Content */
        .main {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 40px 60px;
            max-width: 1000px;
        }
        .markdown-body {
            background: transparent;
            color: var(--text-color);
            font-size: 16px;
            line-height: 1.85;
        }
        .markdown-body h1 { 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 0.4em; 
            color: #fff; 
            font-size: 2.2em;
            font-weight: 600;
            margin-bottom: 0.8em;
        }
        .markdown-body h2 { 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 0.35em; 
            margin-top: 2.2em; 
            margin-bottom: 0.8em;
            font-size: 1.6em;
            font-weight: 600;
            color: #f0f6fc;
        }
        .markdown-body h3 { 
            margin-top: 1.8em; 
            margin-bottom: 0.6em;
            color: #e6edf3; 
            font-size: 1.3em;
            font-weight: 600;
        }
        .markdown-body p {
            margin: 1.2em 0;
            color: #d0d7de;
            line-height: 1.9;
            letter-spacing: 0.015em;
        }
        .markdown-body li {
            color: #d0d7de;
            line-height: 1.9;
            margin: 0.5em 0;
        }
        .markdown-body strong {
            color: #f0f6fc;
            font-weight: 600;
        }
        .markdown-body em {
            color: #9eabb8;
            font-style: italic;
        }
        .markdown-body code {
            background: #262c36;
            padding: 0.25em 0.55em;
            border-radius: 5px;
            font-size: 90%;
            font-family: 'Cascadia Code', 'Fira Code', 'JetBrains Mono', Consolas, monospace;
            font-weight: 450;
            color: #79c0ff;
            border: 1px solid #30363d;
        }
        .markdown-body pre {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 18px 20px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.7;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
            position: relative;
        }
        /* Code block language label */
        .markdown-body pre[data-lang]::before {
            content: attr(data-lang);
            position: absolute;
            top: 0;
            right: 0;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 500;
            color: #8b949e;
            background: #21262d;
            border-radius: 0 8px 0 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .markdown-body pre code {
            font-size: 14px;
            font-weight: 400;
            color: #e6edf3;
            border: none;
            background: transparent;
            padding: 0;
            display: block;
        }
        /* Ensure hljs styles are applied correctly */
        .markdown-body pre code.hljs {
            background: transparent !important;
            padding: 0 !important;
        }
        .markdown-body table { border-collapse: collapse; width: 100%; font-size: 15px; }
        .markdown-body table th, .markdown-body table td {
            border: 1px solid var(--border-color);
            padding: 12px 16px;
            text-align: left;
            line-height: 1.6;
        }
        .markdown-body table th { 
            background: #21262d; 
            font-weight: 600;
            color: #f0f6fc;
        }
        .markdown-body table td {
            color: #d0d7de;
        }
        .markdown-body table tr:nth-child(2n) { background: #161b2244; }
        .markdown-body table tr:hover { background: #21262d55; }
        .markdown-body blockquote {
            border-left: 4px solid var(--accent-color);
            background: linear-gradient(90deg, #1f6feb18 0%, transparent 100%);
            padding: 14px 22px;
            margin: 1.2em 0;
            font-size: 15px;
            border-radius: 0 6px 6px 0;
            color: #b8c0c8;
        }
        .markdown-body blockquote strong {
            color: #f0f6fc;
        }
        .markdown-body a { 
            color: #58a6ff; 
            font-weight: 500; 
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s;
        }
        .markdown-body a:hover {
            border-bottom-color: #58a6ff;
        }
        .markdown-body hr {
            border: none;
            border-top: 1px solid #30363d;
            margin: 2em 0;
        }
        .markdown-body ul, .markdown-body ol {
            padding-left: 2em;
            margin: 1em 0;
        }
        
        /* API Card */
        .api-card {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 1.5em 0;
            overflow: hidden;
        }
        .api-card-header {
            background: #21262d;
            padding: 14px 18px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .api-card-method {
            background: #238636;
            color: #fff;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
        }
        .api-card-method.get { background: #1f6feb; }
        .api-card-method.set { background: #a371f7; }
        .api-card-method.action { background: #238636; }
        .api-card-method.event { background: #d29922; color: #000; }
        .api-card-name { 
            font-family: 'Cascadia Code', 'Fira Code', Consolas, monospace; 
            font-size: 16px; 
            font-weight: 500;
            color: #fff; 
        }
        .api-card-body { padding: 18px; font-size: 15px; line-height: 1.7; }
        .api-card-desc { color: #9eabb8; margin-bottom: 14px; font-size: 15px; }
        
        /* Badge */
        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 500;
        }
        .badge-blue { background: #1f6feb33; color: #58a6ff; }
        .badge-green { background: #23863633; color: #3fb950; }
        .badge-purple { background: #a371f733; color: #d2a8ff; }
        .badge-orange { background: #d29922; color: #000; }
        
        /* Search */
        .search-box {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }
        .search-box input {
            width: 100%;
            padding: 10px 14px;
            background: #21262d;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-color);
            font-size: 15px;
            transition: all 0.2s;
        }
        .search-box input::placeholder { color: #7d8590; }
        .search-box input:focus { 
            outline: none; 
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.15);
        }
        
        /* Back to top button */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 44px;
            height: 44px;
            background: #21262d;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            color: var(--text-color);
            font-size: 20px;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .back-to-top:hover {
            background: var(--accent-color);
            color: #fff;
            transform: translateY(-2px);
        }
        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        
        /* Sidebar Scrollbar */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }
        .sidebar::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 3px;
        }
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }
        
        /* Main Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #0d1117;
        }
        ::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }
        
        /* Section Animation */
        section {
            scroll-margin-top: 20px;
        }
        
        /* Version Badge */
        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
            color: #fff;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        /* Feature List Icon */
        .markdown-body ul li::marker {
            color: var(--accent-color);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main { margin-left: 0; padding: 20px; }
            .back-to-top { bottom: 20px; right: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Back to Top Button -->
        <button class="back-to-top" id="backToTop" onclick="scrollToTop()" title="Back to Top">‚Üë</button>
        
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <h1>foo_ui_webview2 <span>API</span></h1>
            
            <div class="search-box">
                <input type="text" id="search" placeholder="Search APIs..." onkeyup="filterNav()">
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Getting Started</div>
                <a href="#overview" class="active">Overview</a>
                <a href="#installation">Installation</a>
                <a href="#developer-requirements">üë®‚Äçüíª Developer Requirements</a>
                <a href="#important-notes">‚ö†Ô∏è Important Notes</a>
                <a href="#quick-start">Quick Start</a>
                <a href="#common-use-cases">Common Use Cases ‚≠ê</a>
                <a href="#bridge-protocol">Bridge Protocol</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Playback API <span class="api-count">25</span></div>
                <a href="#playback-control">Playback Control</a>
                <a href="#playback-state">State Query</a>
                <a href="#playback-volume">Volume Control</a>
                <a href="#playback-order">Playback Order</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Playlist API <span class="api-count">42</span></div>
                <a href="#playlist-management">Playlist Management</a>
                <a href="#playlist-tracks">Track Operations</a>
                <a href="#playlist-autoplaylist">Smart Playlists</a>
                <a href="#playlist-selection">Selection</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Library API <span class="api-count">22</span></div>
                <a href="#library-browse">Browse Library</a>
                <a href="#library-search">Search</a>
                <a href="#library-cache">Cache Control üÜï</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Artwork API <span class="api-count">12</span></div>
                <a href="#artwork-api">Artwork &amp; Metadata</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Config API <span class="api-count">20</span></div>
                <a href="#config-api">Configuration</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Window API <span class="api-count">55</span></div>
                <a href="#window-api">Basic Controls</a>
                <a href="#window-titlebar">Titlebar</a>
                <a href="#window-dwm">DWM Effects</a>
                <a href="#window-zoom">Zoom Control üÜï</a>
                <a href="#window-interaction">Drag &amp; Menu</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">System API <span class="api-count">9</span></div>
                <a href="#system-api">API Discovery</a>
                <a href="#system-plugins">Plugin Registration</a>
                <a href="#system-info">System Info</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">File API <span class="api-count">10</span></div>
                <a href="#file-api">File Operations</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Dialog API <span class="api-count">4</span></div>
                <a href="#dialog-api">Dialogs</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Clipboard API <span class="api-count">4</span></div>
                <a href="#clipboard-api">Clipboard</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Shell API <span class="api-count">3</span></div>
                <a href="#shell-api">Shell Integration</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">HTTP API <span class="api-count">4</span></div>
                <a href="#http-api">HTTP Requests</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">UI API <span class="api-count">5</span></div>
                <a href="#ui-api">UI Interaction</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Keyboard API <span class="api-count">4</span></div>
                <a href="#keyboard-api">Keyboard Shortcuts</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Lyrics API <span class="api-count">3</span></div>
                <a href="#lyrics-api">Lyrics</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Metadata API <span class="api-count">11</span></div>
                <a href="#metadata-api">Metadata</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Audio API <span class="api-count">12</span></div>
                <a href="#audio-api">Audio Analysis</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Console API <span class="api-count">6</span></div>
                <a href="#console-api">Logging</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">DnD API <span class="api-count">4</span></div>
                <a href="#dnd-api">Drag &amp; Drop</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Queue API <span class="api-count">8</span></div>
                <a href="#queue-api">Playback Queue</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">JIT Queue API <span class="api-count">7</span></div>
                <a href="#jit-queue-api">JIT Queue</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Discovery API <span class="api-count">15</span></div>
                <a href="#discovery-api">Service Discovery</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">DSP API <span class="api-count">8</span></div>
                <a href="#dsp-api">DSP Effects üÜï</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Output API <span class="api-count">3</span></div>
                <a href="#output-api">Audio Output üÜï</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">ReplayGain API <span class="api-count">8</span></div>
                <a href="#replaygain-api">ReplayGain üîÑ</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Playcount API <span class="api-count">4</span></div>
                <a href="#playcount-api">Play Statistics üÜï</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Events</div>
                <a href="#events">Event System</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Security</div>
                <a href="#security">üîí Security</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Reference</div>
                <a href="#api-summary">API Summary</a>
                <a href="#changelog">üìù Changelog</a>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="main">
            <article class="markdown-body">
                
<!-- ==================== OVERVIEW ==================== -->
<section id="overview">

# foo_ui_webview2 API Documentation

> **Version**: 1.1.12  
> **Last Updated**: 2026-01-14  
> **Author**: NereaFantasia  
> **foobar2000 Min Version**: 2.0+  
> **Total APIs**: 299  
> **Test Coverage**: 299/299 Passed (100%)

## Overview

**foo_ui_webview2** is a foobar2000 component which replaces the default user interface using WebView2 technology, allowing developers to build custom UIs using modern Web technologies (HTML/CSS/JavaScript).

### Key Features

- üåê **WebView2 Rendering** - Full Chromium browser engine
- üé® **Mica Effect** - Windows 11 native transparent background
- üîå **299 APIs** - Comprehensive foobar2000 functionality coverage
- üì° **Bi-directional Communication** - Real-time C++ ‚Üî JavaScript interaction
- üéµ **Event System** - Real-time notifications for playback status, playlist, and window state changes
- ü™ü **Custom Titlebar** - Full support for dragging, double-click to maximize, and context menus
- üìÅ **File System** - File read/write and directory operations
- üåç **HTTP Requests** - GET/POST/HEAD/Download (supports async mode)
- üéπ **Global Hotkeys** - Register system-level hotkeys
- üîí **Security Hardening** - Origin verification, path security, SSRF protection
- üìã **Queue Management** - Full control over playback queue and JIT queue
- üñ•Ô∏è **Background Mode** - Can run simultaneously with Default UI or other interfaces
- üñºÔ∏è **Artwork Scaling** - Server-side image scaling, reducing data transfer by up to 99% üÜï v1.1.6
- üëÜ **Menu Control** - `ui.showCustomMenu` supports native menu suppression üÜï v1.1.7
- üì° **Real-time Events** - `metadb:changed` pushes rating/tag changes in real-time üÜï v1.1.9
- üîß **Unicode Path Fix** - Paths with special characters (e.g., Japanese quotes) now work correctly üÜï v1.1.10

### API Distribution

| Module | APIs | Description |
|---|---|---|
| `playback` | 25 | Playback control, state, volume, play by path |
| `playlist` | 42 | Playlist management, smart playlists |
| `library` | 22 | Library browsing, search, path lookup, cache control |
| `artwork` | 12 | Artwork, lyrics, batch retrieval, server-side scaling üîÑ |
| `config` | 20 | Configuration, device info, persistent storage |
| `window` | 55 | Window control, DWM effects, zoom control |
| `system` | 9 | Theme/DPI/Language, API discovery |
| `file` | 10 | File read/write/copy/move, directory ops üîÑ |
| `dialog` | 4 | File/folder dialogs |
| `clipboard` | 4 | Clipboard operations |
| `shell` | 3 | Shell integration (`shell.exec` disabled) |
| `http` | 4 | HTTP requests |
| `ui` | 5 | Custom menus, notifications |
| `keyboard` | 4 | Global hotkeys |
| `lyrics` | 3 | Lyrics management |
| `metadata` | 11 | Metadata read/write, batch ops, rating üîÑ |
| `audio` | 12 | Audio analysis, spectrum, waveform üîÑ |
| `console` | 6 | Logging |
| `dnd` | 4 | Drag & Drop |
| `queue` | 8 | Playback queue management |
| `jitQueue` | 7 | JIT (Just-In-Time) queue |
| `discovery` | 15 | Service discovery, menu commands, foo_playcount rating üîÑ |
| `dsp` | 8 | DSP effects management üÜï |
| `output` | 3 | Audio output devices üÜï |
| `replaygain` | 8 | ReplayGain settings, scan, get, remove üîÑ |
| `playcount` | 4 | Play statistics (foo_playcount integration) üÜï |
| `test` | 2 | Testing tools |

</section>

<!-- ==================== INSTALLATION ==================== -->
<section id="installation">

## Installation

### System Requirements

| Item | Requirement |
|---|---|
| **OS** | Windows 10/11 (64-bit) |
| **foobar2000** | v2.0 or higher (64-bit) |
| **WebView2 Runtime** | Usually pre-installed on Windows 10/11; if not, download from [Microsoft](https://developer.microsoft.com/microsoft-edge/webview2/) |

> üí° **Tip**: foobar2000 v2.0 is the transition point for 64-bit support. If you are using v1.x, please upgrade to v2.0+ first.

---

### Method 1: Using fb2k-component Installer (Recommended) ‚ú®

This is the simplest installation method suitable for most users.

1. **Download Installer**
   
   Download `foo_ui_webview2.fb2k-component` from the release page.

2. **Double-click to Install**
   
   Double-click the downloaded `.fb2k-component` file. foobar2000 will open an installation confirmation dialog.

3. **Confirm Installation**
   
   Click `Yes` to confirm. foobar2000 will copy the component to the correct location.

4. **Restart foobar2000**
   
   Restart foobar2000 for the component to take effect.

5. **Select UI**
   
   `File` ‚Üí `Preferences` ‚Üí `Display` ‚Üí `Default User Interface` ‚Üí Select `WebView UI` ‚Üí Click `OK`.

> üì¶ **Note**: `.fb2k-component` is the official foobar2000 component package format, which is essentially a ZIP archive containing DLL files.

---

### Method 2: Manual DLL Installation

Use this method if you prefer to manage components manually.

1. **Download Plugin**
   
   Download `foo_ui_webview2.dll` from the release page.

2. **Locate foobar2000 Installation Directory**
   
   Typically located at:

```plaintext
C:\Program Files\foobar2000\              # Default installation
C:\Users\<Username>\AppData\Local\foobar2000\  # Portable/User installation
```

3. **Copy to Components Directory**
   
   Copy `foo_ui_webview2.dll` to the `components` subdirectory:

```plaintext
<foobar2000_install_dir>\components\foo_ui_webview2.dll
```

4. **Restart foobar2000**

5. **Select UI**
   
   `File` ‚Üí `Preferences` ‚Üí `Display` ‚Üí `Default User Interface` ‚Üí Select `WebView UI`.

---

### Verify Installation

After successful installation, you should see:

- foobar2000 interface changes to the default WebView UI skin.
- `View` ‚Üí `WebView UI` option appears in the menu bar.
- `File` ‚Üí `Preferences` ‚Üí `Tools` ‚Üí `WebView UI` preferences page is available.

If you encounter issues, please check:
- [ ] Are you using the 64-bit version of foobar2000?
- [ ] Is WebView2 Runtime installed?
- [ ] Is the DLL file placed in the correct `components` directory?

---

### Directory Structure

```plaintext
foobar2000/
‚îú‚îÄ‚îÄ foobar2000.exe              # Main executable
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ foo_ui_webview2.dll      # Plugin DLL
‚îú‚îÄ‚îÄ user-components-x64/
‚îÇ   ‚îî‚îÄ‚îÄ foo_ui_webview2/         # Optional: User components dir (Portable)
‚îî‚îÄ‚îÄ configuration/
    ‚îî‚îÄ‚îÄ foo_ui_webview2/         # Plugin configuration
        ‚îú‚îÄ‚îÄ settings.json       # User settings
        ‚îî‚îÄ‚îÄ cache/              # Cache directory
```

### Background Mode üÜï

Background mode allows WebView UI to run simultaneously with Default UI or other interfaces (like Columns UI). When enabled, WebView UI creates a hidden window in the background, and all APIs remain available.

**How to Enable:**

1. **Enable Background Mode**  
   `Preferences` ‚Üí `Advanced` ‚Üí `Tools` ‚Üí `WebView UI` ‚Üí `Enable Background Mode`

2. **Select Other UI**  
   `Preferences` ‚Üí `Display` ‚Üí `Default User Interface` ‚Üí Select `Default UI` or others.

3. **Restart foobar2000**

4. **Show/Hide Window**  
   `View` ‚Üí `WebView UI` ‚Üí `Show/Hide Window`

**Use Cases:**
- Use WebView UI as a secondary window for lyrics or artwork.
- Use Default UI for playlist management while using WebView UI for visualization.
- Run custom scripts or automation tasks in the background.

</section>

<!-- ==================== DEVELOPER REQUIREMENTS ==================== -->
<section id="developer-requirements">

## üë®‚Äçüíª Developer Requirements

> üí° **Don't worry!** If you are new to frontend development, the requirements here are not strict. The design philosophy of foobar2000 WebView UI is to **lower the barrier to entry**‚Äîyou only need to master basic Web technologies to start building your own personalized interface.

---

### ‚úÖ Basic Skills (Essential)

<div class="api-card" style="border-left: 4px solid #3fb950; background: linear-gradient(135deg, rgba(63, 185, 80, 0.1) 0%, transparent 50%);">
    <div class="api-card-body">

Here are the **minimum technical requirements** for developing custom UIs with this plugin:

| Skill | Level | Description |
|---|---|---|
| **JavaScript** | ‚≠ê‚≠ê Beginner | Understand variables, functions, objects, arrays; understand `async/await` syntax |
| **HTML** | ‚≠ê Beginner | Can write basic HTML structure like `<div>`, `<button>`, `<img>` |
| **CSS** | ‚≠ê Beginner | Understand basic selectors, layout (Flexbox is enough), colors and fonts |

**Core JavaScript Concepts You Need to Know**:

```javascript
// 1Ô∏è‚É£ Basic Syntax - Variables and Functions
const volume = 0.8;
function playMusic() { /* ... */ }

// 2Ô∏è‚É£ Async Operations - This is crucial! Our APIs are async
const track = await fb2k.invoke('playback.getCurrentTrack', {});

// 3Ô∏è‚É£ Object and Array Operations
const { title, artist, album } = track;  // Destructuring
tracks.forEach(t => console.log(t.title));  // Iteration

// 4Ô∏è‚É£ Event Listeners
fb2k.on('playback:trackChanged', (data) => {
    updateUI(data);
});
```

üíö **Good News**: If you can understand the code above, you already have the foundation for development!

</div>
</div>

---

### üöÄ Recommended Advanced Skills

<div class="api-card" style="border-left: 4px solid #58a6ff; background: linear-gradient(135deg, rgba(88, 166, 255, 0.1) 0%, transparent 50%);">
    <div class="api-card-body">

These skills are **not mandatory**, but can help you create more professional and complex interfaces:

| Skill | Priority | Why Useful |
|---|---|---|
| **Vue.js 3** | ‚≠ê‚≠ê‚≠ê Highly Recommended | Component-based development, reactive data binding, greatly improves efficiency |
| **TypeScript** | ‚≠ê‚≠ê Recommended | Type checking avoids common errors, smarter IDE autocompletion |
| **CSS Flexbox/Grid** | ‚≠ê‚≠ê Recommended | Essential for complex layouts (e.g., album grids, playback queues) |
| **Pinia/Vuex** | ‚≠ê Optional | State management, suitable for large projects |
| **Vite** | ‚≠ê Optional | Modern build tool, excellent development experience |

**Framework Choice Framework**:

| Your Situation | Recommendation |
|---|---|
| üå± Total Beginner | Start with Vanilla HTML/CSS/JS, learn frameworks after getting familiar with APIs |
| üåø Some Frontend Knowledge | Use **Vue 3 + Composition API** directly |
| üå≤ Experienced Developer | Vue 3 + TypeScript + Pinia + Vite stack |

</div>
</div>

---

### üìö Learning Resources

<div class="api-card">
    <div class="api-card-body">

**If you are a beginner, we recommend these free learning paths**:

1. **JavaScript Basics** ‚Üí [MDN Web Docs](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide)
2. **async/await** ‚Üí [JavaScript.info - Async/await](https://javascript.info/async-await)
3. **Vue 3 Introduction** ‚Üí [Vue.js Official Tutorial](https://vuejs.org/tutorial/)
4. **CSS Flexbox** ‚Üí [Flexbox Froggy Game](https://flexboxfroggy.com/)

> üéØ **Tip**: You don't need to master everything to start! Many excellent foobar2000 skins started from simple HTML pages and improved iteratively.

</div>
</div>

---

### ‚ö° Development Environment Recommendations

| Tool | Recommended | Description |
|---|---|---|
| **Code Editor** | VS Code | Free, rich plugins, easy debugging |
| **Browser Debugging** | Edge DevTools | WebView2 is based on Chromium, debuggable with Edge |
| **Package Manager** | npm / pnpm | Manage dependencies (if using frameworks) |
| **Version Control** | Git | Code backup, collaboration |

**Recommended VS Code Extensions**:
- `Volar` - Official Vue 3 extension
- `ESLint` - Linting
- `Prettier` - Code formatting
- `Auto Close Tag` - Auto close HTML tags

</section>

<!-- ==================== IMPORTANT NOTES ==================== -->
<section id="important-notes">

## ‚ö†Ô∏è Important Notes

### Identifying Static Local Files vs Streaming

foobar2000 supports various media sources, including local files, files inside archives, CD tracks, network streams, etc. Correctly identifying the file type is necessary before operating on files.

#### Path Format Types

| Path Prefix | Type | Description | Example |
|---|---|---|---|
| `C:\` `D:\` | Local File | Windows Standard Path | `D:\Music\song.flac` |
| `file://` | Local File | URI Format Local Path | `file://D:/Music/song.flac` |
| `file-relative://` | Relative Path | Relative to playlist | `file-relative://../../song.flac` |
| `archive://` | Archive | File inside archive | `archive://D:\Album.zip\|track01.flac` |
| `unpack://` | Unpacked File | Temporarily unpacked file | `unpack://...` |
| `cdda://` | CD Track | Physical CD track | `cdda://E,1` |
| `http://` `https://` | Network Stream | Online media stream | `https://stream.example.com/live` |

#### Identification Method

```javascript
// ========== Check if Static Local File ==========
function isLocalFile(path) {
    if (!path) return false;
    
    // Network Stream: Not local file
    if (path.startsWith('http://') || path.startsWith('https://')) {
        return false;
    }
    
    // CD Track: Not standard file
    if (path.startsWith('cdda://')) {
        return false;
    }
    
    // Relative Path: Needs context to resolve
    if (path.startsWith('file-relative://')) {
        return false; // Use absolutePath instead
    }
    
    // Archive File: Readable but not directly accessible
    if (path.startsWith('archive://') || path.startsWith('unpack://')) {
        return true; // Is file, but artwork retrieval needs API
    }
    
    // file:// URI or Standard Path
    return true;
}

// ========== Recommended: Use absolutePath ==========
const track = await fb2k.invoke('playlist.getTracks', { count: 1 });
const t = track.tracks[0];

// path: May be file-relative://../../song.flac
// absolutePath: Always D:\Music\song.flac (if local file)
console.log('Internal Path:', t.path);
console.log('Absolute Path:', t.absolutePath);

// ‚úÖ Correct: Always use absolutePath for file operations
if (t.absolutePath && isLocalFile(t.absolutePath)) {
    const artwork = await fb2k.invoke('artwork.getForTrack', {
        path: t.absolutePath
    });
}
```

#### Key Principles

> **‚ö° Always use `absolutePath` instead of `path`**  
> Track objects returned by APIs contain two path fields:
> - `path`: foobar2000 internal path (may be `file-relative://` etc.)
> - `absolutePath`: Local filesystem absolute path (Recommended)

---

### Volume Format

| Scenario | Range | Description |
|---|---|---|
| API Input/Output | `0-100` | Integer percentage, 0=Mute, 100=Max |
| Slider Control | `0-100` | Direct binding |
| dB Conversion | - | `0% ‚âà -100dB`, `100% = 0dB` |

```javascript
// Set volume to 80% (approx -20dB)
await fb2k.invoke('playback.setVolume', { volume: 80 });

// Get volume
const { volume } = await fb2k.invoke('playback.getVolume');
console.log(`Current Volume: ${volume}%`);
```

---

### Event Name Format

All events use **colon-separated** naming format:

```javascript
// ‚úÖ Correct Format
fb2k.on('playback:trackChanged', callback);
fb2k.on('playback:stateChanged', callback);
fb2k.on('playlist:itemsChanged', callback);

// ‚ùå Incorrect Format (Not supported)
fb2k.on('playback.trackChanged', callback);
fb2k.on('playbackTrackChanged', callback);
```

---

### Async Operation Note

All `fb2k.invoke()` calls return a Promise, **must use `await` or `.then()`**:

```javascript
// ‚úÖ Correct
await fb2k.invoke('playback.play');
const track = await fb2k.invoke('playback.getCurrentTrack');

// ‚ùå Incorrect: Forgetting await leads to incomplete operation
fb2k.invoke('playback.play');
const track = fb2k.invoke('playback.getCurrentTrack'); // Returns Promise instead of result
```

</section>

<!-- ==================== QUICK START ==================== -->
<section id="quick-start">

## Quick Start

### Basic Call Example

```javascript
// 1. Call API (All calls are asynchronous)
const result = await fb2k.invoke('playback.play');
console.log(result); // { success: true }

// 2. Get current track info
const track = await fb2k.invoke('playback.getCurrentTrack');
console.log(track.title, track.artist);
console.log('Absolute Path:', track.absolutePath); // Recommended

// 3. Listen to events (Use colon-separated format)
const unsubscribe = fb2k.on('playback:trackChanged', (data) => {
    console.log('Now Playing:', data.title);
});
// Unsubscribe: unsubscribe();

// 4. Call with parameters (Volume range 0-100)
await fb2k.invoke('playback.setVolume', { volume: 80 }); // 80%

// 5. Check if local file
function isStaticFile(absolutePath) {
    if (!absolutePath) return false;
    return !absolutePath.startsWith('http://') &&
           !absolutePath.startsWith('https://') &&
           !absolutePath.startsWith('cdda://');
}
```

### Bridge Object

The plugin automatically injects the `window.fb2k` object:

```javascript
window.fb2k = {
    // Call API
    invoke(method, params) ‚Üí Promise<result>,
    
    // Listen to events
    on(event, callback) ‚Üí unsubscribe function,
    
    // Internal properties (Do not use directly)
    _callbacks: Map,
    _callId: number,
    _evts: Object
};
```

</section>

<!-- ==================== COMMON USE CASES ==================== -->
<section id="common-use-cases">

## Common Use Cases & Best Practices

### üéµ Scenario 1: Building a Player Interface

This is the most common use case, demonstrating how to build a complete playback control interface:

```javascript
// ========== Utility: Check Static File ==========
function isStaticLocalFile(path) {
    if (!path) return false;
    // Network stream and CD are not static files
    if (path.startsWith('http://') || path.startsWith('https://')) return false;
    if (path.startsWith('cdda://')) return false;
    return true;
}

// ========== Initialize Player State ==========
async function initPlayer() {
    // Get current playback state
    const state = await fb2k.invoke('playback.getState');
    updatePlayButton(state.state === 'playing');
    
    // Get volume (0-100 percentage)
    const volumeInfo = await fb2k.invoke('playback.getVolume');
    updateVolumeSlider(volumeInfo.volume); // Use directly, no conversion needed
    
    // Get current track info
    if (state.state === 'playing' || state.state === 'paused') {
        const track = await fb2k.invoke('playback.getCurrentTrack');
        updateTrackInfo(track);
        
        // Get artwork (Use absolutePath for compatibility)
        if (isStaticLocalFile(track.absolutePath)) {
            const artwork = await fb2k.invoke('artwork.getCurrent');
            if (artwork.found) {
                document.getElementById('cover').src = artwork.dataUrl;
            }
        }
    }
}

// ========== Playback Control Buttons ==========
document.getElementById('btn-play').onclick = async () => {
    await fb2k.invoke('playback.playOrPause');
};

document.getElementById('btn-prev').onclick = async () => {
    await fb2k.invoke('playback.previous');
};

document.getElementById('btn-next').onclick = async () => {
    await fb2k.invoke('playback.next');
};

// ========== Progress Bar Control ==========
const progressBar = document.getElementById('progress');

// Click to seek
progressBar.onclick = async (e) => {
    const rect = progressBar.getBoundingClientRect();
    const percent = (e.clientX - rect.left) / rect.width;
    const state = await fb2k.invoke('playback.getState');
    const targetPos = percent * state.duration;
    await fb2k.invoke('playback.setPosition', { position: targetPos });
};

// ========== Volume Control ==========
const volumeSlider = document.getElementById('volume');

volumeSlider.oninput = async (e) => {
    // Slider 0-100 directly as volume percentage
    const volume = parseInt(e.target.value); // 0-100
    await fb2k.invoke('playback.setVolume', { volume });
};

document.getElementById('btn-mute').onclick = async () => {
    await fb2k.invoke('playback.toggleMute');
};

// ========== Event Listeners ==========
// Track Changed
fb2k.on('playback:trackChanged', async (track) => {
    updateTrackInfo(track);
    const artwork = await fb2k.invoke('artwork.getCurrent');
    if (artwork.found) {
        document.getElementById('cover').src = artwork.dataUrl;
    }
});

// Playback State Changed
fb2k.on('playback:stateChanged', (state) => {
    updatePlayButton(state.isPlaying);
});

// Playback Time Changed (For progress bar update)
fb2k.on('playback:time', (data) => {
    // Need to cache duration, as playback:time only has position
    const percent = (data.position / currentDuration) * 100;
    document.getElementById('progress-fill').style.width = percent + '%';
    document.getElementById('time-current').textContent = formatTime(data.position);
});

// Volume Changed
fb2k.on('playback:volumeChanged', (data) => {
    volumeSlider.value = data.volume; // Already 0-100 range
});

// ========== Helper Functions ==========
function formatTime(seconds) {
    const min = Math.floor(seconds / 60);
    const sec = Math.floor(seconds % 60);
    return `${min}:${sec.toString().padStart(2, '0')}`;
}

function updateTrackInfo(track) {
    document.getElementById('title').textContent = track.title || 'Unknown Track';
    document.getElementById('artist').textContent = track.artist || 'Unknown Artist';
    document.getElementById('album').textContent = track.album || '';
    document.getElementById('time-total').textContent = formatTime(track.duration);
}

function updatePlayButton(isPlaying) {
    document.getElementById('btn-play').textContent = isPlaying ? '‚è∏' : '‚ñ∂';
}

// Initialize on page load
initPlayer();
```

### üìã Scenario 2: Playlist Management

```javascript
// ========== Get All Playlists ==========
async function loadPlaylists() {
    const { playlists } = await fb2k.invoke('playlist.getAll');
    
    const container = document.getElementById('playlist-list');
    container.innerHTML = '';
    
    playlists.forEach((pl, index) => {
        const item = document.createElement('div');
        item.className = 'playlist-item' + (pl.isActive ? ' active' : '');
        item.innerHTML = `
            <span class="name">${pl.name}</span>
            <span class="count">${pl.itemCount} tracks</span>
        `;
        item.onclick = () => switchPlaylist(index);
        container.appendChild(item);
    });
}

// ========== Switch Playlist ==========
async function switchPlaylist(index) {
    await fb2k.invoke('playlist.setActive', { playlist: index });
    loadPlaylists();
    loadTracks(index);
}

// ========== Load Tracks (Pagination) ==========
async function loadTracks(playlist, page = 0) {
    const pageSize = 50;
    const result = await fb2k.invoke('playlist.getTracks', {
        playlist,
        start: page * pageSize,
        count: pageSize
    });
    
    const container = document.getElementById('track-list');
    if (page === 0) container.innerHTML = '';
    
    result.tracks.forEach(track => {
        const item = document.createElement('div');
        item.className = 'track-item';
        item.innerHTML = `
            <span class="number">${track.index + 1}</span>
            <span class="title">${track.title}</span>
            <span class="artist">${track.artist}</span>
            <span class="duration">${formatTime(track.duration)}</span>
        `;
        item.ondblclick = () => playTrack(playlist, track.index);
        container.appendChild(item);
    });
    
    // Load More Button
    if (result.tracks.length === pageSize) {
        const loadMore = document.createElement('button');
        loadMore.textContent = 'Load More...';
        loadMore.onclick = () => loadTracks(playlist, page + 1);
        container.appendChild(loadMore);
    }
}

// ========== Play Specific Track ==========
async function playTrack(playlist, track) {
    await fb2k.invoke('playlist.playTrack', { playlist, track });
}

// ========== Create New Playlist ==========
async function createPlaylist() {
    const name = prompt('Enter playlist name:');
    if (name) {
        await fb2k.invoke('playlist.create', { name });
        loadPlaylists();
    }
}

// ========== Delete Playlist ==========
async function deletePlaylist(index) {
    if (confirm('Are you sure you want to delete this playlist?')) {
        await fb2k.invoke('playlist.remove', { playlist: index });
        loadPlaylists();
    }
}

// ========== Add Files to Playlist ==========
async function addFilesToPlaylist() {
    // Open file selection dialog
    const result = await fb2k.invoke('dialog.openFile', {
        title: 'Select Music Files',
        filters: [
            { name: 'Audio Files', spec: '*.mp3;*.flac;*.wav;*.m4a;*.ogg' },
            { name: 'All Files', spec: '*.*' }
        ],
        multiSelect: true
    });
    
    if (!result.cancelled && result.paths.length > 0) {
        await fb2k.invoke('playlist.addPaths', {
            paths: result.paths
        });
        loadTracks(await getActivePlaylist());
    }
}

// ========== Listen to Playlist Changes ==========
fb2k.on('playlist:itemsChanged', () => {
    loadTracks(currentPlaylistIndex);
});

fb2k.on('playlist:playlistsChanged', () => {
    loadPlaylists();
});
```

### üîç Scenario 3: Library Search & Artwork

```javascript
// ========== Utility Functions ==========
function isStaticLocalFile(path) {
    if (!path) return false;
    if (path.startsWith('http://') || path.startsWith('https://')) return false;
    if (path.startsWith('cdda://')) return false;
    return true;
}

// ========== Search Library ==========
async function searchLibrary(query) {
    const result = await fb2k.invoke('library.search', {
        query: query,
        offset: 0,
        limit: 50
    });
    
    console.log(`Found ${result.total} results`);
    
    const container = document.getElementById('search-results');
    container.innerHTML = '';
    
    for (const track of result.tracks) {
        const item = document.createElement('div');
        item.className = 'search-result';
        
        // ‚ö†Ô∏è Always use absolutePath (not path)
        let coverSrc = 'default-cover.png';
        
        // Only static local files can get artwork
        if (isStaticLocalFile(track.absolutePath)) {
            const artwork = await fb2k.invoke('artwork.getForTrack', {
                path: track.absolutePath,  // ‚úÖ Use absolutePath
                type: 'front'
            });
            if (artwork.available) {
                coverSrc = artwork.dataUrl;
            }
        }
        
        item.innerHTML = `
            <img src="${coverSrc}" 
                 class="cover-thumb" width="50" height="50">
            <div class="info">
                <div class="title">${track.title}</div>
                <div class="artist">${track.artist}</div>
            </div>
        `;
        
        item.onclick = () => playFromPath(track.absolutePath);
        container.appendChild(item);
    }
    
    // Pagination (Load More)
    if (result.hasMore) {
        addLoadMoreButton(query, 50);
    }
}

// ========== Search Syntax Example ==========
// Simple Search
searchLibrary('love');

// Field Search
searchLibrary('artist HAS Beatles');
searchLibrary('album IS "Abbey Road"');

// Combined Search
searchLibrary('artist HAS Beatles AND year GREATER 1968');
searchLibrary('genre IS Rock OR genre IS Pop');

// ========== Load Album List (With Artwork) ==========
async function loadAlbums() {
    const result = await fb2k.invoke('library.getAlbums', {
        sort: 'year',      // Sort by year
        limit: 30,
        includeTracks: false
    });
    
    const container = document.getElementById('album-grid');
    container.innerHTML = '';
    
    for (const album of result.albums) {
        // Use firstTrackAbsolutePath to get album artwork
        const artwork = await fb2k.invoke('artwork.getForTrack', {
            path: album.firstTrackAbsolutePath,
            type: 'front'
        });
        
        const card = document.createElement('div');
        card.className = 'album-card';
        card.innerHTML = `
            <img src="${artwork.available ? artwork.dataUrl : 'default-album.png'}" 
                 class="album-cover">
            <div class="album-name">${album.name}</div>
            <div class="album-artist">${album.artist}</div>
            <div class="album-info">${album.year} ¬∑ ${album.trackCount} tracks</div>
        `;
        
        card.onclick = () => showAlbumDetail(album.name, album.artist);
        container.appendChild(card);
    }
}

// ========== Show Album Detail ==========
async function showAlbumDetail(albumName, artist) {
    const tracks = await fb2k.invoke('library.getAlbumTracks', {
        album: albumName,
        artist: artist
    });
    
    // Show track list...
    console.log(`${albumName} has ${tracks.length} tracks`);
}
```

### ü™ü Scenario 4: Window & Appearance Control

```javascript
// ========== Window Control ==========

// Minimize/Maximize/Close
document.getElementById('btn-minimize').onclick = () => 
    fb2k.invoke('window.minimize');

document.getElementById('btn-maximize').onclick = () => 
    fb2k.invoke('window.maximize');

document.getElementById('btn-close').onclick = () => 
    fb2k.invoke('window.close');

// Always On Top
let isAlwaysOnTop = false;
document.getElementById('btn-pin').onclick = async () => {
    isAlwaysOnTop = !isAlwaysOnTop;
    await fb2k.invoke('window.setAlwaysOnTop', { enabled: isAlwaysOnTop });
    document.getElementById('btn-pin').classList.toggle('active', isAlwaysOnTop);
};

// ========== Mica/Blur Effect ==========
async function applyMicaEffect() {
    // Windows 11 Mica Effect
    await fb2k.invoke('window.setMica', { enabled: true });
    
    // Or use Blur Effect (Windows 10 Compatible)
    // await fb2k.invoke('window.setBlur', { enabled: true });
}

// ========== Rounded Corners (Windows 11) ==========
async function setRoundedCorners(style) {
    // style: 'default' | 'none' | 'round' | 'small'
    await fb2k.invoke('window.setCornerPreference', { preference: style });
}

// ========== Fullscreen Toggle ==========
let isFullscreen = false;
document.getElementById('btn-fullscreen').onclick = async () => {
    if (isFullscreen) {
        await fb2k.invoke('window.exitFullscreen');
    } else {
        await fb2k.invoke('window.enterFullscreen');
    }
    isFullscreen = !isFullscreen;
};

// ========== Watch Window State ==========
fb2k.on('window:stateChanged', (state) => {
    console.log('Window State:', state.state); // normal, minimized, maximized
    updateMaximizeButton(state.state === 'maximized');
});

fb2k.on('window:focusChanged', (data) => {
    document.body.classList.toggle('window-inactive', !data.focused);
});

// ========== Custom Titlebar Drag ==========
// Mark draggable area
document.getElementById('titlebar').setAttribute('data-webview-drag', 'true');

// Mark non-draggable button area
document.querySelectorAll('.titlebar-button').forEach(btn => {
    btn.setAttribute('data-webview-drag', 'false');
});
```

### ‚å®Ô∏è Scenario 5: Global Hotkeys

```javascript
// ========== Register Global Hotkeys ==========
async function registerHotkeys() {
    // Play/Pause: Ctrl+Shift+Space
    await fb2k.invoke('keyboard.registerHotkey', {
        id: 'play-pause',
        key: 'Space',
        modifiers: ['ctrl', 'shift']
    });
    
    // Next Track: Ctrl+Shift+Right
    await fb2k.invoke('keyboard.registerHotkey', {
        id: 'next-track',
        key: 'Right',
        modifiers: ['ctrl', 'shift']
    });
    
    // Previous Track: Ctrl+Shift+Left
    await fb2k.invoke('keyboard.registerHotkey', {
        id: 'prev-track',
        key: 'Left',
        modifiers: ['ctrl', 'shift']
    });
    
    // Volume Up: Ctrl+Shift+Up
    await fb2k.invoke('keyboard.registerHotkey', {
        id: 'volume-up',
        key: 'Up',
        modifiers: ['ctrl', 'shift']
    });
    
    // Volume Down: Ctrl+Shift+Down
    await fb2k.invoke('keyboard.registerHotkey', {
        id: 'volume-down',
        key: 'Down',
        modifiers: ['ctrl', 'shift']
    });
}

// ========== Listener Hotkey Trigger ==========
fb2k.on('keyboard:hotkeyPressed', async (data) => {
    switch (data.id) {
        case 'play-pause':
            await fb2k.invoke('playback.playOrPause');
            break;
        case 'next-track':
            await fb2k.invoke('playback.next');
            break;
        case 'prev-track':
            await fb2k.invoke('playback.previous');
            break;
        case 'volume-up':
            const state1 = await fb2k.invoke('playback.getVolume');
            await fb2k.invoke('playback.setVolume', { 
                volume: Math.min(100, state1.volume + 5) 
            });
            break;
        case 'volume-down':
            const state2 = await fb2k.invoke('playback.getVolume');
            await fb2k.invoke('playback.setVolume', { 
                volume: Math.max(0, state2.volume - 5) 
            });
            break;
    }
});

// Register on page load
registerHotkeys();

// ========== Unregister on page unload ==========
window.addEventListener('beforeunload', async () => {
    await fb2k.invoke('keyboard.unregisterHotkey', { id: 'play-pause' });
    await fb2k.invoke('keyboard.unregisterHotkey', { id: 'next-track' });
    await fb2k.invoke('keyboard.unregisterHotkey', { id: 'prev-track' });
    await fb2k.invoke('keyboard.unregisterHotkey', { id: 'volume-up' });
    await fb2k.invoke('keyboard.unregisterHotkey', { id: 'volume-down' });
});
```

### üìÅ Scenario 6: Configuration & File Storage

```javascript
// ========== Use Config Storage ==========
const CONFIG_PREFIX = 'myapp.';

// Save Config
async function saveConfig(key, value) {
    await fb2k.invoke('config.set', {
        key: CONFIG_PREFIX + key,
        value: JSON.stringify(value)
    });
}

// Load Config
async function loadConfig(key, defaultValue = null) {
    const result = await fb2k.invoke('config.get', {
        key: CONFIG_PREFIX + key
    });
    if (result.value) {
        return JSON.parse(result.value);
    }
    return defaultValue;
}

// Usage Example
async function initSettings() {
    // Load user settings
    const settings = await loadConfig('settings', {
        theme: 'dark',
        showLyrics: true,
        coverSize: 'large'
    });
    
    applySettings(settings);
}

async function saveSettings(settings) {
    await saveConfig('settings', settings);
}

// ========== File Read/Write ==========
// Save to file
async function exportPlaylistToFile() {
    // Select save location
    const result = await fb2k.invoke('dialog.saveFile', {
        title: 'Export Playlist',
        filters: [
            { name: 'JSON Files', spec: '*.json' }
        ],
        defaultName: 'playlist-backup.json'
    });
    
    if (!result.cancelled) {
        const { tracks } = await fb2k.invoke('playlist.getTracks', { count: 10000 });
        await fb2k.invoke('file.write', {
            path: result.path,
            content: JSON.stringify(tracks, null, 2)
        });
        console.log('Export Success:', result.path);
    }
}

// Read from file
async function importPlaylistFromFile() {
    const result = await fb2k.invoke('dialog.openFile', {
        title: 'Import Playlist',
        filters: [
            { name: 'JSON Files', spec: '*.json' }
        ]
    });
    
    if (!result.cancelled) {
        const content = await fb2k.invoke('file.read', {
            path: result.paths[0]
        });
        const tracks = JSON.parse(content.content);
        console.log('Imported', tracks.length, 'tracks');
    }
}
```

### üé® Scenario 7: Path Handling & File Type Identification

```javascript
// ========== foobar2000 Path Format List ==========
//
// üìÅ Local File:
//   - C:\Music\song.flac              (Windows Standard Path)
//   - file://C:/Music/song.flac        (Standard file URI)
//
// üì¶ Archive File:
//   - archive://D:\Album.zip|/track01.flac  (Files inside ZIP/RAR)
//   - unpack://...                          (Temporarily unpacked files)
//
// üíø CD Track:
//   - cdda://E,1                       (Drive E: Track 1)
//
// üåê Network Stream:
//   - http://stream.example.com/live   (HTTP Stream)
//   - https://...                       (HTTPS Stream)
//
// üìÇ Relative Path (Playlist internal use only):
//   - file-relative://../../song.flac  (Relative path, needs context)

// ========== Key Principles ==========
// Track object returned by API contains two path fields:
// - path: foobar2000 internal format (may be special protocol)
// - absolutePath: Local filesystem absolute path (Recommended)

// ========== Identify File Type ==========
function getFileType(absolutePath) {
    if (!absolutePath) return 'unknown';
    
    if (absolutePath.startsWith('http://') || 
        absolutePath.startsWith('https://')) {
        return 'stream';          // Network Stream
    }
    if (absolutePath.startsWith('cdda://')) {
        return 'cd';              // CD Track
    }
    if (absolutePath.startsWith('archive://') ||
        absolutePath.startsWith('unpack://')) {
        return 'archive';         // Archive File
    }
    return 'local';               // Local File
}

// ========== Correct Way to Get Artwork ==========

// ‚ùå Incorrect: path might fail (file-relative:// cannot resolve)
const tracks = await fb2k.invoke('playlist.getTracks', { count: 1 });
const artwork = await fb2k.invoke('artwork.getForTrack', {
    path: tracks.tracks[0].path  // May be file-relative://...
});

// ‚úÖ Correct: Use absolutePath
const tracks2 = await fb2k.invoke('playlist.getTracks', { count: 1 });
const t = tracks2.tracks[0];

// Check file type first
const fileType = getFileType(t.absolutePath);
if (fileType === 'stream') {
    console.log('Network stream, mostly no artwork');
} else {
    const artwork = await fb2k.invoke('artwork.getForTrack', {
        path: t.absolutePath  // ‚úÖ Always use absolutePath
    });
}

// ‚úÖ Better: Use getByPlaylistItem (No path needed, handles automatically)
const artwork = await fb2k.invoke('artwork.getByPlaylistItem', {
    playlist: 0,
    index: 0,
    type: 'front'
});

// ========== Batch Get Artwork ==========
async function loadCoversForTracks(tracks) {
    const covers = {};
    
    // Parallel requests (Control concurrency)
    const batchSize = 5;
    for (let i = 0; i < tracks.length; i += batchSize) {
        const batch = tracks.slice(i, i + batchSize);
        const promises = batch.map(async track => {
            const art = await fb2k.invoke('artwork.getForTrack', {
                path: track.absolutePath
            });
            return { index: track.index, artwork: art };
        });
        
        const results = await Promise.all(promises);
        results.forEach(r => covers[r.index] = r.artwork);
    }
    
    return covers;
}
```

</section>

<!-- ==================== BRIDGE PROTOCOL ==================== -->
<section id="bridge-protocol">

## Bridge Protocol

### Request Format

```json
{
    "id": 1,
    "method": "playback.play",
    "params": {}
}
```

### Response Format

```json
{
    "type": "response",
    "id": 1,
    "result": { "success": true }
}
```

### Error Response

```json
{
    "type": "response",
    "id": 1,
    "error": "Invalid playlist index"
}
```

### Event Format

```json
{
    "type": "event",
    "event": "playback:trackChanged",
    "data": {
        "title": "Song Name",
        "artist": "Artist Name",
        "album": "Album Name",
        "duration": 180.5
    }
}
```

</section>

<!-- ==================== PLAYBACK CONTROL ==================== -->
<section id="playback-control">

## Playback API - Control

### playback.play

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.play</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Start playback. Resumes if paused, starts from beginning if stopped.</div>

**Parameters**: None

**Returns**:
```json
{ "success": true }
```

**Example**:
```javascript
await fb2k.invoke('playback.play');
```
</div>
</div>

### playback.pause

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.pause</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Pause playback.</div>

**Parameters**: None

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playback.stop

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.stop</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Stop playback.</div>

**Parameters**: None

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playback.playOrPause

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.playOrPause</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Toggle playback/pause state.</div>

**Parameters**: None

**Returns**:
```json
{ "success": true }
```

**Alias**: `playback.playPause`
    </div>
</div>

### playback.next

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.next</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Play next track.</div>

**Parameters**: None

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playback.previous

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.previous</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Play previous track.</div>

**Parameters**: None

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playback.random

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.random</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Play a random track.</div>

**Parameters**: None

**Returns**:
```json
{ "success": true }
```
</div>
</div>

</section>

<!-- ==================== PLAYBACK STATE ==================== -->
<section id="playback-state">

## Playback API - State Query

### playback.getState

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getState</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current playback state.</div>

**Returns**:
```json
{
    "state": "playing",
    "canSeek": true,
    "canPause": true
}
```

| Field | Type | Description |
|---|---|---|
| `state` | string | Playback state: `"stopped"` / `"playing"` / `"paused"` |
| `canSeek` | boolean | Can seek? |
| `canPause` | boolean | Can pause? |

> **Note**: For volume info use `playback.getVolume`, for position use `playback.getPosition`.
    </div>
</div>

### playback.getCurrentTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getCurrentTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current playing track information.</div>

**Returns**:
```json
{
    "title": "Song Title",
    "artist": "Artist Name",
    "album": "Album Name",
    "albumArtist": "Album Artist",
    "genre": "Genre",
    "date": "2024",
    "trackNumber": 1,
    "discNumber": 1,
    "duration": 180.5,
    "path": "C:/Music/song.flac",
    "fileSize": 35000000,
    "bitrate": 1411,
    "sampleRate": 44100,
    "channels": 2,
    "codec": "FLAC"
}
```
</div>
</div>

### playback.getPosition

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getPosition</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current playback position.</div>

**Returns**:
```json
{
    "position": 45.3,
    "duration": 180.5
}
```
</div>
</div>

### playback.setPosition

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playback.setPosition</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set playback position (Seek).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `position` | number | ‚úì | Target position (seconds), `seconds` alias also supported |

**Example**:
```javascript
await fb2k.invoke('playback.setPosition', { position: 60 }); // Seek to 1 minute
// OR
await fb2k.invoke('playback.setPosition', { seconds: 60 }); // Also valid
```
</div>
</div>

</section>

<!-- ==================== PLAYBACK VOLUME ==================== -->
<section id="playback-volume">

## Playback API - Volume Control

### playback.getVolume

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getVolume</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current volume.</div>

**Returns**:
```json
{
    "volume": 80,
    "volumeDb": -20.0,
    "muted": false
}
```

| Field | Type | Description |
|---|---|---|
| `volume` | number | Volume percentage (0-100, 100 is max) |
| `volumeDb` | number | Volume dB value (-100 to 0, 0 is max) |
| `muted` | boolean | Is muted? |

> **Note**: `volume` is linear percentage, `volumeDb` is dB value. Recommended to use `volume` for UI display.
    </div>
</div>

### playback.setVolume

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playback.setVolume</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set volume.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `volume` | number | ‚úì | Volume percentage (0-100, 100 is max) |

**Example**:
```javascript
await fb2k.invoke('playback.setVolume', { volume: 80 }); // Set to 80% (approx -20 dB)
await fb2k.invoke('playback.setVolume', { volume: 50 }); // Set to 50% (-50 dB)
await fb2k.invoke('playback.setVolume', { volume: 100 }); // Max volume (0 dB)
```

> **Conversion Formula**: `dB = volume - 100`, i.e., `volume: 80` corresponds to `-20 dB`
    </div>
</div>

### playback.mute

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.mute</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set mute state.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `muted` | boolean | ‚úó | Is muted (default true) |

**Returns**:
```json
{ "success": true }
```

**Example**:
```javascript
await fb2k.invoke('playback.mute', { muted: true });  // Mute
await fb2k.invoke('playback.mute', { muted: false }); // Unmute
await fb2k.invoke('playback.mute'); // Mute (default muted=true)
```
</div>
</div>

### playback.toggleMute

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.toggleMute</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Toggle mute state.</div>

**Returns**:
```json
{ "success": true, "muted": true }
```

| Field | Type | Description |
|---|---|---|
| `success` | boolean | Operation success |
| `muted` | boolean | Mute state after toggle |
    </div>
</div>

</section>

<!-- ==================== PLAYBACK ORDER ==================== -->
<section id="playback-order">

## Playback API - Playback Order

### playback.getPlaybackOrder

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getPlaybackOrder</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current playback order mode.</div>

**Returns**:
```json
{
    "order": 0,
    "orderName": "Default"
}
```

| Order Value | Name | Description |
|---|---|---|
| 0 | Default | Default order |
| 1 | Repeat (playlist) | Repeat playlist |
| 2 | Repeat (track) | Repeat track |
| 3 | Random | Random play |
| 4 | Shuffle (tracks) | Shuffle tracks |
| 5 | Shuffle (albums) | Shuffle albums |
| 6 | Shuffle (folders) | Shuffle folders |
    </div>
</div>

### playback.setPlaybackOrder

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playback.setPlaybackOrder</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set playback order mode.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `order` | number | ‚úì | Order mode (0-6) |

**Example**:
```javascript
await fb2k.invoke('playback.setPlaybackOrder', { order: 3 }); // Set to Random
```
</div>
</div>

### playback.getStopAfterCurrent / setStopAfterCurrent

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getStopAfterCurrent</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get/Set "Stop after current track" state.</div>

**Returns**:
```json
{ "stopAfterCurrent": false }
```

**Set**:
```javascript
await fb2k.invoke('playback.setStopAfterCurrent', { enabled: true });
```
</div>
</div>

### playback.toggleStopAfterCurrent

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.toggleStopAfterCurrent</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Toggle "Stop after current track" state.</div>

**Returns**:
```json
{ "enabled": true }
```
</div>
</div>

### playback.getCurrentTrackIndex üÜï

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getCurrentTrackIndex</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get the index of the current playing track in the playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| includeTrackInfo | boolean | - | Whether to include track details (default false) |

**Returns**:
```json
{
    "found": true,
    "playlist": 0,
    "index": 15,
    "track": { ... }  // Only when includeTrackInfo=true
}
```

**Example**:
```javascript
const pos = await fb2k.invoke('playback.getCurrentTrackIndex');
if (pos.found) {
    console.log(`Playing track ${pos.index} in playlist ${pos.playlist}`);
}

// With track info
const posWithTrack = await fb2k.invoke('playback.getCurrentTrackIndex', { 
    includeTrackInfo: true 
});
```
</div>
</div>

### playback.getPlayingPlaylist üÜï

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getPlayingPlaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get information about the currently playing playlist.</div>

**Returns**:
```json
{
    "found": true,
    "playlist": 0,
    "name": "Default"
}
```

**Example**:
```javascript
const playing = await fb2k.invoke('playback.getPlayingPlaylist');
if (playing.found) {
    console.log(`Playing from "${playing.name}"`);
}
```
</div>
</div>

### playback.playPause

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.playPause</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Toggle playback/pause state. Similar to playOrPause, but does NOT start playback if stopped.</div>

**Returns**: `{}`
    </div>
</div>

### playback.playPath

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.playPath</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Play a file directly by path. Supports CUE/multi-subsong files via syntax.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Audio file path. Supports `\|subsong:N` syntax (0-based) |

**Returns**:
```json
{ "success": true, "tracksAdded": 1, "path": "...", "subsong": 2 }
```

**Example**:
```javascript
// Normal file
await fb2k.invoke('playback.playPath', {
    path: 'D:\\Music\\song.mp3'
});

// üÜï CUE specific track (3rd track, index 2)
await fb2k.invoke('playback.playPath', {
    path: 'D:\\Music\\album.flac|subsong:2'
});
```

> **Note**: subsong index is 0-based. If `trackNumber` from `playlist.getTracks` is 1-based, subtract 1.
</div>
</div>

### playback.playPaths

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.playPaths</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Play multiple file paths. Supports CUE/multi-subsong files.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| paths | string[] | ‚úÖ | Array of audio paths. Support `\|subsong:N` format |
| startIndex | number | - | Index to start playing from (default 0) |

**Returns**:
```json
{ "success": true, "tracksAdded": 5, "startedAt": 0 }
```

**Example**:
```javascript
// Play multiple files
await fb2k.invoke('playback.playPaths', {
    paths: ['D:\\Music\\song1.mp3', 'D:\\Music\\song2.mp3'],
    startIndex: 0
});

// üÜï CUE multi-track
await fb2k.invoke('playback.playPaths', {
    paths: [
        'D:\\Music\\album.flac|subsong:0',
        'D:\\Music\\album.flac|subsong:1',
        'D:\\Music\\album.flac|subsong:2'
    ],
    startIndex: 1  // Start from 2nd track
});
```
</div>
</div>

</section>

---

<!-- ==================== PLAYLIST MANAGEMENT ==================== -->
<section id="playlist-management">

## Playlist API - Playlist Management

### playlist.getCount

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getCount</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get total number of playlists.</div>

**Returns**:
```json
{ "count": 5 }
```
</div>
</div>

### playlist.getAll

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getAll</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get information of all playlists. Returns an array of playlists.</div>

**Returns**:
```json
[
    {
        "index": 0,
        "name": "Default",
        "trackCount": 150,
        "isActive": true,
        "isPlaying": true,
        "duration": 36000.5,
        "isLocked": false
    },
    {
        "index": 1,
        "name": "Favorites",
        "trackCount": 50,
        "isActive": false,
        "isPlaying": false,
        "duration": 12000.0,
        "isLocked": false
    }
]
```
</div>
</div>

### playlist.getActive

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getActive</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get the currently active playlist.</div>

**Returns**:
```json
{
    "index": 0,
    "name": "Default",
    "trackCount": 150
}
```
</div>
</div>

### playlist.setActive

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playlist.setActive</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set the active playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `index` | number | ‚úì | Playlist index |

**Example**:
```javascript
await fb2k.invoke('playlist.setActive', { index: 1 });
```
</div>
</div>

### playlist.getPlaying

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getPlaying</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get the currently playing playlist.</div>

**Returns**:
```json
{
    "index": 0,
    "name": "Default",
    "trackCount": 150
}
```
</div>
</div>

### playlist.create

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.create</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Create a new playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `name` | string | ‚úó | Playlist name (default "New Playlist") |

**Returns**:
```json
{
    "success": true,
    "index": 2,
    "name": "My Playlist"
}
```

**Example**:
```javascript
const result = await fb2k.invoke('playlist.create', { name: 'Rock Music' });
console.log('Created success, index:', result.index);
```
</div>
</div>

### playlist.remove

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.remove</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Remove a playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index (default active) |

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playlist.rename

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playlist.rename</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Rename a playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |
| `name` | string | ‚úì | New name |

**Example**:
```javascript
await fb2k.invoke('playlist.rename', { playlist: 0, name: 'My Favorites' });
```
</div>
</div>

### playlist.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Clear all tracks from a playlist. üÜï v1.1.2 Enhanced return value</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |

**Returns**:
```json
{
    "success": true,
    "playlist": 0,
    "clearedCount": 22,     // Track count before clear
    "remainingCount": 0     // Should be 0 (for verification)
}
```
</div>
</div>

### playlist.duplicate

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.duplicate</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Duplicate a playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Source playlist index |
| `name` | string | ‚úó | New playlist name |

**Returns**:
```json
{
    "success": true,
    "sourcePlaylist": 0,
    "newPlaylist": 1,
    "name": "Default (Copy)",
    "trackCount": 150
}
```
</div>
</div>

</section>

<!-- ==================== PLAYLIST TRACKS ==================== -->
<section id="playlist-tracks">

## Playlist API - Track Operations

> **Parameter Compatibility**: All Playlist APIs support both `playlist` and `playlistIndex` parameter names.

### playlist.getTrackCount

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getTrackCount</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get number of tracks in a playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index (Alias: `playlistIndex`) |

**Returns**:
```json
{
    "playlist": 0,
    "count": 150
}
```
</div>
</div>

### playlist.getTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get tracks from a playlist (Pagination). Returns both <code>items</code> (deprecated?) and <code>tracks</code> fields.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index (Alias: `playlistIndex`) |
| `start` | number | ‚úó | Start index (default 0) |
| `count` | number | ‚úó | Count to retrieve (default 50) |

**Returns**:
```json
{
    "playlist": 0,
    "start": 0,
    "count": 20,
    "total": 150,
    "items": [...],
    "tracks": [
        {
            "index": 0,
            "title": "Song 1",
            "artist": "Artist 1",
            "album": "Album 1",
            "duration": 180.5,
            "path": "file://C:/Music/song1.flac",
            "absolutePath": "C:\\Music\\song1.flac"
        }
    ]
}
```

> üí° **Tip**: `absolutePath` is the local filesystem path, usable for `artwork.getForTrack`. `path` is foobar2000 internal format.

**Example**:
```javascript
// Get first 20 tracks
const page1 = await fb2k.invoke('playlist.getTracks', { start: 0, count: 20 });

// Get tracks 21-40
const page2 = await fb2k.invoke('playlist.getTracks', { start: 20, count: 20 });
```
</div>
</div>

### playlist.playTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.playTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Play a specific track in a playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |
| `track` | number | ‚úì | Track index |

**Example**:
```javascript
await fb2k.invoke('playlist.playTrack', { playlist: 0, track: 5 });
```
</div>
</div>

### playlist.removeTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.removeTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Remove specific tracks from a playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `index` | number | ‚úó | Playlist index |
| `items` | number[] | ‚úì | Array of track indices to remove |

**Example**:
```javascript
await fb2k.invoke('playlist.removeTracks', { items: [0, 5, 10] });
```
</div>
</div>

### playlist.moveTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.moveTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Move selected tracks (up or down).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `index` | number | ‚úó | Playlist index |
| `items` | number[] | ‚úì | Array of track indices to move |
| `delta` | number | ‚úì | Move offset (positive = down, negative = up) |

**Example**:
```javascript
// Move tracks 0, 1, 2 down by 3 positions
await fb2k.invoke('playlist.moveTracks', { items: [0, 1, 2], delta: 3 });

// Move tracks 5, 6 up by 2 positions
await fb2k.invoke('playlist.moveTracks', { items: [5, 6], delta: -2 });
```
</div>
</div>

### playlist.addPaths

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.addPaths</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Add files/folders to playlist. üÜï v1.1.2 Enhanced return value</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |
| `paths` | string[] | ‚úì | Array of file/folder paths |

**Returns**:
```json
{
    "success": true,
    "playlist": 0,
    "requestedPaths": 25,    // Count of requested paths
    "addedCount": 25,        // Actual added count
    "countBefore": 0,        // Count before add
    "totalCount": 25         // Count after add
}
```

**Example**:
```javascript
await fb2k.invoke('playlist.addPaths', {
    paths: ['C:/Music/album1', 'C:/Music/song.mp3']
});
```
</div>
</div>

### playlist.addHandles üÜï

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.addHandles</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">üÜï v1.1.5 New. Precisely add tracks to playlist, without auto-expanding CUE/subsongs. Each handle corresponds strictly to one track. Difference from addPaths: addPaths auto-expands CUE files, addHandles adds only specified tracks.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index (default active) |
| `handles` | array | ‚úì | Array of handles (object or string format) |

**Handle Array Format**:
```javascript
// Object format - Recommended
{ path: "D:/music/album.cue", subsong: 0 }   // CUE file itself
{ path: "D:/music/album.cue", subsong: 1 }   // CUE Track 1
{ path: "D:/music/song.mp3" }                 // Normal file, default subsong 0

// String format - Supports |subsong:N suffix
"D:/music/album.cue|subsong:0"
"D:/music/album.cue|subsong:1"
"D:/music/song.mp3"
```

**Returns**:
```json
{
    "success": true,
    "playlist": 0,
    "requestedCount": 22,    // Requested handle count
    "addedCount": 22,        // Actual added count
    "invalidCount": 0,       // Invalid handle count
    "countBefore": 0,        // Count before add
    "totalCount": 22         // Count after add
}
```

**Example**:
```javascript
// Object format - Precise subsong control
await fb2k.invoke('playlist.addHandles', {
    playlist: 0,
    handles: [
        { path: 'D:/Music/album.cue', subsong: 0 },  // CUE itself
        { path: 'D:/Music/album.cue', subsong: 1 },  // Track 1
        { path: 'D:/Music/album.cue', subsong: 2 },  // Track 2
        { path: 'D:/Music/song.mp3' }                 // File
    ]
});

// String format - Use |subsong:N suffix
await fb2k.invoke('playlist.addHandles', {
    handles: [
        'D:/Music/album.cue|subsong:1',
        'D:/Music/album.cue|subsong:2',
        'D:/Music/song.flac'
    ]
});
```

**Use Cases**:
- Precise control over which tracks to add, avoiding CUE auto-expansion
- Frontend already knows specific subsong index
- Selectively adding from multi-track files (CUE, multi-track APE/FLAC)
</div>
</div>

### playlist.replaceAllAndPlay üÜï

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.replaceAllAndPlay</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">üÜï v1.1.2 New. Atomic operation: Clear playlist + Add paths + Play specified track. Solves timing issues of clear ‚Üí addPaths ‚Üí playTrack.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |
| `paths` | string[] | ‚úì | Array of file/URL paths |
| `playIndex` | number | ‚úó | Index to play (default 0) |
| `stopFirst` | boolean | ‚úó | Stop playback first (default true) |

**Returns**:
```json
{
    "success": true,
    "playlist": 0,
    "clearedCount": 10,      // Cleared count
    "addedCount": 22,        // Added count
    "totalCount": 22,        // Total count
    "playIndex": 19          // Actual playing index
}
```

**Example**:
```javascript
// Replace playlist content and play 19th track
const result = await fb2k.invoke('playlist.replaceAllAndPlay', {
    playlist: 0,
    paths: [
        'E:/Music/song1.flac',
        'E:/Music/song2.flac',
        'https://stream.example.com/audio.mp3'
    ],
    playIndex: 19,
    stopFirst: true
});

console.log(`Cleared ${result.clearedCount}, Added ${result.addedCount}`);
```

**Use Cases**:
- Load new playlist and play immediately
- Avoid unexpected `stateChanged` events from `playback.stop`
- Ensure playlist index correctly matches track
</div>
</div>

### playlist.sort

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.sort</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Sort playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `index` | number | ‚úó | Playlist index |
| `pattern` | string | ‚úó | Sort pattern (default "%title%") |
| `descending` | boolean | ‚úó | Sort descending |
| `selectedOnly` | boolean | ‚úó | Sort selected only |

**Example**:
```javascript
// Sort by artist
await fb2k.invoke('playlist.sort', { pattern: '%artist%' });

// Sort by date descending
await fb2k.invoke('playlist.sort', { pattern: '%date%', descending: true });
```
</div>
</div>

### playlist.shuffle

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.shuffle</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Shuffle playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playlist.undo / playlist.redo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.undo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Undo/Redo playlist operations.</div>

**Returns**:
```json
{ "success": true }
```
</div>
</div>

</section>

<!-- ==================== PLAYLIST AUTOPLAYLIST ==================== -->
<section id="playlist-autoplaylist">

## Playlist API - Smart Playlists

> Autoplaylists automatically populate tracks from the library based on query conditions.

### playlist.isAutoplaylist

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.isAutoplaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Check if a playlist is an autoplaylist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |

**Returns**:
```json
{
    "playlist": 0,
    "isAutoplaylist": true
}
```
</div>
</div>

### playlist.createAutoplaylist

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.createAutoplaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Create an autoplaylist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `name` | string | ‚úó | Playlist name |
| `query` | string | ‚úì | Query condition (foobar2000 query syntax) |
| `sort` | string | ‚úó | Sort pattern |
| `keepSorted` | boolean | ‚úó | Keep sorted (prevent manual reorder) |

**Returns**:
```json
{
    "success": true,
    "playlist": 2,
    "name": "Recent Additions",
    "query": "%added% DURING LAST 2 WEEKS"
}
```

**Query Examples**:
```javascript
// Recently added
await fb2k.invoke('playlist.createAutoplaylist', {
    name: 'Recent',
    query: '%added% DURING LAST 2 WEEKS',
    sort: '%added%',
    keepSorted: true
});

// Top rated
await fb2k.invoke('playlist.createAutoplaylist', {
    name: 'Top Rated',
    query: '%rating% GREATER 3'
});

// Specific artist
await fb2k.invoke('playlist.createAutoplaylist', {
    name: 'Beatles',
    query: 'artist HAS beatles'
});

// Specific genre
await fb2k.invoke('playlist.createAutoplaylist', {
    name: 'Jazz',
    query: 'genre IS jazz'
});
```
</div>
</div>

### playlist.convertToAutoplaylist

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.convertToAutoplaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Convert a normal playlist to an autoplaylist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |
| `query` | string | ‚úì | Query condition |
| `sort` | string | ‚úó | Sort pattern |
| `keepSorted` | boolean | ‚úó | Keep sorted |

**Returns**:
```json
{
    "success": true,
    "playlist": 0
}
```
</div>
</div>

### playlist.removeAutoplaylist

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.removeAutoplaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Remove autoplaylist properties (convert back to normal).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |

**Returns**:
```json
{
    "success": true,
    "playlist": 0
}
```
</div>
</div>

### playlist.getAutoplaylistInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getAutoplaylistInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get autoplaylist details.</div>

**Returns**:
```json
{
    "isAutoplaylist": true,
    "playlist": 0,
    "keepSorted": true
}
```
</div>
</div>

</section>

<!-- ==================== PLAYLIST SELECTION ==================== -->
<section id="playlist-selection">

## Playlist API - Selection

### playlist.getSelectedTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getSelectedTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get selected tracks.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |

**Returns**:
```json
{
    "playlist": 0,
    "selectedIndices": [0, 5, 10],
    "tracks": [
        { "index": 0, "title": "Song 1", ... },
        { "index": 5, "title": "Song 6", ... }
    ]
}
```
</div>
</div>

### playlist.setSelection

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playlist.setSelection</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set selected tracks.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |
| `indices` | number[] | ‚úì | Array of track indices to select |

**Example**:
```javascript
await fb2k.invoke('playlist.setSelection', { indices: [0, 1, 2, 3, 4] });
```
</div>
</div>

### playlist.removeSelectedTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.removeSelectedTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Remove selected tracks.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index |

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playlist.focusTrack / playlist.getFocusTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getFocusTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get/Set focus track (cursor position).</div>

**Get Returns**:
```json
{
    "playlist": 0,
    "focusIndex": 5,
    "track": { "title": "Song 6", ... }
}
```

**Set**:
```javascript
await fb2k.invoke('playlist.focusTrack', { playlist: 0, track: 10 });
```
</div>
</div>

### playlist.getLockInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getLockInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get playlist lock status.</div>

**Returns**:
```json
{
    "playlist": 0,
    "isLocked": false
}
```
</div>
</div>

### playlist.isLocked

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.isLocked</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Check if playlist is locked.</div>

**Returns**:
```json
{ "isLocked": false }
```
</div>
</div>

### playlist.getSelection

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getSelection</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get selected track indices.</div>

**Returns**:
```json
{
    "items": [0, 5, 10],
    "count": 3,
    "playlist": 0
}
```
</div>
</div>

### playlist.selectAll

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.selectAll</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Select all tracks in playlist.</div>

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playlist.deselectAll

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.deselectAll</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Deselect all tracks in playlist.</div>

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playlist.getFocusedTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getFocusedTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get focus track index.</div>

**Returns**:
```json
{
    "playlist": 0,
    "index": 5
}
```
</div>
</div>

### playlist.setFocusedTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.setFocusedTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set focus track.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| index | number | ‚úÖ | Track index |

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playlist.reverse

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.reverse</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Reverse playlist order.</div>

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playlist.redo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.redo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Redo playlist operation.</div>

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### playlist.getAutoplaylistQuery

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getAutoplaylistQuery</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get autoplaylist query.</div>

**Returns**:
```json
{
    "isAutoplaylist": true,
    "playlist": 0,
    "query": null,
    "keepSorted": true,
    "note": "Query string not exposed by SDK"
}
```
</div>
</div>

</section>

<!-- ==================== LIBRARY BROWSE ==================== -->
<section id="library-browse">

## Library API - Browse

### library.isEnabled

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.isEnabled</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Check if library is enabled.</div>

**Returns**:
```json
{ "enabled": true }
```
</div>
</div>

### library.getStats

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getStats</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get library statistics.</div>

**Returns**:
```json
{
    "totalTracks": 15000,
    "totalAlbums": 500,
    "totalArtists": 200,
    "totalDuration": 3600000,
    "totalSize": 150000000000,
    "cacheValid": true,
    "lastModified": 1736064000000
}
```

> üÜï Added `cacheValid` and `lastModified` fields for cache status check.
</div>
</div>

### library.getAlbums

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getAlbums</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get list of albums in library. Supports returning cover data directly to avoid extra requests.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `query` | string | ‚úó | Filter keyword (album name or artist) |
| `sort` | string | ‚úó | Sort mode: `name`, `artist`, `year`, `trackCount` |
| `offset` | number | ‚úó | Start offset (default 0) |
| `limit` | number | ‚úó | Max return count (default 100) |
| `includeTracks` | boolean | ‚úó | Include track list |
| `includeCover` | boolean | ‚úó | üÜï Directly return cover dataUrl (avoid extra requests) |
| `coverMaxSize` | number | ‚úó | üÜï Max cover size KB (default 500, 0=unlimited) |
| `useCache` | boolean | ‚úó | üÜï Use cache (default true) |

**Returns**:
```json
{
    "total": 500,
    "offset": 0,
    "limit": 100,
    "hasMore": true,
    "includeCover": true,
    "albums": [
        {
            "name": "Abbey Road",
            "artist": "The Beatles",
            "albumArtist": "The Beatles",
            "trackCount": 17,
            "discCount": 1,
            "duration": 2800,
            "year": "1969",
            "genre": "Rock",
            "label": "Apple Records",
            "firstTrackPath": "file://C:/Music/Beatles/01.flac",
            "firstTrackAbsolutePath": "C:\\Music\\Beatles\\01.flac",
            "coverDataUrl": "data:image/jpeg;base64,/9j/4AAQ...",
            "tracks": [...]
        }
    ]
}
```

> üí° **Optimization**: Use `includeCover: true` to fetch all album covers at once, avoiding individual `artwork.getForTrack` calls, significantly improving load speed.
    </div>
</div>

### library.getAlbumTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getAlbumTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get tracks for a specific album. Returned tracks include <code>absolutePath</code> field.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `album` | string | ‚úì | Album name |
| `artist` | string | ‚úó | Album artist (distinguish same-name albums) |

**Returns**:
```json
[
    {
        "index": 0,
        "title": "Come Together",
        "artist": "The Beatles",
        "trackNumber": 1,
        "path": "file://C:/Music/Beatles/01.flac",
        "absolutePath": "C:\\Music\\Beatles\\01.flac"
    }
]
```
</div>
</div>

### library.getArtists

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getArtists</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get list of artists in library. Returns artist array.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `sort` | string | ‚úó | Sort mode: `name`, `trackCount`, `albumCount` |
| `limit` | number | ‚úó | Max return count (default 1000) |

**Returns**:
```json
[
    { 
        "name": "The Beatles", 
        "albumCount": 13, 
        "trackCount": 200,
        "totalDuration": 28800.5
    },
    { 
        "name": "Pink Floyd", 
        "albumCount": 15, 
        "trackCount": 180,
        "totalDuration": 32400.0
    }
]
```
</div>
</div>

### library.getGenres

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getGenres</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get list of genres in library.</div>

**Returns**:
```json
{
    "success": true,
    "genres": [
        { "name": "Rock", "trackCount": 5000 },
        { "name": "Jazz", "trackCount": 2000 }
    ]
}
```

> **Note**: Returned genres include `name` and `trackCount` fields.
    </div>
</div>

### library.getRandomTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getRandomTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get random tracks from library.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `count` | number | ‚úó | Track count (default 10) |

**Returns**:
```json
{
    "tracks": [
        { "title": "Random Song 1", ... }
    ]
}
```
</div>
</div>

### library.addToPlaylist

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">library.addToPlaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Add library tracks to playlist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `paths` | string[] | ‚úì | Track path array |
| `playlist` | number | ‚úó | Target playlist |

**Returns**:
```json
{
    "success": true,
    "addedCount": 10
}
```
</div>
</div>

### library.rescan

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">library.rescan</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Rescan library.</div>

**Returns**:
```json
{ "success": true }
```
</div>
</div>

</section>

<!-- ==================== LIBRARY SEARCH ==================== -->
<section id="library-search">

## Library API - Search

### library.search

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.search</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Search tracks in library.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `query` | string | ‚úì | Search keyword or query expression |
| `offset` | number | ‚úó | Start offset (default 0), alias: `start` |
| `limit` | number | ‚úó | Max results (default 100), alias: `count` |

**Returns**:
```json
{
    "total": 150,
    "offset": 0,
    "limit": 100,
    "hasMore": true,
    "items": [...],
    "tracks": [
        {
            "index": 0,
            "title": "Let It Be",
            "artist": "The Beatles",
            "album": "Let It Be",
            "path": "file://C:/Music/Beatles/let_it_be.flac",
            "absolutePath": "C:\\Music\\Beatles\\let_it_be.flac",
            "duration": 243.5,
            "bitrate": 1411,
            "sampleRate": 44100
        }
    ]
}
```

> üí° **Tip**: `absolutePath` can be used for `artwork.getForTrack` to get cover.

**Search Query Examples**:
```javascript
// Simple search (search in title, artist, album)
await fb2k.invoke('library.search', { query: 'love' });

// Exact field search
await fb2k.invoke('library.search', { query: 'artist HAS beatles' });

// Combined query
await fb2k.invoke('library.search', { query: 'artist HAS beatles AND year GREATER 1968' });

// Genre search
await fb2k.invoke('library.search', { query: 'genre IS rock' });
```
</div>
</div>

### library.getByPath

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getByPath</span>
        <span class="badge badge-green">v1.1.0 New</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Search track in library by file path.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `path` | string | ‚úì | File path (full or partial) |

**Returns** (Found):
```json
{
    "found": true,
    "path": "D:\\Music\\Album\\song.mp3",
    "track": {
        "index": 0,
        "title": "Song Title",
        "artist": "Artist Name",
        "album": "Album Name",
        "path": "file://D:/Music/Album/song.mp3",
        "absolutePath": "D:\\Music\\Album\\song.mp3",
        "duration": 243.5
    }
}
```

**Returns** (Not Found):
```json
{
    "found": false,
    "path": "D:\\Music\\notfound.mp3",
    "track": null
}
```

**Example**:
```javascript
// Search by full path
const result = await fb2k.invoke('library.getByPath', {
    path: 'D:\\Music\\Album\\song.mp3'
});

if (result.found) {
    console.log(`Found track: ${result.track.title}`);
    // Use for artwork
    const artwork = await fb2k.invoke('artwork.getForTrack', {
        path: result.track.absolutePath
    });
}
```
</div>
</div>

### library.getCount

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getCount</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get total track count in library.</div>

**Returns**:
```json
{ "count": 15000 }
```
</div>
</div>

### library.getAll

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getAll</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get all tracks in library (pagination & caching supported).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| offset | number | - | Start offset |
| limit | number | - | Max return count |
| useCache | boolean | - | üÜï Use cache (default true) |

**Returns**:
```json
{
    "items": [...],
    "total": 15000,
    "offset": 0,
    "limit": 100
}
```
</div>
</div>

### library.getStatus

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getStatus</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get library status.</div>

**Returns**:
```json
{
    "enabled": true,
    "scanning": false,
    "totalTracks": 15000
}
```
</div>
</div>

### library.query

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.query</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Search library using foobar2000 query syntax.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| query | string | ‚úÖ | Query string, e.g. `%artist% HAS rock` |
| offset | number | - | Start offset |
| limit | number | - | Max return count |

**Example**:
```javascript
const result = await fb2k.invoke('library.query', {
    query: '%artist% HAS Beatles',
    limit: 50
});
```
</div>
</div>

### library.refresh

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">library.refresh</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Refresh library (rescan).</div>

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### library.browseDirectory

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.browseDirectory</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Browse library directory structure.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | - | Directory path, or empty for root |

**Returns**:
```json
{
    "path": "D:\\Music",
    "directories": ["Album1", "Album2"],
    "files": ["song1.mp3", "song2.flac"]
}
```
</div>
</div>

### library.getRecentlyAdded

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getRecentlyAdded</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get recently added tracks.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| limit | number | - | Return count, default 50 |

**Returns**:
```json
{
    "items": [...],
    "count": 50
}
```
</div>
</div>

### library.getArtistTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getArtistTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get all tracks for specific artist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| artist | string | ‚úÖ | Artist name |

**Returns**:
```json
{
    "artist": "The Beatles",
    "items": [...],
    "count": 200
}
```
</div>
</div>

### library.getArtistAlbums

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getArtistAlbums</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get all albums for specific artist.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| artist | string | ‚úÖ | Artist name |

**Returns**:
```json
{
    "artist": "The Beatles",
    "items": [
        { "name": "Abbey Road", "trackCount": 17, "year": 1969 }
    ],
    "count": 13
}
```
</div>
</div>

</section>

---

<!-- ==================== LIBRARY CACHE ==================== -->
<section id="library-cache">

## Library API - Cache Control üÜï

> **Auto Invalidation**: Cache automatically invalidates when library changes (add/remove/modify tracks).
> **Cover Cache**: Max 100MB, auto-purges oldest entries when exceeded.

### library.invalidateCache

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">library.invalidateCache</span>
        <span class="badge badge-green">v1.1.3 New</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Manually invalidate library cache. Usually not needed as cache auto-invalidates on library changes.</div>

**Returns**:
```json
{
    "success": true,
    "timestamp": 1736064000000
}
```

**Use Cases**:
```javascript
// Force refresh data (e.g. user manually requests refresh)
await fb2k.invoke('library.invalidateCache');

// Then refetch data (will read from library again)
const albums = await fb2k.invoke('library.getAlbums', { useCache: true });
```
</div>
</div>

### library.getCacheStats

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getCacheStats</span>
        <span class="badge badge-green">v1.1.3 New</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get cache statistics for debugging and performance analysis.</div>

**Returns**:
```json
{
    "albumsCacheValid": true,
    "tracksCacheValid": true,
    "albumsCacheSize": 500,
    "tracksCacheSize": 15000,
    "coverCacheSize": 52428800,
    "coverCacheCount": 250,
    "cacheHits": 42,
    "cacheMisses": 3,
    "lastModified": 1736064000000
}
```

| Field | Type | Description |
|---|---|---|
| `albumsCacheValid` | boolean | Is album cache valid |
| `tracksCacheValid` | boolean | Is track cache valid |
| `albumsCacheSize` | number | Cached album count |
| `tracksCacheSize` | number | Cached track count |
| `coverCacheSize` | number | Cover cache size (bytes) |
| `coverCacheCount` | number | Cached cover count |
| `cacheHits` | number | Cache hit count |
| `cacheMisses` | number | Cache miss count |
| `lastModified` | number | Last modified timestamp |
</div>
</div>

</section>

<!-- ==================== ARTWORK API ==================== -->
<section id="artwork-api">

## Artwork API - Album Art

> **Alias Support**: The following APIs can also be called using the `albumArt.*` namespace:
> - `albumArt.getCurrent` ‚Üí `artwork.getCurrent`
> - `albumArt.getByPath` ‚Üí `artwork.getByPath`
> - `albumArt.getAvailableTypes` ‚Üí `artwork.getAvailableTypes`

### artwork.getCurrent

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getCurrent</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get album art for the currently playing track. Tries multiple methods:<br>
        1. now_playing_album_art_notify_manager (fastest, cached)<br>
        2. album_art_manager_v2 (comprehensive)<br>
        3. album_art_extractor (direct extraction)</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `type` | string | ‚úó | Art type: `front`, `back`, `disc`, `artist`, `icon` (default `front`) |

**Returns** (Success):
```json
{
    "found": true,
    "available": true,
    "type": "front",
    "source": "now_playing_manager",
    "mimeType": "image/jpeg",
    "size": 123456,
    "data": "base64...",
    "dataUrl": "data:image/jpeg;base64,/9j/4AAQ..."
}
```

**Returns** (Failure):
```json
{
    "found": false,
    "available": false,
    "type": "front",
    "reason": "no_track"
}
```

| Field | Type | Description |
|---|---|---|
| `found` | boolean | Found? (Legacy field) |
| `available` | boolean | Found? (Standardized field, v1.1.0 new) |
| `type` | string | Requested art type |
| `source` | string | Source: `now_playing_manager`, `album_art_manager_v2`, `extractor` |
| `reason` | string | Reason: `no_track` (not playing), `not_found` (no art) |
| `mimeType` | string | MIME type (e.g., `image/jpeg`, `image/png`) |
| `size` | number | Data size (bytes) |
| `data` | string | Base64 encoded image data |
| `dataUrl` | string | Data URL for `<img src>` |

**Example**:
```javascript
const artwork = await fb2k.invoke('artwork.getCurrent');
if (artwork.found) {
    document.getElementById('cover').src = artwork.dataUrl;
    console.log('Artwork source:', artwork.source);
} else {
    console.log('No artwork:', artwork.reason);
}

// Get back cover
const backArt = await fb2k.invoke('artwork.getCurrent', { type: 'back' });
```
</div>
</div>

### artwork.getByPath

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getByPath</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get artwork by file path. Uses <code>album_art_extractor</code> for direct extraction.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `path` | string | ‚úì | Absolute audio file path |
| `type` | string | ‚úó | Art type (default `front`) |

**Returns**:
```json
{
    "found": true,
    "type": "front",
    "path": "C:/Music/song.flac",
    "mimeType": "image/jpeg",
    "size": 123456,
    "data": "base64...",
    "dataUrl": "data:image/jpeg;base64,..."
}
```

**Example**:
```javascript
const artwork = await fb2k.invoke('artwork.getByPath', {
    path: 'C:/Music/album/track01.flac',
    type: 'front'
});
```
</div>
</div>

### artwork.getForTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getForTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get artwork for a specific track. Uses <code>album_art_manager_v2</code>, supports embedded art and external files.<br>
        <strong>v1.1.6 New</strong>: Supports `maxSize` parameter for server-side resizing, significantly reducing data transfer.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `path` | string | ‚úì | Track file path (see supported formats below) |
| `type` | string | ‚úó | Art type: `front`, `back`, `disc`, `artist`, `icon` |
| `maxSize` | number | ‚úó | **v1.1.6 New** Max edge length (px). Resizes to JPEG if larger. 0 or omit for no resize. |

**Supported Path Formats**:
- ‚úÖ Absolute Path: `C:/Music/song.flac` or `C:\\Music\\song.flac`
- ‚úÖ file:// URI: `file://C:/Music/song.flac`
- ‚ö†Ô∏è `file-relative://` path **NOT Supported**, use `artwork.getByPlaylistItem` instead.

**Returns** (Unscaled):
```json
{
    "available": true,
    "found": true,
    "type": "front",
    "mimeType": "image/jpeg",
    "width": 1500,
    "height": 1500,
    "size": 234567,
    "resized": false,
    "dataUrl": "data:image/jpeg;base64,..."
}
```

**Returns** (Scaled with maxSize):
```json
{
    "available": true,
    "found": true,
    "type": "front",
    "mimeType": "image/jpeg",
    "width": 200,
    "height": 200,
    "originalWidth": 1500,
    "originalHeight": 1500,
    "size": 15234,
    "resized": true,
    "dataUrl": "data:image/jpeg;base64,..."
}
```

| Field | Type | Description |
|---|---|---|
| `available` | boolean | Found? (Standardized) |
| `found` | boolean | Found? (Legacy) |
| `type` | string | Requested art type |
| `mimeType` | string | MIME Type (Always `image/jpeg` if resized) |
| `width` | number | **v1.1.6** Image width |
| `height` | number | **v1.1.6** Image height |
| `originalWidth` | number | **v1.1.6** Original width (only if resized) |
| `originalHeight` | number | **v1.1.6** Original height (only if resized) |
| `size` | number | Data size (bytes) |
| `resized` | boolean | **v1.1.6** Was resized? |
| `dataUrl` | string | Data URL |

**Example**:
```javascript
// Full size
const fullArt = await fb2k.invoke('artwork.getForTrack', {
    path: 'E:/Music/album/song.flac'
});
console.log(`Original: ${fullArt.width}x${fullArt.height}, Size: ${fullArt.size} bytes`);

// Thumbnail 200x200 (Recommended for list/grid)
const thumbnail = await fb2k.invoke('artwork.getForTrack', {
    path: 'E:/Music/album/song.flac',
    maxSize: 200
});
console.log(`Thumbnail: ${thumbnail.width}x${thumbnail.height}, Size: ${thumbnail.size} bytes`);
// Output: Thumbnail: 200x200, Size: 15234 bytes (99% reduction from 2MB)

// From playlist
const tracks = await fb2k.invoke('playlist.getTracks', { count: 1 });
const artwork = await fb2k.invoke('artwork.getForTrack', {
    path: tracks.tracks[0].absolutePath,
    maxSize: 100
});
```

> üí° **Performance Tip**: Use `maxSize: 200` in lists/grids to reduce data transfer from ~2MB to ~15KB, reducing UI freeze.

> ‚ö†Ô∏è **Note**: If path is `file-relative://` (from playlist), use `artwork.getByPlaylistItem` instead.
    </div>
</div>

### artwork.getByPlaylistItem

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getByPlaylistItem</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get artwork by playlist index. Recommended for playlist tracks, handles relative paths correctly.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `playlist` | number | ‚úó | Playlist index (default active) |
| `index` | number | ‚úó | Track index (default 0) |
| `type` | string | ‚úó | Art type (default `front`) |

**Returns**:
```json
{
    "found": true,
    "type": "front",
    "playlist": 0,
    "index": 5,
    "mimeType": "image/jpeg",
    "size": 123456,
    "data": "base64...",
    "dataUrl": "data:image/jpeg;base64,..."
}
```

**Example**:
```javascript
// Get artwork for 6th track in current playlist
const artwork = await fb2k.invoke('artwork.getByPlaylistItem', {
    index: 5,
    type: 'front'
});

// Get artwork for specific playlist
const artwork2 = await fb2k.invoke('artwork.getByPlaylistItem', {
    playlist: 2,
    index: 0
});
```

> üí° **Tip**: Prefer this over `artwork.getForTrack` for playlist items to avoid path issues.
    </div>
</div>

### artwork.getAvailableTypes

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getAvailableTypes</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get list of available artwork types for a track.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `path` | string | ‚úó | Track path (default current playing) |

**Returns**:
```json
{
    "types": ["front", "back", "disc"]
}
```

**Example**:
```javascript
// Current track
const result = await fb2k.invoke('artwork.getAvailableTypes');
console.log(result.types); // ["front", "back"]

// Specific track
const result2 = await fb2k.invoke('artwork.getAvailableTypes', {
    path: 'C:/Music/song.flac'
});
```
</div>
</div>

### artwork.getBatch

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getBatch</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Batch get artwork for multiple tracks. Good for album lists.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `paths` | string[] | ‚úì | Array of track paths |
| `type` | string | ‚úó | Art type (default `front`) |
| `maxSize` | number | ‚úó | Max size px (reserved) |

**Returns**:
```json
{
    "success": true,
    "artworks": [
        {
            "path": "C:/Music/song1.flac",
            "available": true,
            "mimeType": "image/jpeg",
            "size": 123456,
            "dataUrl": "data:image/jpeg;base64,..."
        },
        {
            "path": "C:/Music/song2.flac",
            "available": false
        }
    ]
}
```

**Example**:
```javascript
// Batch fetch
const tracks = await fb2k.invoke('playlist.getTracks', { count: 10 });
const paths = tracks.tracks.map(t => t.absolutePath);

const result = await fb2k.invoke('artwork.getBatch', { paths });
result.artworks.forEach((art, i) => {
    if (art.available) {
        document.getElementById(`cover-${i}`).src = art.dataUrl;
    }
});
```
</div>
</div>

### artwork.getAvailableArtwork

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getAvailableArtwork</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get all available artwork types and sources (embedded or folder).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `path` | string | ‚úì | Track path |

**Returns**:
```json
{
    "success": true,
    "types": ["front", "back"],
    "sources": ["embedded", "folder:cover.jpg", "folder:folder.png"]
}
```

| Field | Type | Description |
|---|---|---|
| `types` | string[] | Embedded art types |
| `sources` | string[] | Art sources (`embedded` or `folder:filename`) |

**Example**:
```javascript
const result = await fb2k.invoke('artwork.getAvailableArtwork', {
    path: 'C:/Music/album/track01.flac'
});
// { types: ["front"], sources: ["embedded", "folder:cover.jpg"] }
```
</div>
</div>

### artwork.getFolderImages

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getFolderImages</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get list of all image files in a folder.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `directory` | string | ‚úì | Directory path |

**Returns**:
```json
{
    "success": true,
    "images": [
        {
            "name": "cover.jpg",
            "path": "C:/Music/album/cover.jpg",
            "size": 123456
        },
        {
            "name": "back.png",
            "path": "C:/Music/album/back.png",
            "size": 98765
        }
    ]
}
```

**Supported Formats**: `.jpg`, `.jpeg`, `.png`, `.gif`, `.bmp`, `.webp`

**Example**:
```javascript
const result = await fb2k.invoke('artwork.getFolderImages', {
    directory: 'C:/Music/album'
});

result.images.forEach(img => {
    console.log(`${img.name}: ${img.size} bytes`);
});
```
</div>
</div>

### artwork.getLyrics

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getLyrics</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get lyrics (from metadata tags).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `path` | string | ‚úó | Track path (default current playing) |

**Returns**:
```json
{
    "found": true,
    "tag": "LYRICS",
    "lyrics": "[00:12.34]First line of lyrics\n[00:15.67]Second line...",
    "synced": false
}
```

| Field | Type | Description |
|---|---|---|
| `found` | boolean | Found? |
| `tag` | string | Source tag name |
| `lyrics` | string | Lyrics content |
| `synced` | boolean | Is synced (LRC)? |

**Supported Tags**: `LYRICS`, `UNSYNCED LYRICS`, `UNSYNCEDLYRICS`, `SYNCEDLYRICS`, `SYNCED LYRICS`

**Example**:
```javascript
const lyrics = await fb2k.invoke('artwork.getLyrics');
if (lyrics.found) {
    if (lyrics.synced) {
        // Parse LRC
        parseLrcLyrics(lyrics.lyrics);
    } else {
        // Plain text
        displayPlainLyrics(lyrics.lyrics);
    }
}
```
</div>
</div>

### artwork.getMetadata

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getMetadata</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get basic track metadata.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `path` | string | ‚úó | Track path (default current playing) |

**Returns**:
```json
{
    "title": "Let It Be",
    "artist": "The Beatles",
    "album": "Let It Be",
    "album_artist": "The Beatles",
    "year": "1970",
    "genre": "Rock",
    "track_number": "6",
    "disc_number": "1",
    "has_lyrics": true
}
```

**Example**:
```javascript
// Current track
const meta = await fb2k.invoke('artwork.getMetadata');
console.log(`${meta.artist} - ${meta.title}`);

// Specific track
const meta2 = await fb2k.invoke('artwork.getMetadata', {
    path: 'C:/Music/song.flac'
});
```
</div>
</div>

</section>

<!-- ==================== CONFIG API ==================== -->
<section id="config-api">

## Config API - Configuration Management

### config.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.get</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get configuration value.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `key` | string | ‚úì | Config key |
| `default` | any | ‚úó | Default value |

**Returns**:
```json
{
    "key": "theme",
    "value": "dark",
    "exists": true
}
```

**Example**:
```javascript
const theme = await fb2k.invoke('config.get', { key: 'theme', default: 'light' });
```
</div>
</div>

### config.set

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.set</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set configuration value.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `key` | string | ‚úì | Config key |
| `value` | any | ‚úì | Config value |

**Returns**:
```json
{ "success": true }
```

**Example**:
```javascript
await fb2k.invoke('config.set', { key: 'volume', value: 0.8 });
await fb2k.invoke('config.set', { key: 'lastPlayed', value: Date.now() });
```
</div>
</div>

### config.remove

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">config.remove</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Remove configuration item.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `key` | string | ‚úì | Config key |

**Returns**:
```json
{ "success": true, "existed": true }
```
</div>
</div>

### config.getAll

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getAll</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get all configuration items.</div>

**Returns**:
```json
{
    "config": {
        "theme": "dark",
        "volume": 0.8,
        "lastPlayed": 1704067200000
    }
}
```
</div>
</div>

### config.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">config.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Clear all configuration items.</div>

**Returns**:
```json
{ "success": true }
```
</div>
</div>

### config.keys

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.keys</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get all configuration keys.</div>

**Returns**:
```json
{
    "keys": ["theme", "volume", "lastPlayed"]
}
```
</div>
</div>

### config.has

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.has</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Check if config key exists.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `key` | string | ‚úì | Config key |

**Returns**:
```json
{ "exists": true }
```
</div>
</div>

### config.setMultiple / config.getMultiple

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.setMultiple</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Batch set/get configuration.</div>

**Batch Set**:
```javascript
await fb2k.invoke('config.setMultiple', {
    values: {
        theme: 'dark',
        volume: 0.8,
        shuffle: true
    }
});
```

**Batch Get**:
```javascript
const result = await fb2k.invoke('config.getMultiple', {
    keys: ['theme', 'volume', 'shuffle']
});
// result.values = { theme: 'dark', volume: 0.8, shuffle: true }
```
</div>
</div>

### config.export / config.import

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">config.export</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Export/Import configuration.</div>

**Export**:
```javascript
const exported = await fb2k.invoke('config.export');
// exported.data = "base64_encoded_json..."
localStorage.setItem('fb2k_backup', exported.data);
```

**Import**:
```javascript
const backup = localStorage.getItem('fb2k_backup');
await fb2k.invoke('config.import', { data: backup });
```
</div>
</div>

### config.getVersionInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getVersionInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get foobar2000 version info.</div>

**Returns**:
```json
{
    "version": "2.0",
    "versionFull": "foobar2000 v2.0",
    "architecture": "x64",
    "portable": false
}
```
</div>
</div>

### config.getComponents

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getComponents</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get installed components list.</div>

**Returns**:
```json
{
    "items": [
        { "name": "foo_ui_webview2", "version": "1.1.0", "filename": "foo_ui_webview2.dll" }
    ],
    "count": 15
}
```
</div>
</div>

### config.getOutputDevices

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getOutputDevices</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get available audio output devices.</div>

**Returns**:
```json
{
    "items": [
        { "id": "...", "name": "Speakers (Realtek)", "active": true }
    ],
    "count": 3
}
```
</div>
</div>

### config.setOutputDevice

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.setOutputDevice</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set audio output device.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| id | string | ‚úÖ | Device ID |
    </div>
</div>

### config.getOutputConfig

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getOutputConfig</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get audio output configuration.</div>

**Returns**:
```json
{
    "bufferLength": 1000,
    "device": "...",
    "deviceName": "Speakers"
}
```
</div>
</div>

### config.setOutputBuffer

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.setOutputBuffer</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set output buffer size.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| bufferLength | number | ‚úÖ | Buffer length (ms) |
    </div>
</div>

### config.getDspPresets

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getDspPresets</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get DSP presets.</div>

**Returns**:
```json
{
    "items": [
        { "id": "...", "name": "Default", "active": true }
    ],
    "count": 3
}
```
</div>
</div>

### config.getActiveDspPreset

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getActiveDspPreset</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get active DSP preset.</div>
    </div>
</div>

### config.setActiveDspPreset

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.setActiveDspPreset</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set active DSP preset.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| id | string | ‚úÖ | Preset ID |
    </div>
</div>

### config.getAdvancedConfig

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getAdvancedConfig</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get advanced configuration list.</div>
    </div>
</div>

### config.getAdvancedConfigValue

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getAdvancedConfigValue</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get value of specific advanced config item.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| key | string | ‚úÖ | Config key |
    </div>
</div>

### config.setAdvancedConfigValue

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.setAdvancedConfigValue</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set value of advanced config item.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| key | string | ‚úÖ | Config key |
| value | any | ‚úÖ | Config value |
    </div>
</div>

### config.resetAdvancedConfig

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">config.resetAdvancedConfig</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Reset advanced config to default.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| key | string | ‚úÖ | Config key |
    </div>
</div>

### config.getLibraryStatus

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getLibraryStatus</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get library status info.</div>
    </div>
</div>

### config.getLibraryFilePatterns

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getLibraryFilePatterns</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get library file monitoring patterns.</div>
    </div>
</div>

### config.showLibraryPreferences

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">config.showLibraryPreferences</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Open Library preferences page.</div>
    </div>
</div>

### config.getPreferencesPages

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getPreferencesPages</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get list of preferences pages.</div>
    </div>
</div>

### config.getPreferencesStandardGuids

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getPreferencesStandardGuids</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get standard preferences page GUIDs.</div>
    </div>
</div>

</section>

<!-- ==================== WINDOW API ==================== -->
<section id="window-api">

## Window API - Window Control

### Window Basic Operations

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.minimize / window.maximize / window.restore / window.close</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Basic window operations.</div>

```javascript
await fb2k.invoke('window.minimize');  // Minimize
await fb2k.invoke('window.maximize');  // Maximize
await fb2k.invoke('window.restore');   // Restore
await fb2k.invoke('window.close');     // Close
```
</div>
</div>

### window.getState

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getState</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get window state.</div>

**Returns**:
```json
{
    "isMaximized": false,
    "isMinimized": false,
    "isFullscreen": false,
    "isFocused": true,
    "width": 1280,
    "height": 720,
    "x": 100,
    "y": 100
}
```
</div>
</div>

### window.isMaximized / window.isMinimized / window.isFullscreen

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.isMaximized / window.isMinimized / window.isFullscreen</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get maximized/minimized/fullscreen states respectively.</div>

```javascript
const { maximized } = await fb2k.invoke('window.isMaximized');
const { minimized } = await fb2k.invoke('window.isMinimized');
const { fullscreen } = await fb2k.invoke('window.isFullscreen');
```
</div>
</div>

### window.startResize

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.startResize</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Start window resizing. Used for custom window borders.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `edge` | string | ‚úó | Edge direction: left, right, top, bottom, topleft, topright, bottomleft, bottomright |

**Example**:
```javascript
// Call on border element mousedown
borderElement.onmousedown = (e) => {
    fb2k.invoke('window.startResize', { edge: 'bottomright' });
};
```
</div>
</div>

### window.setSize

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setSize</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set window size.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `width` | number | ‚úì | Width |
| `height` | number | ‚úì | Height |

**Example**:
```javascript
await fb2k.invoke('window.setSize', { width: 1920, height: 1080 });
```
</div>
</div>

### window.setPosition

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setPosition</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set window position.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `x` | number | ‚úì | X coordinate |
| `y` | number | ‚úì | Y coordinate |

**Example**:
```javascript
await fb2k.invoke('window.setPosition', { x: 0, y: 0 });
```
</div>
</div>

### window.center

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.center</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Center window on screen.</div>

```javascript
await fb2k.invoke('window.center');
```
</div>
</div>

### window.setAlwaysOnTop

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setAlwaysOnTop</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set window always on top.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `enabled` | boolean | ‚úó | Enabled (default true) |

**Example**:
```javascript
await fb2k.invoke('window.setAlwaysOnTop', { enabled: true });
```

**Related APIs**:
- `window.isAlwaysOnTop` - Get status
- `window.toggleAlwaysOnTop` - Toggle status
    </div>
</div>

### window.setFullscreen

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setFullscreen</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set fullscreen mode.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `enabled` | boolean | ‚úó | Enabled (default true) |

**Example**:
```javascript
await fb2k.invoke('window.setFullscreen', { fullscreen: true });
```
</div>
</div>

### window.setMinSize / window.getMinSize üÜï

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setMinSize</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set window minimum size limit.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `width` | number | ‚úì | Min Width |
| `height` | number | ‚úì | Min Height |

**Example**:
```javascript
// Set min size
await fb2k.invoke('window.setMinSize', { width: 800, height: 600 });

// Get min size
const minSize = await fb2k.invoke('window.getMinSize');
console.log(minSize); // { width: 800, height: 600 }
```
</div>
</div>

### window.setMaxSize / window.getMaxSize üÜï

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setMaxSize</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set window maximum size limit. Set 0 for no limit.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `width` | number | ‚úì | Max Width (0=unlimited) |
| `height` | number | ‚úì | Max Height (0=unlimited) |

**Example**:
```javascript
// Set max size
await fb2k.invoke('window.setMaxSize', { width: 1920, height: 1080 });

// Remove max size
await fb2k.invoke('window.setMaxSize', { width: 0, height: 0 });

// Get max size
const maxSize = await fb2k.invoke('window.getMaxSize');
console.log(maxSize); // { width: 1920, height: 1080 }
```
</div>
</div>

### window.setResizable / window.isResizable üÜï

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setResizable</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Enable/Disable window resizing. If disabled, window borders cannot be used to resize.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `resizable` | boolean | ‚úì | Allow resize |

**Example**:
```javascript
// Disable resize
await fb2k.invoke('window.setResizable', { resizable: false });

// Enable resize
await fb2k.invoke('window.setResizable', { resizable: true });

// Check current state
const state = await fb2k.invoke('window.isResizable');
console.log(state.resizable); // true or false
```
</div>
</div>

### window.setCornerPreference / window.getCornerPreference üÜï

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setCornerPreference</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set window corner preference (Windows 11 only).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `mode` | string | ‚úì | Corner mode: `"default"` / `"none"` / `"round"` / `"small"` |

**Modes**:
| Value | Description |
|------|------|
| `"default"` | System default |
| `"none"` | No rounding (square) |
| `"round"` | Round (approx 8px) |
| `"small"` | Small round (approx 4px) |

**Example**:
```javascript
// Set round
await fb2k.invoke('window.setCornerPreference', { mode: 'round' });

// Set square
await fb2k.invoke('window.setCornerPreference', { mode: 'none' });

// Get current mode
const result = await fb2k.invoke('window.getCornerPreference');
console.log(result.mode); // "default" / "none" / "round" / "small"
```
</div>
</div>

### window.getBounds

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getBounds</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get window bounds.</div>

**Returns**:
```json
{ "x": 100, "y": 100, "width": 1280, "height": 720 }
```
</div>
</div>

### window.setBounds

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setBounds</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set window bounds.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `x` | number | ‚úó | X coordinate |
| `y` | number | ‚úó | Y coordinate |
| `width` | number | ‚úó | Width |
| `height` | number | ‚úó | Height |
    </div>
</div>

### window.getDpiScale

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getDpiScale</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get DPI scale info.</div>

**Returns**:
```json
{ "dpi": 144, "scale": 1.5 }
```
</div>
</div>

### window.getTitle

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getTitle</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get window title.</div>

**Returns**:
```json
{ "title": "foobar2000" }
```
</div>
</div>

### window.focus

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.focus</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Bring window to front and focus.</div>
    </div>
</div>

### window.blur

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.blur</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Remove window focus.</div>
    </div>
</div>

### window.flash

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.flash</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Flash window and taskbar button.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `enabled` | boolean | ‚úó | Enabled (default true) |
| `count` | number | ‚úó | Flash count (default 3) |
    </div>
</div>

### window.flashTaskbar

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.flashTaskbar</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Flash taskbar button.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `count` | number | ‚úó | Flash count (default 3) |
    </div>
</div>

### window.enterFullscreen / window.exitFullscreen

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.enterFullscreen / window.exitFullscreen</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Enter/Exit fullscreen mode.</div>

```javascript
await fb2k.invoke('window.enterFullscreen');
await fb2k.invoke('window.exitFullscreen');
```
</div>
</div>

### window.toggleFullscreen

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.toggleFullscreen</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Toggle fullscreen state.</div>

**Returns**:
```json
{ "success": true, "fullscreen": true }
```
</div>
</div>

### window.setBlur

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setBlur</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Enable/Disable window blur effect.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `enabled` | boolean | ‚úó | Enabled (default true) |
    </div>
</div>

</section>

<!-- ==================== WINDOW TITLEBAR ==================== -->
<section id="window-titlebar">

## Window API - Titlebar

### window.setTitle

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setTitle</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set window title.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `title` | string | ‚úì | Window title |

**Example**:
```javascript
await fb2k.invoke('window.setTitle', { title: 'Now Playing: Let It Be' });
```
</div>
</div>

### window.getTitlebarHeight

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getTitlebarHeight</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get titlebar height.</div>

**Returns**:
```json
{ "height": 32 }
```
</div>
</div>

### window.setTitlebarHeight

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setTitlebarHeight</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set titlebar height (for custom titlebar).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `height` | number | ‚úì | Height (px) |

**Example**:
```javascript
await fb2k.invoke('window.setTitlebarHeight', { height: 48 });
```
</div>
</div>

### window.setDragRegion

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setDragRegion</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set draggable region.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `x` | number | ‚úì | X coordinate |
| `y` | number | ‚úì | Y coordinate |
| `width` | number | ‚úì | Width |
| `height` | number | ‚úì | Height |

**Example**:
```javascript
// Set top 48px as draggable
await fb2k.invoke('window.setDragRegion', {
    x: 0, y: 0, width: window.innerWidth, height: 48
});
```
</div>
</div>

### window.setDragRegions

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setDragRegions</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set multiple draggable regions.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `regions` | array | ‚úì | Region array |

**Example**:
```javascript
await fb2k.invoke('window.setDragRegions', {
    regions: [
        { x: 0, y: 0, width: 200, height: 48 },
        { x: 400, y: 0, width: 200, height: 48 }
    ]
});
```
</div>
</div>

### window.clearDragRegions

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.clearDragRegions</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Clear all draggable regions.</div>
    </div>
</div>

### window.setNoDragRegions

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setNoDragRegions</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set non-draggable regions (exclude specific areas within drag regions).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `regions` | array | ‚úì | Region array |
    </div>
</div>

### window.getCaptionButtonsWidth

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getCaptionButtonsWidth</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get system caption buttons width.</div>

**Returns**:
```json
{ "width": 138, "buttonWidth": 46 }
```
</div>
</div>

### window.getTitlebarInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getTitlebarInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get full titlebar info.</div>

**Returns**:
```json
{
    "height": 32,
    "captionButtonsWidth": 138,
    "captionButtonWidth": 46,
    "isMaximized": false
}
```
</div>
</div>

### üé® Custom Titlebar Implementation Guide

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method guide">GUIDE</span>
        <span class="api-card-name">Custom Titlebar Guide</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Implement a full custom titlebar involving drag, window controls, and resize borders.</div>

**HTML Structure**:
```html
<div class="titlebar" data-webview-drag="true">
    <!-- Left: Icon and Title -->
    <div class="titlebar-left">
        <img src="icon.png" class="app-icon" data-webview-drag="false">
        <span class="app-title">My foobar2000</span>
    </div>
    
    <!-- Center: Search Box etc. -->
    <div class="titlebar-center" data-webview-drag="false">
        <input type="text" placeholder="Search..." class="search-box">
    </div>
    
    <!-- Right: Window Controls -->
    <div class="titlebar-buttons" data-webview-drag="false">
        <button id="btn-minimize" class="titlebar-btn">‚îÄ</button>
        <button id="btn-maximize" class="titlebar-btn">‚ñ°</button>
        <button id="btn-close" class="titlebar-btn close">‚úï</button>
    </div>
</div>
```

**CSS Styles**:
```css
.titlebar {
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: transparent;
    -webkit-app-region: drag; /* Allow drag */
    user-select: none;
}

.titlebar-left, .titlebar-center, .titlebar-buttons {
    display: flex;
    align-items: center;
    -webkit-app-region: no-drag; /* Exclude these regions */
}

.titlebar-btn {
    width: 46px;
    height: 32px;
    border: none;
    background: transparent;
    color: white;
    font-size: 12px;
    cursor: pointer;
    transition: background 0.15s;
}

.titlebar-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

.titlebar-btn.close:hover {
    background: #e81123;
}

/* Inactive window style */
.window-inactive .titlebar {
    opacity: 0.7;
}
```

**JavaScript Logic**:
```javascript
// ========== Window Controls ==========
document.getElementById('btn-minimize').onclick = () => 
    fb2k.invoke('window.minimize');

document.getElementById('btn-maximize').onclick = () => 
    fb2k.invoke('window.maximize');

document.getElementById('btn-close').onclick = () => 
    fb2k.invoke('window.close');

// ========== Sync Maximize Button State ==========
fb2k.on('window:stateChanged', (data) => {
    const btn = document.getElementById('btn-maximize');
    if (data.isMaximized) {
        btn.textContent = '‚ùê';  // Restore icon
        btn.title = 'Restore';
    } else {
        btn.textContent = '‚ñ°';  // Maximize icon
        btn.title = 'Maximize';
    }
});

// ========== Window Focus State ==========
fb2k.on('window:focusChanged', (data) => {
    document.body.classList.toggle('window-inactive', !data.focused);
});

// ========== Set Titlebar Height ==========
fb2k.invoke('window.setTitlebarHeight', { height: 32 });
```

**Important Notes**:
- Use `data-webview-drag="true"` to mark draggable regions.
- Use `data-webview-drag="false"` to exclude interactive elements.
- Resize borders are handled automatically (5px trigger area, 1px visual border).
- Call `window.setTitlebarHeight` to inform system of titlebar area.
    </div>
</div>

</section>

<!-- ==================== WINDOW DWM ==================== -->
<section id="window-dwm">

## Window API - DWM Effects

> DWM (Desktop Window Manager) effects allow applying modern Windows visual effects.

### üé® DWM Effects Guide

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method guide">GUIDE</span>
        <span class="api-card-name">Windows Visual Effects</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Best practices for configuring modern Windows visual effects.</div>

**Comparison**:

| Effect | Windows Version | Features |
|---|---|---|
| **Mica** | Windows 11+ | Dynamic blur based on desktop wallpaper, best performance |
| **Mica Alt** | Windows 11+ | Darker variant of Mica, higher contrast |
| **Acrylic** | Windows 10/11 | Blur behind window content, more transparent |

**Recommended Config**:

```javascript
// ========== Init Visual Effects ==========
async function initVisualEffects() {
    // Detect OS version
    const sysInfo = await fb2k.invoke('system.getInfo');
    
    // Set dark mode (affects system controls)
    await fb2k.invoke('window.setDarkMode', { enabled: true });
    
    // Windows 11: Use Mica
    if (sysInfo.windowsBuild >= 22000) {
        await fb2k.invoke('window.setMica', { 
            enabled: true, 
            variant: 'mica-alt'  // or 'standard'
        });
        
        // Set rounded corners
        await fb2k.invoke('window.setCornerPreference', { 
            mode: 'round'  // 'none', 'round', 'small'
        });
    } 
    // Windows 10: Use Acrylic
    else {
        await fb2k.invoke('window.setAcrylic', { 
            enabled: true,
            tintColor: '#1a1a1aCC'  // Tint with alpha
        });
    }
    
    // Optional: Custom border color
    await fb2k.invoke('window.setBorderColor', { 
        color: '#0078D4'  // Accent color
    });
}

// ========== Theme Switching ==========
async function setTheme(isDark) {
    await fb2k.invoke('window.setDarkMode', { enabled: isDark });
    
    // Update border color
    await fb2k.invoke('window.setBorderColor', { 
        color: isDark ? '#3a3a3a' : '#cccccc' 
    });
    
    // Update caption color
    await fb2k.invoke('window.setCaptionColor', { 
        color: isDark ? '#1a1a1a' : '#f0f0f0' 
    });
}
```

**CSS Integration** (Make page background transparent):
```css
html, body {
    background: transparent !important;
}

/* Or use semi-transparent background */
body {
    background: rgba(0, 0, 0, 0.3);
}

/* Add custom blur layer */
.content-area {
    background: rgba(30, 30, 30, 0.7);
    backdrop-filter: blur(10px);
}
```

> ‚ö†Ô∏è **Note**: Mica/Acrylic effects require transparent webview background. Ensure CSS `body` background is `transparent` or semi-transparent.
    </div>
</div>

### window.setMica

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setMica</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Apply Windows 11 Mica effect.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `enabled` | boolean | ‚úì | Enabled |
| `variant` | string | ‚úó | "mica" or "mica-alt" |
| `darkMode` | boolean | ‚úó | Dark mode (true) or Light mode (false) |

**Example**:
```javascript
// Enable Standard Mica (Dark)
await fb2k.invoke('window.setMica', { enabled: true, darkMode: true });

// Use Mica Alt (Light)
await fb2k.invoke('window.setMica', { enabled: true, variant: 'mica-alt', darkMode: false });
```
</div>
</div>

### window.setAcrylic

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setAcrylic</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Apply Acrylic blur effect.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `enabled` | boolean | ‚úì | Enabled |
| `darkMode` | boolean | ‚úó | Dark mode (true) or Light mode (false) |

**Example**:
```javascript
await fb2k.invoke('window.setAcrylic', {
    enabled: true,
    tintColor: '#000000AA'
});
```
</div>
</div>

### window.setBackgroundTransparency

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setBackgroundTransparency</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Control WebView background transparency. Key API for DWM effects (Mica/Acrylic) to show through.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `transparent` | boolean | ‚úó | Is transparent (default true) |

**Returns**:
```json
{
    "success": true,
    "transparent": true,
    "description": "WebView background is now transparent - DWM effects will show through"
}
```

**Example**:
```javascript
// Enable transparency (Allow DWM)
await fb2k.invoke('window.setBackgroundTransparency', { transparent: true });

// Disable transparency (Opaque)
await fb2k.invoke('window.setBackgroundTransparency', { transparent: false });
```

> üí° **Tip**: Calling `window.setMica`, `window.setAcrylic`, `window.setBlur` automatically enables transparency.
    </div>
</div>

### window.refreshWebView

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.refreshWebView</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Refresh WebView rendering. Call after DWM changes to ensure correct display.</div>

**Parameters**: None

**Returns**:
```json
{ "success": true }
```

**Example**:
```javascript
// Manually refresh if DWM effect not showing
await fb2k.invoke('window.refreshWebView');
```
</div>
</div>

### window.setBorderColor

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setBorderColor</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set window border color.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `color` | string | ‚úì | Color value (e.g. "#0078D4") |

**Example**:
```javascript
await fb2k.invoke('window.setBorderColor', { color: '#0078D4' });
```
</div>
</div>

### window.setCaptionColor

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setCaptionColor</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set caption color.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `color` | string | ‚úì | Color value |

**Example**:
```javascript
await fb2k.invoke('window.setCaptionColor', { color: '#1a1a1a' });
```
</div>
</div>

### window.setDarkMode

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setDarkMode</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set window dark mode (affects caption buttons).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `enabled` | boolean | ‚úì | Enable dark mode |

**Example**:
```javascript
await fb2k.invoke('window.setDarkMode', { enabled: true });
```
</div>
</div>

### window.setCornerPreference

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setCornerPreference</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set window corner style (Windows 11).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `corner` | string | ‚úì | "default", "doNotRound", "round", "roundSmall" |

**Example**:
```javascript
await fb2k.invoke('window.setCornerPreference', { corner: 'round' });
```
</div>
</div>

</section>

<!-- ==================== WINDOW ZOOM CONTROL ==================== -->
<section id="window-zoom">

## Window API - Zoom Control üÜï v1.1.5

> These APIs control WebView zoom level and DPI adaptation. System sends `window:dpiChanged` event when moving between monitors with different DPI.

### window.setZoom

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setZoom</span>
        <span class="badge badge-green">v1.1.5 New</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set WebView zoom level.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `zoom` | number | ‚úì | Zoom level (0.25 - 4.0), 1.0 = 100% |

**Returns**:
```json
{
    "success": true,
    "zoom": 1.5
}
```

**Example**:
```javascript
// Zoom to 150%
await fb2k.invoke('window.setZoom', { zoom: 1.5 });

// Zoom to 80%
await fb2k.invoke('window.setZoom', { zoom: 0.8 });
```
    </div>
</div>

### window.getZoom

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getZoom</span>
        <span class="badge badge-green">v1.1.5 New</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current zoom and DPI info.</div>

**Parameters**: None

**Returns**:
```json
{
    "zoom": 1.0,
    "dpi": 144,
    "dpiScale": 1.5
}
```

| Field | Type | Description |
|---|---|---|
| `zoom` | number | Current zoom level |
| `dpi` | number | Current DPI (96 = 100%) |
| `dpiScale` | number | DPI scale factor (1.0, 1.25, 1.5, 2.0 etc.) |

**Example**:
```javascript
const info = await fb2k.invoke('window.getZoom');
console.log(`Zoom: ${info.zoom * 100}%, DPI: ${info.dpi}`);
```
    </div>
</div>

### window.resetZoom

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.resetZoom</span>
        <span class="badge badge-green">v1.1.5 New</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Reset zoom to default (1.0 = 100%).</div>

**Parameters**: None

**Returns**:
```json
{
    "success": true,
    "zoom": 1.0
}
```

**Example**:
```javascript
await fb2k.invoke('window.resetZoom');
```
    </div>
</div>

### window.setZoomForDpi

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setZoomForDpi</span>
        <span class="badge badge-green">v1.1.5 New</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Auto set zoom based on DPI. If DPI not specified, uses current window DPI.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `dpi` | number | ‚úó | DPI value, uses current if omitted |

**Returns**:
```json
{
    "success": true,
    "dpi": 144,
    "zoom": 1.5
}
```

**Example**:
```javascript
// Auto set zoom using current window DPI
await fb2k.invoke('window.setZoomForDpi');

// Set zoom for specific DPI
await fb2k.invoke('window.setZoomForDpi', { dpi: 192 }); // 200%
```
    </div>
</div>

### window:dpiChanged Event

Triggered when DPI changes (e.g. dragging window to another monitor):

```javascript
fb2k.on('window:dpiChanged', (data) => {
    console.log('DPI Change:', data.dpi, 'Scale:', data.dpiScale);
    
    // Event Data:
    // data.dpi - Current DPI
    // data.dpiScale - Scale factor
    // data.titlebarHeight - Titlebar height (px)
    // data.captionButtonWidth - System button width
    // data.captionButtonsWidth - Total buttons width
});
```

**Auto-injected CSS Variables**:

On DPI change, the following CSS variables are auto-injected to `:root`:

```css
:root {
    --dpi: 144;              /* Current DPI */
    --dpi-scale: 1.5;        /* Scale Factor */
    --titlebar-height: 48px; /* Titlebar Height */
    --caption-button-width: 69px; /* System Button Width */
}
```

</section>

<!-- ==================== WINDOW DRAG & MENU ==================== -->
<section id="window-interaction">

## Window API - Drag & Menu

### window.startDrag

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.startDrag</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Start window drag. Call in mousedown event of custom titlebar to move window.</div>

**Parameters**: None

**Returns**:
```json
{ "success": true }
```

**Example**:
```javascript
// Call on titlebar mousedown
document.getElementById('titlebar').onmousedown = function(e) {
    if (e.button !== 0 || e.detail > 1) return; // Left click only
    if (e.target.closest('.titlebar-buttons')) return; // Exclude buttons
    fb2k.invoke('window.startDrag');
};
```
</div>
</div>

### window.toggleMaximize

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.toggleMaximize</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Toggle window maximize state. Restore if maximized, otherwise maximize.</div>

**Parameters**: None

**Returns**:
```json
{ "success": true, "maximized": true }
```

**Example**:
```javascript
// Double click titlebar to toggle maximize
document.getElementById('titlebar').ondblclick = function(e) {
    if (e.target.closest('.titlebar-buttons')) return;
    fb2k.invoke('window.toggleMaximize');
};
```
</div>
</div>

### window.showSystemMenu

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.showSystemMenu</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Show Windows native system menu (Restore, Move, Size, Min/Max, Close).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `x` | number | ‚úì | Screen X |
| `y` | number | ‚úì | Screen Y |

**Returns**:
```json
{ "success": true }
```

**Example**:
```javascript
// Show system menu on Alt+Space or specific context
await fb2k.invoke('window.showSystemMenu', {
    x: window.screenX + 10,
    y: window.screenY + 30
});
```
</div>
</div>

### ui.showContextMenu

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">ui.showContextMenu</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Show foobar2000 style context menu (Open, Add Folder, Dev Tools, Prefs, etc).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `x` | number | ‚úì | Screen X |
| `y` | number | ‚úì | Screen Y |

**Returns**:
```json
{ "success": true }
```

**Menu Items**:
- Open File(s)...
- Add Folder...
- Reload
- Developer Tools
- foobar2000 Console
- Preferences...
- About foobar2000...

**Example**:
```javascript
// Right click titlebar to show menu
document.getElementById('titlebar').oncontextmenu = function(e) {
    e.preventDefault();
    fb2k.invoke('ui.showContextMenu', {
        x: e.screenX,
        y: e.screenY
    });
};
```
</div>
</div>

</section>

<!-- ==================== SYSTEM API ==================== -->
<section id="system-api">

## System API

System API provides API discovery and external plugin registration management.

### system.listAvailableApis

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.listAvailableApis</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">List all available APIs, including builtin and external plugin APIs.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `namespace` | string | ‚úó | Filter by namespace |
| `includeInternal` | boolean | ‚úó | Include internal APIs (default false) |

**Returns**:
```json
{
    "apis": [
        {
            "method": "playback.play",
            "namespace": "playback",
            "description": "Start playback",
            "isExternal": false
        },
        {
            "method": "my_plugin.doSomething",
            "namespace": "my_plugin",
            "description": "Do something",
            "isExternal": true,
            "pluginId": "my_plugin"
        }
    ],
    "total": 128
}
```

**Example**:
```javascript
// Get all APIs
const result = await fb2k.system.listAvailableApis();
console.log(`Total ${result.total} APIs`);

// Filter by namespace
const playbackApis = await fb2k.system.listAvailableApis({ namespace: 'playback' });
```
</div>
</div>

### system.getApisByNamespace

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getApisByNamespace</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get all APIs in specific namespace.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `namespace` | string | ‚úì | Namespace name |

**Returns**:
```json
{
    "namespace": "playback",
    "apis": [
        { "method": "playback.play", "description": "Start playback" },
        { "method": "playback.pause", "description": "Pause playback" }
    ],
    "count": 21
}
```

**Example**:
```javascript
const playbackApis = await fb2k.system.getApisByNamespace({ namespace: 'playback' });
playbackApis.apis.forEach(api => console.log(api.method));
```
</div>
</div>

### system.searchApis

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.searchApis</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Search APIs (fuzzy match method and description).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `query` | string | ‚úì | Search keyword |
| `limit` | number | ‚úó | Max results (default 50) |

**Returns**:
```json
{
    "query": "volume",
    "results": [
        { "method": "playback.getVolume", "description": "Get current volume" },
        { "method": "playback.setVolume", "description": "Set volume" }
    ],
    "count": 2
}
```

**Example**:
```javascript
const results = await fb2k.system.searchApis({ query: 'playlist' });
console.log(`Found ${results.count} related APIs`);
```
</div>
</div>

### system.getApiStats

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getApiStats</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get API statistics.</div>

**Parameters**: None

**Returns**:
```json
{
    "totalApis": 128,
    "builtinApis": 122,
    "externalApis": 6,
    "registeredPlugins": 1,
    "namespaces": ["playback", "playlist", "library", "artwork", "config", "window", "ui", "system", "test", "my_plugin"]
}
```

**Example**:
```javascript
const stats = await fb2k.system.getApiStats();
console.log(`Builtin: ${stats.builtinApis}, External: ${stats.externalApis}`);
```
</div>
</div>

</section>

<section id="system-plugins">

### system.getRegisteredPlugins

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getRegisteredPlugins</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get list of registered external plugins.</div>

**Parameters**: None

**Returns**:
```json
{
    "plugins": [
        {
            "id": "my_plugin",
            "name": "My Plugin",
            "version": "1.0.0",
            "author": "Author Name",
            "description": "Plugin description",
            "apiCount": 5
        }
    ],
    "count": 1
}
```

**Example**:
```javascript
const plugins = await fb2k.system.getRegisteredPlugins();
plugins.plugins.forEach(p => {
    console.log(`${p.name} v${p.version} - ${p.apiCount} APIs`);
});
```
</div>
</div>

### system.isPluginRegistered

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.isPluginRegistered</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Check if specific plugin is registered.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| `pluginId` | string | ‚úì | Plugin ID |

**Returns**:
```json
{
    "pluginId": "my_plugin",
    "registered": true
}
```

**Example**:
```javascript
const result = await fb2k.system.isPluginRegistered({ pluginId: 'my_plugin' });
if (result.registered) {
    // Plugin available
    await fb2k.invoke('my_plugin.doSomething');
}
```
</div>
</div>

### system.getTheme

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getTheme</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get system theme info.</div>

**Parameters**: None

**Returns**:
```json
{
    "darkMode": true,
    "isDark": true,
    "accentColor": "#0078D4",
    "transparency": true
}
```

**Example**:
```javascript
const theme = await fb2k.invoke('system.getTheme');
if (theme.darkMode) {
    document.body.classList.add('dark');
}
document.documentElement.style.setProperty('--accent', theme.accentColor);
```
</div>
</div>

### system.getDPI

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getDPI</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get system DPI scale info.</div>

**Parameters**: None

**Returns**:
```json
{
    "dpi": 120,
    "scale": 1.25
}
```

**Example**:
```javascript
const dpi = await fb2k.invoke('system.getDPI');
console.log(`DPI: ${dpi.dpi}, Scale: ${dpi.scale * 100}%`);
```
</div>
</div>

### system.getLocale

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getLocale</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get system locale info.</div>

**Parameters**: None

**Returns**:
```json
{
    "locale": "zh-CN",
    "language": "‰∏≠Êñá(ÁÆÄ‰Ωì)",
    "country": "‰∏≠ÂõΩ"
}
```

**Example**:
```javascript
const locale = await fb2k.invoke('system.getLocale');
console.log(`Language: ${locale.language}`);
```
</div>
</div>

</section>

<!-- ==================== NEW APIs v0.2.0 ==================== -->

<section id="file-api">

## File API - File System

Provides file read/write and directory operations.

### file.read

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">file.read</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">üìÅ Restricted</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Read file content.<br>üìÅ **Security**: System directories (Windows/System32/Program Files) are blocked.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | File path |
| encoding | string | - | Encoding, default utf-8 |

**Returns**:
```json
{ "success": true, "content": "File content..." }
```

**Example**:
```javascript
// ‚úÖ Allowed - Non-system drive
const result = await fb2k.invoke('file.read', { path: 'D:/Music/playlist.m3u' });

// ‚ùå Denied - System path
await fb2k.invoke('file.read', { path: 'C:/Windows/System32/config/SAM' });
// Returns: { success: false, error: "Access denied: protected system path" }
```

See [Security](#security) section.
    </div>
</div>

### file.write

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">file.write</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">üìÅ Restricted</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Write file content.<br>üìÅ **Security**: Writing only allowed in foobar2000 config dir and temp dir.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | File path (Config/Temp dir only) |
| content | string | ‚úÖ | Content to write |
| append | boolean | - | Append mode, default false |

**Example**:
```javascript
// ‚úÖ Allowed - Config dir
await fb2k.invoke('file.write', {
    path: '%APPDATA%/foobar2000/foo_ui_webview2/config.json',
    content: JSON.stringify(config)
});

// ‚ùå Denied - Arbitrary path
await fb2k.invoke('file.write', { path: 'D:/test.txt', content: 'test' });
// Returns: { success: false, error: "Access denied: write not allowed to this path" }
```

See [Security](#security) section.
    </div>
</div>

### file.exists

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">file.exists</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Check if file or directory exists.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Path |

**Returns**:
```json
{ "exists": true, "isDirectory": false }
```
</div>
</div>

### file.list

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">file.list</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">List directory content.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Directory path |
| pattern | string | - | Filter pattern, e.g. *.mp3 |
| limit | number | - | Max results |

**Example**:
```javascript
const result = await fb2k.invoke('file.list', { 
    path: 'C:/Music', 
    pattern: '*.mp3',
    limit: 100 
});
```
</div>
</div>

### file.mkdir / file.delete

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">file.mkdir / file.delete</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Create directory or delete file.</div>

**Example**:
```javascript
// Create dir
await fb2k.invoke('file.mkdir', { path: 'C:/NewFolder' });

// Delete file
await fb2k.invoke('file.delete', { path: 'C:/temp.txt' });
```
    </div>
</div>

### file.copy üÜï

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">file.copy</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">üìÅ Restricted</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Copy file or directory. Recursive support.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| source | string | ‚úÖ | Source path |
| destination | string | ‚úÖ | Destination path |
| overwrite | boolean | - | Overwrite? default false |

**Returns**:
```json
{ "success": true, "source": "D:/Music/file.mp3", "destination": "D:/Backup/file.mp3" }
```

**Example**:
```javascript
const result = await fb2k.invoke('file.copy', {
    source: 'D:/Music/song.mp3',
    destination: 'D:/Backup/song.mp3',
    overwrite: true
});
```
    </div>
</div>

### file.move üÜï

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">file.move</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">üìÅ Restricted</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Move file or directory.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| source | string | ‚úÖ | Source path |
| destination | string | ‚úÖ | Destination path |

**Returns**:
```json
{ "success": true, "source": "D:/Music/file.mp3", "destination": "D:/Archive/file.mp3" }
```

**Example**:
```javascript
const result = await fb2k.invoke('file.move', {
    source: 'D:/Downloads/new_song.mp3',
    destination: 'D:/Music/new_song.mp3'
});
```
    </div>
</div>

### file.rename üÜï

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">file.rename</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">üìÅ Restricted</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Rename file or directory.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Original path |
| newName | string | ‚úÖ | New name (filename only) |

**Returns**:
```json
{ "success": true, "oldPath": "D:/Music/old.mp3", "newPath": "D:/Music/new.mp3" }
```

**Example**:
```javascript
const result = await fb2k.invoke('file.rename', {
    path: 'D:/Music/track01.mp3',
    newName: 'My Favorite Song.mp3'
});
```
    </div>
</div>

### file.getInfo üÜï

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">file.getInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get detailed file/directory info.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Path |

**Returns**:
```json
{
    "success": true,
    "path": "D:/Music/song.mp3",
    "exists": true,
    "isDirectory": false,
    "size": 5242880,
    "createdTime": "2025-01-01T12:00:00Z",
    "modifiedTime": "2025-01-02T15:30:00Z",
    "accessedTime": "2025-01-10T08:00:00Z",
    "isReadOnly": false,
    "isHidden": false
}
```

**Example**:
```javascript
const info = await fb2k.invoke('file.getInfo', { path: 'D:/Music/song.mp3' });
console.log(`Size: ${info.size} bytes`);
```
    </div>
</div>

</section>

<section id="dialog-api">

## Dialog API - System Dialogs

### dialog.openFile

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dialog.openFile</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Open file selection dialog.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| title | string | - | Dialog title |
| filters | array | - | File filters |
| multiple | boolean | - | Allow multiple |

**Returns**:
```json
{ "canceled": false, "filePaths": ["C:/song.mp3"] }
```

**Example**:
```javascript
const result = await fb2k.invoke('dialog.openFile', {
    title: 'Select Audio Files',
    filters: [{ name: 'Audio', extensions: ['mp3', 'flac', 'wav'] }],
    multiple: true
});
```
</div>
</div>

### dialog.saveFile

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dialog.saveFile</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Open save file dialog.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| title | string | - | Dialog title |
| defaultName | string | - | Default filename |
| filters | array | - | File filters |


**Example**:
```javascript
await fb2k.invoke('dialog.saveFile', {
    title: 'Save Playlist',
    defaultName: 'playlist.m3u8'
});
```
</div>
</div>

### dialog.openFolder

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dialog.openFolder</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Open folder selection dialog.</div>

**Example**:
```javascript
await fb2k.invoke('dialog.openFolder', { title: 'Select Music Folder' });
```
</div>
</div>

### dialog.confirm

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dialog.confirm</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Show confirmation dialog.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| title | string | - | Dialog title |
| message | string | ‚úÖ | Message content |
| type | string | - | Type: info, warning, error, question |

**Example**:
```javascript
const result = await fb2k.invoke('dialog.confirm', {
    title: 'Confirm',
    message: 'Are you sure you want to delete?',
    type: 'warning'
});
```
</div>
</div>

</section>

<section id="clipboard-api">

## Clipboard API

### clipboard.read

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">clipboard.read</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Read text from clipboard.</div>

**Returns**:
```json
{ "success": true, "text": "Clipboard Content" }
```
</div>
</div>

### clipboard.write

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">clipboard.write</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Write text to clipboard.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| text | string | ‚úÖ | Text to write |

**Example**:
```javascript
await fb2k.invoke('clipboard.write', { text: 'Hello!' });
```
</div>
</div>

### clipboard.writeHTML

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">clipboard.writeHTML</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Write HTML to clipboard.</div>

**Example**:
```javascript
await fb2k.invoke('clipboard.writeHTML', { html: '<b>Bold</b>' });
```
</div>
</div>

### clipboard.writeFiles

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">clipboard.writeFiles</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Write file list to clipboard (for pasting in Explorer).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| paths | string[] | ‚úÖ | Array of file paths |

**Example**:
```javascript
await fb2k.invoke('clipboard.writeFiles', { 
    paths: ['C:/Music/song1.mp3', 'C:/Music/song2.mp3'] 
});
```
</div>
</div>

</section>

<section id="shell-api">

## Shell API - System Integration

### shell.showInExplorer

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">shell.showInExplorer</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Show file in Explorer.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | File path |

**Example**:
```javascript
await fb2k.invoke('shell.showInExplorer', { path: 'C:/Music/song.mp3' });
```
</div>
</div>

### shell.openExternal

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">shell.openExternal</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Open URL or file with default program.</div>

**Example**:
```javascript
await fb2k.invoke('shell.openExternal', { url: 'https://www.foobar2000.org' });
```
</div>
</div>

### shell.exec

<div class="api-card" style="border-color: #f85149; opacity: 0.7;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #f85149;">DISABLED</span>
        <span class="api-card-name">shell.exec</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc" style="color: #f85149;">‚õî **DISABLED** - Arbitrary command execution is too risky so this API has been removed. Calls will return "Method not found" error.</div>

**Alternative**: Use `shell.openExternal` (Url) or `shell.openWith` (File).

See [Security](#security) section.
    </div>
</div>

### shell.openWith

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">shell.openWith</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">üö´ Restricted</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Open file with system default program.<br>üö´ **Security**: Opening executables (.exe/.bat/.cmd etc.) is blocked.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | File path (No executables) |

**Example**:
```javascript
// ‚úÖ Allowed
await fb2k.invoke('shell.openWith', { path: 'D:/Music/song.mp3' });

// ‚ùå Denied
await fb2k.invoke('shell.openWith', { path: 'C:/app.exe' });
// Returns: { success: false, error: "Executable files cannot be opened..." }
```

See [Security](#security) section.
    </div>
</div>

</section>

<section id="http-api">

## HTTP API - Network Requests

Uses WinHTTP to make network requests. Supports both Sync and Async modes.

> üí° **Performance Tip**: Default Sync mode blocks UI. To avoid blocking, use `async: true` or native browser `fetch()` API.

### http.get

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">http.get</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">üåê SSRF Protection</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Send HTTP GET request.<br>üåê **Security**: Local network access (localhost/192.168.x.x/10.x.x.x etc.) is blocked by default.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| url | string | ‚úÖ | Request URL |
| headers | object | - | Request headers |
| timeout | number | - | Timeout (ms), default 30000 |
| async | boolean | - | Async mode. If `true`, non-blocking, returns via `http:response` event |

**Returns (Sync Mode async=false, default)**:
```json
{ "success": true, "status": 200, "body": "...", "headers": {...} }
```

**Returns (Async Mode async=true)**:
```json
{ "success": true, "requestId": "http_1", "async": true }
```
Result returned via `http:response` event:
```json
{ "requestId": "http_1", "success": true, "status": 200, "body": "...", "headers": {...} }
```

**Example**:
```javascript
// üîí Sync Mode (Default, Blocks UI)
const result = await fb2k.invoke('http.get', {
    url: 'https://api.example.com/data',
    headers: { 'Authorization': 'Bearer token' }
});
console.log('Body:', result.body);

// ‚ö° Async Mode (Non-blocking)
fb2k.on('http:response', (data) => {
    if (data.requestId === myRequestId) {
        console.log('Response:', data.body);
    }
});
const asyncResult = await fb2k.invoke('http.get', {
    url: 'https://api.example.com/data',
    async: true
});
const myRequestId = asyncResult.requestId;

// ‚úÖ Recommended: Use browser native fetch() (Completely non-blocking)
const response = await fetch('https://api.example.com/data');
const data = await response.json();
```

> üí° Enable Local Network Access: **Preferences ‚Üí Advanced ‚Üí Tools ‚Üí WebView UI ‚Üí Allow local network access**
    </div>
</div>

### http.post

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">http.post</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">üåê SSRF Protection</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Send HTTP POST request.<br>üåê **Security**: Local network blocked by default.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| url | string | ‚úÖ | Request URL |
| body | string | - | Request body |
| headers | object | - | Request headers |
| timeout | number | - | Timeout (ms), default 30000 |
| async | boolean | - | Async mode, default `false` |

**Example**:
```javascript
// Sync Mode (Default)
const result = await fb2k.invoke('http.post', {
    url: 'https://api.example.com/submit',
    body: JSON.stringify({ key: 'value' }),
    headers: { 'Content-Type': 'application/json' }
});

// Recommended: Browser native fetch()
const response = await fetch('https://api.example.com/submit', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ key: 'value' })
});
```
</div>
</div>

### http.head

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">http.head</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Send HTTP HEAD request (Headers only, no body).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| url | string | ‚úÖ | Request URL |
| headers | object | - | Headers |
| timeout | number | - | Timeout (ms) |
| async | boolean | - | Async mode |

**Returns (Sync)**:
```json
{
    "success": true,
    "status": 200,
    "headers": { "Content-Length": "12345", "Content-Type": "audio/mpeg" },
    "contentLength": 12345
}
```

**Example**:
```javascript
// Check file size
const result = await fb2k.invoke('http.head', {
    url: 'https://example.com/file.mp3'
});
console.log(`Size: ${result.contentLength} bytes`);
```
</div>
</div>

### http.download

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">http.download</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Download file to local storage.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| url | string | ‚úÖ | Download URL |
| saveTo | string | ‚úÖ | Save path (Supports %profile%) |
| timeout | number | - | Timeout (ms), default 60000 |

**Returns**:
```json
{
    "success": true,
    "status": 200,
    "bytesWritten": 12345,
    "path": "C:\\path\\to\\file.mp3"
}
```

**Example**:
```javascript
await fb2k.invoke('http.download', {
    url: 'https://example.com/cover.jpg',
    saveTo: '%profile%\\covers\\album.jpg'
});
```
</div>
</div>

</section>

<section id="ui-api">

## UI API - Interaction

### ui.showCustomMenu

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">ui.showCustomMenu</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Show custom context menu.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| items | array | ‚úÖ | Menu items array |
| x | number | - | X coordinate |
| y | number | - | Y coordinate |
| suppressDefault | boolean | - | Suppress default menu (default false) |

**Returns**:
```json
{ "success": true, "selectedId": "play" }
```

**Example**:
```javascript
const result = await fb2k.invoke('ui.showCustomMenu', {
    items: [
        { id: 'play', label: 'Play' },
        { type: 'separator' },
        { id: 'delete', label: 'Delete' }
    ],
    x: event.clientX,
    y: event.clientY,
    suppressDefault: true // Ensure native/fb2k menu doesn't show
});
```
</div>
</div>

### ui.showToast

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">ui.showToast</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Show toast notification.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| message | string | ‚úÖ | Message |
| duration | number | - | Duration (ms) |

**Example**:
```javascript
await fb2k.invoke('ui.showToast', { 
    message: 'Operation Successful', 
    duration: 3000 
});
```
</div>
</div>

### ui.showNotification

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">ui.showNotification</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Show system notification.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| title | string | ‚úÖ | Title |
| message | string | ‚úÖ | Message |
| timeout | number | - | Timeout (ms) |

**Example**:
```javascript
await fb2k.invoke('ui.showNotification', {
    title: 'foobar2000',
    message: 'Now Playing: Song Title',
    timeout: 5000
});
```
</div>
</div>

### ui.hideNotification

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">ui.hideNotification</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Hide current notifications.</div>

**Returns**:
```json
{
    "success": true
}
```

**Example**:
```javascript
await fb2k.invoke('ui.hideNotification');
```
</div>
</div>

</section>

<section id="keyboard-api">

## Keyboard API - Shortcuts

### keyboard.registerHotkey

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">keyboard.registerHotkey</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Register global hotkey.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| id | string | ‚úÖ | Hotkey ID |
| key | string | ‚úÖ | Key name |
| modifiers | array | - | Modifiers: ctrl, alt, shift |

**Example**:
```javascript
await fb2k.invoke('keyboard.registerHotkey', {
    id: 'play_pause',
    key: 'Space',
    modifiers: ['ctrl', 'alt']
});

// Listen for hotkey
fb2k.on('keyboard:hotkeyPressed', (data) => {
    if (data.id === 'play_pause') {
        fb2k.invoke('playback.playOrPause');
    }
});
```
</div>
</div>

### keyboard.unregisterHotkey

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">keyboard.unregisterHotkey</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Unregister hotkey.</div>

**Example**:
```javascript
await fb2k.invoke('keyboard.unregisterHotkey', { id: 'play_pause' });
```
</div>
</div>

### keyboard.registerShortcut

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">keyboard.registerShortcut</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Register in-app shortcut.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| id | string | ‚úÖ | Shortcut ID |
| key | string | ‚úÖ | Key name |
| modifiers | array | - | Modifiers |
    </div>
</div>

### keyboard.getRegisteredHotkeys

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">keyboard.getRegisteredHotkeys</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get list of registered hotkeys.</div>

**Returns**:
```json
{
    "hotkeys": [
        { "id": "play_pause", "key": "Space", "modifiers": ["ctrl", "alt"] }
    ],
    "count": 1
}
```
</div>
</div>

</section>

<section id="lyrics-api">

## Lyrics API

### lyrics.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">lyrics.get</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get lyrics for current track.</div>

**Returns**:
```json
{ "success": true, "lyrics": "[00:00.00]Lyrics...", "type": "lrc" }
```
</div>
</div>

### lyrics.save

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">lyrics.save</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Save lyrics.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| lyrics | string | ‚úÖ | Lyrics content |
| embedded | boolean | - | true (Embed), false (Save as .lrc) |

**Example**:
```javascript
await fb2k.invoke('lyrics.save', { 
    lyrics: '[00:00.00]Lyrics content',
    embedded: true
});
```
</div>
</div>

### lyrics.exists

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">lyrics.exists</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Check if lyrics exist.</div>

**Returns**:
```json
{ "exists": true, "embedded": false, "external": true }
```
</div>
</div>

</section>

<section id="metadata-api">

## Metadata API

### metadata.read

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">metadata.read</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Read metadata from specific file (Structured).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Audio file path |

**Returns**:
```json
{
    "success": true,
    "path": "E:\\Music\\song.flac",
    "tags": {
        "TITLE": "Song Title",
        "ARTIST": "Artist Name",
        "ALBUM": "Album Name"
    },
    "info": {
        "duration": 180.5,
        "bitrate": 1411,
        "sampleRate": 44100,
        "channels": 2,
        "codec": "FLAC"
    }
}
```
</div>
</div>

### metadata.readByPath

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">metadata.readByPath</span>
        <span class="badge badge-green">v1.1.0</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Read all metadata from file (Flat). Returns tags and tech info at same level.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Audio file path |

**Returns**:
```json
{
    "success": true,
    "path": "E:\\Music\\song.flac",
    "TITLE": "Song Title",
    "ARTIST": "Artist Name",
    "ALBUM": "Album Name",
    "TRACKNUMBER": "1",
    "DATE": "2024",
    "GENRE": "Electronic",
    "BITRATE": "1411",
    "SAMPLERATE": "44100",
    "CHANNELS": "2",
    "CODEC": "FLAC",
    "ENCODING": "lossless",
    "DURATION": "180.500",
    "FILESIZE": "35000000"
}
```

**Example**:
```javascript
const meta = await fb2k.invoke('metadata.readByPath', {
    path: 'E:\\Music\\song.flac'
});
console.log(meta.TITLE, meta.ARTIST, meta.DURATION);
```

> üí° **Tip**: Unlike `metadata.read`, this API returns a flat structure with uppercase tag keys for direct access.
    </div>

### metadata.write

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">metadata.write</span>
        <span class="badge badge-blue">v1.1.6 Enhanced</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Write metadata tags to file.<br>
        <strong>v1.1.6</strong>: Now implements true tag writing.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Audio file path |
| tags | object | ‚úÖ | Tag key-value pairs. Set value to null to remove tag. |

**Example**:
```javascript
await fb2k.invoke('metadata.write', {
    path: 'E:\\Music\\song.flac',
    tags: {
        TITLE: 'New Title',
        ARTIST: 'New Artist',
        RATING: '5'
    }
});
```
    </div>
</div>

### metadata.removeTag

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">metadata.removeTag</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Remove specific tags.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Audio file path |
| tags | array | ‚úÖ | Array of tag names to remove |

**Example**:
```javascript
await fb2k.invoke('metadata.removeTag', {
    path: 'E:\\Music\\song.flac',
    tags: ['COMMENT', 'RATING']
});
```
    </div>
</div>

### metadata.writeBatch

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">metadata.writeBatch</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Batch write metadata to multiple files.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| items | array | ‚úÖ | Array containing path and tags objects |
    </div>
</div>

### metadata.embedArtwork

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">metadata.embedArtwork</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Embed artwork into audio file. Supports multiple types.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Audio file path |
| imageData | string | ‚úÖ | Base64 encoded image data |
| type | string | ‚ùå | Artwork type, default "front" |

**Supported Types**:
| Type | Description |
|---|---|
| `front` / `cover_front` | Front Cover (Default) |
| `back` / `cover_back` | Back Cover |
| `disc` | Disc Art |
| `icon` | Album Icon |
| `artist` | Artist Image |

**Returns**:
```json
{
  "success": true,
  "path": "E:\\Music\\song.flac",
  "type": "front",
  "size": 45678
}
```

**Example**:
```javascript
// Embed front cover
await fb2k.invoke('metadata.embedArtwork', {
  path: 'E:\\Music\\song.flac',
  imageData: 'base64EncodedImageData...',
  type: 'front'
});

// Embed artist image
await fb2k.invoke('metadata.embedArtwork', {
  path: 'E:\\Music\\song.flac',
  imageData: 'base64EncodedImageData...',
  type: 'artist'
});
```

> ‚ö†Ô∏è **Note**: Not all audio formats support embedded artwork. Common formats like FLAC, MP3, M4A usually do.
    </div>
</div>

### metadata.removeEmbeddedArt

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">metadata.removeEmbeddedArt</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Remove embedded artwork from audio file.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Audio file path |
| type | string | ‚ùå | Artwork type to remove (Empty removes all) |
| removeAll | boolean | ‚ùå | Set to true to remove all artwork |

**Returns**:
```json
{
  "success": true,
  "path": "E:\\Music\\song.flac",
  "removedTypes": ["front", "back", "disc", "icon", "artist"]
}
```

**Example**:
```javascript
// Remove specific type
await fb2k.invoke('metadata.removeEmbeddedArt', {
  path: 'E:\\Music\\song.flac',
  type: 'back'
});

// Remove all
await fb2k.invoke('metadata.removeEmbeddedArt', {
  path: 'E:\\Music\\song.flac',
  removeAll: true
});
```
    </div>
</div>

### rating.set

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">rating.set</span>
        <span class="badge badge-green">v1.1.6</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set track rating (1-5 stars). Writes to RATING tag in file.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Audio file path |
| rating | number | ‚úÖ | Rating value (0-5), 0 = Clear rating |

**Returns**:
```json
{
    "success": true,
    "path": "E:\\Music\\song.flac",
    "rating": 5
}
```

**Example**:
```javascript
// Set 5 stars
await fb2k.invoke('rating.set', {
    path: 'E:\\Music\\song.flac',
    rating: 5
});

// Clear rating
await fb2k.invoke('rating.set', {
    path: 'E:\\Music\\song.flac',
    rating: 0
});
```

> üí° **Tip**: Rating 0 removes the RATING tag. Ratings are persisted to file and compatible with other foobar2000 components.
    </div>
</div>

### rating.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">rating.get</span>
        <span class="badge badge-green">v1.1.6</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get track rating.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Audio file path |

**Returns**:
```json
{
    "success": true,
    "path": "E:\\Music\\song.flac",
    "rating": 4
}
```

**Example**:
```javascript
const result = await fb2k.invoke('rating.get', {
    path: 'E:\\Music\\song.flac'
});
console.log(`Rating: ${result.rating}/5`);  // Rating: 4/5
```
    </div>
</div>

</section>

<section id="audio-api">

## Audio API - Audio Analysis (12)

### audio.subscribeSpectrum

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">audio.subscribeSpectrum</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Subscribe to real-time spectrum data. Uses foobar2000 visualisation_stream API for FFT.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| fftSize | number | - | FFT Size, power of 2 (256-8192), default 1024 |
| fps | number | - | Frame rate (1-60), default 30 |
| event | string | - | Event name, default "audio:spectrum" |

**Returns**:
```json
{
    "success": true,
    "subscriptionId": "spectrum_main",
    "fftSize": 1024,
    "fps": 30,
    "event": "audio:spectrum"
}
```

**Example**:
```javascript
await fb2k.invoke('audio.subscribeSpectrum', {
    fftSize: 1024,
    fps: 30
});

// Receive spectrum data
fb2k.on('audio:spectrum', (data) => {
    // data.spectrum = [0.5, 0.8, 0.3, ...] (Normalized)
    renderVisualizer(data.spectrum);
});
```
</div>
</div>

### audio.unsubscribeSpectrum

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">audio.unsubscribeSpectrum</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Unsubscribe spectrum data, release resources.</div>
    </div>
</div>

### audio.getSpectrum

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">audio.getSpectrum</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Manually get current spectrum data (Polling mode). Requires subscribeSpectrum first.</div>

**Returns**:
```json
{
    "success": true,
    "spectrum": [0.1, 0.3, 0.8, ...],
    "fftSize": 1024
}
```
</div>
</div>

### audio.getWaveform

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">audio.getWaveform</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current playback waveform fragment (Real-time).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| duration | number | - | Duration (seconds), default 0.05 |

**Returns**:
```json
{
    "success": true,
    "waveform": [-0.1, 0.3, -0.5, ...],
    "duration": 0.05
}
```
</div>
</div>

### audio.setChannelMode

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">audio.setChannelMode</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set spectrum analysis channel mode.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| mode | string | - | "default", "mono", "front", "back" |
</div>
</div>

### audio.subscribeStream

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">audio.subscribeStream</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Subscribe to audio stream capture (for recording/streaming).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| event | string | - | Event name, default "audio:stream" |
| interval | number | - | Callback interval (sec), default 0.05 |

**Note**: Requires playback_stream_capture integration.
</div>
</div>

### audio.unsubscribeStream

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">audio.unsubscribeStream</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Unsubscribe audio stream capture.</div>
    </div>
</div>

### audio.analyzeBPM

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method query">QUERY</span>
        <span class="api-card-name">audio.analyzeBPM</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Analyze track BPM. Tries metadata first, then estimates from genre.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Audio file path |
| forceAnalysis | boolean | - | Force re-analysis (Skip metadata) |

**Returns**:
```json
{
    "success": true,
    "bpm": 128,
    "source": "metadata",  // "metadata", "estimate"
    "confidence": 1.0      // 1.0=metadata, 0.3=genre estimate
}
```

**Genre BPM Estimation**:
- Drum & Bass: 174
- Dubstep: 140
- House: 128
- Techno: 130
- Trance: 138
- Hip-Hop: 90
- Rock/Pop: 120
</div>
</div>

### audio.generateWaveform

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method query">QUERY</span>
        <span class="api-card-name">audio.generateWaveform</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Generate waveform visualization data (Requires audio decoding).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| path | string | ‚úÖ | Audio file path |
| resolution | number | - | Data points (50-4000), default 800 |

**Returns**:
```json
{
    "success": true,
    "peaks": [0.8, 0.6, 0.9, ...],
    "rms": [0.3, 0.2, 0.4, ...],
    "duration": 234.5,
    "sampleRate": 44100,
    "channels": 2,
    "resolution": 800
}
```
</div>
</div>

### audio.getOutputInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">audio.getOutputInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current audio output info.</div>

**Returns**:
```json
{
    "success": true,
    "volume": -10.0,
    "volumePercent": 31.6
}
```
</div>
</div>

### audio.getStreamInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">audio.getStreamInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current playback stream info.</div>

**Returns**:
```json
{
    "success": true,
    "playing": true,
    "sampleRate": 44100,
    "channels": 2,
    "bitrate": 320,
    "codec": "MP3",
    "duration": 234.5
}
```
</div>
</div>

### audio.isVisualizationAvailable

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">audio.isVisualizationAvailable</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Check if visualization is available.</div>

**Returns**:
```json
{
    "success": true,
    "available": true
}
```
</div>
</div>

</section>

<section id="console-api">

## Console API - Logging

### console.log / console.warn / console.error

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">console.log / warn / error</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Output to foobar2000 console.</div>

**Example**:
```javascript
await fb2k.invoke('console.log', { message: 'Normal log' });
await fb2k.invoke('console.warn', { message: 'Warning message' });
await fb2k.invoke('console.error', { message: 'Error message' });
```
</div>
</div>

### log.write

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">log.write</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Write to log file.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| message | string | ‚úÖ | Log content |
| level | string | - | Log level: info, warn, error |

**Example**:
```javascript
await fb2k.invoke('log.write', { 
    message: 'Log entry',
    level: 'info'
});
```
</div>
</div>

### log.read

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">log.read</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Read log file.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| lines | number | - | Lines to read, default 100 |
    </div>
</div>

### log.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">log.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Clear log file.</div>

**Returns**:
```json
{ "success": true }
```
</div>
</div>

</section>

<section id="dnd-api">

## DnD API - Drag & Drop

### dnd.registerDropZone

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dnd.registerDropZone</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Register drop zone.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| elementId | string | ‚úÖ | DOM Element ID |
| accepts | array | - | Accepted MIME types |

**Example**:
```javascript
await fb2k.invoke('dnd.registerDropZone', {
    elementId: 'playlist-area',
    accepts: ['audio/*', 'application/x-foobar2000-playlist']
});

// Listen for drop event
fb2k.on('dnd:drop', (data) => {
    console.log('Dropped files:', data.files);
});
```
</div>
</div>

### dnd.unregisterDropZone

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dnd.unregisterDropZone</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Unregister drop zone.</div>

**Example**:
```javascript
await fb2k.invoke('dnd.unregisterDropZone', { elementId: 'playlist-area' });
```
</div>
</div>

### dnd.getDropZones

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">dnd.getDropZones</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get all registered drop zones.</div>

**Returns**:
```json
{
    "zones": [
        { "elementId": "playlist-area", "accepts": ["audio/*"] }
    ],
    "count": 1
}
```
</div>
</div>

### dnd.startDrag

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dnd.startDrag</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Start drag operation (Drag from WebView).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| type | string | ‚úÖ | Data type |
| data | any | ‚úÖ | Drag data |
    </div>
</div>

</section>

<!-- ==================== QUEUE API ==================== -->
<section id="queue-api">

## Queue API - Playback Queue üÜï

foobar2000 native playback queue management. Supports "Play Next", mixing local files and stream URLs.

### queue.addPaths üÜï

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">queue.addPaths</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Add paths/URLs to queue in one step. Core API for "Play Next". Auto handles playlist addition and queuing.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| paths | array | ‚úÖ | Array of file paths or URLs |
| playlist | number | - | Target playlist index (Default: Dedicated queue playlist) |
| useQueuePlaylist | boolean | - | Use dedicated "[WebView Queue]" playlist (Default true) |

**Returns**:
```json
{
    "success": true,
    "addedCount": 2,
    "playlist": 3,
    "queueCount": 5
}
```

**Example**:
```javascript
// Play Next - Simplest usage
await fb2k.invoke('queue.addPaths', { 
    paths: ['C:/Music/song.mp3', 'http://stream.example.com/audio.mp3']
});

// Add to specific playlist
await fb2k.invoke('queue.addPaths', { 
    paths: ['D:/Music/album/*.flac'],
    playlist: 0,
    useQueuePlaylist: false
});
```
</div>
</div>

### queue.add

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">queue.add</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Add items from playlist to queue.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| playlist | number | - | Playlist index (Default active) |
| track | number | - | Single track index |
| tracks | array | - | Track index array |


**Example**:
```javascript
// Add single track
await fb2k.invoke('queue.add', { playlist: 0, track: 5 });

// Add multiple tracks
await fb2k.invoke('queue.add', { playlist: 0, tracks: [3, 5, 7] });
```
</div>
</div>

### queue.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">queue.get</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current queue content.</div>

**Returns**:
```json
{
    "items": [
        {
            "queueIndex": 0,
            "path": "C:/Music/song.mp3",
            "title": "Song Title",
            "artist": "Artist Name",
            "album": "Album Name",
            "duration": 245.5,
            "playlist": 0,
            "playlistItem": 15
        }
    ],
    "count": 3
}
```

**Example**:
```javascript
const queue = await fb2k.invoke('queue.get');
console.log(`Queue has ${queue.count} songs`);
queue.items.forEach(item => {
    console.log(`${item.title} - ${item.artist}`);
});
```
</div>
</div>

### queue.remove

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">queue.remove</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Remove specific items from queue.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| index | number | - | Queue index to remove |
| indices | array | - | Array of queue indices to remove |

**Example**:
```javascript
// Remove first item
await fb2k.invoke('queue.remove', { index: 0 });

// Remove multiple items
await fb2k.invoke('queue.remove', { indices: [0, 2, 4] });
```
</div>
</div>

### queue.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">queue.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Clear entire queue.</div>

**Returns**:
```json
{ "success": true, "clearedCount": 5 }
```

**Example**:
```javascript
await fb2k.invoke('queue.clear');
```
</div>
</div>

### queue.getCount

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">queue.getCount</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get number of items in queue.</div>

**Returns**:
```json
{ "count": 3, "hasItems": true }
```
</div>
</div>

### queue.moveToTop

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">queue.moveToTop</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Move specific item to top of queue (Play Next).</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| index | number | ‚úÖ | Queue index to move |

**Example**:
```javascript
// Move 3rd item to top
await fb2k.invoke('queue.moveToTop', { index: 2 });
```
</div>
</div>

</section>

<!-- ==================== JIT QUEUE API ==================== -->
<section id="jit-queue-api">

## JIT Queue API (Streaming Just-In-Time Queue) üÜï

JIT Queue (Just-In-Time Queue) is a dual-layer queue architecture designed for streaming. Unlike the native Queue API, JIT Queue uses a "Frontend Logic, Backend Execution" model, solving the issue of streaming URL expiration.

### Architecture

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Frontend (Web/Vue3)                       ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  Logical Queue (Pinia Store)                            ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - tracks: Track[] (Full Metadata, 1000+ songs)         ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - playMode: 'list' | 'shuffle' | 'repeat'            ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îÇ                          ‚Üì fb2k.call()                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                    C++ Backend                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ
‚îÇ  ‚îÇ  QueueManager (Shadow Playlist)                        ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - Buffers only 2-3 songs                               ‚îÇ  ‚îÇ
‚îÇ  ‚îÇ  - URL resolved JIT, never expires                      ‚îÇ  ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Core Advantages**:
- **URLs Never Expire**: URLs are resolved only moments before playback.
- **Low Memory Usage**: Backend buffers only 2-3 songs.
- **Flexible Logic**: Shuffle, loop, and flow modes controlled entirely by frontend.
- **Seamless Transition**: Next song preloaded during current playback.

### jitQueue.playNow

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.playNow</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Play specific track immediately. Clears buffer and starts new session. <strong>v1.1.3+: Supports both HTTP streaming URLs and local file paths.</strong></div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| trackId | string | ‚úÖ | Frontend unique ID (e.g., `netease_12345` or `local_xxx`) |
| title | string | ‚ùå | Track title (For display) |
| url | string | ‚úÖ | Stream URL **or** Local path (Auto-detected) |

**URL Detection**:
- Starts with `http://` or `https://` ‚Üí Streaming mode (shadow playlist)
- Windows absolute path (`E:\Music\song.flac`) ‚Üí Local file mode
- UNC path (`\\server\share\song.mp3`) ‚Üí Local file mode

**Example**:
```javascript
// Streaming URL
const url = await fetchRealUrl(track.id);
const result = await fb2k.invoke('jitQueue.playNow', {
    trackId: 'netease_12345',
    title: 'Song Title',
    url: url  // http://...
});

// Local File Path (v1.1.3+)
const result = await fb2k.invoke('jitQueue.playNow', {
    trackId: 'local_001',
    title: 'Song Title',
    url: 'E:\\Music\\song.flac'  // Local path
});
// { success: true, trackId: "...", shadowPlaylist: 5 }
```
</div>
</div>

### jitQueue.enqueueNext

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.enqueueNext</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Preload next track into buffer. Call in response to `jitQueue:needNext`. <strong>v1.1.3+: Supports both URL and local paths.</strong></div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| trackId | string | ‚úÖ | Frontend unique ID |
| title | string | ‚ùå | Track title |
| url | string | ‚úÖ | Stream URL **or** Local path |

**Example**:
```javascript
// Respond to needNext event
fb2k.on('jitQueue:needNext', async ({ currentTrackId }) => {
    const nextTrack = getNextTrack(currentTrackId);
    if (nextTrack) {
        const url = await fetchRealUrl(nextTrack.id);
        await fb2k.invoke('jitQueue.enqueueNext', {
            trackId: nextTrack.id,
            title: nextTrack.title,
            url: url
        });
    }
});
```

**Returns**:
```json
{ "success": true, "trackId": "netease_67890", "bufferSize": 2 }
```
</div>
</div>

### jitQueue.skip

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.skip</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Skip to next track in buffer.</div>

**Example**:
```javascript
await fb2k.invoke('jitQueue.skip');
// { success: true, currentTrackId: "netease_67890" }
```
</div>
</div>

### jitQueue.stop

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.stop</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Stop playback and optionally clear buffer.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| clearBuffer | boolean | ‚ùå | Clear buffer (default true) |

**Example**:
```javascript
// Stop and clear
await fb2k.invoke('jitQueue.stop');

// Stop but keep buffer
await fb2k.invoke('jitQueue.stop', { clearBuffer: false });
```
</div>
</div>

### jitQueue.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Clear shadow playlist buffer.</div>

**Example**:
```javascript
await fb2k.invoke('jitQueue.clear');
// { success: true }
```
</div>
</div>

### jitQueue.getState

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method getter">GETTER</span>
        <span class="api-card-name">jitQueue.getState</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current JIT queue state.</div>

**Returns**:
```json
{
    "isActive": true,
    "currentTrackId": "netease_12345",
    "nextTrackId": "netease_67890",
    "bufferSize": 2,
    "shadowPlaylist": 5
}
```
</div>
</div>

### jitQueue.notifyEmpty

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.notifyEmpty</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Notify backend that frontend has no more tracks. Triggers recommendations etc.</div>

**Example**:
```javascript
fb2k.on('jitQueue:needNext', async ({ currentTrackId }) => {
    const nextTrack = getNextTrack(currentTrackId);
    if (!nextTrack) {
        // No more tracks, notify backend
        await fb2k.invoke('jitQueue.notifyEmpty');
    }
});
```
</div>
</div>

### JIT Queue Events

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">jitQueue:needNext</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Backend requests next track from frontend. Triggered when current track starts or nears end.</div>

```javascript
fb2k.on('jitQueue:needNext', async ({ currentTrackId }) => {
    console.log('Backend needs next track, current:', currentTrackId);
    
    // Calculate next track based on play mode
    const nextTrack = calculateNextTrack(currentTrackId, playMode);
    
    if (nextTrack) {
        const url = await fetchRealUrl(nextTrack.id);
        await fb2k.invoke('jitQueue.enqueueNext', {
            trackId: nextTrack.id,
            title: nextTrack.title,
            url: url
        });
    }
});
```

**Event Data**:
```json
{ "currentTrackId": "netease_12345" }
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">jitQueue:trackChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when JIT Queue current track changes. Use to update UI highlight.</div>

```javascript
fb2k.on('jitQueue:trackChanged', ({ trackId, title }) => {
    console.log('Now playing:', trackId, title);
    highlightTrack(trackId);
});
```

**Event Data**:
```json
{ "trackId": "netease_12345", "title": "Song Title" }
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">jitQueue:listExhausted</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when buffer is empty and no more tracks available. Use to fetch recommendations.</div>

```javascript
fb2k.on('jitQueue:listExhausted', async ({ lastTrackId }) => {
    console.log('Queue exhausted, last track was:', lastTrackId);
    
    // Fetch recommendations
    const recommendations = await fetchRecommendations(lastTrackId);
    addToLogicalQueue(recommendations);
});
```

**Event Data**:
```json
{ "lastTrackId": "netease_12345" }
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">jitQueue:error</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered on URL resolution failure or other errors.</div>

```javascript
fb2k.on('jitQueue:error', ({ trackId, error, url }) => {
    console.error('Failed to play:', trackId, error);
    showErrorToast(`Playback failed: ${error}`);
});
```

**Event Data**:
```json
{
    "trackId": "netease_12345",
    "error": "Failed to resolve URL",
    "url": "https://..."
}
```
</div>
</div>

### Complete Usage Example

```javascript
// stores/jitQueue.ts
import { defineStore } from 'pinia';

export const useJitQueueStore = defineStore('jitQueue', {
    state: () => ({
        tracks: [],           // Full logical queue
        currentIndex: -1,
        playMode: 'list'      // 'list' | 'shuffle' | 'repeat'
    }),

    actions: {
        // Play specific track
        async play(index) {
            this.currentIndex = index;
            const track = this.tracks[index];
            
            // Get real URL (Call streaming API)
            const url = await fetchRealUrl(track.id);
            
            // Send to C++ to play immediately
            await fb2k.invoke('jitQueue.playNow', {
                trackId: track.id,
                title: track.title,
                url: url
            });
        },

        // Calculate next track
        getNextTrack(currentId) {
            const currentIdx = this.tracks.findIndex(t => t.id === currentId);
            if (currentIdx === -1) return null;

            let nextIdx;
            switch (this.playMode) {
                case 'shuffle':
                    nextIdx = Math.floor(Math.random() * this.tracks.length);
                    break;
                case 'repeat':
                    nextIdx = currentIdx;
                    break;
                default:
                    nextIdx = currentIdx + 1;
            }

            return nextIdx < this.tracks.length ? this.tracks[nextIdx] : null;
        }
    }
});

// App.vue - Global Event Listeners
const jitQueueStore = useJitQueueStore();

fb2k.on('jitQueue:needNext', async ({ currentTrackId }) => {
    const nextTrack = jitQueueStore.getNextTrack(currentTrackId);
    
    if (nextTrack) {
        const url = await fetchRealUrl(nextTrack.id);
        await fb2k.invoke('jitQueue.enqueueNext', {
            trackId: nextTrack.id,
            title: nextTrack.title,
            url: url
        });
    } else {
        await fb2k.invoke('jitQueue.notifyEmpty');
    }
});

fb2k.on('jitQueue:trackChanged', ({ trackId }) => {
    jitQueueStore.currentIndex = jitQueueStore.tracks.findIndex(t => t.id === trackId);
});

fb2k.on('jitQueue:listExhausted', async ({ lastTrackId }) => {
    // Flow Mode: Auto fetch recommendations
    const recommendations = await fetchRecommendations(lastTrackId);
    jitQueueStore.tracks.push(...recommendations);
});
```

</section>

<!-- ==================== DISCOVERY API ==================== -->
<section id="discovery-api">

## Discovery API (Active Service Discovery) üÜï

> **Status**: 11 APIs Implemented
> **Version**: 1.1.3+

Actively discover services registered by other foobar2000 components, including main menu commands, input formats, DSPs, UI elements, etc. Unlike the passive mode of PluginRegistry, Discovery API actively enumerates all registered services in the system.

---

### discovery.getAllServices

Get statistical summary of all discoverable services.

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getAllServices</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Returns count statistics for various services. Useful to understand current component and feature scale.</div>
        <p><strong>Request</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getAllServices', {});</code></pre>
        <p><strong>Response</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "services": {
        "mainMenuCommands": 156,
        "mainMenuGroups": 42,
        "inputFormats": 30,
        "uiElements": 25,
        "dspEntries": 18,
        "outputDevices": 5,
        "preferencePages": 35,
        "components": 32
    },
    "totalServices": 324
}</code></pre>
    </div>
</div>

---

### discovery.getComponents

Get information about all installed components.

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getComponents</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Enumerates all installed components, including filename, name, version, and description.</div>
        <p><strong>Request</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getComponents', {});</code></pre>
        <p><strong>Response</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 32,
    "components": [
        {
            "filename": "foo_ui_webview2.dll",
            "name": "WebView UI",
            "version": "1.1.3",
            "about": "Modern WebView2-based UI for foobar2000"
        },
        {
            "filename": "foo_input_sacd.dll",
            "name": "SACD Decoder",
            "version": "1.2.0",
            "about": "Super Audio CD decoder"
        },
        {
            "filename": "ESLyric.dll",
            "name": "ESLyric",
            "version": "0.5.4",
            "about": "Enhanced lyrics display and search"
        }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getMainMenuCommands

Get all main menu commands (from all components).

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getMainMenuCommands</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Enumerates all commands in the main menu, including those registered by other components.</div>
        <p><strong>Request</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getMainMenuCommands', {});</code></pre>
        <p><strong>Response</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 156,
    "commands": [
        {
            "name": "Play",
            "description": "Start playback",
            "guid": "{A7A5E4F1-...}",
            "parentGuid": "{00000000-...}",
            "index": 0
        },
        {
            "name": "Search Lyrics",
            "description": "Search lyrics for current track",
            "guid": "{B8C6D7E2-...}",
            "parentGuid": "{ESLyric-GUID}",
            "index": 0
        }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.executeMainMenuCommand

Execute a main menu command by GUID.

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method post">POST</span>
        <span class="api-card-name">discovery.executeMainMenuCommand</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Execute any main menu command, useful for invoking features provided by other components.</div>
        <p><strong>Request</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.executeMainMenuCommand', {
    guid: '{A7A5E4F1-1234-5678-9ABC-DEF012345678}'
});</code></pre>
        <p><strong>Response</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "guid": "{A7A5E4F1-1234-5678-9ABC-DEF012345678}"
}</code></pre>
        <p><strong>Example - Search Lyrics</strong>:</p>
        <pre><code class="language-javascript">// Search for lyric command first
const result = await fb2k.invoke('discovery.searchCommands', { query: 'lyric' });
const lyricCommand = result.results[0];

// Execute that command
if (lyricCommand) {
    await fb2k.invoke('discovery.executeMainMenuCommand', { 
        guid: lyricCommand.guid 
    });
}</code></pre>
    </div>
</div>

---

### discovery.searchCommands

Search main menu commands by name/description.

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.searchCommands</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Fuzzy search for main menu commands by name or description.</div>
        <p><strong>Request</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.searchCommands', {
    query: 'lyric'  // Search keyword (Case insensitive)
});</code></pre>
        <p><strong>Response</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "query": "lyric",
    "count": 3,
    "results": [
        {
            "name": "Search Lyrics",
            "description": "Search lyrics online",
            "guid": "{...}",
            "type": "mainmenu"
        },
        {
            "name": "Save Lyrics",
            "description": "Save lyrics to file",
            "guid": "{...}",
            "type": "mainmenu"
        }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getInputFormats

Get supported audio input formats.

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getInputFormats</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Enumerates all audio formats supported by foobar2000, including those from third-party decoders.</div>
        <p><strong>Request</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getInputFormats', {});</code></pre>
        <p><strong>Response</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 30,
    "fileTypes": [
        { "name": "FLAC Audio", "mask": "*.flac", "index": 0 },
        { "name": "MP3 Audio", "mask": "*.mp3", "index": 1 },
        { "name": "SACD ISO", "mask": "*.iso", "index": 2 },
        { "name": "DSD Audio", "mask": "*.dsf;*.dff", "index": 3 }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getMainMenuGroups

Get main menu group structure.

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getMainMenuGroups</span>
    </div>
    <div class="api-card-body">
        <p><strong>Request</strong>:</p>

**Response**:
```json
{
    "success": true,
    "count": 42,
    "groups": [
        { "guid": "{...}", "parentGuid": "{...}", "name": "File", "sortPriority": 0 },
        { "guid": "{...}", "parentGuid": "{...}", "name": "View", "sortPriority": 1 }
    ]
}
```
    </div>
</div>

---

### discovery.getUIElements

Get UI element list.

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getUIElements</span>
    </div>
    <div class="api-card-body">
        <p><strong>Request</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getUIElements', {});</code></pre>
        <p><strong>Response</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 25,
    "elements": [
        {
            "guid": "{...}",
            "subclassGuid": "{...}",
            "name": "Playlist View",
            "description": "Standard playlist viewer",
            "isUserAddable": true
        }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getDspEntries

Get DSP processor list.

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getDspEntries</span>
    </div>
    <div class="api-card-body">
        <p><strong>Request</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getDspEntries', {});</code></pre>
        <p><strong>Response</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 18,
    "entries": [
        { "guid": "{...}", "name": "Resampler (PPHS)" },
        { "guid": "{...}", "name": "Equalizer" },
        { "guid": "{...}", "name": "ReplayGain" }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getOutputDevices

Get output device list.

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getOutputDevices</span>
    </div>
    <div class="api-card-body">
        <p><strong>Request</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getOutputDevices', {});</code></pre>
        <p><strong>Response</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 5,
    "devices": [
        { "guid": "{...}" },
        { "guid": "{...}" }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getPreferencePages

Get preference page list.

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getPreferencePages</span>
    </div>
    <div class="api-card-body">
        <p><strong>Request</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getPreferencePages', {});</code></pre>
        <p><strong>Response</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 35,
    "pages": [
        { "guid": "{...}", "parentGuid": "{...}", "name": "Playback" },
        { "guid": "{...}", "parentGuid": "{...}", "name": "Output" },
        { "guid": "{...}", "parentGuid": "{...}", "name": "WebView UI" }
    ]
}</code></pre>
    </div>
</div>

</section>

<!-- ==================== DSP API ==================== -->
<section id="dsp-api">

## DSP API - Effect Management (8) üÜï

DSP (Digital Signal Processing) effect chain management.

### dsp.getPresets

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">dsp.getPresets</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get all DSP presets list.</div>

**Returns**:
```json
{
    "success": true,
    "presets": [
        { "index": 0, "name": "Flat" },
        { "index": 1, "name": "Loudness" }
    ]
}
```
    </div>
</div>

### dsp.getActivePreset

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">dsp.getActivePreset</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get currently active DSP preset.</div>

**Returns**:
```json
{ "success": true, "index": 0, "name": "Flat" }
```
    </div>
</div>

### dsp.setActivePreset

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dsp.setActivePreset</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set active DSP preset.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| index | number | ‚úÖ | Preset index |
    </div>
</div>

### dsp.getChain

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">dsp.getChain</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current DSP effect chain.</div>

**Returns**:
```json
{
    "success": true,
    "chain": [
        { "guid": "{...}", "name": "Equalizer", "index": 0 },
        { "guid": "{...}", "name": "Compressor", "index": 1 }
    ]
}
```
    </div>
</div>

### dsp.setChain

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dsp.setChain</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set DSP effect chain.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| chain | array | ‚úÖ | DSP configuration array |
    </div>
</div>

### dsp.addDsp / dsp.removeDsp / dsp.moveDsp

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dsp.addDsp / removeDsp / moveDsp</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Add, remove, or move DSP effects.</div>

**Example**:
```javascript
// Add DSP
await fb2k.invoke('dsp.addDsp', { guid: '{...}' });

// Remove DSP
await fb2k.invoke('dsp.removeDsp', { index: 0 });

// Move DSP
await fb2k.invoke('dsp.moveDsp', { fromIndex: 0, toIndex: 1 });
```
    </div>
</div>

</section>

<!-- ==================== OUTPUT API ==================== -->
<section id="output-api">

## Output API - Audio Output (3) üÜï

Audio output device management.

### output.getDevices

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">output.getDevices</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get all available audio output devices.</div>

**Returns**:
```json
{
    "success": true,
    "devices": [
        { "name": "WASAPI: Speakers", "id": "{...}", "isCurrent": true },
        { "name": "DirectSound: Headphones", "id": "{...}", "isCurrent": false }
    ]
}
```
    </div>
</div>

### output.getSettings

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">output.getSettings</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current output settings.</div>

**Returns**:
```json
{
    "success": true,
    "outputId": "{...}",
    "deviceId": "{...}",
    "bufferLength": 1.0,
    "bitDepth": 16
}
```
    </div>
</div>

### output.getEntries

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">output.getEntries</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get output module list (WASAPI, DirectSound, etc.).</div>
    </div>
</div>

</section>

<!-- ==================== REPLAYGAIN API ==================== -->
<section id="replaygain-api">

## ReplayGain API (5) üÜï

ReplayGain volume normalization settings.

### replaygain.getSettings

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">replaygain.getSettings</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get ReplayGain settings.</div>

**Returns**:
```json
{
    "success": true,
    "mode": "track",
    "preamp": 0.0,
    "preampWithRg": 0.0
}
```
    </div>
</div>

### replaygain.getMode

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">replaygain.getMode</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get current ReplayGain mode.</div>

**Returns**:
```json
{ "success": true, "mode": "track" }  // "none", "track", "album"
```
    </div>
</div>

### replaygain.setMode

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">replaygain.setMode</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Set ReplayGain mode.</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| mode | string | ‚úÖ | "none", "track", "album" |
    </div>
</div>

### replaygain.getPreamp / setPreamp

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">replaygain.getPreamp / setPreamp</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get or set preamp gain (dB).</div>

**Parameters (setPreamp)**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| preamp | number | ‚úÖ | Gain value (dB) |

**Example**:
```javascript
// Get preamp
const result = await fb2k.invoke('replaygain.getPreamp', {});
console.log(result.preamp); // 0.0

// Set preamp
await fb2k.invoke('replaygain.setPreamp', { preamp: 3.0 });
```
    </div>
</div>

### replaygain.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">replaygain.get</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get file ReplayGain info (trackGain, trackPeak, albumGain, albumPeak). üÜï v1.1.12</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| paths | string[] | ‚úÖ | File path array |

**Returns**:
```json
{
  "success": true,
  "count": 1,
  "results": [
    {
      "path": "E:\\Music\\track.flac",
      "success": true,
      "hasReplayGain": true,
      "trackGain": "-6.50 dB",
      "trackGainRaw": -6.5,
      "trackPeak": "0.988000",
      "trackPeakRaw": 0.988,
      "albumGain": "-6.25 dB",
      "albumGainRaw": -6.25,
      "albumPeak": "0.995000",
      "albumPeakRaw": 0.995
    }
  ]
}
```

**Example**:
```javascript
const rg = await fb2k.invoke('replaygain.get', {
  paths: ["E:\\Music\\track1.flac", "E:\\Music\\track2.flac"]
});
console.log(rg.results[0].trackGain); // "-6.50 dB"
```
    </div>
</div>

### replaygain.scan

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">replaygain.scan</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Trigger ReplayGain scan. Uses foobar2000 context menu. üÜï v1.1.12</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| paths | string[] | ‚úÖ | File path array |
| mode | string | ‚ùå | Scan mode: "track" (default) or "album" |

**Returns**:
```json
{ "success": true }
```

**Example**:
```javascript
// Scan single file (track mode)
await fb2k.invoke('replaygain.scan', {
  paths: ["E:\\Music\\track.flac"],
  mode: "track"
});

// Scan album
await fb2k.invoke('replaygain.scan', {
  paths: ["E:\\Music\\album\\*.flac"],
  mode: "album"
});
```

> ‚ö†Ô∏è **Note**: This API opens the foobar2000 ReplayGain scan dialog.

    </div>
</div>

### replaygain.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">replaygain.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Clear file ReplayGain info. üÜï v1.1.12</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| paths | string[] | ‚úÖ | File path array |

**Returns**:
```json
{ "success": true, "clearedCount": 2 }
```

**Example**:
```javascript
await fb2k.invoke('replaygain.clear', {
  paths: ["E:\\Music\\track1.flac", "E:\\Music\\track2.flac"]
});
```
    </div>
</div>

</section>

<!-- ==================== PLAYCOUNT API ==================== -->
<section id="playcount-api">

## Playcount API - Playback Statistics (4)

Get playback statistics provided by foo_playcount component, including play count, first played, last played, added date, etc.

> ‚ö†Ô∏è **Dependency**: Requires foo_playcount component installed.

### playcount.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playcount.get</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get file playback statistics (from foo_playcount). üÜï v1.1.12</div>

**Parameters**:
| Parameter | Type | Required | Description |
|---|---|---|---|
| paths | string[] | ‚úÖ | File path array |

**Returns**:
```json
{
  "success": true,
  "count": 1,
  "results": [
    {
      "path": "E:\\Music\\track.flac",
      "success": true,
      "playCount": 15,
      "rating": 4,
      "firstPlayed": "2023-01-15 10:30:00",
      "lastPlayed": "2024-01-10 15:45:00",
      "added": "2022-08-20 14:00:00",
      "inLibrary": true
    }
  ]
}
```

**Example**:
```javascript
const result = await fb2k.invoke('playcount.get', {
  paths: ["E:\\Music\\track1.flac", "E:\\Music\\track2.flac"]
});
console.log(result.results[0].playCount); // 15
console.log(result.results[0].lastPlayed); // "2024-01-10 15:45:00"
```
    </div>
</div>

### playcount.getBatch

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playcount.getBatch</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Batch get playback statistics (Same as get, provided for API consistency). üÜï v1.1.12</div>

**Parameters**: Same as `playcount.get`

    </div>
</div>

### playcount.getStats

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playcount.getStats</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Get overall library playback statistics. üÜï v1.1.12</div>

**Returns**:
```json
{
  "success": true,
  "totalTracks": 5000,
  "playedTracks": 3200,
  "unplayedTracks": 1800,
  "ratedTracks": 500,
  "totalPlayCount": 45000,
  "maxPlayCount": 150,
  "averagePlayCount": 14.0625,
  "averageRating": 4.2
}
```

**Example**:
```javascript
const stats = await fb2k.invoke('playcount.getStats', {});
console.log(`Played ${stats.playedTracks}/${stats.totalTracks} tracks`);
console.log(`Avg Play Count: ${stats.averagePlayCount.toFixed(1)}`);
```
    </div>
</div>

### playcount.set

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #f85149;">DISABLED</span>
        <span class="api-card-name">playcount.set</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Placeholder API. foo_playcount does not support direct playcount modification. Use `rating.set` for ratings.</div>

**Returns**:
```json
{ "success": false, "error": "Direct playcount modification not supported. Use rating.set for ratings." }
```
    </div>
</div>

</section>

<!-- ==================== EVENTS ==================== -->
<section id="events">

## Event System

Plugins push real-time events to the frontend. Use `fb2k.on()` to subscribe.

### Playback Events

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playback:trackChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when current track changes. üÜï v1.1.2 Added id and absolutePath fields</div>

```javascript
fb2k.on('playback:trackChanged', (data) => {
    console.log('Track ID:', data.id);  // Unique ID (Prefer absolutePath)
    console.log('New track:', data.title, '-', data.artist);
    updateUI(data);
});
```

**Event Data**:
```json
{
    "id": "E:\\Music\\Album\\song.flac",   // üÜï Unique ID (Absolute Path)
    "title": "Let It Be",
    "artist": "The Beatles",
    "album": "Let It Be",
    "duration": 243.5,
    "path": "file-relative://../../song.flac",  // Original fb2k path
    "absolutePath": "E:\\Music\\Album\\song.flac"  // üÜï Absolute Path
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playback:stateChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when playback state changes (play, pause, stop). üÜï v1.1.2 Enhanced</div>

```javascript
fb2k.on('playback:stateChanged', (data) => {
    console.log('State:', data.state); // "playing", "paused", "stopped"
    console.log('Position:', data.position);
    console.log('Duration:', data.duration);
    updatePlayPauseButton(data.state);
});
```

**Event Data**:
```json
{
    "state": "playing",   // "playing", "paused", "stopped"
    "position": 45.2,     // Current position (seconds)
    "duration": 300.0     // Total duration (seconds)
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playback:time</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered on playback position change (approx. every 0.5s).</div>

```javascript
fb2k.on('playback:time', (data) => {
    updateProgressBar(data.position);
});
```

**Event Data**:
```json
{
    "position": 45.2
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playback:volumeChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when volume changes.</div>

```javascript
fb2k.on('playback:volumeChanged', (data) => {
    updateVolumeSlider(data.volume);
});
```

**Event Data**:
```json
{
    "volume": 75,
    "volumeDb": -25.0,
    "muted": false
}
```
</div>
</div>

### Window Events

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">window:stateChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when window state changes (maximize/restore/minimize). Used to update custom titlebar buttons.</div>

```javascript
fb2k.on('window:stateChanged', (data) => {
    const maxBtn = document.getElementById('btn-max');
    if (data.isMaximized) {
        maxBtn.innerHTML = '&#xE923;'; // Restore icon
        maxBtn.title = 'Restore';
    } else {
        maxBtn.innerHTML = '&#xE922;'; // Maximize icon
        maxBtn.title = 'Maximize';
    }
});
```

**Event Data**:
```json
{
    "isMaximized": true,
    "isMinimized": false

### Playlist Events

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playlist.changed</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when playlist content changes.</div>

```javascript
fb2k.on('playlist.changed', (data) => {
    if (data.playlist === currentPlaylist) {
        refreshPlaylistView();
    }
});
```

**Event Data**:
```json
{
    "playlist": 0,
    "changeType": "items_added",  // "items_added", "items_removed", "reordered", "cleared"
    "trackCount": 151
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playlist.activeChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when active playlist changes.</div>

```javascript
fb2k.on('playlist.activeChanged', (data) => {
    switchToPlaylist(data.playlist);
});
```
</div>
</div>

### HTTP Events (Async Mode)

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">http:response</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when async HTTP request completes. Only returns results via this event when `http.get`, `http.post`, `http.head` are called with `async: true`.</div>

```javascript
// Listen for async response
fb2k.on('http:response', (data) => {
    console.log(`Request ${data.requestId} completed`);
    if (data.success) {
        console.log('Status:', data.status);
        console.log('Body:', data.body);
    } else {
        console.error('Error:', data.error);
    }
});

// Make async request (Must set async: true)
const result = await fb2k.invoke('http.get', { 
    url: 'https://api.example.com/data',
    async: true  // Enable async mode
});
console.log('Request started, ID:', result.requestId);  // "http_1"
```

**Event Data (Success)**:
```json
{
    "requestId": "http_1",
    "success": true,
    "status": 200,
    "body": "{\"data\": \"...\"}",
    "headers": {
        "Content-Type": "application/json",
        "Content-Length": "1234"
    }
}
```

**Event Data (Failure)**:
```json
{
    "requestId": "http_1",
    "success": false,
    "error": "Connection timeout"
}
```

> üí° **Tip**: Use `requestId` to match requests and responses, supporting concurrent async requests.
</div>
</div>

### Plugin Events

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">plugin:registered</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when external plugin is registered.</div>

```javascript
fb2k.on('plugin:registered', (data) => {
    console.log(`New plugin registered: ${data.name} v${data.version}`);
    // Can refresh API list or enable related features
});
```

**Event Data**:
```json
{
    "id": "my_plugin",
    "name": "My Plugin",
    "version": "1.0.0",
    "author": "Author Name",
    "description": "Plugin description"
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">plugin:unregistered</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when external plugin is unregistered.</div>

```javascript
fb2k.on('plugin:unregistered', (data) => {
    console.log(`Plugin unregistered: ${data.id}`);
    // Disable related features
});
```

**Event Data**:
```json
{
    "id": "my_plugin"
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">api:registered</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when external API is registered.</div>

```javascript
fb2k.on('api:registered', (data) => {
    console.log(`New API registered: ${data.method}`);
});
```

**Event Data**:
```json
{
    "method": "my_plugin.doSomething",
    "namespace": "my_plugin",
    "description": "Do something"
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">api:unregistered</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when external API is unregistered.</div>

```javascript
fb2k.on('api:unregistered', (data) => {
    console.log(`API unregistered: ${data.method}`);
});
```

**Event Data**:
```json
{
    "method": "my_plugin.doSomething"
}
```
</div>
</div>

### Window Events

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">window:stateChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">Triggered when window state changes.</div>

```javascript
fb2k.on('window:stateChanged', (data) => {
    if (data.isMaximized) {
        hideMaximizeButton();
    } else {
        showMaximizeButton();
    }
});
```
</div>
</div>

### Event Management

```javascript
// Subscribe to event
const unsubscribe = fb2k.on('playback:trackChanged', handler);

// Unsubscribe
unsubscribe();

// Or use off
fb2k.off('playback:trackChanged', handler);

// One-time event
fb2k.once('playback:trackChanged', (data) => {
    console.log('First track change:', data.title);
});
```

</section>

<!-- ==================== SECURITY ==================== -->
<section id="security">

## üîí Security Restrictions

To protect user system security, the following APIs have security restrictions. Developers must be aware of these restrictions when using them.

### Restriction Overview

| API | Restriction Type | Description |
|-----|----------|------|
| `shell.exec` | ‚õî **Disabled** | Arbitrary command execution risk is too high, completely removed |
| `shell.openWith` | üö´ Executable Blacklist | Prevents opening 30+ types of executable files like .exe/.bat/.cmd/.ps1/.vbs |
| `file.read` | üìÅ Path Security | Access to system drive protected directories is prohibited |
| `file.write` | üìÅ Write Restriction | Only allowed to write to foobar2000 profile directory and temp directory |
| `file.delete` | üìÅ Write Restriction | Only allowed to delete files in foobar2000 profile directory and temp directory |
| `http.get/post` | üåê SSRF Protection | Access to internal network addresses is disabled by default |
| DevTools | üîß Default Off | Must be effectively enabled in Advanced Preferences |

### shell.exec - Disabled

<div class="api-card" style="border-color: #f85149; background: rgba(248, 81, 73, 0.1);">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #f85149;">DISABLED</span>
        <span class="api-card-name">shell.exec</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc" style="color: #f85149;">‚õî This API has been disabled. Calling it will return an error.</div>

**Reason**: Allowing arbitrary command execution poses a severe security risk (Remote Code Execution RCE).

**Alternatives**: 
- Use `shell.openExternal` to open URLs
- Use `shell.showInExplorer` to show files in Explorer
- Use `shell.openWith` to open files with associated programs (subject to blacklist)
    </div>
</div>

### shell.openWith - Executable Blacklist

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #d29922; color: #000;">RESTRICTED</span>
        <span class="api-card-name">shell.openWith</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">üö´ Opening executable files is prohibited. Only media/document files are allowed.</div>

**Prohibited Extensions** (30+ types):
```
.exe .com .cmd .bat .ps1 .vbs .vbe .js .jse .wsf .wsh .msc
.scr .pif .hta .cpl .msi .msp .msu .dll .ocx .sys .drv
.lnk .url .reg .inf .jar .application
```

**Allowed Examples**:
```javascript
// ‚úÖ Allowed - Media file
await fb2k.invoke('shell.openWith', { path: 'D:/Music/song.mp3' });

// ‚úÖ Allowed - Document
await fb2k.invoke('shell.openWith', { path: 'C:/docs/readme.txt' });

// ‚ùå Denied - Executable file
await fb2k.invoke('shell.openWith', { path: 'C:/app.exe' });
// Returns: { success: false, error: "Executable files cannot be opened for security reasons" }
```
</div>
</div>

### file.read - Path Security

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #d29922; color: #000;">RESTRICTED</span>
        <span class="api-card-name">file.read</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">üìÅ Access to system drive protected directories is prohibited. Non-system drives are allowed by default.</div>

**Prohibited Directories** (System Drive):
- `C:\Windows\` and subdirectories
- `C:\Program Files\` and subdirectories
- `C:\Program Files (x86)\` and subdirectories
- `C:\ProgramData\` and subdirectories

**Allowed Examples**:
```javascript
// ‚úÖ Allowed - Non-system drive
await fb2k.invoke('file.read', { path: 'D:/Music/playlist.m3u' });

// ‚úÖ Allowed - User directory
await fb2k.invoke('file.read', { path: 'C:/Users/Name/Music/song.txt' });

// ‚ùå Denied - System directory
await fb2k.invoke('file.read', { path: 'C:/Windows/System32/config/SAM' });
// Returns: { success: false, error: "Access denied: protected system path" }
```

> üí° **Note**: Non-system drives (D:, E:, etc.) are allowed by default, supporting NAS and portable usage scenarios.
    </div>
</div>

### file.write - Write Restriction

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #d29922; color: #000;">RESTRICTED</span>
        <span class="api-card-name">file.write</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">üìÅ Only allowed to write to foobar2000 profile directory and temp directory.</div>

**Allowed Write Directories**:
- foobar2000 Profile Directory (`%APPDATA%\foobar2000\` or portable profile folder)
- System Temp Directory (`%TEMP%`)

**Example**:
```javascript
// ‚úÖ Allowed - Profile directory
await fb2k.invoke('file.write', { 
    path: fb2k.getProfilePath() + '/mytheme/config.json',
    content: JSON.stringify(config)
});

// ‚ùå Denied - Arbitrary path
await fb2k.invoke('file.write', { path: 'D:/test.txt', content: 'test' });
// Returns: { success: false, error: "Access denied: write not allowed to this path" }
```
</div>
</div>

### http.get/post - SSRF Protection

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #d29922; color: #000;">RESTRICTED</span>
        <span class="api-card-name">http.get / http.post</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">üåê Access to internal network addresses is disabled by default to prevent SSRF attacks.</div>

**Prohibited Addresses**:
- `localhost` / `127.x.x.x`
- `192.168.x.x` (Private Network)
- `10.x.x.x` (Private Network)
- `172.16-31.x.x` (Private Network)
- `169.254.x.x` (Link Local)
- `::1` (IPv6 localhost)

**Example**:
```javascript
// ‚úÖ Allowed - Internet
await fb2k.invoke('http.get', { url: 'https://api.example.com/data' });

// ‚ùå Denied - Local Server (Default)
await fb2k.invoke('http.get', { url: 'http://localhost:3000/api' });
// Returns: { success: false, error: "Access to local network is disabled..." }
```

> üí° **Enable Local Access**: Enable in foobar2000 Advanced Preferences  
> **Preferences ‚Üí Advanced ‚Üí Tools ‚Üí WebView UI ‚Üí Allow local network access**
    </div>
</div>

### DevTools - Developer Tools

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #d29922; color: #000;">RESTRICTED</span>
        <span class="api-card-name">DevTools (F12)</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">üîß Developer Tools are disabled by default and must be manually enabled.</div>

**How to Enable**:
1. Open foobar2000 Preferences
2. Go to **Advanced ‚Üí Tools ‚Üí WebView UI**
3. Check **Enable DevTools**
4. Restart foobar2000
5. Press F12 or use context menu to open DevTools

> ‚ö†Ô∏è **Note**: Enabling DevTools increases the risk of being exploited by malicious scripts. Only recommended for development.
    </div>
</div>

### CSP Policy

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">INFO</span>
        <span class="api-card-name">Content-Security-Policy</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">üõ°Ô∏è Frontend pages are protected by CSP, but allow loading resources from common CDNs.</div>

**Allowed External Sources**:

| Type | Allowed Sources |
|------|-----------|
| Scripts (`script-src`) | `cdnjs.cloudflare.com`, `unpkg.com`, `cdn.jsdelivr.net` |
| Styles (`style-src`) | Above CDNs + `fonts.googleapis.com` |
| Fonts (`font-src`) | `fonts.gstatic.com`, Above CDNs |
| Images (`img-src`) | All `https:` sources |
| Connect (`connect-src`) | `https:`, `localhost:*`, `127.0.0.1:*`, WebSocket |

**Example - Loading CDN Libraries**:
```html
<!-- ‚úÖ Allowed - cdnjs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- ‚úÖ Allowed - Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<!-- ‚úÖ Allowed - unpkg -->
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
```

> üí° **Note**: Inline scripts (`'unsafe-inline'`) and eval (`'unsafe-eval'`) are allowed to support Vite/Vue development modes.
    </div>
</div>

</section>

<!-- ==================== API SUMMARY ==================== -->
<section id="api-summary">

## API Summary Statistics

| Category | API Count | Description |
|------|----------|------|
| **playback** | 25 | Playback control, volume, path playback, queue position |
| **playlist** | 42 | Playlist management, track operations, smart playlists |
| **library** | 22 | Library browsing, search, path finding, cache control |
| **artwork** | 12 | Covers, batch retrieval, folder images (with aliases) |
| **config** | 20 | Configuration storage, import/export |
| **window** | 55 | Window control, DWM effects, zoom control |
| **system** | 9 | Theme/DPI/Lang, API discovery, plugin registration |
| **file** | 10 | File IO, copy, move, directory operations üîÑ |
| **dialog** | 4 | File/Folder dialogs |
| **clipboard** | 4 | Clipboard read/write |
| **shell** | 3 | Explorer, external programs (`shell.exec` disabled) |
| **http** | 4 | HTTP GET/POST/HEAD/Download |
| **ui** | 5 | Custom menus, Toast, notifications |
| **keyboard** | 4 | Global hotkey registration |
| **lyrics** | 3 | Lyric retrieval and saving |
| **metadata** | 7 | Metadata IO, batch writing |
| **audio** | 12 | Spectrum, waveform, audio analysis |
| **console** | 6 | Console logs, file logs |
| **dnd** | 4 | Drag & Drop zone registration |
| **queue** | 8 | Playback queue management |
| **jitQueue** | 7 | Streaming JIT Queue |
| **discovery** | 15 | Active service discovery üîÑ |
| **dsp** | 8 | DSP effect management üÜï |
| **output** | 3 | Audio output devices üÜï |
| **replaygain** | 5 | ReplayGain settings üÜï |
| **test** | 2 | Test APIs |
| **Total** | **289** | |

### v1.1.9 Update (2026-01-12)

**New Event - Real-time Metadata Changes**:
- üÜï `metadb:changed` Event - Pushed in real-time when ratings, tags, play stats etc. change.

**Tech Highlights**:
- üì° `on_metadb_changed` callback mechanism similar to SMP.
- ‚ö° No polling needed, immediate notification after rating updates.
- üéØ Supports foo_playcount rating change detection.

**Event Data Structure**:
```javascript
fb2k.on('metadb:changed', (data) => {
    // data.tracks: List of changed tracks (max 50)
    // data.count: Total count of changed tracks
    // data.fromHook: true=Internal modification (e.g. foo_playcount), false=External modification
    // data.timestamp: Timestamp
    
    for (const track of data.tracks) {
        console.log(`${track.path}: rating=${track.rating}`);
    }
});
```

**rating.set API Refactor**:
- üîÑ `rating.set` now prioritizes using foo_playcount context menu to set rating.
- ‚ö†Ô∏è **Dependency**: Requires [foo_playcount](https://www.foobar2000.org/components/view/foo_playcount) component to work properly.
- üîÑ Automatically falls back to writing to file RATING tag if foo_playcount is unavailable.
- üÜï Supports automatic adaptation for English/Chinese menu paths.

**rating.set Usage Example**:
```javascript
// Set rating (requires foo_playcount plugin)
await fb2k.invoke('rating.set', { 
    path: 'E:\\Music\\song.flac',  // Optional, default current track
    rating: 5                       // 0-5, 0 = Clear rating
});

// Return value includes storage field indicating storage location
// storage: "stats" = foo_playcount database (Recommended)
// storage: "file" = File tag (Fallback)
```

---

### v1.1.8 Update (2026-01-11)

**New API - foo_playcount Integration**:
- üÜï `discovery.executeContextMenuByPath` - Execute context menu commands via path (supports dynamic submenus).
- üÜï `discovery.getContextMenuTree` - Get complete context menu tree structure.

**Discovery API Update**:
- üîÑ Total API count updated: 287 ‚Üí **289**
- üîÑ Discovery API count: 13 ‚Üí **15**
- üêõ Fixed UTF-8 encoding issue, now correctly handles special chars (like ‚òÖ) in command names.

**Use Case - foo_playcount Rating**:
```javascript
// Set 5 star rating (Chinese version)
await fb2k.invoke('discovery.executeContextMenuByPath', { 
    path: 'Êí≠ÊîæÁªüËÆ°‰ø°ÊÅØ/Á≠âÁ∫ß/5' 
});

// English version
await fb2k.invoke('discovery.executeContextMenuByPath', { 
    path: 'Playback Statistics/Rating/5' 
});

// Clear rating
await fb2k.invoke('discovery.executeContextMenuByPath', { 
    path: 'Êí≠ÊîæÁªüËÆ°‰ø°ÊÅØ/Á≠âÁ∫ß/<Êú™ËÆæÁΩÆ>' 
});

// Get complete menu tree
const result = await fb2k.invoke('discovery.getContextMenuTree');
console.log(result.tree); // Shows all available context menus
```

---

### v1.1.7 Update (2026-01-08)

**New Functionality**
- ‚ú® `ui.showCustomMenu` added `suppressDefault` parameter, providing stronger native menu control.

---

### v1.1.6 Update (2026-01-07)

**New Functionality**
- ‚ú® `artwork.getForTrack` added `maxSize` parameter, supporting server-side scaling.
- üìê Cover API returns `width`/`height` dimension info.
- ‚≠ê Added `rating.set` and `rating.get` APIs, supporting song rating (1-5 stars).
- üìù `metadata.write` implemented real tag writing function.
- üéµ `library.getAll` return value added `rating` field.

**Improvements**
- üöÄ WebView2 SDK updated to 1.0.3650.58.

---

### v1.1.5 Update (2026-01-07)

**Bug Fix - Track Technical Info**:
- Fixed issue where `bitrate`, `sampleRate`, `channels`, `codec` etc. returned 0 or empty.
- Cause: Used obsolete `get_info()` method, switched to SDK recommended `get_info_ref()` method.
- All track info APIs now uniformly return `codec` field (e.g. "FLAC", "MP3", "AAC").
- Scope: `playback.getCurrentTrack`, `playlist.getTracks`, `library.search`, `queue.get` and all APIs returning track info.

**Preferences Interface Optimization**:
- Fixed config items not persisting in preferences page.
- New DWM backdrop effect hot-reload, immediate effect when switching Mica/Acrylic/None.
- Notifies Windows to redraw frame via `SetWindowPos + SWP_FRAMECHANGED`.
- Added `MainWindow::RefreshBackdropEffect()` method.

**Bug Fix - Context Menu Coordinates**:
- Fixed right-click menu not showing at mouse position.
- Added DPI-aware coordinate validation, auto-fallback when WebView2 coords differ too much from real mouse pos.
- Adapts to runtime DPI scaling changes.

**Bug Fix - Drag Region DPI Scaling**:
- Fixed `window.setDragRegions` / `window.setNoDragRegions` failing at high DPI (125%, 150% etc.).
- Cause: JS passes CSS pixel coords, C++ uses physical pixels, missing DPI conversion.
- API now automatically converts coords based on `GetDpiForWindow()`.

**Bug Fix - CSS app-region Support**:
- Fixed `-webkit-app-region: drag/no-drag` CSS property not working.
- Cause: `WM_NCHITTEST` did not call WebView2's `GetNonClientRegionAtPoint` API.
- Solved issue where Vue Teleport to body elements were not correctly detected.
- CSS properties now take effect directly, regardless of Teleport.

**Bug Fix - Corner Settings**:
- Fixed Mica/Acrylic effect disappearing after setting `window.setCornerPreference`.
- Auto calls `RefreshBackdropEffect()` to re-apply backdrop after setting corners.

---

### v1.1.3 Update (2026-01-05)

**New Discovery API - Active Service Discovery** üÜï:
- `discovery.getAllServices` - Get statistical summary of all discoverable services.
- `discovery.getMainMenuCommands` - Get all main menu commands.
- `discovery.getMainMenuGroups` - Get main menu group structure.
- `discovery.executeMainMenuCommand` - Execute main menu command by GUID.
- `discovery.getInputFormats` - Get supported audio input formats.
- `discovery.getComponents` - Get all installed components info.
- `discovery.getUIElements` - Get UI elements.
- `discovery.getDspEntries` - Get DSP processors.
- `discovery.getOutputDevices` - Get output devices.
- `discovery.getPreferencePages` - Get preference pages.
- `discovery.searchCommands` - Search menu commands by name/description.

**JIT Queue Local File Support**:
- `jitQueue.playNow` and `jitQueue.enqueueNext` now support local file paths.
- Auto-detect URL type: HTTP/HTTPS ‚Üí Streaming mode, Local path ‚Üí Direct play.
- Supports Windows absolute paths and UNC paths.

**playback.playPath CUE Subsong Fix**:
- Uses `process_locations()` to correctly parse CUE subsongs.
- Fixed subsong index format (removed incorrect `/subsong,N` suffix).
- `|subsong:N` sent by frontend is used directly (already 0-based).

**Async HTTP API**:
- `http.get/post/head` added `async` parameter.
- Async mode returns results via `http:response` event.
- Recommendation: Frontend use browser native `fetch()` API for best performance.

**API Performance Tracker**:
- Auto-detects main thread blocking API calls.
- Console outputs `[Perf]` logs showing API execution time.
- Thresholds: 50ms record, 200ms warning, 500ms blocking warning.

### v1.1.2 Update (2026-01-04)

**New Feature - Background Mode**:
- Supports running WebView UI in background when using Default UI or others.
- APIs remain available in background mode.
- Setting: Preferences ‚Üí Advanced ‚Üí Tools ‚Üí WebView UI ‚Üí Enable background mode.
- Menu: View ‚Üí WebView UI ‚Üí Show/Hide Window.
- Default off, requires restart.

**New Feature - Async HTTP API**:
- `http.get/post/head` added `async` parameter, runs in background thread when true.
- Async mode immediately returns `{ requestId, async: true }`.

**New Feature - API Performance Tracker**:
- Auto-detects blocking API calls.

**New Events**:
- `http:response` - Async HTTP request complete.
- `playback:stateChanged` - Unified playback state change event.

**New API - JIT Queue**:
- `jitQueue.playNow` - Play URL/Local path immediately.
- `jitQueue.enqueueNext` - Preload next track.
- `jitQueue.skip` - Skip to next in buffer.
- `jitQueue.stop` - Stop playback.
- `jitQueue.clear` - Clear buffer.
- `jitQueue.getState` - Get status.
- `jitQueue.notifyEmpty` - Notify empty.

**New API - Queue**:
- `queue.addPaths` - Add URL/Path to queue.
- `queue.add` - Add playlist item to queue.
- `queue.get` - Get queue content.
- `queue.remove` - Remove from queue.
- `queue.clear` - Clear queue.
- `queue.getCount` - Get queue count.
- `queue.moveToTop` - Move to top.

**New API - Playback**:
- `playback.getCurrentTrackIndex`
- `playback.getPlayingPlaylist`

**New API - Playlist**:
- `playlist.replaceAllAndPlay` - Atomic clear+add+play.

**API Enhancements**:
- `playlist.clear` returns counts.
- `playlist.addPaths` returns counts.
- `playback:trackChanged` / `playback.getCurrentTrack` added `id` and `absolutePath`.

**New API - Window**:
- `window.setNoDragRegions`
- `window.getTitlebarInfo`
- `window.getCaptionButtonsWidth`

**Core Fixes**:
- Fixed `window.setNoDragRegions` race condition.
- Fixed window drag logic.
- Custom drag region enhancements.

**UI & Theme**:
- Dark mode support for Preferences/Context Menu.
- Preferences page refactor (Layout, Auto-size, Buttons).

### v1.1.1 Update (2026-01-03)

**New API**:
- `metadata.readByPath` - Read all metadata for specific path (flat format).

**CSP Optimization**:
- Allowed scripts/styles from `cdnjs`, `unpkg`, `jsdelivr`.
- Allowed fonts from Google Fonts.
- Allowed all HTTPS images.
- WebSocket support.

### v1.1.0 Update

**New API**:
- `library.getByPath`

**API Standardization**:
- List APIs added `items` field.
- Availability APIs added `available` field.

**Parameter Compatibility**:
- `playlist.*`: `playlist` / `playlistIndex`.
- `library.search/getAll`: `offset`, `limit` / `start`, `count`.
- `config.setOutputBuffer`: `bufferLength` / `milliseconds`.

**Test Coverage**:
- 287 tests passed.
- 100% pass rate.

</section>

<!-- ==================== CHANGELOG ==================== -->
<section id="changelog">

## üìù Changelog

Complete version history, sorted from newest to oldest.

### v1.1.12 (2026-01-14)

**New Features**
- ‚ú® Added `replaygain.get` - Get file ReplayGain info.
- ‚ú® Added `replaygain.scan` - Trigger ReplayGain scan.
- ‚ú® Added `replaygain.clear` - Clear ReplayGain info.
- ‚ú® Added `playcount.get` - Get playback stats (from foo_playcount).
- ‚ú® Added `playcount.getBatch` - Batch get playback stats.
- ‚ú® Added `playcount.getStats` - Get library stats.
- ‚ú® Added `playcount.set` - Placeholder.
- ‚ú® Improved `metadata.embedArtwork` and `metadata.removeEmbeddedArt` docs.

**Bug Fixes**
- üîß Fixed `replaygain.get` incomplete return - Forced reading from file.

**Total APIs**: 299

---

### v1.1.11 (2026-01-13)

**New Features**
- ‚ú® Added `metadata.readBatch` - Batch read metadata.
- ‚ú® Added `metadata.removeField` - Remove specific tag field.

**Bug Fixes**
- üîß Fixed `rating.set(0)` - Clears rating via menu traversal.
- üîß Fixed `metadata.readByPath` incomplete fields.
- üîß Fixed inconsistent field names (Unified to upper case).
- üîß Auto extract track number from filename.

**Total APIs**: 291

---

### v1.1.10 (2026-01-11)

**Bug Fixes**
- üîß **Unicode Path Fix**: Fixed APIs failing with Japanese quotes or full-width symbols.
- üõ†Ô∏è **DLL Init Fix**: Fixed "DLL initialization routine failed".
- üìù Fixed 7 APIs: `metadata.readByPath`, `metadata.read`, etc.

---

### v1.1.9 (2026-01-10)

**New Features**
- üì° **Real-time Metadata Event**: Added `metadb:changed`.
- ‚ú® Immediate notification after rating updates.

---

### v1.1.8 (2026-01-09)

**New Features**
- ‚ú® **foo_playcount Integration**: Via `discovery.executeContextMenuByPath`.
- üîç `discovery.getContextMenuTree`.
- üîß `discovery.executeContextMenuByPath` supports dynamic submenus.

**Bug Fixes**
- üêõ Fixed UTF-8 encoding issue.

---

### v1.1.7 (2026-01-08)

**New Features**
- ‚ú® `ui.showCustomMenu` added `suppressDefault` parameter.

---

### v1.1.6 (2026-01-07)

**New Features**
- ‚ú® `artwork.getForTrack` added `maxSize`.
- üìê Cover API returns `width`/`height`.
- ‚≠ê Added `rating.set` / `rating.get`.
- üìù `metadata.write` real tag writing.
- üéµ `library.getAll` returns rating.

**Improvements**
- üöÄ WebView2 SDK 1.0.3650.58.

---

### v1.1.5 and earlier

For older version history, please refer to [GitHub Releases](https://github.com/user/foo_ui_webview2/releases).

</section>

---

<div style="text-align: center; padding: 40px 0; color: #666;">
    <p>foo_ui_webview2 Plugin API Documentation</p>
    <p>Last edited: 2026-01-16 | Version: 1.1.12</p>
    <p><a href="https://github.com/user/foo_ui_webview2" style="color: #0078D4;">GitHub Repository</a></p>
</div>

            </article>
        </main>
    </div>
    
    <script>
        // Configure marked
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    try {
                        return hljs.highlight(code, { language: lang }).value;
                    } catch (e) {}
                }
                return hljs.highlightAuto(code).value;
            },
            breaks: false,
            gfm: true
        });
        
        // Wait for DOM
        document.addEventListener('DOMContentLoaded', function() {
            const article = document.querySelector('.markdown-body');
            if (article) {
                let content = article.innerHTML;
                
                // ========== Pre-processing: Fix HTML+Markdown rendering issues ==========
                // Problem: Indented HTML tags (like "    </div>") are recognized as code blocks by marked
                // Solution: Remove indentation before HTML tags before parsing
                
                // 1. Remove indentation before closing HTML tags at start of lines
                content = content.replace(/^[ \t]+(<\/?[a-zA-Z][^>]*>)/gm, '$1');
                
                // 2. Remove extra newlines between HTML tags (Keep 1 for Markdown paragraphs)
                content = content.replace(/(>)\s*\n\s*\n\s*\n+\s*(<)/g, '$1\n\n$2');
                
                // 3. Clean up extra whitespace inside HTML tags
                content = content.replace(/<div class="api-card-body">\s+\n/g, '<div class="api-card-body">\n');
                content = content.replace(/\n\s+<\/div>\s*<\/div>/g, '\n</div>\n</div>');
                
                // Parse with marked
                article.innerHTML = marked.parse(content);
            }
            
            // Apply syntax highlighting to all code blocks
            document.querySelectorAll('pre code').forEach((block) => {
                // Add language label
                const pre = block.parentElement;
                const langClass = Array.from(block.classList).find(c => c.startsWith('language-'));
                if (langClass && pre) {
                    const lang = langClass.replace('language-', '');
                    if (lang && lang !== 'plaintext') {
                        pre.setAttribute('data-lang', lang);
                    }
                }
                
                if (!block.classList.contains('hljs')) {
                    hljs.highlightElement(block);
                }
            });
        });
        
        // Navigation active state
        document.querySelectorAll('.nav-section a').forEach(link => {
            link.addEventListener('click', function() {
                document.querySelectorAll('.nav-section a').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Search filter
        function filterNav() {
            const search = document.getElementById('search').value.toLowerCase();
            document.querySelectorAll('.nav-section a').forEach(link => {
                const text = link.textContent.toLowerCase();
                link.style.display = text.includes(search) ? 'block' : 'none';
            });
        }
        
        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
        
        // Back to top button
        const backToTopBtn = document.getElementById('backToTop');
        window.addEventListener('scroll', function() {
            if (window.scrollY > 300) {
                backToTopBtn.classList.add('visible');
            } else {
                backToTopBtn.classList.remove('visible');
            }
            
            // Update sidebar highlight on scroll
            updateActiveNavOnScroll();
        });
        
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // Auto highlight active section on scroll
        function updateActiveNavOnScroll() {
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('.nav-section a[href^="#"]');
            
            let currentSection = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) {
                    currentSection = section.getAttribute('id');
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + currentSection) {
                    link.classList.add('active');
                }
            });
        }
    </script>
</body>
</html>

