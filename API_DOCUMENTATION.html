<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>foo_ui_webview2 API æ–‡æ¡£</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.5.0/github-markdown-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.0/marked.min.js"></script>
    <style>
        /* è‡ªå®šä¹‰ä»£ç é«˜äº®é¢œè‰² - æé«˜å¯¹æ¯”åº¦ */
        .hljs {
            background: #161b22 !important;
            color: #e6edf3 !important;
        }
        .hljs-comment,
        .hljs-quote { color: #8b949e !important; font-style: italic; }
        .hljs-keyword,
        .hljs-selector-tag { color: #ff7b72 !important; font-weight: 500; }
        .hljs-string,
        .hljs-attr { color: #a5d6ff !important; }
        .hljs-number,
        .hljs-literal { color: #79c0ff !important; }
        .hljs-variable,
        .hljs-template-variable { color: #ffa657 !important; }
        .hljs-function,
        .hljs-title { color: #d2a8ff !important; }
        .hljs-type,
        .hljs-class .hljs-title { color: #7ee787 !important; }
        .hljs-built_in { color: #ffa657 !important; }
        .hljs-params { color: #e6edf3 !important; }
        .hljs-property { color: #79c0ff !important; }
        .hljs-name { color: #7ee787 !important; }
        .hljs-punctuation { color: #c9d1d9 !important; }
        
        :root {
            --bg-color: #0d1117;
            --text-color: #e6edf3;
            --text-secondary: #9eabb8;
            --border-color: #30363d;
            --accent-color: #58a6ff;
            --code-bg: #161b22;
            --sidebar-width: 300px;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, 'Microsoft YaHei UI', 'Noto Sans SC', sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.75;
            font-size: 15px;
            font-weight: 400;
            letter-spacing: 0.01em;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .container { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: #010409;
            border-right: 1px solid var(--border-color);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            padding: 20px 0;
        }
        .sidebar h1 {
            font-size: 20px;
            font-weight: 600;
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--border-color);
            color: #fff;
        }
        .sidebar h1 span { color: var(--accent-color); }
        .nav-section { padding: 15px 0; border-bottom: 1px solid var(--border-color); }
        .nav-section-title {
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            color: #9eabb8;
            padding: 0 20px 10px;
            letter-spacing: 0.5px;
        }
        .nav-section a {
            display: block;
            padding: 8px 20px;
            color: var(--text-color);
            text-decoration: none;
            font-size: 15px;
            font-weight: 450;
            transition: all 0.15s;
        }
        .nav-section a:hover { background: #21262d; color: var(--accent-color); }
        .nav-section a.active { background: #1f6feb22; color: var(--accent-color); border-left: 2px solid var(--accent-color); }
        .api-count {
            background: #30363d;
            color: #9eabb8;
            font-size: 12px;
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
        }
        
        /* Main Content */
        .main {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 40px 60px;
            max-width: 1000px;
        }
        .markdown-body {
            background: transparent;
            color: var(--text-color);
            font-size: 16px;
            line-height: 1.85;
        }
        .markdown-body h1 { 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 0.4em; 
            color: #fff; 
            font-size: 2.2em;
            font-weight: 600;
            margin-bottom: 0.8em;
        }
        .markdown-body h2 { 
            border-bottom: 1px solid var(--border-color); 
            padding-bottom: 0.35em; 
            margin-top: 2.2em; 
            margin-bottom: 0.8em;
            font-size: 1.6em;
            font-weight: 600;
            color: #f0f6fc;
        }
        .markdown-body h3 { 
            margin-top: 1.8em; 
            margin-bottom: 0.6em;
            color: #e6edf3; 
            font-size: 1.3em;
            font-weight: 600;
        }
        .markdown-body p {
            margin: 1.2em 0;
            color: #d0d7de;
            line-height: 1.9;
            letter-spacing: 0.015em;
        }
        .markdown-body li {
            color: #d0d7de;
            line-height: 1.9;
            margin: 0.5em 0;
        }
        .markdown-body strong {
            color: #f0f6fc;
            font-weight: 600;
        }
        .markdown-body em {
            color: #9eabb8;
            font-style: italic;
        }
        .markdown-body code {
            background: #262c36;
            padding: 0.25em 0.55em;
            border-radius: 5px;
            font-size: 90%;
            font-family: 'Cascadia Code', 'Fira Code', 'JetBrains Mono', Consolas, monospace;
            font-weight: 450;
            color: #79c0ff;
            border: 1px solid #30363d;
        }
        .markdown-body pre {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 18px 20px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.7;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
            position: relative;
        }
        /* ä»£ç å—è¯­è¨€æ ‡ç­¾ */
        .markdown-body pre[data-lang]::before {
            content: attr(data-lang);
            position: absolute;
            top: 0;
            right: 0;
            padding: 4px 10px;
            font-size: 11px;
            font-weight: 500;
            color: #8b949e;
            background: #21262d;
            border-radius: 0 8px 0 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .markdown-body pre code {
            font-size: 14px;
            font-weight: 400;
            color: #e6edf3;
            border: none;
            background: transparent;
            padding: 0;
            display: block;
        }
        /* ç¡®ä¿ hljs æ ·å¼æ­£ç¡®åº”ç”¨ */
        .markdown-body pre code.hljs {
            background: transparent !important;
            padding: 0 !important;
        }
        .markdown-body table { border-collapse: collapse; width: 100%; font-size: 15px; }
        .markdown-body table th, .markdown-body table td {
            border: 1px solid var(--border-color);
            padding: 12px 16px;
            text-align: left;
            line-height: 1.6;
        }
        .markdown-body table th { 
            background: #21262d; 
            font-weight: 600;
            color: #f0f6fc;
        }
        .markdown-body table td {
            color: #d0d7de;
        }
        .markdown-body table tr:nth-child(2n) { background: #161b2244; }
        .markdown-body table tr:hover { background: #21262d55; }
        .markdown-body blockquote {
            border-left: 4px solid var(--accent-color);
            background: linear-gradient(90deg, #1f6feb18 0%, transparent 100%);
            padding: 14px 22px;
            margin: 1.2em 0;
            font-size: 15px;
            border-radius: 0 6px 6px 0;
            color: #b8c0c8;
        }
        .markdown-body blockquote strong {
            color: #f0f6fc;
        }
        .markdown-body a { 
            color: #58a6ff; 
            font-weight: 500; 
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s;
        }
        .markdown-body a:hover {
            border-bottom-color: #58a6ff;
        }
        .markdown-body hr {
            border: none;
            border-top: 1px solid #30363d;
            margin: 2em 0;
        }
        .markdown-body ul, .markdown-body ol {
            padding-left: 2em;
            margin: 1em 0;
        }
        
        /* API Card */
        .api-card {
            background: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            margin: 1.5em 0;
            overflow: hidden;
        }
        .api-card-header {
            background: #21262d;
            padding: 14px 18px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .api-card-method {
            background: #238636;
            color: #fff;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 600;
        }
        .api-card-method.get { background: #1f6feb; }
        .api-card-method.set { background: #a371f7; }
        .api-card-method.action { background: #238636; }
        .api-card-method.event { background: #d29922; color: #000; }
        .api-card-name { 
            font-family: 'Cascadia Code', 'Fira Code', Consolas, monospace; 
            font-size: 16px; 
            font-weight: 500;
            color: #fff; 
        }
        .api-card-body { padding: 18px; font-size: 15px; line-height: 1.7; }
        .api-card-desc { color: #9eabb8; margin-bottom: 14px; font-size: 15px; }
        
        /* Badge */
        .badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 500;
        }
        .badge-blue { background: #1f6feb33; color: #58a6ff; }
        .badge-green { background: #23863633; color: #3fb950; }
        .badge-purple { background: #a371f733; color: #d2a8ff; }
        .badge-orange { background: #d29922; color: #000; }
        
        /* Search */
        .search-box {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color);
        }
        .search-box input {
            width: 100%;
            padding: 10px 14px;
            background: #21262d;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-color);
            font-size: 15px;
            transition: all 0.2s;
        }
        .search-box input::placeholder { color: #7d8590; }
        .search-box input:focus { 
            outline: none; 
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.15);
        }
        
        /* è¿”å›é¡¶éƒ¨æŒ‰é’® */
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 44px;
            height: 44px;
            background: #21262d;
            border: 1px solid var(--border-color);
            border-radius: 50%;
            color: var(--text-color);
            font-size: 20px;
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        .back-to-top:hover {
            background: var(--accent-color);
            color: #fff;
            transform: translateY(-2px);
        }
        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        
        /* ä¾§è¾¹æ æ»šåŠ¨æ¡ç¾åŒ– */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }
        .sidebar::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 3px;
        }
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }
        
        /* ä¸»å†…å®¹æ»šåŠ¨æ¡ */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #0d1117;
        }
        ::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }
        
        /* Section åŠ¨ç”» */
        section {
            scroll-margin-top: 20px;
        }
        
        /* ç‰ˆæœ¬å¾½ç«  */
        .version-badge {
            display: inline-block;
            background: linear-gradient(135deg, #238636 0%, #2ea043 100%);
            color: #fff;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        /* ç‰¹æ€§åˆ—è¡¨å›¾æ ‡ */
        .markdown-body ul li::marker {
            color: var(--accent-color);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main { margin-left: 0; padding: 20px; }
            .back-to-top { bottom: 20px; right: 20px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- è¿”å›é¡¶éƒ¨æŒ‰é’® -->
        <button class="back-to-top" id="backToTop" onclick="scrollToTop()" title="è¿”å›é¡¶éƒ¨">â†‘</button>
        
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <h1>foo_ui_webview2 <span>API</span></h1>
            
            <div class="search-box">
                <input type="text" id="search" placeholder="æœç´¢ API..." onkeyup="filterNav()">
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">å…¥é—¨</div>
                <a href="#overview" class="active">æ¦‚è¿°</a>
                <a href="#installation">å®‰è£…</a>
                <a href="#developer-requirements">ğŸ‘¨â€ğŸ’» å¼€å‘è€…æŠ€æœ¯è¦æ±‚</a>
                <a href="#important-notes">âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹</a>
                <a href="#quick-start">å¿«é€Ÿå¼€å§‹</a>
                <a href="#common-use-cases">å¸¸ç”¨åœºæ™¯ â­</a>
                <a href="#bridge-protocol">Bridge åè®®</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Playback API <span class="api-count">25</span></div>
                <a href="#playback-control">æ’­æ”¾æ§åˆ¶</a>
                <a href="#playback-state">çŠ¶æ€è·å–</a>
                <a href="#playback-volume">éŸ³é‡æ§åˆ¶</a>
                <a href="#playback-order">æ’­æ”¾é¡ºåº</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Playlist API <span class="api-count">42</span></div>
                <a href="#playlist-management">åˆ—è¡¨ç®¡ç†</a>
                <a href="#playlist-tracks">æ›²ç›®æ“ä½œ</a>
                <a href="#playlist-autoplaylist">æ™ºèƒ½æ’­æ”¾åˆ—è¡¨</a>
                <a href="#playlist-selection">é€‰æ‹©æ“ä½œ</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Library API <span class="api-count">22</span></div>
                <a href="#library-browse">æµè§ˆåª’ä½“åº“</a>
                <a href="#library-search">æœç´¢</a>
                <a href="#library-cache">ç¼“å­˜æ§åˆ¶ ğŸ†•</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Artwork API <span class="api-count">12</span></div>
                <a href="#artwork-api">å°é¢ &amp; å…ƒæ•°æ®</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Config API <span class="api-count">20</span></div>
                <a href="#config-api">é…ç½®ç®¡ç†</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Window API <span class="api-count">55</span></div>
                <a href="#window-api">åŸºæœ¬æ§åˆ¶</a>
                <a href="#window-titlebar">æ ‡é¢˜æ </a>
                <a href="#window-dwm">DWM æ•ˆæœ</a>
                <a href="#window-zoom">ç¼©æ”¾æ§åˆ¶ ğŸ†•</a>
                <a href="#window-interaction">æ‹–æ‹½ä¸èœå•</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">System API <span class="api-count">9</span></div>
                <a href="#system-api">API å‘ç°</a>
                <a href="#system-plugins">æ’ä»¶æ³¨å†Œ</a>
                <a href="#system-info">ç³»ç»Ÿä¿¡æ¯</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">File API <span class="api-count">10</span></div>
                <a href="#file-api">æ–‡ä»¶æ“ä½œ</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Dialog API <span class="api-count">4</span></div>
                <a href="#dialog-api">å¯¹è¯æ¡†</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Clipboard API <span class="api-count">4</span></div>
                <a href="#clipboard-api">å‰ªè´´æ¿</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Shell API <span class="api-count">3</span></div>
                <a href="#shell-api">ç³»ç»Ÿé›†æˆ</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">HTTP API <span class="api-count">4</span></div>
                <a href="#http-api">ç½‘ç»œè¯·æ±‚</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">UI API <span class="api-count">5</span></div>
                <a href="#ui-api">ç•Œé¢äº¤äº’</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Keyboard API <span class="api-count">4</span></div>
                <a href="#keyboard-api">å¿«æ·é”®</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Lyrics API <span class="api-count">3</span></div>
                <a href="#lyrics-api">æ­Œè¯</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Metadata API <span class="api-count">11</span></div>
                <a href="#metadata-api">å…ƒæ•°æ®</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Audio API <span class="api-count">12</span></div>
                <a href="#audio-api">éŸ³é¢‘åˆ†æ</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Console API <span class="api-count">6</span></div>
                <a href="#console-api">æ—¥å¿—</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">DnD API <span class="api-count">4</span></div>
                <a href="#dnd-api">æ‹–æ”¾</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Queue API <span class="api-count">8</span></div>
                <a href="#queue-api">æ’­æ”¾é˜Ÿåˆ—</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">JIT Queue API <span class="api-count">7</span></div>
                <a href="#jit-queue-api">æµåª’ä½“å³æ—¶é˜Ÿåˆ—</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Discovery API <span class="api-count">15</span></div>
                <a href="#discovery-api">æœåŠ¡å‘ç°</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">DSP API <span class="api-count">8</span></div>
                <a href="#dsp-api">DSP æ•ˆæœå™¨ ğŸ†•</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Output API <span class="api-count">3</span></div>
                <a href="#output-api">éŸ³é¢‘è¾“å‡º ğŸ†•</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">ReplayGain API <span class="api-count">8</span></div>
                <a href="#replaygain-api">ReplayGain ğŸ”„</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Playcount API <span class="api-count">4</span></div>
                <a href="#playcount-api">æ’­æ”¾ç»Ÿè®¡ ğŸ†•</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Events</div>
                <a href="#events">äº‹ä»¶ç³»ç»Ÿ</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">å®‰å…¨</div>
                <a href="#security">ğŸ”’ å®‰å…¨é™åˆ¶</a>
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">å‚è€ƒ</div>
                <a href="#api-summary">API ç»Ÿè®¡æ‘˜è¦</a>
                <a href="#changelog">ğŸ“ æ›´æ–°æ—¥å¿—</a>
            </div>
        </nav>
        
        <!-- Main Content -->
        <main class="main">
            <article class="markdown-body">
                
<!-- ==================== OVERVIEW ==================== -->
<section id="overview">

# foo_ui_webview2 API æ–‡æ¡£

> **ç‰ˆæœ¬**: 1.1.12  
> **æœ€åæ›´æ–°**: 2026-01-14  
> **ä½œè€…**: NereaFantasia  
> **foobar2000 æœ€ä½ç‰ˆæœ¬**: 2.0+  
> **API æ€»æ•°**: 299 ä¸ª  
> **æµ‹è¯•è¦†ç›–ç‡**: 299/299 æµ‹è¯•é€šè¿‡ (100%)

## æ¦‚è¿°

**foo_ui_webview2** æ˜¯ä¸€ä¸ª foobar2000 æ’ä»¶ï¼Œå®ƒä½¿ç”¨ WebView2 æŠ€æœ¯æ›¿æ¢é»˜è®¤ç”¨æˆ·ç•Œé¢ï¼Œå…è®¸å¼€å‘è€…ä½¿ç”¨ç°ä»£ Web æŠ€æœ¯ï¼ˆHTML/CSS/JavaScriptï¼‰æ„å»ºè‡ªå®šä¹‰ UIã€‚

### ä¸»è¦ç‰¹æ€§

- ğŸŒ **WebView2 æ¸²æŸ“** - å®Œæ•´çš„ Chromium æµè§ˆå™¨å¼•æ“
- ğŸ¨ **Mica æ•ˆæœ** - Windows 11 åŸç”Ÿé€æ˜èƒŒæ™¯
- ğŸ”Œ **299 ä¸ª API** - å®Œæ•´çš„ foobar2000 åŠŸèƒ½è¦†ç›–
- ğŸ“¡ **åŒå‘é€šä¿¡** - C++ â†” JavaScript å®æ—¶äº¤äº’
- ğŸµ **äº‹ä»¶ç³»ç»Ÿ** - æ’­æ”¾çŠ¶æ€ã€æ’­æ”¾åˆ—è¡¨ã€çª—å£çŠ¶æ€å˜åŒ–å®æ—¶æ¨é€
- ğŸªŸ **è‡ªå®šä¹‰æ ‡é¢˜æ ** - å®Œæ•´çš„æ ‡é¢˜æ æ‹–æ‹½ã€åŒå‡»æœ€å¤§åŒ–ã€å³é”®èœå•æ”¯æŒ
- ğŸ“ **æ–‡ä»¶ç³»ç»Ÿ** - è¯»å†™æ–‡ä»¶ã€ç›®å½•æ“ä½œ
- ğŸŒ **HTTP è¯·æ±‚** - GET/POST/HEAD/ä¸‹è½½ï¼ˆæ”¯æŒå¼‚æ­¥æ¨¡å¼ï¼‰
- ğŸ¹ **å…¨å±€å¿«æ·é”®** - æ³¨å†Œç³»ç»Ÿçº§çƒ­é”®
- ğŸ”’ **å®‰å…¨åŠ å›º** - Origin éªŒè¯ã€è·¯å¾„å®‰å…¨ã€SSRF é˜²æŠ¤
- ğŸ“‹ **é˜Ÿåˆ—ç®¡ç†** - æ’­æ”¾é˜Ÿåˆ—ä¸ JIT é˜Ÿåˆ—å®Œæ•´æ§åˆ¶
- ğŸ–¥ï¸ **åå°æ¨¡å¼** - å¯ä¸ Default UI ç­‰å…¶ä»–ç•Œé¢åŒæ—¶ä½¿ç”¨
- ğŸ–¼ï¸ **å°é¢ç¼©æ”¾** - æœåŠ¡ç«¯å›¾ç‰‡ç¼©æ”¾ï¼Œå‡å°‘ 99% æ•°æ®ä¼ è¾“ ğŸ†• v1.1.6
- ğŸ‘† **èœå•æ§åˆ¶** - `ui.showCustomMenu` æ”¯æŒåŸç”Ÿèœå•æŠ‘åˆ¶ ğŸ†• v1.1.7
- ğŸ“¡ **å®æ—¶äº‹ä»¶** - `metadb:changed` å®æ—¶æ¨é€è¯„åˆ†/æ ‡ç­¾å˜åŒ– ğŸ†• v1.1.9
- ğŸ”§ **Unicodeè·¯å¾„ä¿®å¤** - å«æ—¥æ–‡å¼•å·ç­‰ç‰¹æ®Šå­—ç¬¦çš„è·¯å¾„ç°åœ¨æ­£å¸¸å·¥ä½œ ğŸ†• v1.1.10

### API åˆ†å¸ƒ

| æ¨¡å— | API æ•°é‡ | æè¿° |
|------|----------|------|
| `playback` | 25 | æ’­æ”¾æ§åˆ¶ã€çŠ¶æ€ã€éŸ³é‡ã€è·¯å¾„æ’­æ”¾ |
| `playlist` | 42 | æ’­æ”¾åˆ—è¡¨ç®¡ç†ã€æ™ºèƒ½åˆ—è¡¨ |
| `library` | 22 | åª’ä½“åº“æµè§ˆã€æœç´¢ã€è·¯å¾„æŸ¥æ‰¾ã€ç¼“å­˜æ§åˆ¶ |
| `artwork` | 12 | å°é¢ã€æ­Œè¯ã€æ‰¹é‡è·å–ã€æœåŠ¡ç«¯ç¼©æ”¾ ğŸ”„ |
| `config` | 20 | é…ç½®ã€è®¾å¤‡ã€æŒä¹…åŒ–å­˜å‚¨ |
| `window` | 55 | çª—å£æ§åˆ¶ã€DWM æ•ˆæœã€ç¼©æ”¾æ§åˆ¶ |
| `system` | 9 | ä¸»é¢˜/DPI/è¯­è¨€ã€API å‘ç° |
| `file` | 10 | æ–‡ä»¶è¯»å†™ã€å¤åˆ¶ã€ç§»åŠ¨ã€ç›®å½•æ“ä½œ ğŸ”„ |
| `dialog` | 4 | æ–‡ä»¶/æ–‡ä»¶å¤¹å¯¹è¯æ¡† |
| `clipboard` | 4 | å‰ªè´´æ¿æ“ä½œ |
| `shell` | 3 | ç³»ç»Ÿé›†æˆï¼ˆ`shell.exec` å·²ç¦ç”¨ï¼‰ |
| `http` | 4 | HTTP è¯·æ±‚ |
| `ui` | 5 | è‡ªå®šä¹‰èœå•ã€é€šçŸ¥ |
| `keyboard` | 4 | å…¨å±€å¿«æ·é”® |
| `lyrics` | 3 | æ­Œè¯ç®¡ç† |
| `metadata` | 11 | å…ƒæ•°æ®è¯»å†™ã€æ‰¹é‡è¯»å–ã€æ‰¹é‡å†™å…¥ã€è¯„åˆ† ğŸ”„ |
| `audio` | 12 | éŸ³é¢‘åˆ†æã€é¢‘è°±ã€æ³¢å½¢ ğŸ”„ |
| `console` | 6 | æ—¥å¿—è¾“å‡º |
| `dnd` | 4 | æ‹–æ”¾æ”¯æŒ |
| `queue` | 8 | æ’­æ”¾é˜Ÿåˆ—ç®¡ç† |
| `jitQueue` | 7 | JIT å³æ—¶é˜Ÿåˆ— |
| `discovery` | 15 | æœåŠ¡å‘ç°ã€èœå•å‘½ä»¤ã€foo_playcount è¯„åˆ† ğŸ”„ |
| `dsp` | 8 | DSP æ•ˆæœå™¨ç®¡ç† ğŸ†• |
| `output` | 3 | éŸ³é¢‘è¾“å‡ºè®¾å¤‡ ğŸ†• |
| `replaygain` | 8 | ReplayGain è®¾ç½®ã€æ‰«æã€è·å–ã€æ¸…é™¤ ğŸ”„ |
| `playcount` | 4 | æ’­æ”¾ç»Ÿè®¡ä¿¡æ¯ï¼ˆfoo_playcount é›†æˆï¼‰ğŸ†• |
| `test` | 2 | æµ‹è¯•å·¥å…· |

</section>

<!-- ==================== INSTALLATION ==================== -->
<section id="installation">

## å®‰è£…

### ç³»ç»Ÿè¦æ±‚

| é¡¹ç›® | è¦æ±‚ |
|------|------|
| **æ“ä½œç³»ç»Ÿ** | Windows 10/11 (64-bit) |
| **foobar2000** | v2.0 æˆ–æ›´é«˜ç‰ˆæœ¬ (64-bit) |
| **WebView2 Runtime** | é€šå¸¸å·²é¢„è£…äº Windows 10/11ï¼›å¦‚æœªå®‰è£…ï¼Œè¯·ä» [Microsoft å®˜ç½‘](https://developer.microsoft.com/microsoft-edge/webview2/) ä¸‹è½½ |

> ğŸ’¡ **æç¤º**ï¼šfoobar2000 v2.0 æ˜¯ 64 ä½ç‰ˆæœ¬çš„åˆ†æ°´å²­ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ v1.x ç‰ˆæœ¬ï¼Œè¯·å…ˆå‡çº§åˆ° v2.0+ã€‚

---

### å®‰è£…æ–¹å¼ä¸€ï¼šä½¿ç”¨ fb2k-component å®‰è£…åŒ…ï¼ˆæ¨èï¼‰âœ¨

è¿™æ˜¯æœ€ç®€å•çš„å®‰è£…æ–¹å¼ï¼Œé€‚åˆå¤§å¤šæ•°ç”¨æˆ·ã€‚

1. **ä¸‹è½½å®‰è£…åŒ…**
   
   ä»å‘å¸ƒé¡µé¢ä¸‹è½½ `foo_ui_webview2.fb2k-component` æ–‡ä»¶

2. **åŒå‡»å®‰è£…**
   
   åŒå‡»ä¸‹è½½çš„ `.fb2k-component` æ–‡ä»¶ï¼Œfoobar2000 ä¼šè‡ªåŠ¨å¼¹å‡ºå®‰è£…ç¡®è®¤å¯¹è¯æ¡†

3. **ç¡®è®¤å®‰è£…**
   
   ç‚¹å‡» `Yes` ç¡®è®¤å®‰è£…ï¼Œfoobar2000 ä¼šè‡ªåŠ¨å°†ç»„ä»¶å¤åˆ¶åˆ°æ­£ç¡®ä½ç½®

4. **é‡å¯ foobar2000**
   
   å®‰è£…å®Œæˆåéœ€è¦é‡å¯ foobar2000 ä½¿ç»„ä»¶ç”Ÿæ•ˆ

5. **é€‰æ‹© UI**
   
   `File` â†’ `Preferences` â†’ `Display` â†’ `Default User Interface` â†’ é€‰æ‹© `WebView UI` â†’ ç‚¹å‡» `OK`

> ğŸ“¦ **æ³¨æ„**ï¼š`.fb2k-component` æ˜¯ foobar2000 å®˜æ–¹çš„ç»„ä»¶å®‰è£…åŒ…æ ¼å¼ï¼Œå®è´¨æ˜¯ä¸€ä¸ªåŒ…å« DLL æ–‡ä»¶çš„å‹ç¼©åŒ…ã€‚

---

### å®‰è£…æ–¹å¼äºŒï¼šæ‰‹åŠ¨å®‰è£… DLL

å¦‚æœä½ åå¥½æ‰‹åŠ¨ç®¡ç†ç»„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤æ–¹å¼ã€‚

1. **ä¸‹è½½æ’ä»¶**
   
   ä»å‘å¸ƒé¡µé¢ä¸‹è½½ `foo_ui_webview2.dll` æ–‡ä»¶

2. **æ‰¾åˆ° foobar2000 å®‰è£…ç›®å½•**
   
   é€šå¸¸ä½äºï¼š

```plaintext
C:\Program Files\foobar2000\              # é»˜è®¤å®‰è£…ä½ç½®
C:\Users\<ç”¨æˆ·å>\AppData\Local\foobar2000\  # ä¾¿æºç‰ˆ/ç”¨æˆ·å®‰è£…
```

3. **å¤åˆ¶åˆ°ç»„ä»¶ç›®å½•**
   
   å°† `foo_ui_webview2.dll` å¤åˆ¶åˆ° `components` å­ç›®å½•ï¼š

```plaintext
<foobar2000å®‰è£…ç›®å½•>\components\foo_ui_webview2.dll
```

4. **é‡å¯ foobar2000**

5. **é€‰æ‹© UI**
   
   `File` â†’ `Preferences` â†’ `Display` â†’ `Default User Interface` â†’ é€‰æ‹© `WebView UI`

---

### éªŒè¯å®‰è£…

å®‰è£…æˆåŠŸåï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š

- foobar2000 ç•Œé¢å˜ä¸º WebView UI çš„é»˜è®¤çš®è‚¤
- èœå•æ å‡ºç° `View` â†’ `WebView UI` é€‰é¡¹
- `File` â†’ `Preferences` â†’ `Tools` â†’ `WebView UI` åå¥½è®¾ç½®é¡µé¢

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
- [ ] æ˜¯å¦ä½¿ç”¨ 64-bit ç‰ˆæœ¬çš„ foobar2000
- [ ] WebView2 Runtime æ˜¯å¦å·²å®‰è£…
- [ ] DLL æ–‡ä»¶æ˜¯å¦æ”¾åœ¨æ­£ç¡®çš„ `components` ç›®å½•

---

### ç›®å½•ç»“æ„

```plaintext
foobar2000/
â”œâ”€â”€ foobar2000.exe              # ä¸»ç¨‹åº
â”œâ”€â”€ components/
â”‚   â””â”€â”€ foo_ui_webview2.dll      # æ’ä»¶ä¸»æ–‡ä»¶
â”œâ”€â”€ user-components-x64/
â”‚   â””â”€â”€ foo_ui_webview2/         # å¯é€‰ï¼šç”¨æˆ·ç»„ä»¶ç›®å½•ï¼ˆä¾¿æºç‰ˆï¼‰
â””â”€â”€ configuration/
    â””â”€â”€ foo_ui_webview2/         # æ’ä»¶é…ç½®æ–‡ä»¶
        â”œâ”€â”€ settings.json       # ç”¨æˆ·è®¾ç½®
        â””â”€â”€ cache/              # ç¼“å­˜ç›®å½•
```

### åå°æ¨¡å¼ (Background Mode) ğŸ†•

åå°æ¨¡å¼å…è®¸ WebView UI ä¸ Default UI æˆ–å…¶ä»–ç•Œé¢ï¼ˆå¦‚ Columns UIï¼‰åŒæ—¶ä½¿ç”¨ã€‚å¯ç”¨åï¼ŒWebView UI ä¼šåœ¨åå°åˆ›å»ºä¸€ä¸ªéšè—çª—å£ï¼Œæ‰€æœ‰ API ä»ç„¶å¯ç”¨ã€‚

**å¯ç”¨æ­¥éª¤ï¼š**

1. **å¼€å¯åå°æ¨¡å¼**  
   `Preferences` â†’ `Advanced` â†’ `Tools` â†’ `WebView UI` â†’ `Enable Background Mode`

2. **é€‰æ‹©å…¶ä»– UI**  
   `Preferences` â†’ `Display` â†’ `Default User Interface` â†’ é€‰æ‹© `Default UI` æˆ–å…¶ä»–

3. **é‡å¯ foobar2000**

4. **æ˜¾ç¤º/éšè—çª—å£**  
   `View` â†’ `WebView UI` â†’ `Show/Hide Window`

**ä½¿ç”¨åœºæ™¯ï¼š**
- å°† WebView UI ä½œä¸ºæ­Œè¯ã€å°é¢ç­‰è¾…åŠ©ä¿¡æ¯çª—å£
- ä½¿ç”¨ Default UI è¿›è¡Œæ’­æ”¾åˆ—è¡¨ç®¡ç†ï¼ŒåŒæ—¶ç”¨ WebView UI æ˜¾ç¤ºå¯è§†åŒ–æ•ˆæœ
- åœ¨åå°è¿è¡Œè‡ªå®šä¹‰è„šæœ¬æˆ–è‡ªåŠ¨åŒ–ä»»åŠ¡

</section>

<!-- ==================== DEVELOPER REQUIREMENTS ==================== -->
<section id="developer-requirements">

## ğŸ‘¨â€ğŸ’» å¼€å‘è€…æŠ€æœ¯è¦æ±‚

> ğŸ’¡ **åˆ«æ‹…å¿ƒï¼** å¦‚æœä½ åˆšæ¥è§¦å‰ç«¯å¼€å‘ï¼Œè¿™é‡Œçš„è¦æ±‚å¹¶ä¸è‹›åˆ»ã€‚foobar2000 WebView UI çš„è®¾è®¡ç†å¿µæ˜¯**é™ä½å…¥é—¨é—¨æ§›**â€”â€”ä½ åªéœ€è¦æŒæ¡åŸºæœ¬çš„ Web æŠ€æœ¯ï¼Œå°±å¯ä»¥å¼€å§‹æ„å»ºè‡ªå·±çš„ä¸ªæ€§åŒ–ç•Œé¢ã€‚

---

### âœ… åŸºç¡€æŠ€èƒ½ï¼ˆå¿…å¤‡ï¼‰

<div class="api-card" style="border-left: 4px solid #3fb950; background: linear-gradient(135deg, rgba(63, 185, 80, 0.1) 0%, transparent 50%);">
    <div class="api-card-body">

ä»¥ä¸‹æ˜¯ä½¿ç”¨æœ¬æ’ä»¶å¼€å‘è‡ªå®šä¹‰ UI çš„**æœ€ä½æŠ€æœ¯è¦æ±‚**ï¼š

| æŠ€èƒ½ | è¦æ±‚ç­‰çº§ | è¯´æ˜ |
|------|----------|------|
| **JavaScript** | â­â­ å…¥é—¨çº§ | äº†è§£å˜é‡ã€å‡½æ•°ã€å¯¹è±¡ã€æ•°ç»„çš„åŸºæœ¬ç”¨æ³•ï¼›ç†è§£ `async/await` å¼‚æ­¥è¯­æ³• |
| **HTML** | â­ åˆå­¦è€… | èƒ½ç¼–å†™åŸºæœ¬çš„ HTML ç»“æ„ï¼Œå¦‚ `<div>`ã€`<button>`ã€`<img>` ç­‰ |
| **CSS** | â­ åˆå­¦è€… | äº†è§£åŸºæœ¬é€‰æ‹©å™¨ã€å¸ƒå±€ï¼ˆFlexbox å³å¯ï¼‰ã€é¢œè‰²å’Œå­—ä½“è®¾ç½® |

**ä½ éœ€è¦çŸ¥é“çš„ JavaScript æ ¸å¿ƒæ¦‚å¿µ**ï¼š

```javascript
// 1ï¸âƒ£ åŸºç¡€è¯­æ³• - å˜é‡å’Œå‡½æ•°
const volume = 0.8;
function playMusic() { /* ... */ }

// 2ï¸âƒ£ å¼‚æ­¥æ“ä½œ - è¿™æ˜¯æœ€é‡è¦çš„ï¼æˆ‘ä»¬çš„ API éƒ½æ˜¯å¼‚æ­¥çš„
const track = await fb2k.invoke('playback.getCurrentTrack', {});

// 3ï¸âƒ£ å¯¹è±¡å’Œæ•°ç»„æ“ä½œ
const { title, artist, album } = track;  // è§£æ„èµ‹å€¼
tracks.forEach(t => console.log(t.title));  // éå†

// 4ï¸âƒ£ äº‹ä»¶ç›‘å¬
fb2k.on('playback:trackChanged', (data) => {
    updateUI(data);
});
```

ğŸ’š **å¥½æ¶ˆæ¯**ï¼šå¦‚æœä½ èƒ½çœ‹æ‡‚ä¸Šé¢çš„ä»£ç ï¼Œä½ å·²ç»å…·å¤‡å¼€å‘çš„åŸºç¡€äº†ï¼

</div>
</div>

---

### ğŸš€ æ¨èè¿›é˜¶æŠ€èƒ½

<div class="api-card" style="border-left: 4px solid #58a6ff; background: linear-gradient(135deg, rgba(88, 166, 255, 0.1) 0%, transparent 50%);">
    <div class="api-card-body">

ä»¥ä¸‹æŠ€èƒ½**ä¸æ˜¯å¿…é¡»çš„**ï¼Œä½†å¯ä»¥å¸®åŠ©ä½ åˆ›å»ºæ›´ä¸“ä¸šã€æ›´å¤æ‚çš„ç•Œé¢ï¼š

| æŠ€èƒ½ | ä¼˜å…ˆçº§ | ä¸ºä»€ä¹ˆæœ‰ç”¨ |
|------|--------|-----------|
| **Vue.js 3** | â­â­â­ å¼ºçƒˆæ¨è | ç»„ä»¶åŒ–å¼€å‘ã€å“åº”å¼æ•°æ®ç»‘å®šï¼Œå¤§å¹…æå‡å¼€å‘æ•ˆç‡ |
| **TypeScript** | â­â­ æ¨è | ç±»å‹æ£€æŸ¥å¯é¿å…å¸¸è§é”™è¯¯ï¼ŒIDE è‡ªåŠ¨è¡¥å…¨æ›´æ™ºèƒ½ |
| **CSS Flexbox/Grid** | â­â­ æ¨è | å¤æ‚å¸ƒå±€çš„å¿…å¤‡æŠ€èƒ½ï¼ˆå¦‚ä¸“è¾‘ç½‘æ ¼ã€æ’­æ”¾é˜Ÿåˆ—ï¼‰ |
| **Pinia/Vuex** | â­ å¯é€‰ | çŠ¶æ€ç®¡ç†ï¼Œé€‚åˆå¤§å‹é¡¹ç›® |
| **Vite** | â­ å¯é€‰ | ç°ä»£æ„å»ºå·¥å…·ï¼Œå¼€å‘ä½“éªŒæä½³ |

**æ¡†æ¶é€‰æ‹©å»ºè®®**ï¼š

| ä½ çš„æƒ…å†µ | æ¨èæ–¹æ¡ˆ |
|----------|----------|
| ğŸŒ± çº¯æ–°æ‰‹ | ä»åŸç”Ÿ HTML/CSS/JS å¼€å§‹ï¼Œç†Ÿæ‚‰ API åå†å­¦æ¡†æ¶ |
| ğŸŒ¿ æœ‰å‰ç«¯åŸºç¡€ | ç›´æ¥ä½¿ç”¨ **Vue 3 + Composition API** |
| ğŸŒ² ç†Ÿç»ƒå¼€å‘è€… | Vue 3 + TypeScript + Pinia + Vite å…¨å®¶æ¡¶ |

</div>
</div>

---

### ğŸ“š å­¦ä¹ èµ„æº

<div class="api-card">
    <div class="api-card-body">

**å¦‚æœä½ æ˜¯æ–°æ‰‹ï¼Œæ¨èä»¥ä¸‹å…è´¹å­¦ä¹ è·¯å¾„**ï¼š

1. **JavaScript åŸºç¡€** â†’ [MDN Web Docs](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide)
2. **async/await** â†’ [JavaScript.info - Async æ•™ç¨‹](https://zh.javascript.info/async-await)
3. **Vue 3 å…¥é—¨** â†’ [Vue.js å®˜æ–¹æ•™ç¨‹](https://cn.vuejs.org/tutorial/)
4. **CSS Flexbox** â†’ [Flexbox Froggy æ¸¸æˆ](https://flexboxfroggy.com/)

> ğŸ¯ **æç¤º**ï¼šä½ ä¸éœ€è¦ç²¾é€šæ‰€æœ‰æŠ€æœ¯æ‰èƒ½å¼€å§‹ï¼å¾ˆå¤šä¼˜ç§€çš„ foobar2000 çš®è‚¤éƒ½æ˜¯ä»ç®€å•çš„ HTML é¡µé¢å¼€å§‹ï¼Œé€æ­¥è¿­ä»£å®Œå–„çš„ã€‚

</div>
</div>

---

### âš¡ å¼€å‘ç¯å¢ƒå»ºè®®

| å·¥å…· | æ¨è | è¯´æ˜ |
|------|------|------|
| **ä»£ç ç¼–è¾‘å™¨** | VS Code | å…è´¹ã€æ’ä»¶ä¸°å¯Œã€è°ƒè¯•æ–¹ä¾¿ |
| **æµè§ˆå™¨è°ƒè¯•** | Edge DevTools | WebView2 åŸºäº Chromiumï¼Œå¯ç”¨ Edge è°ƒè¯• |
| **åŒ…ç®¡ç†å™¨** | npm / pnpm | å®‰è£…ä¾èµ–åº“ï¼ˆå¦‚æœä½¿ç”¨æ¡†æ¶ï¼‰ |
| **ç‰ˆæœ¬æ§åˆ¶** | Git | å¤‡ä»½ä»£ç ã€åä½œå¼€å‘ |

**VS Code æ¨èæ’ä»¶**ï¼š
- `Volar` - Vue 3 å®˜æ–¹æ’ä»¶
- `ESLint` - ä»£ç è§„èŒƒæ£€æŸ¥
- `Prettier` - ä»£ç æ ¼å¼åŒ–
- `Auto Close Tag` - HTML æ ‡ç­¾è‡ªåŠ¨é—­åˆ

</section>

<!-- ==================== IMPORTANT NOTES ==================== -->
<section id="important-notes">

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### è¯†åˆ«é™æ€æœ¬åœ°æ–‡ä»¶ vs æµåª’ä½“

foobar2000 æ”¯æŒå¤šç§åª’ä½“æ¥æºï¼ŒåŒ…æ‹¬æœ¬åœ°æ–‡ä»¶ã€å‹ç¼©åŒ…å†…æ–‡ä»¶ã€CD éŸ³è½¨ã€ç½‘ç»œæµç­‰ã€‚åœ¨æ“ä½œæ–‡ä»¶å‰ï¼Œéœ€è¦æ­£ç¡®è¯†åˆ«æ–‡ä»¶ç±»å‹ï¼š

#### è·¯å¾„æ ¼å¼ç±»å‹

| è·¯å¾„å‰ç¼€ | ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|----------|------|------|------|
| `C:\` `D:\` | æœ¬åœ°æ–‡ä»¶ | Windows æ ‡å‡†è·¯å¾„ | `D:\Music\song.flac` |
| `file://` | æœ¬åœ°æ–‡ä»¶ | URI æ ¼å¼æœ¬åœ°è·¯å¾„ | `file://D:/Music/song.flac` |
| `file-relative://` | ç›¸å¯¹è·¯å¾„ | ç›¸å¯¹äºæ’­æ”¾åˆ—è¡¨çš„è·¯å¾„ | `file-relative://../../song.flac` |
| `archive://` | å‹ç¼©åŒ… | å‹ç¼©åŒ…å†…çš„æ–‡ä»¶ | `archive://D:\Album.zip\|track01.flac` |
| `unpack://` | è§£å‹æ–‡ä»¶ | ä¸´æ—¶è§£å‹çš„æ–‡ä»¶ | `unpack://...` |
| `cdda://` | CD éŸ³è½¨ | ç‰©ç† CD éŸ³è½¨ | `cdda://E,1` |
| `http://` `https://` | ç½‘ç»œæµ | åœ¨çº¿åª’ä½“æµ | `https://stream.example.com/live` |

#### è¯†åˆ«æ–¹æ³•

```javascript
// ========== åˆ¤æ–­æ˜¯å¦ä¸ºé™æ€æœ¬åœ°æ–‡ä»¶ ==========
function isLocalFile(path) {
    if (!path) return false;
    
    // ç½‘ç»œæµï¼šä¸æ˜¯æœ¬åœ°æ–‡ä»¶
    if (path.startsWith('http://') || path.startsWith('https://')) {
        return false;
    }
    
    // CD éŸ³è½¨ï¼šä¸æ˜¯æ™®é€šæ–‡ä»¶
    if (path.startsWith('cdda://')) {
        return false;
    }
    
    // ç›¸å¯¹è·¯å¾„ï¼šéœ€è¦ä¸Šä¸‹æ–‡æ‰èƒ½è§£æ
    if (path.startsWith('file-relative://')) {
        return false; // ä½¿ç”¨ absolutePath ä»£æ›¿
    }
    
    // å‹ç¼©åŒ…å†…æ–‡ä»¶ï¼šå¯è¯»ä½†ä¸å¯ç›´æ¥è®¿é—®
    if (path.startsWith('archive://') || path.startsWith('unpack://')) {
        return true; // æ˜¯æ–‡ä»¶ï¼Œä½†å°é¢è·å–éœ€é€šè¿‡ API
    }
    
    // file:// URI æˆ–æ ‡å‡†è·¯å¾„
    return true;
}

// ========== æ¨èï¼šä½¿ç”¨ absolutePath ==========
const track = await fb2k.invoke('playlist.getTracks', { count: 1 });
const t = track.tracks[0];

// path: å¯èƒ½æ˜¯ file-relative://../../song.flac
// absolutePath: å§‹ç»ˆæ˜¯ D:\Music\song.flacï¼ˆå¦‚æœæ˜¯æœ¬åœ°æ–‡ä»¶ï¼‰
console.log('å†…éƒ¨è·¯å¾„:', t.path);
console.log('ç»å¯¹è·¯å¾„:', t.absolutePath);

// âœ… æ­£ç¡®ï¼šå§‹ç»ˆä½¿ç”¨ absolutePath è¿›è¡Œæ–‡ä»¶æ“ä½œ
if (t.absolutePath && isLocalFile(t.absolutePath)) {
    const artwork = await fb2k.invoke('artwork.getForTrack', {
        path: t.absolutePath
    });
}
```

#### å…³é”®åŸåˆ™

> **âš¡ å§‹ç»ˆä½¿ç”¨ `absolutePath` è€Œé `path`**  
> API è¿”å›çš„æ›²ç›®å¯¹è±¡åŒ…å«ä¸¤ä¸ªè·¯å¾„å­—æ®µï¼š
> - `path`: foobar2000 å†…éƒ¨è·¯å¾„ï¼ˆå¯èƒ½æ˜¯ `file-relative://` ç­‰ç‰¹æ®Šæ ¼å¼ï¼‰
> - `absolutePath`: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç»å¯¹è·¯å¾„ï¼ˆæ¨èä½¿ç”¨ï¼‰

---

### éŸ³é‡æ ¼å¼è¯´æ˜

| åœºæ™¯ | èŒƒå›´ | è¯´æ˜ |
|------|------|------|
| API è¾“å…¥/è¾“å‡º | `0-100` | æ•´æ•°ç™¾åˆ†æ¯”ï¼Œ0=é™éŸ³ï¼Œ100=æœ€å¤§ |
| æ»‘å—æ§ä»¶ | `0-100` | ç›´æ¥ç»‘å®š |
| dB æ¢ç®— | - | `0% â‰ˆ -100dB`ï¼Œ`100% = 0dB` |

```javascript
// è®¾ç½®éŸ³é‡ä¸º 80%ï¼ˆçº¦ -20dB å·¦å³ï¼‰
await fb2k.invoke('playback.setVolume', { volume: 80 });

// è·å–éŸ³é‡
const { volume } = await fb2k.invoke('playback.getVolume');
console.log(`å½“å‰éŸ³é‡: ${volume}%`);
```

---

### äº‹ä»¶åç§°æ ¼å¼

æ‰€æœ‰äº‹ä»¶ä½¿ç”¨ **å†’å·åˆ†éš”** çš„å‘½åæ ¼å¼ï¼š

```javascript
// âœ… æ­£ç¡®æ ¼å¼
fb2k.on('playback:trackChanged', callback);
fb2k.on('playback:stateChanged', callback);
fb2k.on('playlist:itemsChanged', callback);

// âŒ é”™è¯¯æ ¼å¼ï¼ˆä¸æ”¯æŒï¼‰
fb2k.on('playback.trackChanged', callback);
fb2k.on('playbackTrackChanged', callback);
```

---

### å¼‚æ­¥æ“ä½œæ³¨æ„

æ‰€æœ‰ `fb2k.invoke()` è°ƒç”¨éƒ½è¿”å› Promiseï¼Œ**å¿…é¡»ä½¿ç”¨ `await` æˆ– `.then()`**ï¼š

```javascript
// âœ… æ­£ç¡®
await fb2k.invoke('playback.play');
const track = await fb2k.invoke('playback.getCurrentTrack');

// âŒ é”™è¯¯ï¼šå¿˜è®° await ä¼šå¯¼è‡´æ“ä½œæœªå®Œæˆ
fb2k.invoke('playback.play');
const track = fb2k.invoke('playback.getCurrentTrack'); // è¿”å› Promise è€Œéç»“æœ
```

</section>

<!-- ==================== QUICK START ==================== -->
<section id="quick-start">

## å¿«é€Ÿå¼€å§‹

### åŸºç¡€è°ƒç”¨ç¤ºä¾‹

```javascript
// 1. è°ƒç”¨ APIï¼ˆæ‰€æœ‰è°ƒç”¨éƒ½æ˜¯å¼‚æ­¥çš„ï¼‰
const result = await fb2k.invoke('playback.play');
console.log(result); // { success: true }

// 2. è·å–å½“å‰æ›²ç›®ä¿¡æ¯
const track = await fb2k.invoke('playback.getCurrentTrack');
console.log(track.title, track.artist);
console.log('ç»å¯¹è·¯å¾„:', track.absolutePath); // æ¨èä½¿ç”¨

// 3. ç›‘å¬äº‹ä»¶ï¼ˆä½¿ç”¨å†’å·åˆ†éš”æ ¼å¼ï¼‰
const unsubscribe = fb2k.on('playback:trackChanged', (data) => {
    console.log('æ­£åœ¨æ’­æ”¾:', data.title);
});
// å–æ¶ˆè®¢é˜…ï¼šunsubscribe();

// 4. å¸¦å‚æ•°è°ƒç”¨ï¼ˆéŸ³é‡èŒƒå›´ 0-100ï¼‰
await fb2k.invoke('playback.setVolume', { volume: 80 }); // 80%

// 5. åˆ¤æ–­æ˜¯å¦ä¸ºæœ¬åœ°æ–‡ä»¶
function isStaticFile(absolutePath) {
    if (!absolutePath) return false;
    return !absolutePath.startsWith('http://') &&
           !absolutePath.startsWith('https://') &&
           !absolutePath.startsWith('cdda://');
}
```

### Bridge å¯¹è±¡

æ’ä»¶ä¼šè‡ªåŠ¨æ³¨å…¥ `window.fb2k` å¯¹è±¡ï¼š

```javascript
window.fb2k = {
    // è°ƒç”¨ API
    invoke(method, params) â†’ Promise<result>,
    
    // ç›‘å¬äº‹ä»¶
    on(event, callback) â†’ unsubscribe function,
    
    // å†…éƒ¨å±æ€§ï¼ˆå‹¿ç›´æ¥ä½¿ç”¨ï¼‰
    _callbacks: Map,
    _callId: number,
    _evts: Object
};
```

</section>

<!-- ==================== COMMON USE CASES ==================== -->
<section id="common-use-cases">

## å¸¸ç”¨åœºæ™¯ä¸æœ€ä½³å®è·µ

### ğŸµ åœºæ™¯ 1ï¼šæ„å»ºæ’­æ”¾å™¨ç•Œé¢

è¿™æ˜¯æœ€å¸¸è§çš„ä½¿ç”¨åœºæ™¯ï¼Œå±•ç¤ºå¦‚ä½•æ„å»ºä¸€ä¸ªå®Œæ•´çš„æ’­æ”¾æ§åˆ¶ç•Œé¢ï¼š

```javascript
// ========== å·¥å…·å‡½æ•°ï¼šåˆ¤æ–­é™æ€æ–‡ä»¶ ==========
function isStaticLocalFile(path) {
    if (!path) return false;
    // ç½‘ç»œæµå’Œ CD ä¸æ˜¯é™æ€æ–‡ä»¶
    if (path.startsWith('http://') || path.startsWith('https://')) return false;
    if (path.startsWith('cdda://')) return false;
    return true;
}

// ========== åˆå§‹åŒ–æ’­æ”¾å™¨çŠ¶æ€ ==========
async function initPlayer() {
    // è·å–å½“å‰æ’­æ”¾çŠ¶æ€
    const state = await fb2k.invoke('playback.getState');
    updatePlayButton(state.state === 'playing');
    
    // è·å–éŸ³é‡ï¼ˆ0-100 ç™¾åˆ†æ¯”ï¼‰
    const volumeInfo = await fb2k.invoke('playback.getVolume');
    updateVolumeSlider(volumeInfo.volume); // ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€è½¬æ¢
    
    // è·å–å½“å‰æ›²ç›®ä¿¡æ¯
    if (state.state === 'playing' || state.state === 'paused') {
        const track = await fb2k.invoke('playback.getCurrentTrack');
        updateTrackInfo(track);
        
        // è·å–å°é¢ï¼ˆä½¿ç”¨ absolutePath ç¡®ä¿å…¼å®¹æ€§ï¼‰
        if (isStaticLocalFile(track.absolutePath)) {
            const artwork = await fb2k.invoke('artwork.getCurrent');
            if (artwork.found) {
                document.getElementById('cover').src = artwork.dataUrl;
            }
        }
    }
}

// ========== æ’­æ”¾æ§åˆ¶æŒ‰é’® ==========
document.getElementById('btn-play').onclick = async () => {
    await fb2k.invoke('playback.playOrPause');
};

document.getElementById('btn-prev').onclick = async () => {
    await fb2k.invoke('playback.previous');
};

document.getElementById('btn-next').onclick = async () => {
    await fb2k.invoke('playback.next');
};

// ========== è¿›åº¦æ¡æ§åˆ¶ ==========
const progressBar = document.getElementById('progress');

// ç‚¹å‡»è·³è½¬
progressBar.onclick = async (e) => {
    const rect = progressBar.getBoundingClientRect();
    const percent = (e.clientX - rect.left) / rect.width;
    const state = await fb2k.invoke('playback.getState');
    const targetPos = percent * state.duration;
    await fb2k.invoke('playback.setPosition', { position: targetPos });
};

// ========== éŸ³é‡æ§åˆ¶ ==========
const volumeSlider = document.getElementById('volume');

volumeSlider.oninput = async (e) => {
    // æ»‘å— 0-100 ç›´æ¥ä½œä¸ºéŸ³é‡ç™¾åˆ†æ¯”
    const volume = parseInt(e.target.value); // 0-100
    await fb2k.invoke('playback.setVolume', { volume });
};

document.getElementById('btn-mute').onclick = async () => {
    await fb2k.invoke('playback.toggleMute');
};

// ========== äº‹ä»¶ç›‘å¬ ==========
// æ›²ç›®å˜åŒ–
fb2k.on('playback:trackChanged', async (track) => {
    updateTrackInfo(track);
    const artwork = await fb2k.invoke('artwork.getCurrent');
    if (artwork.found) {
        document.getElementById('cover').src = artwork.dataUrl;
    }
});

// æ’­æ”¾çŠ¶æ€å˜åŒ–
fb2k.on('playback:stateChanged', (state) => {
    updatePlayButton(state.isPlaying);
});

// æ’­æ”¾ä½ç½®å˜åŒ–ï¼ˆç”¨äºæ›´æ–°è¿›åº¦æ¡ï¼‰
fb2k.on('playback:time', (data) => {
    // éœ€è¦ç¼“å­˜ durationï¼Œå› ä¸º playback:time åªæœ‰ position
    const percent = (data.position / currentDuration) * 100;
    document.getElementById('progress-fill').style.width = percent + '%';
    document.getElementById('time-current').textContent = formatTime(data.position);
});

// éŸ³é‡å˜åŒ–
fb2k.on('playback:volumeChanged', (data) => {
    volumeSlider.value = data.volume; // å·²ç»æ˜¯ 0-100 èŒƒå›´
});

// ========== è¾…åŠ©å‡½æ•° ==========
function formatTime(seconds) {
    const min = Math.floor(seconds / 60);
    const sec = Math.floor(seconds % 60);
    return `${min}:${sec.toString().padStart(2, '0')}`;
}

function updateTrackInfo(track) {
    document.getElementById('title').textContent = track.title || 'æœªçŸ¥æ›²ç›®';
    document.getElementById('artist').textContent = track.artist || 'æœªçŸ¥è‰ºæœ¯å®¶';
    document.getElementById('album').textContent = track.album || '';
    document.getElementById('time-total').textContent = formatTime(track.duration);
}

function updatePlayButton(isPlaying) {
    document.getElementById('btn-play').textContent = isPlaying ? 'â¸' : 'â–¶';
}

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
initPlayer();
```

### ğŸ“‹ åœºæ™¯ 2ï¼šæ’­æ”¾åˆ—è¡¨ç®¡ç†

```javascript
// ========== è·å–æ‰€æœ‰æ’­æ”¾åˆ—è¡¨ ==========
async function loadPlaylists() {
    const { playlists } = await fb2k.invoke('playlist.getAll');
    
    const container = document.getElementById('playlist-list');
    container.innerHTML = '';
    
    playlists.forEach((pl, index) => {
        const item = document.createElement('div');
        item.className = 'playlist-item' + (pl.isActive ? ' active' : '');
        item.innerHTML = `
            <span class="name">${pl.name}</span>
            <span class="count">${pl.itemCount} é¦–</span>
        `;
        item.onclick = () => switchPlaylist(index);
        container.appendChild(item);
    });
}

// ========== åˆ‡æ¢æ’­æ”¾åˆ—è¡¨ ==========
async function switchPlaylist(index) {
    await fb2k.invoke('playlist.setActive', { playlist: index });
    loadPlaylists();
    loadTracks(index);
}

// ========== åŠ è½½æ›²ç›®åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ ==========
async function loadTracks(playlist, page = 0) {
    const pageSize = 50;
    const result = await fb2k.invoke('playlist.getTracks', {
        playlist,
        start: page * pageSize,
        count: pageSize
    });
    
    const container = document.getElementById('track-list');
    if (page === 0) container.innerHTML = '';
    
    result.tracks.forEach(track => {
        const item = document.createElement('div');
        item.className = 'track-item';
        item.innerHTML = `
            <span class="number">${track.index + 1}</span>
            <span class="title">${track.title}</span>
            <span class="artist">${track.artist}</span>
            <span class="duration">${formatTime(track.duration)}</span>
        `;
        item.ondblclick = () => playTrack(playlist, track.index);
        container.appendChild(item);
    });
    
    // åŠ è½½æ›´å¤šæŒ‰é’®
    if (result.tracks.length === pageSize) {
        const loadMore = document.createElement('button');
        loadMore.textContent = 'åŠ è½½æ›´å¤š...';
        loadMore.onclick = () => loadTracks(playlist, page + 1);
        container.appendChild(loadMore);
    }
}

// ========== æ’­æ”¾æŒ‡å®šæ›²ç›® ==========
async function playTrack(playlist, track) {
    await fb2k.invoke('playlist.playTrack', { playlist, track });
}

// ========== åˆ›å»ºæ–°æ’­æ”¾åˆ—è¡¨ ==========
async function createPlaylist() {
    const name = prompt('è¾“å…¥æ’­æ”¾åˆ—è¡¨åç§°:');
    if (name) {
        await fb2k.invoke('playlist.create', { name });
        loadPlaylists();
    }
}

// ========== åˆ é™¤æ’­æ”¾åˆ—è¡¨ ==========
async function deletePlaylist(index) {
    if (confirm('ç¡®å®šåˆ é™¤æ­¤æ’­æ”¾åˆ—è¡¨?')) {
        await fb2k.invoke('playlist.remove', { playlist: index });
        loadPlaylists();
    }
}

// ========== æ·»åŠ æ–‡ä»¶åˆ°æ’­æ”¾åˆ—è¡¨ ==========
async function addFilesToPlaylist() {
    // æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
    const result = await fb2k.invoke('dialog.openFile', {
        title: 'é€‰æ‹©éŸ³ä¹æ–‡ä»¶',
        filters: [
            { name: 'éŸ³é¢‘æ–‡ä»¶', spec: '*.mp3;*.flac;*.wav;*.m4a;*.ogg' },
            { name: 'æ‰€æœ‰æ–‡ä»¶', spec: '*.*' }
        ],
        multiSelect: true
    });
    
    if (!result.cancelled && result.paths.length > 0) {
        await fb2k.invoke('playlist.addPaths', {
            paths: result.paths
        });
        loadTracks(await getActivePlaylist());
    }
}

// ========== ç›‘å¬æ’­æ”¾åˆ—è¡¨å˜åŒ– ==========
fb2k.on('playlist:itemsChanged', () => {
    loadTracks(currentPlaylistIndex);
});

fb2k.on('playlist:playlistsChanged', () => {
    loadPlaylists();
});
```

### ğŸ” åœºæ™¯ 3ï¼šåª’ä½“åº“æœç´¢ä¸å°é¢è·å–

```javascript
// ========== å·¥å…·å‡½æ•° ==========
function isStaticLocalFile(path) {
    if (!path) return false;
    if (path.startsWith('http://') || path.startsWith('https://')) return false;
    if (path.startsWith('cdda://')) return false;
    return true;
}

// ========== æœç´¢åª’ä½“åº“ ==========
async function searchLibrary(query) {
    const result = await fb2k.invoke('library.search', {
        query: query,
        offset: 0,
        limit: 50
    });
    
    console.log(`æ‰¾åˆ° ${result.total} ä¸ªç»“æœ`);
    
    const container = document.getElementById('search-results');
    container.innerHTML = '';
    
    for (const track of result.tracks) {
        const item = document.createElement('div');
        item.className = 'search-result';
        
        // âš ï¸ å§‹ç»ˆä½¿ç”¨ absolutePathï¼ˆé pathï¼‰
        let coverSrc = 'default-cover.png';
        
        // åªæœ‰é™æ€æœ¬åœ°æ–‡ä»¶æ‰èƒ½è·å–å°é¢
        if (isStaticLocalFile(track.absolutePath)) {
            const artwork = await fb2k.invoke('artwork.getForTrack', {
                path: track.absolutePath,  // âœ… ä½¿ç”¨ absolutePath
                type: 'front'
            });
            if (artwork.available) {
                coverSrc = artwork.dataUrl;
            }
        }
        
        item.innerHTML = `
            <img src="${coverSrc}" 
                 class="cover-thumb" width="50" height="50">
            <div class="info">
                <div class="title">${track.title}</div>
                <div class="artist">${track.artist}</div>
            </div>
        `;
        
        item.onclick = () => playFromPath(track.absolutePath);
        container.appendChild(item);
    }
    
    // åˆ†é¡µåŠ è½½æ›´å¤š
    if (result.hasMore) {
        addLoadMoreButton(query, 50);
    }
}

// ========== æœç´¢è¯­æ³•ç¤ºä¾‹ ==========
// ç®€å•æœç´¢
searchLibrary('love');

// å­—æ®µæœç´¢
searchLibrary('artist HAS Beatles');
searchLibrary('album IS "Abbey Road"');

// ç»„åˆæœç´¢
searchLibrary('artist HAS Beatles AND year GREATER 1968');
searchLibrary('genre IS Rock OR genre IS Pop');

// ========== è·å–ä¸“è¾‘åˆ—è¡¨ï¼ˆå¸¦å°é¢ï¼‰ ==========
async function loadAlbums() {
    const result = await fb2k.invoke('library.getAlbums', {
        sort: 'year',      // æŒ‰å¹´ä»½æ’åº
        limit: 30,
        includeTracks: false
    });
    
    const container = document.getElementById('album-grid');
    container.innerHTML = '';
    
    for (const album of result.albums) {
        // ä½¿ç”¨ firstTrackAbsolutePath è·å–ä¸“è¾‘å°é¢
        const artwork = await fb2k.invoke('artwork.getForTrack', {
            path: album.firstTrackAbsolutePath,
            type: 'front'
        });
        
        const card = document.createElement('div');
        card.className = 'album-card';
        card.innerHTML = `
            <img src="${artwork.available ? artwork.dataUrl : 'default-album.png'}" 
                 class="album-cover">
            <div class="album-name">${album.name}</div>
            <div class="album-artist">${album.artist}</div>
            <div class="album-info">${album.year} Â· ${album.trackCount} é¦–</div>
        `;
        
        card.onclick = () => showAlbumDetail(album.name, album.artist);
        container.appendChild(card);
    }
}

// ========== æ˜¾ç¤ºä¸“è¾‘è¯¦æƒ… ==========
async function showAlbumDetail(albumName, artist) {
    const tracks = await fb2k.invoke('library.getAlbumTracks', {
        album: albumName,
        artist: artist
    });
    
    // æ˜¾ç¤ºæ›²ç›®åˆ—è¡¨...
    console.log(`${albumName} å…± ${tracks.length} é¦–æ›²ç›®`);
}
```

### ğŸªŸ åœºæ™¯ 4ï¼šçª—å£ä¸å¤–è§‚æ§åˆ¶

```javascript
// ========== çª—å£æ§åˆ¶ ==========

// æœ€å°åŒ–/æœ€å¤§åŒ–/å…³é—­
document.getElementById('btn-minimize').onclick = () => 
    fb2k.invoke('window.minimize');

document.getElementById('btn-maximize').onclick = () => 
    fb2k.invoke('window.maximize');

document.getElementById('btn-close').onclick = () => 
    fb2k.invoke('window.close');

// çª—å£ç½®é¡¶
let isAlwaysOnTop = false;
document.getElementById('btn-pin').onclick = async () => {
    isAlwaysOnTop = !isAlwaysOnTop;
    await fb2k.invoke('window.setAlwaysOnTop', { enabled: isAlwaysOnTop });
    document.getElementById('btn-pin').classList.toggle('active', isAlwaysOnTop);
};

// ========== Mica/æ¯›ç»ç’ƒæ•ˆæœ ==========
async function applyMicaEffect() {
    // Windows 11 Mica æ•ˆæœ
    await fb2k.invoke('window.setMica', { enabled: true });
    
    // æˆ–ä½¿ç”¨æ¯›ç»ç’ƒæ•ˆæœ (Windows 10 å…¼å®¹)
    // await fb2k.invoke('window.setBlur', { enabled: true });
}

// ========== åœ†è§’çª—å£ (Windows 11) ==========
async function setRoundedCorners(style) {
    // style: 'default' | 'none' | 'round' | 'small'
    await fb2k.invoke('window.setCornerPreference', { preference: style });
}

// ========== å…¨å±åˆ‡æ¢ ==========
let isFullscreen = false;
document.getElementById('btn-fullscreen').onclick = async () => {
    if (isFullscreen) {
        await fb2k.invoke('window.exitFullscreen');
    } else {
        await fb2k.invoke('window.enterFullscreen');
    }
    isFullscreen = !isFullscreen;
};

// ========== ç›‘å¬çª—å£çŠ¶æ€ ==========
fb2k.on('window:stateChanged', (state) => {
    console.log('çª—å£çŠ¶æ€:', state.state); // normal, minimized, maximized
    updateMaximizeButton(state.state === 'maximized');
});

fb2k.on('window:focusChanged', (data) => {
    document.body.classList.toggle('window-inactive', !data.focused);
});

// ========== è‡ªå®šä¹‰æ ‡é¢˜æ æ‹–æ‹½ ==========
// æ ‡è®°å¯æ‹–æ‹½åŒºåŸŸ
document.getElementById('titlebar').setAttribute('data-webview-drag', 'true');

// æ ‡è®°ä¸å¯æ‹–æ‹½çš„æŒ‰é’®åŒºåŸŸ
document.querySelectorAll('.titlebar-button').forEach(btn => {
    btn.setAttribute('data-webview-drag', 'false');
});
```

### âŒ¨ï¸ åœºæ™¯ 5ï¼šå…¨å±€å¿«æ·é”®

```javascript
// ========== æ³¨å†Œå…¨å±€å¿«æ·é”® ==========
async function registerHotkeys() {
    // æ’­æ”¾/æš‚åœ: Ctrl+Shift+Space
    await fb2k.invoke('keyboard.registerHotkey', {
        id: 'play-pause',
        key: 'Space',
        modifiers: ['ctrl', 'shift']
    });
    
    // ä¸‹ä¸€æ›²: Ctrl+Shift+Right
    await fb2k.invoke('keyboard.registerHotkey', {
        id: 'next-track',
        key: 'Right',
        modifiers: ['ctrl', 'shift']
    });
    
    // ä¸Šä¸€æ›²: Ctrl+Shift+Left
    await fb2k.invoke('keyboard.registerHotkey', {
        id: 'prev-track',
        key: 'Left',
        modifiers: ['ctrl', 'shift']
    });
    
    // éŸ³é‡+: Ctrl+Shift+Up
    await fb2k.invoke('keyboard.registerHotkey', {
        id: 'volume-up',
        key: 'Up',
        modifiers: ['ctrl', 'shift']
    });
    
    // éŸ³é‡-: Ctrl+Shift+Down
    await fb2k.invoke('keyboard.registerHotkey', {
        id: 'volume-down',
        key: 'Down',
        modifiers: ['ctrl', 'shift']
    });
}

// ========== ç›‘å¬å¿«æ·é”®è§¦å‘ ==========
fb2k.on('keyboard:hotkeyPressed', async (data) => {
    switch (data.id) {
        case 'play-pause':
            await fb2k.invoke('playback.playOrPause');
            break;
        case 'next-track':
            await fb2k.invoke('playback.next');
            break;
        case 'prev-track':
            await fb2k.invoke('playback.previous');
            break;
        case 'volume-up':
            const state1 = await fb2k.invoke('playback.getVolume');
            await fb2k.invoke('playback.setVolume', { 
                volume: Math.min(100, state1.volume + 5) 
            });
            break;
        case 'volume-down':
            const state2 = await fb2k.invoke('playback.getVolume');
            await fb2k.invoke('playback.setVolume', { 
                volume: Math.max(0, state2.volume - 5) 
            });
            break;
    }
});

// é¡µé¢åŠ è½½æ—¶æ³¨å†Œ
registerHotkeys();

// ========== é¡µé¢å¸è½½æ—¶å–æ¶ˆæ³¨å†Œ ==========
window.addEventListener('beforeunload', async () => {
    await fb2k.invoke('keyboard.unregisterHotkey', { id: 'play-pause' });
    await fb2k.invoke('keyboard.unregisterHotkey', { id: 'next-track' });
    await fb2k.invoke('keyboard.unregisterHotkey', { id: 'prev-track' });
    await fb2k.invoke('keyboard.unregisterHotkey', { id: 'volume-up' });
    await fb2k.invoke('keyboard.unregisterHotkey', { id: 'volume-down' });
});
```

### ğŸ“ åœºæ™¯ 6ï¼šé…ç½®ä¸æ–‡ä»¶å­˜å‚¨

```javascript
// ========== ä½¿ç”¨é…ç½®å­˜å‚¨ ==========
const CONFIG_PREFIX = 'myapp.';

// ä¿å­˜é…ç½®
async function saveConfig(key, value) {
    await fb2k.invoke('config.set', {
        key: CONFIG_PREFIX + key,
        value: JSON.stringify(value)
    });
}

// è¯»å–é…ç½®
async function loadConfig(key, defaultValue = null) {
    const result = await fb2k.invoke('config.get', {
        key: CONFIG_PREFIX + key
    });
    if (result.value) {
        return JSON.parse(result.value);
    }
    return defaultValue;
}

// ä½¿ç”¨ç¤ºä¾‹
async function initSettings() {
    // åŠ è½½ç”¨æˆ·è®¾ç½®
    const settings = await loadConfig('settings', {
        theme: 'dark',
        showLyrics: true,
        coverSize: 'large'
    });
    
    applySettings(settings);
}

async function saveSettings(settings) {
    await saveConfig('settings', settings);
}

// ========== æ–‡ä»¶è¯»å†™ ==========
// ä¿å­˜åˆ°æ–‡ä»¶
async function exportPlaylistToFile() {
    // é€‰æ‹©ä¿å­˜ä½ç½®
    const result = await fb2k.invoke('dialog.saveFile', {
        title: 'å¯¼å‡ºæ’­æ”¾åˆ—è¡¨',
        filters: [
            { name: 'JSON æ–‡ä»¶', spec: '*.json' }
        ],
        defaultName: 'playlist-backup.json'
    });
    
    if (!result.cancelled) {
        const { tracks } = await fb2k.invoke('playlist.getTracks', { count: 10000 });
        await fb2k.invoke('file.write', {
            path: result.path,
            content: JSON.stringify(tracks, null, 2)
        });
        console.log('å¯¼å‡ºæˆåŠŸ:', result.path);
    }
}

// è¯»å–æ–‡ä»¶
async function importPlaylistFromFile() {
    const result = await fb2k.invoke('dialog.openFile', {
        title: 'å¯¼å…¥æ’­æ”¾åˆ—è¡¨',
        filters: [
            { name: 'JSON æ–‡ä»¶', spec: '*.json' }
        ]
    });
    
    if (!result.cancelled) {
        const content = await fb2k.invoke('file.read', {
            path: result.paths[0]
        });
        const tracks = JSON.parse(content.content);
        console.log('å¯¼å…¥äº†', tracks.length, 'é¦–æ›²ç›®');
    }
}
```

### ğŸ¨ åœºæ™¯ 7ï¼šè·¯å¾„å¤„ç†ä¸æ–‡ä»¶ç±»å‹è¯†åˆ«

```javascript
// ========== foobar2000 è·¯å¾„æ ¼å¼å®Œæ•´åˆ—è¡¨ ==========
//
// ğŸ“ æœ¬åœ°æ–‡ä»¶:
//   - C:\Music\song.flac              (Windows æ ‡å‡†è·¯å¾„)
//   - file://C:/Music/song.flac        (æ ‡å‡† file URI)
//
// ğŸ“¦ å‹ç¼©åŒ…æ–‡ä»¶:
//   - archive://D:\Album.zip|/track01.flac  (ZIP/RAR ç­‰å†…éƒ¨æ–‡ä»¶)
//   - unpack://...                          (ä¸´æ—¶è§£å‹æ–‡ä»¶)
//
// ğŸ’¿ CD éŸ³è½¨:
//   - cdda://E,1                       (å…‰é©± E: ç¬¬ 1 è½¨)
//
// ğŸŒ ç½‘ç»œæµ:
//   - http://stream.example.com/live   (HTTP æµ)
//   - https://...                       (HTTPS æµ)
//
// ğŸ“‚ ç›¸å¯¹è·¯å¾„ (ä»…æ’­æ”¾åˆ—è¡¨å†…éƒ¨ä½¿ç”¨):
//   - file-relative://../../song.flac  (ç›¸å¯¹è·¯å¾„ï¼Œéœ€ä¸Šä¸‹æ–‡è§£æ)

// ========== å…³é”®åŸåˆ™ ==========
// API è¿”å›çš„æ›²ç›®å¯¹è±¡åŒ…å«ä¸¤ä¸ªè·¯å¾„å­—æ®µ:
// - path: foobar2000 å†…éƒ¨æ ¼å¼ (å¯èƒ½æ˜¯ç‰¹æ®Šåè®®)
// - absolutePath: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç»å¯¹è·¯å¾„ (æ¨èä½¿ç”¨)

// ========== è¯†åˆ«æ–‡ä»¶ç±»å‹ ==========
function getFileType(absolutePath) {
    if (!absolutePath) return 'unknown';
    
    if (absolutePath.startsWith('http://') || 
        absolutePath.startsWith('https://')) {
        return 'stream';          // ç½‘ç»œæµåª’ä½“
    }
    if (absolutePath.startsWith('cdda://')) {
        return 'cd';              // CD éŸ³è½¨
    }
    if (absolutePath.startsWith('archive://') ||
        absolutePath.startsWith('unpack://')) {
        return 'archive';         // å‹ç¼©åŒ…å†…æ–‡ä»¶
    }
    return 'local';               // æœ¬åœ°æ–‡ä»¶
}

// ========== æ­£ç¡®çš„å°é¢è·å–æ–¹å¼ ==========

// âŒ é”™è¯¯ï¼šä½¿ç”¨ path å¯èƒ½å¤±è´¥ï¼ˆfile-relative:// æ— æ³•è§£æï¼‰
const tracks = await fb2k.invoke('playlist.getTracks', { count: 1 });
const artwork = await fb2k.invoke('artwork.getForTrack', {
    path: tracks.tracks[0].path  // å¯èƒ½æ˜¯ file-relative://...
});

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ absolutePath
const tracks2 = await fb2k.invoke('playlist.getTracks', { count: 1 });
const t = tracks2.tracks[0];

// å…ˆæ£€æŸ¥æ–‡ä»¶ç±»å‹
const fileType = getFileType(t.absolutePath);
if (fileType === 'stream') {
    console.log('ç½‘ç»œæµåª’ä½“ï¼Œå¯èƒ½æ— å°é¢');
} else {
    const artwork = await fb2k.invoke('artwork.getForTrack', {
        path: t.absolutePath  // âœ… å§‹ç»ˆä½¿ç”¨ absolutePath
    });
}

// âœ… æ›´å¥½ï¼šä½¿ç”¨ getByPlaylistItemï¼ˆä¸éœ€è¦è·¯å¾„ï¼Œè‡ªåŠ¨å¤„ç†ï¼‰
const artwork = await fb2k.invoke('artwork.getByPlaylistItem', {
    playlist: 0,
    index: 0,
    type: 'front'
});

// ========== æ‰¹é‡è·å–å°é¢ ==========
async function loadCoversForTracks(tracks) {
    const covers = {};
    
    // å¹¶è¡Œè¯·æ±‚ï¼ˆæ³¨æ„æ§åˆ¶å¹¶å‘æ•°ï¼‰
    const batchSize = 5;
    for (let i = 0; i < tracks.length; i += batchSize) {
        const batch = tracks.slice(i, i + batchSize);
        const promises = batch.map(async track => {
            const art = await fb2k.invoke('artwork.getForTrack', {
                path: track.absolutePath
            });
            return { index: track.index, artwork: art };
        });
        
        const results = await Promise.all(promises);
        results.forEach(r => covers[r.index] = r.artwork);
    }
    
    return covers;
}
```

</section>

<!-- ==================== BRIDGE PROTOCOL ==================== -->
<section id="bridge-protocol">

## Bridge åè®®

### è¯·æ±‚æ ¼å¼

```json
{
    "id": 1,
    "method": "playback.play",
    "params": {}
}
```

### å“åº”æ ¼å¼

```json
{
    "type": "response",
    "id": 1,
    "result": { "success": true }
}
```

### é”™è¯¯å“åº”

```json
{
    "type": "response",
    "id": 1,
    "error": "Invalid playlist index"
}
```

### äº‹ä»¶æ ¼å¼

```json
{
    "type": "event",
    "event": "playback:trackChanged",
    "data": {
        "title": "Song Name",
        "artist": "Artist Name",
        "album": "Album Name",
        "duration": 180.5
    }
}
```

</section>

<!-- ==================== PLAYBACK CONTROL ==================== -->
<section id="playback-control">

## Playback API - æ’­æ”¾æ§åˆ¶

### playback.play

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.play</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¼€å§‹æ’­æ”¾ã€‚å¦‚æœå·²æš‚åœåˆ™æ¢å¤æ’­æ”¾ï¼Œå¦‚æœå·²åœæ­¢åˆ™ä»å¤´å¼€å§‹ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{ "success": true }
```

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('playback.play');
```
</div>
</div>

### playback.pause

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.pause</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æš‚åœæ’­æ”¾ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playback.stop

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.stop</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åœæ­¢æ’­æ”¾ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playback.playOrPause

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.playOrPause</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ‡æ¢æ’­æ”¾/æš‚åœçŠ¶æ€ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{ "success": true }
```

**åˆ«å**: `playback.playPause`
    </div>
</div>

### playback.next

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.next</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ’­æ”¾ä¸‹ä¸€æ›²ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playback.previous

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.previous</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ’­æ”¾ä¸Šä¸€æ›²ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playback.random

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.random</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">éšæœºæ’­æ”¾ä¸€æ›²ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

</section>

<!-- ==================== PLAYBACK STATE ==================== -->
<section id="playback-state">

## Playback API - çŠ¶æ€è·å–

### playback.getState

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getState</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ’­æ”¾çŠ¶æ€ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "state": "playing",
    "canSeek": true,
    "canPause": true
}
```

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `state` | string | æ’­æ”¾çŠ¶æ€ï¼š`"stopped"` / `"playing"` / `"paused"` |
| `canSeek` | boolean | æ˜¯å¦å¯ä»¥è·³è½¬è¿›åº¦ |
| `canPause` | boolean | æ˜¯å¦å¯ä»¥æš‚åœ |

> **æ³¨æ„**: éŸ³é‡ä¿¡æ¯è¯·ä½¿ç”¨ `playback.getVolume`ï¼Œæ’­æ”¾ä½ç½®è¯·ä½¿ç”¨ `playback.getPosition`ã€‚
    </div>
</div>

### playback.getCurrentTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getCurrentTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ’­æ”¾æ›²ç›®ä¿¡æ¯ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "title": "Song Title",
    "artist": "Artist Name",
    "album": "Album Name",
    "albumArtist": "Album Artist",
    "genre": "Genre",
    "date": "2024",
    "trackNumber": 1,
    "discNumber": 1,
    "duration": 180.5,
    "path": "C:/Music/song.flac",
    "fileSize": 35000000,
    "bitrate": 1411,
    "sampleRate": 44100,
    "channels": 2,
    "codec": "FLAC"
}
```
</div>
</div>

### playback.getPosition

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getPosition</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ’­æ”¾ä½ç½®ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "position": 45.3,
    "duration": 180.5
}
```
</div>
</div>

### playback.setPosition

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playback.setPosition</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®æ’­æ”¾ä½ç½®ï¼ˆè·³è½¬ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `position` | number | âœ“ | ç›®æ ‡ä½ç½®ï¼ˆç§’ï¼‰ï¼Œä¹Ÿæ”¯æŒ `seconds` å‚æ•°å |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('playback.setPosition', { position: 60 }); // è·³è½¬åˆ° 1 åˆ†é’Ÿ
// æˆ–
await fb2k.invoke('playback.setPosition', { seconds: 60 }); // åŒæ ·æœ‰æ•ˆ
```
</div>
</div>

</section>

<!-- ==================== PLAYBACK VOLUME ==================== -->
<section id="playback-volume">

## Playback API - éŸ³é‡æ§åˆ¶

### playback.getVolume

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getVolume</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰éŸ³é‡ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "volume": 80,
    "volumeDb": -20.0,
    "muted": false
}
```

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `volume` | number | éŸ³é‡ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼Œ100 ä¸ºæœ€å¤§ï¼‰ |
| `volumeDb` | number | éŸ³é‡ dB å€¼ï¼ˆ-100 åˆ° 0ï¼Œ0 ä¸ºæœ€å¤§ï¼‰ |
| `muted` | boolean | æ˜¯å¦é™éŸ³ |

> **æ³¨æ„**: `volume` æ˜¯çº¿æ€§ç™¾åˆ†æ¯”å€¼ï¼Œ`volumeDb` æ˜¯ dB å€¼ã€‚å»ºè®®ä½¿ç”¨ `volume` è¿›è¡Œ UI æ˜¾ç¤ºã€‚
    </div>
</div>

### playback.setVolume

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playback.setVolume</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®éŸ³é‡ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `volume` | number | âœ“ | éŸ³é‡ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼Œ100 ä¸ºæœ€å¤§éŸ³é‡ï¼‰ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('playback.setVolume', { volume: 80 }); // è®¾ç½®ä¸º 80%ï¼ˆçº¦ -20 dBï¼‰
await fb2k.invoke('playback.setVolume', { volume: 50 }); // è®¾ç½®ä¸º 50%ï¼ˆ-50 dBï¼‰
await fb2k.invoke('playback.setVolume', { volume: 100 }); // æœ€å¤§éŸ³é‡ï¼ˆ0 dBï¼‰
```

> **æ¢ç®—å…¬å¼**: `dB = volume - 100`ï¼Œå³ `volume: 80` å¯¹åº” `-20 dB`
    </div>
</div>

### playback.mute

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.mute</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®é™éŸ³çŠ¶æ€ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `muted` | boolean | âœ— | æ˜¯å¦é™éŸ³ï¼ˆé»˜è®¤ trueï¼‰ |

**è¿”å›å€¼**:
```json
{ "success": true }
```

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('playback.mute', { muted: true });  // é™éŸ³
await fb2k.invoke('playback.mute', { muted: false }); // å–æ¶ˆé™éŸ³
await fb2k.invoke('playback.mute'); // é™éŸ³ï¼ˆé»˜è®¤ muted=trueï¼‰
```
</div>
</div>

### playback.toggleMute

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.toggleMute</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ‡æ¢é™éŸ³çŠ¶æ€ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true, "muted": true }
```

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `success` | boolean | æ“ä½œæ˜¯å¦æˆåŠŸ |
| `muted` | boolean | åˆ‡æ¢åçš„é™éŸ³çŠ¶æ€ |
    </div>
</div>

</section>

<!-- ==================== PLAYBACK ORDER ==================== -->
<section id="playback-order">

## Playback API - æ’­æ”¾é¡ºåº

### playback.getPlaybackOrder

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getPlaybackOrder</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ’­æ”¾é¡ºåºæ¨¡å¼ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "order": 0,
    "orderName": "Default"
}
```

| Order å€¼ | åç§° | æè¿° |
|----------|------|------|
| 0 | Default | é»˜è®¤é¡ºåº |
| 1 | Repeat (playlist) | é‡å¤æ’­æ”¾åˆ—è¡¨ |
| 2 | Repeat (track) | å•æ›²å¾ªç¯ |
| 3 | Random | éšæœºæ’­æ”¾ |
| 4 | Shuffle (tracks) | éšæœºï¼ˆæ›²ç›®ï¼‰ |
| 5 | Shuffle (albums) | éšæœºï¼ˆä¸“è¾‘ï¼‰ |
| 6 | Shuffle (folders) | éšæœºï¼ˆæ–‡ä»¶å¤¹ï¼‰ |
    </div>
</div>

### playback.setPlaybackOrder

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playback.setPlaybackOrder</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®æ’­æ”¾é¡ºåºæ¨¡å¼ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `order` | number | âœ“ | é¡ºåºæ¨¡å¼ï¼ˆ0-6ï¼‰ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('playback.setPlaybackOrder', { order: 3 }); // è®¾ç½®ä¸ºéšæœºæ’­æ”¾
```
</div>
</div>

### playback.getStopAfterCurrent / setStopAfterCurrent

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getStopAfterCurrent</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–/è®¾ç½®"æ’­å®Œå½“å‰æ›²ç›®ååœæ­¢"çŠ¶æ€ã€‚</div>

**è¿”å›å€¼**:
```json
{ "stopAfterCurrent": false }
```

**è®¾ç½®**:
```javascript
await fb2k.invoke('playback.setStopAfterCurrent', { enabled: true });
```
</div>
</div>

### playback.toggleStopAfterCurrent

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.toggleStopAfterCurrent</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ‡æ¢"æ’­å®Œå½“å‰æ›²ç›®ååœæ­¢"çŠ¶æ€ã€‚</div>

**è¿”å›å€¼**:
```json
{ "enabled": true }
```
</div>
</div>

### playback.getCurrentTrackIndex ğŸ†•

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getCurrentTrackIndex</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ’­æ”¾æ›²ç›®åœ¨æ’­æ”¾åˆ—è¡¨ä¸­çš„ä½ç½®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| includeTrackInfo | boolean | - | æ˜¯å¦åŒ…å«æ›²ç›®è¯¦ç»†ä¿¡æ¯ï¼ˆé»˜è®¤ falseï¼‰ |

**è¿”å›å€¼**:
```json
{
    "found": true,
    "playlist": 0,
    "index": 15,
    "track": { ... }  // ä»…å½“ includeTrackInfo=true æ—¶
}
```

**ç¤ºä¾‹**:
```javascript
const pos = await fb2k.invoke('playback.getCurrentTrackIndex');
if (pos.found) {
    console.log(`æ­£åœ¨æ’­æ”¾åˆ—è¡¨ ${pos.playlist} çš„ç¬¬ ${pos.index} é¦–`);
}

// åŒ…å«æ›²ç›®ä¿¡æ¯
const posWithTrack = await fb2k.invoke('playback.getCurrentTrackIndex', { 
    includeTrackInfo: true 
});
```
</div>
</div>

### playback.getPlayingPlaylist ğŸ†•

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playback.getPlayingPlaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ­£åœ¨æ’­æ”¾çš„æ’­æ”¾åˆ—è¡¨ä¿¡æ¯ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "found": true,
    "playlist": 0,
    "name": "Default"
}
```

**ç¤ºä¾‹**:
```javascript
const playing = await fb2k.invoke('playback.getPlayingPlaylist');
if (playing.found) {
    console.log(`æ­£åœ¨ä» "${playing.name}" æ’­æ”¾`);
}
```
</div>
</div>

### playback.playPause

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.playPause</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ‡æ¢æ’­æ”¾/æš‚åœçŠ¶æ€ã€‚ä¸ playOrPause ç±»ä¼¼ï¼Œä½†æ˜¯è¯¥APIä¸å¼€å§‹æ–°æ’­æ”¾ï¼ˆå¦‚æœå½“å‰å¤„äºåœæ­¢çŠ¶æ€ï¼‰ã€‚</div>

**è¿”å›å€¼**: `{}`
    </div>
</div>

### playback.playPath

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.playPath</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ç›´æ¥æ’­æ”¾æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ã€‚æ”¯æŒ CUE/å¤šå­è½¨æ–‡ä»¶çš„æŒ‡å®š subsong æ’­æ”¾ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ã€‚æ”¯æŒ `\|subsong:N` æ ¼å¼æŒ‡å®šå­è½¨ç´¢å¼•ï¼ˆ0-basedï¼‰ |

**è¿”å›å€¼**:
```json
{ "success": true, "tracksAdded": 1, "path": "...", "subsong": 2 }
```

**ç¤ºä¾‹**:
```javascript
// æ™®é€šæ–‡ä»¶æ’­æ”¾
await fb2k.invoke('playback.playPath', {
    path: 'D:\\Music\\song.mp3'
});

// ğŸ†• CUE æ–‡ä»¶æ’­æ”¾æŒ‡å®šè½¨é“ï¼ˆç¬¬3è½¨ï¼Œç´¢å¼•ä¸º2ï¼‰
await fb2k.invoke('playback.playPath', {
    path: 'D:\\Music\\album.flac|subsong:2'
});
```

> **æ³¨æ„**: subsong ç´¢å¼•æ˜¯ 0-basedã€‚å¦‚æœä» `playlist.getTracks` è·å–çš„ `trackNumber` æ˜¯ 1-basedï¼Œéœ€è¦å‡ 1ã€‚
</div>
</div>

### playback.playPaths

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playback.playPaths</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ’­æ”¾å¤šä¸ªæ–‡ä»¶è·¯å¾„ã€‚æ”¯æŒ CUE/å¤šå­è½¨æ–‡ä»¶çš„æŒ‡å®š subsong æ’­æ”¾ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| paths | string[] | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„æ•°ç»„ã€‚æ¯ä¸ªè·¯å¾„æ”¯æŒ `\|subsong:N` æ ¼å¼ |
| startIndex | number | - | å¼€å§‹æ’­æ”¾çš„ç´¢å¼•ï¼Œé»˜è®¤ 0 |

**è¿”å›å€¼**:
```json
{ "success": true, "tracksAdded": 5, "startedAt": 0 }
```

**ç¤ºä¾‹**:
```javascript
// æ™®é€šå¤šæ–‡ä»¶æ’­æ”¾
await fb2k.invoke('playback.playPaths', {
    paths: ['D:\\Music\\song1.mp3', 'D:\\Music\\song2.mp3'],
    startIndex: 0
});

// ğŸ†• CUE å¤šè½¨é“æ’­æ”¾
await fb2k.invoke('playback.playPaths', {
    paths: [
        'D:\\Music\\album.flac|subsong:0',
        'D:\\Music\\album.flac|subsong:1',
        'D:\\Music\\album.flac|subsong:2'
    ],
    startIndex: 1  // ä»ç¬¬2é¦–å¼€å§‹æ’­æ”¾
});
```
</div>
</div>

</section>

---

<!-- ==================== PLAYLIST MANAGEMENT ==================== -->
<section id="playlist-management">

## Playlist API - åˆ—è¡¨ç®¡ç†

### playlist.getCount

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getCount</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ’­æ”¾åˆ—è¡¨æ•°é‡ã€‚</div>

**è¿”å›å€¼**:
```json
{ "count": 5 }
```
</div>
</div>

### playlist.getAll

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getAll</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ‰€æœ‰æ’­æ”¾åˆ—è¡¨ä¿¡æ¯ã€‚è¿”å›æ’­æ”¾åˆ—è¡¨æ•°ç»„ã€‚</div>

**è¿”å›å€¼**:
```json
[
    {
        "index": 0,
        "name": "Default",
        "trackCount": 150,
        "isActive": true,
        "isPlaying": true,
        "duration": 36000.5,
        "isLocked": false
    },
    {
        "index": 1,
        "name": "Favorites",
        "trackCount": 50,
        "isActive": false,
        "isPlaying": false,
        "duration": 12000.0,
        "isLocked": false
    }
]
```
</div>
</div>

### playlist.getActive

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getActive</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ¿€æ´»çš„æ’­æ”¾åˆ—è¡¨ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "index": 0,
    "name": "Default",
    "trackCount": 150
}
```
</div>
</div>

### playlist.setActive

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playlist.setActive</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®æ¿€æ´»çš„æ’­æ”¾åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `index` | number | âœ“ | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('playlist.setActive', { index: 1 });
```
</div>
</div>

### playlist.getPlaying

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getPlaying</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ­£åœ¨æ’­æ”¾çš„æ’­æ”¾åˆ—è¡¨ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "index": 0,
    "name": "Default",
    "trackCount": 150
}
```
</div>
</div>

### playlist.create

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.create</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ›å»ºæ–°çš„æ’­æ”¾åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `name` | string | âœ— | æ’­æ”¾åˆ—è¡¨åç§°ï¼ˆé»˜è®¤ "New Playlist"ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "index": 2,
    "name": "My Playlist"
}
```

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('playlist.create', { name: 'Rock Music' });
console.log('åˆ›å»ºæˆåŠŸï¼Œç´¢å¼•:', result.index);
```
</div>
</div>

### playlist.remove

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.remove</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ é™¤æ’­æ”¾åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼•ï¼ˆé»˜è®¤å½“å‰æ¿€æ´»ï¼‰ |

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playlist.rename

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playlist.rename</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é‡å‘½åæ’­æ”¾åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |
| `name` | string | âœ“ | æ–°åç§° |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('playlist.rename', { playlist: 0, name: 'My Favorites' });
```
</div>
</div>

### playlist.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ¸…ç©ºæ’­æ”¾åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ›²ç›®ã€‚ğŸ†• v1.1.2 å¢å¼ºè¿”å›å€¼</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "playlist": 0,
    "clearedCount": 22,     // æ¸…ç©ºå‰çš„æ›²ç›®æ•°é‡
    "remainingCount": 0     // æ¸…ç©ºååº”ä¸º 0ï¼ˆç”¨äºéªŒè¯ï¼‰
}
```
</div>
</div>

### playlist.duplicate

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.duplicate</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¤åˆ¶æ’­æ”¾åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æºæ’­æ”¾åˆ—è¡¨ç´¢å¼• |
| `name` | string | âœ— | æ–°åˆ—è¡¨åç§° |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "sourcePlaylist": 0,
    "newPlaylist": 1,
    "name": "Default (Copy)",
    "trackCount": 150
}
```
</div>
</div>

</section>

<!-- ==================== PLAYLIST TRACKS ==================== -->
<section id="playlist-tracks">

## Playlist API - æ›²ç›®æ“ä½œ

> **å‚æ•°å…¼å®¹æ€§**: æ‰€æœ‰ Playlist API åŒæ—¶æ”¯æŒ `playlist` å’Œ `playlistIndex` å‚æ•°å

### playlist.getTrackCount

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getTrackCount</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ’­æ”¾åˆ—è¡¨ä¸­çš„æ›²ç›®æ•°é‡ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼•ï¼ˆå…¼å®¹åˆ«å: `playlistIndex`ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "playlist": 0,
    "count": 150
}
```
</div>
</div>

### playlist.getTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ’­æ”¾åˆ—è¡¨ä¸­çš„æ›²ç›®åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰ã€‚è¿”å›å€¼åŒæ—¶åŒ…å« <code>items</code> å’Œ <code>tracks</code> å­—æ®µã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼•ï¼ˆå…¼å®¹åˆ«å: `playlistIndex`ï¼‰ |
| `start` | number | âœ— | èµ·å§‹ä½ç½®ï¼ˆé»˜è®¤ 0ï¼‰ |
| `count` | number | âœ— | è·å–æ•°é‡ï¼ˆé»˜è®¤ 50ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "playlist": 0,
    "start": 0,
    "count": 20,
    "total": 150,
    "items": [...],
    "tracks": [
        {
            "index": 0,
            "title": "Song 1",
            "artist": "Artist 1",
            "album": "Album 1",
            "duration": 180.5,
            "path": "file://C:/Music/song1.flac",
            "absolutePath": "C:\\Music\\song1.flac"
        }
    ]
}
```

> ğŸ’¡ **æç¤º**: `absolutePath` æ˜¯æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œå¯ç›´æ¥ç”¨äº `artwork.getForTrack` ç­‰ APIã€‚`path` æ˜¯ foobar2000 å†…éƒ¨æ ¼å¼ï¼Œå¯èƒ½åŒ…å« `file://` æˆ– `file-relative://` å‰ç¼€ã€‚
```

**ç¤ºä¾‹**:
```javascript
// è·å–å‰ 20 é¦–
const page1 = await fb2k.invoke('playlist.getTracks', { start: 0, count: 20 });

// è·å–ç¬¬ 21-40 é¦–
const page2 = await fb2k.invoke('playlist.getTracks', { start: 20, count: 20 });
```
</div>
</div>

### playlist.playTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.playTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ’­æ”¾æ’­æ”¾åˆ—è¡¨ä¸­çš„æŒ‡å®šæ›²ç›®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |
| `track` | number | âœ“ | æ›²ç›®ç´¢å¼• |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('playlist.playTrack', { playlist: 0, track: 5 });
```
</div>
</div>

### playlist.removeTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.removeTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ä»æ’­æ”¾åˆ—è¡¨ä¸­åˆ é™¤æŒ‡å®šæ›²ç›®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `index` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |
| `items` | number[] | âœ“ | è¦åˆ é™¤çš„æ›²ç›®ç´¢å¼•æ•°ç»„ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('playlist.removeTracks', { items: [0, 5, 10] });
```
</div>
</div>

### playlist.moveTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.moveTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ç§»åŠ¨é€‰ä¸­çš„æ›²ç›®ï¼ˆå‘ä¸Šæˆ–å‘ä¸‹ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `index` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |
| `items` | number[] | âœ“ | è¦ç§»åŠ¨çš„æ›²ç›®ç´¢å¼•æ•°ç»„ |
| `delta` | number | âœ“ | ç§»åŠ¨åç§»é‡ï¼ˆæ­£æ•°å‘ä¸‹ï¼Œè´Ÿæ•°å‘ä¸Šï¼‰ |

**ç¤ºä¾‹**:
```javascript
// å°†ç¬¬ 0ã€1ã€2 é¦–å‘ä¸‹ç§»åŠ¨ 3 ä¸ªä½ç½®
await fb2k.invoke('playlist.moveTracks', { items: [0, 1, 2], delta: 3 });

// å°†ç¬¬ 5ã€6 é¦–å‘ä¸Šç§»åŠ¨ 2 ä¸ªä½ç½®
await fb2k.invoke('playlist.moveTracks', { items: [5, 6], delta: -2 });
```
</div>
</div>

### playlist.addPaths

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.addPaths</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ·»åŠ æ–‡ä»¶/æ–‡ä»¶å¤¹åˆ°æ’­æ”¾åˆ—è¡¨ã€‚ğŸ†• v1.1.2 å¢å¼ºè¿”å›å€¼</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |
| `paths` | string[] | âœ“ | æ–‡ä»¶/æ–‡ä»¶å¤¹è·¯å¾„æ•°ç»„ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "playlist": 0,
    "requestedPaths": 25,    // è¯·æ±‚æ·»åŠ çš„è·¯å¾„æ•°
    "addedCount": 25,        // å®é™…æ·»åŠ çš„æ›²ç›®æ•°
    "countBefore": 0,        // æ·»åŠ å‰çš„æ›²ç›®æ•°
    "totalCount": 25         // æ·»åŠ åçš„æ€»æ›²ç›®æ•°
}
```

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('playlist.addPaths', {
    paths: ['C:/Music/album1', 'C:/Music/song.mp3']
});
```
</div>
</div>

### playlist.addHandles ğŸ†•

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.addHandles</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ğŸ†• v1.1.5 æ–°å¢ã€‚ç²¾ç¡®æ·»åŠ è½¨é“åˆ°æ’­æ”¾åˆ—è¡¨ï¼Œä¸è‡ªåŠ¨å±•å¼€ CUE/å­è½¨é“ã€‚æ¯ä¸ª handle ä¸¥æ ¼å¯¹åº”ä¸€ä¸ªè½¨é“ã€‚ä¸ addPaths çš„åŒºåˆ«ï¼šaddPaths ä¼šè‡ªåŠ¨å±•å¼€ CUE æ–‡ä»¶å¾—åˆ°å¤šä¸ªå­è½¨é“ï¼Œè€Œ addHandles åªæ·»åŠ æŒ‡å®šçš„è½¨é“ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼•ï¼ˆé»˜è®¤æ´»åŠ¨æ’­æ”¾åˆ—è¡¨ï¼‰ |
| `handles` | array | âœ“ | è½¨é“æ•°ç»„ï¼Œæ”¯æŒå¯¹è±¡æ ¼å¼æˆ–å­—ç¬¦ä¸²æ ¼å¼ |

**handles æ•°ç»„æ ¼å¼**:
```javascript
// å¯¹è±¡æ ¼å¼ - æ¨è
{ path: "D:/music/album.cue", subsong: 0 }   // CUE æ–‡ä»¶æœ¬èº«
{ path: "D:/music/album.cue", subsong: 1 }   // CUE ç¬¬ä¸€è½¨
{ path: "D:/music/song.mp3" }                 // æ™®é€šæ–‡ä»¶ï¼Œsubsong é»˜è®¤ 0

// å­—ç¬¦ä¸²æ ¼å¼ - æ”¯æŒ |subsong:N åç¼€
"D:/music/album.cue|subsong:0"
"D:/music/album.cue|subsong:1"
"D:/music/song.mp3"
```

**è¿”å›å€¼**:
```json
{
    "success": true,
    "playlist": 0,
    "requestedCount": 22,    // è¯·æ±‚æ·»åŠ çš„ handle æ•°
    "addedCount": 22,        // å®é™…æ·»åŠ çš„æ›²ç›®æ•°
    "invalidCount": 0,       // æ— æ•ˆçš„ handle æ•°
    "countBefore": 0,        // æ·»åŠ å‰çš„æ›²ç›®æ•°
    "totalCount": 22         // æ·»åŠ åçš„æ€»æ›²ç›®æ•°
}
```

**ç¤ºä¾‹**:
```javascript
// å¯¹è±¡æ ¼å¼ - ç²¾ç¡®æ§åˆ¶ subsong
await fb2k.invoke('playlist.addHandles', {
    playlist: 0,
    handles: [
        { path: 'D:/Music/album.cue', subsong: 0 },  // CUE æœ¬èº«
        { path: 'D:/Music/album.cue', subsong: 1 },  // ç¬¬ä¸€è½¨
        { path: 'D:/Music/album.cue', subsong: 2 },  // ç¬¬äºŒè½¨
        { path: 'D:/Music/song.mp3' }                 // æ™®é€šæ–‡ä»¶
    ]
});

// å­—ç¬¦ä¸²æ ¼å¼ - ä½¿ç”¨ |subsong:N åç¼€
await fb2k.invoke('playlist.addHandles', {
    handles: [
        'D:/Music/album.cue|subsong:1',
        'D:/Music/album.cue|subsong:2',
        'D:/Music/song.flac'
    ]
});
```

**ä½¿ç”¨åœºæ™¯**:
- éœ€è¦ç²¾ç¡®æ§åˆ¶æ·»åŠ å“ªäº›è½¨é“ï¼Œä¸å¸Œæœ› CUE è¢«è‡ªåŠ¨å±•å¼€
- å‰ç«¯å·²ç»çŸ¥é“è¦æ·»åŠ çš„å…·ä½“ subsong ç´¢å¼•
- å¤„ç†å¤šè½¨é“æ–‡ä»¶ï¼ˆCUEã€å¤šè½¨ APE/FLACï¼‰æ—¶éœ€è¦é€‰æ‹©æ€§æ·»åŠ 
</div>
</div>

### playlist.replaceAllAndPlay ğŸ†•

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.replaceAllAndPlay</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ğŸ†• v1.1.2 æ–°å¢ã€‚åŸå­æ“ä½œï¼šæ¸…ç©ºæ’­æ”¾åˆ—è¡¨ + æ·»åŠ è·¯å¾„ + æ’­æ”¾æŒ‡å®šæ›²ç›®ã€‚è§£å†³ clear â†’ addPaths â†’ playTrack çš„æ—¶åºé—®é¢˜ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |
| `paths` | string[] | âœ“ | æ–‡ä»¶/URL è·¯å¾„æ•°ç»„ |
| `playIndex` | number | âœ— | æ’­æ”¾ç¬¬å‡ é¦–ï¼ˆé»˜è®¤ 0ï¼‰ |
| `stopFirst` | boolean | âœ— | æ˜¯å¦å…ˆåœæ­¢å½“å‰æ’­æ”¾ï¼ˆé»˜è®¤ trueï¼‰ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "playlist": 0,
    "clearedCount": 10,      // æ¸…ç©ºäº†å¤šå°‘é¦–
    "addedCount": 22,        // æ·»åŠ äº†å¤šå°‘é¦–
    "totalCount": 22,        // å½“å‰æ€»æ•°
    "playIndex": 19          // å®é™…æ’­æ”¾çš„ç´¢å¼•
}
```

**ç¤ºä¾‹**:
```javascript
// æ›¿æ¢æ’­æ”¾åˆ—è¡¨å†…å®¹å¹¶æ’­æ”¾ç¬¬ 19 é¦–
const result = await fb2k.invoke('playlist.replaceAllAndPlay', {
    playlist: 0,
    paths: [
        'E:/Music/song1.flac',
        'E:/Music/song2.flac',
        'https://stream.example.com/audio.mp3'
    ],
    playIndex: 19,
    stopFirst: true
});

console.log(`æ¸…ç©ºäº† ${result.clearedCount} é¦–ï¼Œæ·»åŠ äº† ${result.addedCount} é¦–`);
```

**ä½¿ç”¨åœºæ™¯**:
- åŠ è½½æ–°çš„æ’­æ”¾åˆ—è¡¨å¹¶ç«‹å³æ’­æ”¾
- é¿å… `playback.stop` è§¦å‘æ„å¤–çš„ `stateChanged` äº‹ä»¶
- ç¡®ä¿æ’­æ”¾åˆ—è¡¨ç´¢å¼•ä¸æ›²ç›®æ­£ç¡®å¯¹åº”
</div>
</div>

### playlist.sort

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.sort</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¯¹æ’­æ”¾åˆ—è¡¨è¿›è¡Œæ’åºã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `index` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |
| `pattern` | string | âœ— | æ’åºæ¨¡å¼ï¼ˆé»˜è®¤ "%title%"ï¼‰ |
| `descending` | boolean | âœ— | æ˜¯å¦å€’åº |
| `selectedOnly` | boolean | âœ— | æ˜¯å¦ä»…æ’åºé€‰ä¸­é¡¹ |

**ç¤ºä¾‹**:
```javascript
// æŒ‰è‰ºæœ¯å®¶æ’åº
await fb2k.invoke('playlist.sort', { pattern: '%artist%' });

// æŒ‰æ—¥æœŸå€’åº
await fb2k.invoke('playlist.sort', { pattern: '%date%', descending: true });
```
</div>
</div>

### playlist.shuffle

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.shuffle</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">éšæœºæ‰“ä¹±æ’­æ”¾åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playlist.undo / playlist.redo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.undo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ’¤é”€/é‡åšæ’­æ”¾åˆ—è¡¨æ“ä½œã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

</section>

<!-- ==================== PLAYLIST AUTOPLAYLIST ==================== -->
<section id="playlist-autoplaylist">

## Playlist API - æ™ºèƒ½æ’­æ”¾åˆ—è¡¨

> æ™ºèƒ½æ’­æ”¾åˆ—è¡¨ï¼ˆAutoplaylistï¼‰ä¼šæ ¹æ®æŸ¥è¯¢æ¡ä»¶è‡ªåŠ¨ä»åª’ä½“åº“ä¸­å¡«å……æ›²ç›®ã€‚

### playlist.isAutoplaylist

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.isAutoplaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ£€æŸ¥æ’­æ”¾åˆ—è¡¨æ˜¯å¦ä¸ºæ™ºèƒ½æ’­æ”¾åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |

**è¿”å›å€¼**:
```json
{
    "playlist": 0,
    "isAutoplaylist": true
}
```
</div>
</div>

### playlist.createAutoplaylist

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.createAutoplaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ›å»ºæ™ºèƒ½æ’­æ”¾åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `name` | string | âœ— | æ’­æ”¾åˆ—è¡¨åç§° |
| `query` | string | âœ“ | æŸ¥è¯¢æ¡ä»¶ï¼ˆfoobar2000 æŸ¥è¯¢è¯­æ³•ï¼‰ |
| `sort` | string | âœ— | æ’åºæ¨¡å¼ |
| `keepSorted` | boolean | âœ— | æ˜¯å¦ä¿æŒæ’åºï¼ˆç¦æ­¢æ‰‹åŠ¨é‡æ’ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "playlist": 2,
    "name": "Recent Additions",
    "query": "%added% DURING LAST 2 WEEKS"
}
```

**æŸ¥è¯¢è¯­æ³•ç¤ºä¾‹**:
```javascript
// æœ€è¿‘æ·»åŠ çš„æ›²ç›®
await fb2k.invoke('playlist.createAutoplaylist', {
    name: 'Recent',
    query: '%added% DURING LAST 2 WEEKS',
    sort: '%added%',
    keepSorted: true
});

// é«˜è¯„åˆ†æ›²ç›®
await fb2k.invoke('playlist.createAutoplaylist', {
    name: 'Top Rated',
    query: '%rating% GREATER 3'
});

// ç‰¹å®šè‰ºæœ¯å®¶
await fb2k.invoke('playlist.createAutoplaylist', {
    name: 'Beatles',
    query: 'artist HAS beatles'
});

// ç‰¹å®šæµæ´¾
await fb2k.invoke('playlist.createAutoplaylist', {
    name: 'Jazz',
    query: 'genre IS jazz'
});
```
</div>
</div>

### playlist.convertToAutoplaylist

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.convertToAutoplaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å°†æ™®é€šæ’­æ”¾åˆ—è¡¨è½¬æ¢ä¸ºæ™ºèƒ½æ’­æ”¾åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |
| `query` | string | âœ“ | æŸ¥è¯¢æ¡ä»¶ |
| `sort` | string | âœ— | æ’åºæ¨¡å¼ |
| `keepSorted` | boolean | âœ— | æ˜¯å¦ä¿æŒæ’åº |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "playlist": 0
}
```
</div>
</div>

### playlist.removeAutoplaylist

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.removeAutoplaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ç§»é™¤æ™ºèƒ½æ’­æ”¾åˆ—è¡¨å±æ€§ï¼ˆè½¬å›æ™®é€šåˆ—è¡¨ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "playlist": 0
}
```
</div>
</div>

### playlist.getAutoplaylistInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getAutoplaylistInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ™ºèƒ½æ’­æ”¾åˆ—è¡¨è¯¦ç»†ä¿¡æ¯ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "isAutoplaylist": true,
    "playlist": 0,
    "keepSorted": true
}
```
</div>
</div>

</section>

<!-- ==================== PLAYLIST SELECTION ==================== -->
<section id="playlist-selection">

## Playlist API - é€‰æ‹©æ“ä½œ

### playlist.getSelectedTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getSelectedTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–é€‰ä¸­çš„æ›²ç›®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |

**è¿”å›å€¼**:
```json
{
    "playlist": 0,
    "selectedIndices": [0, 5, 10],
    "tracks": [
        { "index": 0, "title": "Song 1", ... },
        { "index": 5, "title": "Song 6", ... }
    ]
}
```
</div>
</div>

### playlist.setSelection

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">playlist.setSelection</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®é€‰ä¸­çš„æ›²ç›®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |
| `indices` | number[] | âœ“ | è¦é€‰ä¸­çš„æ›²ç›®ç´¢å¼•æ•°ç»„ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('playlist.setSelection', { indices: [0, 1, 2, 3, 4] });
```
</div>
</div>

### playlist.removeSelectedTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.removeSelectedTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ é™¤é€‰ä¸­çš„æ›²ç›®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼• |

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playlist.focusTrack / playlist.getFocusTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getFocusTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–/è®¾ç½®ç„¦ç‚¹æ›²ç›®ï¼ˆå…‰æ ‡ä½ç½®ï¼‰ã€‚</div>

**è·å–è¿”å›å€¼**:
```json
{
    "playlist": 0,
    "focusIndex": 5,
    "track": { "title": "Song 6", ... }
}
```

**è®¾ç½®**:
```javascript
await fb2k.invoke('playlist.focusTrack', { playlist: 0, track: 10 });
```
</div>
</div>

### playlist.getLockInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getLockInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ’­æ”¾åˆ—è¡¨é”å®šçŠ¶æ€ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "playlist": 0,
    "isLocked": false
}
```
</div>
</div>

### playlist.isLocked

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.isLocked</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ£€æŸ¥æ’­æ”¾åˆ—è¡¨æ˜¯å¦é”å®šã€‚</div>

**è¿”å›å€¼**:
```json
{ "isLocked": false }
```
</div>
</div>

### playlist.getSelection

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getSelection</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–é€‰ä¸­çš„æ›²ç›®ç´¢å¼•ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "items": [0, 5, 10],
    "count": 3,
    "playlist": 0
}
```
</div>
</div>

### playlist.selectAll

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.selectAll</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é€‰ä¸­æ’­æ”¾åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ›²ç›®ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playlist.deselectAll

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.deselectAll</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å–æ¶ˆé€‰ä¸­æ’­æ”¾åˆ—è¡¨ä¸­çš„æ‰€æœ‰æ›²ç›®ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playlist.getFocusedTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getFocusedTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–ç„¦ç‚¹æ›²ç›®ç´¢å¼•ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "playlist": 0,
    "index": 5
}
```
</div>
</div>

### playlist.setFocusedTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.setFocusedTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®ç„¦ç‚¹æ›²ç›®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| index | number | âœ… | æ›²ç›®ç´¢å¼• |

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playlist.reverse

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.reverse</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åè½¬æ’­æ”¾åˆ—è¡¨é¡ºåºã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playlist.redo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">playlist.redo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é‡åšæ’­æ”¾åˆ—è¡¨æ“ä½œã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### playlist.getAutoplaylistQuery

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playlist.getAutoplaylistQuery</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ™ºèƒ½æ’­æ”¾åˆ—è¡¨çš„æŸ¥è¯¢æ¡ä»¶ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "isAutoplaylist": true,
    "playlist": 0,
    "query": null,
    "keepSorted": true,
    "note": "Query string not exposed by SDK"
}
```
</div>
</div>

</section>

<!-- ==================== LIBRARY BROWSE ==================== -->
<section id="library-browse">

## Library API - æµè§ˆåª’ä½“åº“

### library.isEnabled

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.isEnabled</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ£€æŸ¥åª’ä½“åº“æ˜¯å¦å¯ç”¨ã€‚</div>

**è¿”å›å€¼**:
```json
{ "enabled": true }
```
</div>
</div>

### library.getStats

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getStats</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–åª’ä½“åº“ç»Ÿè®¡ä¿¡æ¯ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "totalTracks": 15000,
    "totalAlbums": 500,
    "totalArtists": 200,
    "totalDuration": 3600000,
    "totalSize": 150000000000,
    "cacheValid": true,
    "lastModified": 1736064000000
}
```

> ğŸ†• æ–°å¢ `cacheValid` å’Œ `lastModified` å­—æ®µç”¨äºç¼“å­˜çŠ¶æ€æ£€æŸ¥ã€‚
</div>
</div>

### library.getAlbums

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getAlbums</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–åª’ä½“åº“ä¸­çš„ä¸“è¾‘åˆ—è¡¨ã€‚æ”¯æŒç›´æ¥è¿”å›å°é¢æ•°æ®ï¼Œé¿å…é¢å¤–è¯·æ±‚ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `query` | string | âœ— | è¿‡æ»¤å…³é”®è¯ï¼ˆä¸“è¾‘åæˆ–è‰ºæœ¯å®¶ï¼‰ |
| `sort` | string | âœ— | æ’åºæ–¹å¼ï¼š`name`ã€`artist`ã€`year`ã€`trackCount` |
| `offset` | number | âœ— | èµ·å§‹åç§»ï¼ˆé»˜è®¤ 0ï¼‰ |
| `limit` | number | âœ— | æœ€å¤§è¿”å›æ•°é‡ï¼ˆé»˜è®¤ 100ï¼‰ |
| `includeTracks` | boolean | âœ— | æ˜¯å¦åŒ…å«æ›²ç›®åˆ—è¡¨ |
| `includeCover` | boolean | âœ— | ğŸ†• æ˜¯å¦ç›´æ¥è¿”å›å°é¢ dataUrlï¼ˆé¿å…é¢å¤–è¯·æ±‚ï¼‰ |
| `coverMaxSize` | number | âœ— | ğŸ†• å°é¢æœ€å¤§å¤§å° KBï¼ˆé»˜è®¤ 500ï¼Œ0=æ— é™åˆ¶ï¼‰ |
| `useCache` | boolean | âœ— | ğŸ†• æ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼ˆé»˜è®¤ trueï¼‰ |

**è¿”å›å€¼**:
```json
{
    "total": 500,
    "offset": 0,
    "limit": 100,
    "hasMore": true,
    "includeCover": true,
    "albums": [
        {
            "name": "Abbey Road",
            "artist": "The Beatles",
            "albumArtist": "The Beatles",
            "trackCount": 17,
            "discCount": 1,
            "duration": 2800,
            "year": "1969",
            "genre": "Rock",
            "label": "Apple Records",
            "firstTrackPath": "file://C:/Music/Beatles/01.flac",
            "firstTrackAbsolutePath": "C:\\Music\\Beatles\\01.flac",
            "coverDataUrl": "data:image/jpeg;base64,/9j/4AAQ...",
            "tracks": [...]
        }
    ]
}
```

> ğŸ’¡ **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨ `includeCover: true` å¯ä¸€æ¬¡æ€§è·å–æ‰€æœ‰ä¸“è¾‘å°é¢ï¼Œé¿å…é€ä¸ªè°ƒç”¨ `artwork.getForTrack`ï¼Œæ˜¾è‘—æå‡åŠ è½½é€Ÿåº¦ã€‚
    </div>
</div>

### library.getAlbumTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getAlbumTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æŒ‡å®šä¸“è¾‘çš„æ›²ç›®ã€‚è¿”å›çš„æ›²ç›®åŒ…å« <code>absolutePath</code> å­—æ®µã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `album` | string | âœ“ | ä¸“è¾‘åç§° |
| `artist` | string | âœ— | ä¸“è¾‘è‰ºæœ¯å®¶ï¼ˆåŒºåˆ†åŒåä¸“è¾‘ï¼‰ |

**è¿”å›å€¼**:
```json
[
    {
        "index": 0,
        "title": "Come Together",
        "artist": "The Beatles",
        "trackNumber": 1,
        "path": "file://C:/Music/Beatles/01.flac",
        "absolutePath": "C:\\Music\\Beatles\\01.flac"
    }
]
```
</div>
</div>

### library.getArtists

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getArtists</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–åª’ä½“åº“ä¸­çš„è‰ºæœ¯å®¶åˆ—è¡¨ã€‚è¿”å›è‰ºæœ¯å®¶æ•°ç»„ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `sort` | string | âœ— | æ’åºæ–¹å¼ï¼š`name`ã€`trackCount`ã€`albumCount` |
| `limit` | number | âœ— | æœ€å¤§è¿”å›æ•°é‡ï¼ˆé»˜è®¤ 1000ï¼‰ |

**è¿”å›å€¼**:
```json
[
    { 
        "name": "The Beatles", 
        "albumCount": 13, 
        "trackCount": 200,
        "totalDuration": 28800.5
    },
    { 
        "name": "Pink Floyd", 
        "albumCount": 15, 
        "trackCount": 180,
        "totalDuration": 32400.0
    }
]
```
</div>
</div>

### library.getGenres

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getGenres</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–åª’ä½“åº“ä¸­çš„æµæ´¾åˆ—è¡¨ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "success": true,
    "genres": [
        { "name": "Rock", "trackCount": 5000 },
        { "name": "Jazz", "trackCount": 2000 }
    ]
}
```

> **æ³¨æ„**: è¿”å›çš„æµæ´¾åŒ…å« `name` å’Œ `trackCount` å­—æ®µã€‚
    </div>
</div>

### library.getRandomTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getRandomTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ä»åª’ä½“åº“éšæœºè·å–æ›²ç›®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `count` | number | âœ— | æ›²ç›®æ•°é‡ï¼ˆé»˜è®¤ 10ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "tracks": [
        { "title": "Random Song 1", ... }
    ]
}
```
</div>
</div>

### library.addToPlaylist

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">library.addToPlaylist</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å°†åª’ä½“åº“æ›²ç›®æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `paths` | string[] | âœ“ | æ›²ç›®è·¯å¾„æ•°ç»„ |
| `playlist` | number | âœ— | ç›®æ ‡æ’­æ”¾åˆ—è¡¨ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "addedCount": 10
}
```
</div>
</div>

### library.rescan

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">library.rescan</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é‡æ–°æ‰«æåª’ä½“åº“ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

</section>

<!-- ==================== LIBRARY SEARCH ==================== -->
<section id="library-search">

## Library API - æœç´¢

### library.search

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.search</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åœ¨åª’ä½“åº“ä¸­æœç´¢æ›²ç›®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `query` | string | âœ“ | æœç´¢å…³é”®è¯æˆ–æŸ¥è¯¢è¡¨è¾¾å¼ |
| `offset` | number | âœ— | èµ·å§‹åç§»ï¼ˆé»˜è®¤ 0ï¼‰ï¼Œå…¼å®¹åˆ«å: `start` |
| `limit` | number | âœ— | æœ€å¤§ç»“æœæ•°é‡ï¼ˆé»˜è®¤ 100ï¼‰ï¼Œå…¼å®¹åˆ«å: `count` |

**è¿”å›å€¼**:
```json
{
    "total": 150,
    "offset": 0,
    "limit": 100,
    "hasMore": true,
    "items": [...],
    "tracks": [
        {
            "index": 0,
            "title": "Let It Be",
            "artist": "The Beatles",
            "album": "Let It Be",
            "path": "file://C:/Music/Beatles/let_it_be.flac",
            "absolutePath": "C:\\Music\\Beatles\\let_it_be.flac",
            "duration": 243.5,
            "bitrate": 1411,
            "sampleRate": 44100
        }
    ]
}
```

> ğŸ’¡ **æç¤º**: `absolutePath` å¯ç›´æ¥ç”¨äº `artwork.getForTrack` è·å–å°é¢ã€‚
```

**æœç´¢è¯­æ³•ç¤ºä¾‹**:
```javascript
// ç®€å•æœç´¢ï¼ˆåœ¨æ ‡é¢˜ã€è‰ºæœ¯å®¶ã€ä¸“è¾‘ä¸­æŸ¥æ‰¾ï¼‰
await fb2k.invoke('library.search', { query: 'love' });

// ç²¾ç¡®å­—æ®µæœç´¢
await fb2k.invoke('library.search', { query: 'artist HAS beatles' });

// ç»„åˆæŸ¥è¯¢
await fb2k.invoke('library.search', { query: 'artist HAS beatles AND year GREATER 1968' });

// æµæ´¾æœç´¢
await fb2k.invoke('library.search', { query: 'genre IS rock' });
```
</div>
</div>

### library.getByPath

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getByPath</span>
        <span class="badge badge-green">v1.1.0 æ–°å¢</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é€šè¿‡æ–‡ä»¶è·¯å¾„åœ¨åª’ä½“åº“ä¸­æœç´¢æ›²ç›®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `path` | string | âœ“ | æ–‡ä»¶è·¯å¾„ï¼ˆå®Œæ•´æˆ–éƒ¨åˆ†ï¼‰ |

**è¿”å›å€¼**ï¼ˆæ‰¾åˆ°æ—¶ï¼‰:
```json
{
    "found": true,
    "path": "D:\\Music\\Album\\song.mp3",
    "track": {
        "index": 0,
        "title": "Song Title",
        "artist": "Artist Name",
        "album": "Album Name",
        "path": "file://D:/Music/Album/song.mp3",
        "absolutePath": "D:\\Music\\Album\\song.mp3",
        "duration": 243.5
    }
}
```

**è¿”å›å€¼**ï¼ˆæœªæ‰¾åˆ°æ—¶ï¼‰:
```json
{
    "found": false,
    "path": "D:\\Music\\notfound.mp3",
    "track": null
}
```

**ç¤ºä¾‹**:
```javascript
// é€šè¿‡å®Œæ•´è·¯å¾„æœç´¢
const result = await fb2k.invoke('library.getByPath', {
    path: 'D:\\Music\\Album\\song.mp3'
});

if (result.found) {
    console.log(`æ‰¾åˆ°æ›²ç›®: ${result.track.title}`);
    // å¯ä»¥ç”¨äºè·å–å°é¢
    const artwork = await fb2k.invoke('artwork.getForTrack', {
        path: result.track.absolutePath
    });
}
```
</div>
</div>

### library.getCount

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getCount</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–åª’ä½“åº“ä¸­çš„æ›²ç›®æ€»æ•°ã€‚</div>

**è¿”å›å€¼**:
```json
{ "count": 15000 }
```
</div>
</div>

### library.getAll

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getAll</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–åª’ä½“åº“ä¸­çš„æ‰€æœ‰æ›²ç›®ï¼ˆæ”¯æŒåˆ†é¡µå’Œç¼“å­˜ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| offset | number | - | èµ·å§‹åç§» |
| limit | number | - | æœ€å¤§è¿”å›æ•°é‡ |
| useCache | boolean | - | ğŸ†• æ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼ˆé»˜è®¤ trueï¼‰ |

**è¿”å›å€¼**:
```json
{
    "items": [...],
    "total": 15000,
    "offset": 0,
    "limit": 100
}
```
</div>
</div>

### library.getStatus

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getStatus</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–åª’ä½“åº“çŠ¶æ€ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "enabled": true,
    "scanning": false,
    "totalTracks": 15000
}
```
</div>
</div>

### library.query

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.query</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ä½¿ç”¨ foobar2000 æŸ¥è¯¢è¯­æ³•æœç´¢åª’ä½“åº“ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| query | string | âœ… | æŸ¥è¯¢è¯­å¥ï¼Œå¦‚ `%artist% HAS rock` |
| offset | number | - | èµ·å§‹åç§» |
| limit | number | - | æœ€å¤§è¿”å›æ•°é‡ |

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('library.query', {
    query: '%artist% HAS Beatles',
    limit: 50
});
```
</div>
</div>

### library.refresh

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">library.refresh</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ·æ–°åª’ä½“åº“ï¼ˆé‡æ–°æ‰«æï¼‰ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### library.browseDirectory

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.browseDirectory</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æµè§ˆåª’ä½“åº“ç›®å½•ç»“æ„ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | - | ç›®å½•è·¯å¾„ï¼Œç©ºåˆ™è¿”å›æ ¹ç›®å½• |

**è¿”å›å€¼**:
```json
{
    "path": "D:\\Music",
    "directories": ["Album1", "Album2"],
    "files": ["song1.mp3", "song2.flac"]
}
```
</div>
</div>

### library.getRecentlyAdded

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getRecentlyAdded</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æœ€è¿‘æ·»åŠ çš„æ›²ç›®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| limit | number | - | è¿”å›æ•°é‡ï¼Œé»˜è®¤ 50 |

**è¿”å›å€¼**:
```json
{
    "items": [...],
    "count": 50
}
```
</div>
</div>

### library.getArtistTracks

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getArtistTracks</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æŒ‡å®šè‰ºæœ¯å®¶çš„æ‰€æœ‰æ›²ç›®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| artist | string | âœ… | è‰ºæœ¯å®¶åç§° |

**è¿”å›å€¼**:
```json
{
    "artist": "The Beatles",
    "items": [...],
    "count": 200
}
```
</div>
</div>

### library.getArtistAlbums

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getArtistAlbums</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æŒ‡å®šè‰ºæœ¯å®¶çš„æ‰€æœ‰ä¸“è¾‘ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| artist | string | âœ… | è‰ºæœ¯å®¶åç§° |

**è¿”å›å€¼**:
```json
{
    "artist": "The Beatles",
    "items": [
        { "name": "Abbey Road", "trackCount": 17, "year": 1969 }
    ],
    "count": 13
}
```
</div>
</div>

</section>

---

<!-- ==================== LIBRARY CACHE ==================== -->
<section id="library-cache">

## Library API - ç¼“å­˜æ§åˆ¶ ğŸ†•

> **è‡ªåŠ¨å¤±æ•ˆ**: å½“åª’ä½“åº“å‘ç”Ÿå˜åŒ–ï¼ˆæ·»åŠ /åˆ é™¤/ä¿®æ”¹æ›²ç›®ï¼‰æ—¶ï¼Œç¼“å­˜ä¼šè‡ªåŠ¨å¤±æ•ˆã€‚
> **å°é¢ç¼“å­˜**: æœ€å¤§ 100MBï¼Œè¶…å‡ºæ—¶è‡ªåŠ¨æ¸…ç†æœ€æ—§æ¡ç›®ã€‚

### library.invalidateCache

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">library.invalidateCache</span>
        <span class="badge badge-green">v1.1.3 æ–°å¢</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ‰‹åŠ¨æ¸…é™¤åª’ä½“åº“ç¼“å­˜ã€‚é€šå¸¸ä¸éœ€è¦è°ƒç”¨ï¼Œå› ä¸ºç¼“å­˜ä¼šåœ¨åª’ä½“åº“å˜åŒ–æ—¶è‡ªåŠ¨å¤±æ•ˆã€‚</div>

**è¿”å›å€¼**:
```json
{
    "success": true,
    "timestamp": 1736064000000
}
```

**ä½¿ç”¨åœºæ™¯**:
```javascript
// å¼ºåˆ¶åˆ·æ–°æ•°æ®ï¼ˆä¾‹å¦‚ç”¨æˆ·æ‰‹åŠ¨è¯·æ±‚åˆ·æ–°ï¼‰
await fb2k.invoke('library.invalidateCache');

// ç„¶åé‡æ–°è·å–æ•°æ®ï¼ˆä¼šé‡æ–°ä»åª’ä½“åº“è¯»å–ï¼‰
const albums = await fb2k.invoke('library.getAlbums', { useCache: true });
```
</div>
</div>

### library.getCacheStats

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">library.getCacheStats</span>
        <span class="badge badge-green">v1.1.3 æ–°å¢</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–ç¼“å­˜ç»Ÿè®¡ä¿¡æ¯ï¼Œç”¨äºè°ƒè¯•å’Œæ€§èƒ½åˆ†æã€‚</div>

**è¿”å›å€¼**:
```json
{
    "albumsCacheValid": true,
    "tracksCacheValid": true,
    "albumsCacheSize": 500,
    "tracksCacheSize": 15000,
    "coverCacheSize": 52428800,
    "coverCacheCount": 250,
    "cacheHits": 42,
    "cacheMisses": 3,
    "lastModified": 1736064000000
}
```

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `albumsCacheValid` | boolean | ä¸“è¾‘ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ |
| `tracksCacheValid` | boolean | æ›²ç›®ç¼“å­˜æ˜¯å¦æœ‰æ•ˆ |
| `albumsCacheSize` | number | ç¼“å­˜çš„ä¸“è¾‘æ•°é‡ |
| `tracksCacheSize` | number | ç¼“å­˜çš„æ›²ç›®æ•°é‡ |
| `coverCacheSize` | number | å°é¢ç¼“å­˜å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| `coverCacheCount` | number | ç¼“å­˜çš„å°é¢æ•°é‡ |
| `cacheHits` | number | ç¼“å­˜å‘½ä¸­æ¬¡æ•° |
| `cacheMisses` | number | ç¼“å­˜æœªå‘½ä¸­æ¬¡æ•° |
| `lastModified` | number | æœ€åä¿®æ”¹æ—¶é—´æˆ³ |
</div>
</div>

</section>

---

<!-- ==================== ARTWORK API ==================== -->
<section id="artwork-api">

## Artwork API - ä¸“è¾‘å°é¢

> **åˆ«åæ”¯æŒ**: ä»¥ä¸‹ API ä¹Ÿå¯ä½¿ç”¨ `albumArt.*` å‘½åç©ºé—´è°ƒç”¨ï¼š
> - `albumArt.getCurrent` â†’ `artwork.getCurrent`
> - `albumArt.getByPath` â†’ `artwork.getByPath`
> - `albumArt.getAvailableTypes` â†’ `artwork.getAvailableTypes`

### artwork.getCurrent

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getCurrent</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ’­æ”¾æ›²ç›®çš„å°é¢å›¾ç‰‡ã€‚ä½¿ç”¨å¤šç§æ–¹æ³•å°è¯•è·å–å°é¢ï¼š<br>
        1. now_playing_album_art_notify_managerï¼ˆæœ€å¿«ï¼Œç¼“å­˜ï¼‰<br>
        2. album_art_manager_v2ï¼ˆæ›´å…¨é¢ï¼‰<br>
        3. album_art_extractorï¼ˆç›´æ¥æå–ï¼‰</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `type` | string | âœ— | å›¾ç‰‡ç±»å‹: `front`, `back`, `disc`, `artist`, `icon`ï¼ˆé»˜è®¤ `front`ï¼‰ |

**è¿”å›å€¼**ï¼ˆæˆåŠŸæ—¶ï¼‰:
```json
{
    "found": true,
    "available": true,
    "type": "front",
    "source": "now_playing_manager",
    "mimeType": "image/jpeg",
    "size": 123456,
    "data": "base64...",
    "dataUrl": "data:image/jpeg;base64,/9j/4AAQ..."
}
```

**è¿”å›å€¼**ï¼ˆå¤±è´¥æ—¶ï¼‰:
```json
{
    "found": false,
    "available": false,
    "type": "front",
    "reason": "no_track"
}
```

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `found` | boolean | æ˜¯å¦æ‰¾åˆ°å°é¢ï¼ˆå…¼å®¹å­—æ®µï¼‰ |
| `available` | boolean | æ˜¯å¦æ‰¾åˆ°å°é¢ï¼ˆæ ‡å‡†åŒ–å­—æ®µï¼Œv1.1.0 æ–°å¢ï¼‰ |
| `type` | string | è¯·æ±‚çš„å°é¢ç±»å‹ |
| `source` | string | å°é¢æ¥æºï¼š`now_playing_manager`, `album_art_manager_v2`, `extractor` |
| `reason` | string | å¤±è´¥åŸå› ï¼š`no_track`ï¼ˆæ²¡æœ‰æ’­æ”¾ï¼‰, `not_found`ï¼ˆæœªæ‰¾åˆ°å°é¢ï¼‰ |
| `mimeType` | string | MIME ç±»å‹ï¼ˆå¦‚ `image/jpeg`, `image/png`ï¼‰ |
| `size` | number | å›¾ç‰‡æ•°æ®å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| `data` | string | Base64 ç¼–ç çš„å›¾ç‰‡æ•°æ® |
| `dataUrl` | string | å¯ç›´æ¥ç”¨äº `<img src>` çš„ Data URL |

**ç¤ºä¾‹**:
```javascript
const artwork = await fb2k.invoke('artwork.getCurrent');
if (artwork.found) {
    document.getElementById('cover').src = artwork.dataUrl;
    console.log('Artwork source:', artwork.source);
} else {
    console.log('No artwork:', artwork.reason);
}

// è·å–èƒŒé¢å°é¢
const backArt = await fb2k.invoke('artwork.getCurrent', { type: 'back' });
```
</div>
</div>

### artwork.getByPath

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getByPath</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é€šè¿‡æ–‡ä»¶è·¯å¾„è·å–å°é¢ã€‚ä½¿ç”¨ <code>album_art_extractor</code> ç›´æ¥æå–ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `path` | string | âœ“ | éŸ³é¢‘æ–‡ä»¶çš„ç»å¯¹è·¯å¾„ |
| `type` | string | âœ— | å›¾ç‰‡ç±»å‹ï¼ˆé»˜è®¤ `front`ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "found": true,
    "type": "front",
    "path": "C:/Music/song.flac",
    "mimeType": "image/jpeg",
    "size": 123456,
    "data": "base64...",
    "dataUrl": "data:image/jpeg;base64,..."
}
```

**ç¤ºä¾‹**:
```javascript
const artwork = await fb2k.invoke('artwork.getByPath', {
    path: 'C:/Music/album/track01.flac',
    type: 'front'
});
```
</div>
</div>

### artwork.getForTrack

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getForTrack</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æŒ‡å®šæ›²ç›®çš„å°é¢ã€‚ä½¿ç”¨ <code>album_art_manager_v2</code> è·å–å°é¢ï¼Œæ”¯æŒåµŒå…¥å¼å°é¢å’Œå¤–éƒ¨å°é¢æ–‡ä»¶ã€‚<br>
        <strong>v1.1.6 æ–°å¢</strong>: æ”¯æŒ <code>maxSize</code> å‚æ•°è¿›è¡ŒæœåŠ¡ç«¯å›¾ç‰‡ç¼©æ”¾ï¼Œå¤§å¹…å‡å°‘æ•°æ®ä¼ è¾“é‡ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `path` | string | âœ“ | æ›²ç›®æ–‡ä»¶è·¯å¾„ï¼ˆè§ä¸‹æ–¹æ”¯æŒçš„æ ¼å¼ï¼‰ |
| `type` | string | âœ— | å›¾ç‰‡ç±»å‹ï¼š`front`ã€`back`ã€`disc`ã€`artist`ã€`icon` |
| `maxSize` | number | âœ— | **v1.1.6 æ–°å¢** è¿”å›å›¾ç‰‡çš„æœ€å¤§è¾¹é•¿ï¼ˆåƒç´ ï¼‰ã€‚è¶…è¿‡æ­¤å°ºå¯¸å°†æŒ‰æ¯”ä¾‹ç¼©æ”¾ä¸º JPEGã€‚0 æˆ–çœç•¥è¡¨ç¤ºä¸ç¼©æ”¾ã€‚ |

**æ”¯æŒçš„è·¯å¾„æ ¼å¼**:
- âœ… ç»å¯¹è·¯å¾„: `C:/Music/song.flac` æˆ– `C:\\Music\\song.flac`
- âœ… file:// URI: `file://C:/Music/song.flac`
- âš ï¸ `file-relative://` è·¯å¾„**ä¸æ”¯æŒ**ï¼Œè¯·ä½¿ç”¨ `artwork.getByPlaylistItem`

**è¿”å›å€¼**ï¼ˆæœªç¼©æ”¾æ—¶ï¼‰:
```json
{
    "available": true,
    "found": true,
    "type": "front",
    "mimeType": "image/jpeg",
    "width": 1500,
    "height": 1500,
    "size": 234567,
    "resized": false,
    "dataUrl": "data:image/jpeg;base64,..."
}
```

**è¿”å›å€¼**ï¼ˆä½¿ç”¨ maxSize ç¼©æ”¾åï¼‰:
```json
{
    "available": true,
    "found": true,
    "type": "front",
    "mimeType": "image/jpeg",
    "width": 200,
    "height": 200,
    "originalWidth": 1500,
    "originalHeight": 1500,
    "size": 15234,
    "resized": true,
    "dataUrl": "data:image/jpeg;base64,..."
}
```

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `available` | boolean | æ˜¯å¦æ‰¾åˆ°å°é¢ï¼ˆæ ‡å‡†åŒ–å­—æ®µï¼‰ |
| `found` | boolean | æ˜¯å¦æ‰¾åˆ°å°é¢ï¼ˆå…¼å®¹å­—æ®µï¼‰ |
| `type` | string | è¯·æ±‚çš„å°é¢ç±»å‹ |
| `mimeType` | string | MIME ç±»å‹ï¼ˆç¼©æ”¾åå§‹ç»ˆä¸º `image/jpeg`ï¼‰ |
| `width` | number | **v1.1.6 æ–°å¢** è¿”å›å›¾ç‰‡çš„å®½åº¦ï¼ˆåƒç´ ï¼‰ |
| `height` | number | **v1.1.6 æ–°å¢** è¿”å›å›¾ç‰‡çš„é«˜åº¦ï¼ˆåƒç´ ï¼‰ |
| `originalWidth` | number | **v1.1.6 æ–°å¢** åŸå§‹å›¾ç‰‡å®½åº¦ï¼ˆä»…åœ¨ç¼©æ”¾åè¿”å›ï¼‰ |
| `originalHeight` | number | **v1.1.6 æ–°å¢** åŸå§‹å›¾ç‰‡é«˜åº¦ï¼ˆä»…åœ¨ç¼©æ”¾åè¿”å›ï¼‰ |
| `size` | number | å›¾ç‰‡æ•°æ®å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| `resized` | boolean | **v1.1.6 æ–°å¢** æ˜¯å¦è¿›è¡Œäº†ç¼©æ”¾ |
| `dataUrl` | string | å¯ç›´æ¥ç”¨äº `<img src>` çš„ Data URL |

**ç¤ºä¾‹**:
```javascript
// åŸå§‹å°ºå¯¸å°é¢
const fullArt = await fb2k.invoke('artwork.getForTrack', {
    path: 'E:/Music/album/song.flac'
});
console.log(`åŸå§‹å°ºå¯¸: ${fullArt.width}x${fullArt.height}, å¤§å°: ${fullArt.size} bytes`);

// è·å– 200x200 ç¼©ç•¥å›¾ï¼ˆæ¨èç”¨äºåˆ—è¡¨/ç½‘æ ¼è§†å›¾ï¼‰
const thumbnail = await fb2k.invoke('artwork.getForTrack', {
    path: 'E:/Music/album/song.flac',
    maxSize: 200
});
console.log(`ç¼©ç•¥å›¾: ${thumbnail.width}x${thumbnail.height}, å¤§å°: ${thumbnail.size} bytes`);
// è¾“å‡ºç¤ºä¾‹: ç¼©ç•¥å›¾: 200x200, å¤§å°: 15234 bytes (ç›¸æ¯”åŸå§‹ 2MB å‡å°‘ 99%)

// ä»æ’­æ”¾åˆ—è¡¨è·å–æ›²ç›®å°é¢
const tracks = await fb2k.invoke('playlist.getTracks', { count: 1 });
const artwork = await fb2k.invoke('artwork.getForTrack', {
    path: tracks.tracks[0].absolutePath,
    maxSize: 100  // å°ç¼©ç•¥å›¾
});
```

> ğŸ’¡ **æ€§èƒ½å»ºè®®**: åœ¨åˆ—è¡¨/ç½‘æ ¼è§†å›¾ä¸­ä½¿ç”¨ `maxSize: 200` å¯å°†æ•°æ®ä¼ è¾“é‡ä» ~2MB å‡å°‘åˆ° ~15KBï¼Œæ˜¾è‘—é™ä½ UI çº¿ç¨‹é˜»å¡æ—¶é—´ã€‚

> âš ï¸ **æ³¨æ„**: å¦‚æœæ›²ç›®è·¯å¾„æ˜¯ `file-relative://` æ ¼å¼ï¼ˆæ¥è‡ªæ’­æ”¾åˆ—è¡¨çš„ç›¸å¯¹è·¯å¾„ï¼‰ï¼Œè¯·ä½¿ç”¨ `artwork.getByPlaylistItem` APIï¼Œå› ä¸ºç›¸å¯¹è·¯å¾„éœ€è¦æ’­æ”¾åˆ—è¡¨ä¸Šä¸‹æ–‡æ‰èƒ½è§£æã€‚
    </div>
</div>

### artwork.getByPlaylistItem

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getByPlaylistItem</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é€šè¿‡æ’­æ”¾åˆ—è¡¨ç´¢å¼•è·å–å°é¢ã€‚æ¨èç”¨äºæ’­æ”¾åˆ—è¡¨ä¸­çš„æ›²ç›®ï¼Œèƒ½æ­£ç¡®å¤„ç†ç›¸å¯¹è·¯å¾„ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `playlist` | number | âœ— | æ’­æ”¾åˆ—è¡¨ç´¢å¼•ï¼ˆé»˜è®¤å½“å‰æ¿€æ´»çš„æ’­æ”¾åˆ—è¡¨ï¼‰ |
| `index` | number | âœ— | æ›²ç›®åœ¨æ’­æ”¾åˆ—è¡¨ä¸­çš„ç´¢å¼•ï¼ˆé»˜è®¤ 0ï¼‰ |
| `type` | string | âœ— | å›¾ç‰‡ç±»å‹ï¼ˆé»˜è®¤ `front`ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "found": true,
    "type": "front",
    "playlist": 0,
    "index": 5,
    "mimeType": "image/jpeg",
    "size": 123456,
    "data": "base64...",
    "dataUrl": "data:image/jpeg;base64,..."
}
```

**ç¤ºä¾‹**:
```javascript
// è·å–å½“å‰æ’­æ”¾åˆ—è¡¨ç¬¬ 6 é¦–æ›²ç›®çš„å°é¢
const artwork = await fb2k.invoke('artwork.getByPlaylistItem', {
    index: 5,
    type: 'front'
});

// è·å–æŒ‡å®šæ’­æ”¾åˆ—è¡¨çš„å°é¢
const artwork2 = await fb2k.invoke('artwork.getByPlaylistItem', {
    playlist: 2,
    index: 0
});
```

> ğŸ’¡ **æ¨è**: ä»æ’­æ”¾åˆ—è¡¨è·å–æ›²ç›®å°é¢æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨æ­¤ API è€Œé `artwork.getForTrack`ï¼Œå¯é¿å…ç›¸å¯¹è·¯å¾„è§£æé—®é¢˜ã€‚
    </div>
</div>

### artwork.getAvailableTypes

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getAvailableTypes</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ›²ç›®å¯ç”¨çš„å°é¢ç±»å‹åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `path` | string | âœ— | æ›²ç›®è·¯å¾„ï¼ˆé»˜è®¤ä½¿ç”¨å½“å‰æ’­æ”¾æ›²ç›®ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "types": ["front", "back", "disc"]
}
```

**ç¤ºä¾‹**:
```javascript
// è·å–å½“å‰æ›²ç›®å¯ç”¨çš„å°é¢ç±»å‹
const result = await fb2k.invoke('artwork.getAvailableTypes');
console.log(result.types); // ["front", "back"]

// æ£€æŸ¥ç‰¹å®šæ›²ç›®
const result2 = await fb2k.invoke('artwork.getAvailableTypes', {
    path: 'C:/Music/song.flac'
});
```
</div>
</div>

### artwork.getBatch

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getBatch</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ‰¹é‡è·å–å¤šä¸ªæ›²ç›®çš„å°é¢ã€‚é€‚åˆåŠ è½½ä¸“è¾‘åˆ—è¡¨ç­‰åœºæ™¯ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `paths` | string[] | âœ“ | æ›²ç›®è·¯å¾„æ•°ç»„ |
| `type` | string | âœ— | å›¾ç‰‡ç±»å‹ï¼ˆé»˜è®¤ `front`ï¼‰ |
| `maxSize` | number | âœ— | æœ€å¤§å°ºå¯¸ï¼ˆåƒç´ ï¼Œé¢„ç•™å‚æ•°ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "artworks": [
        {
            "path": "C:/Music/song1.flac",
            "available": true,
            "mimeType": "image/jpeg",
            "size": 123456,
            "dataUrl": "data:image/jpeg;base64,..."
        },
        {
            "path": "C:/Music/song2.flac",
            "available": false
        }
    ]
}
```

**ç¤ºä¾‹**:
```javascript
// æ‰¹é‡è·å–å°é¢
const tracks = await fb2k.invoke('playlist.getTracks', { count: 10 });
const paths = tracks.tracks.map(t => t.absolutePath);

const result = await fb2k.invoke('artwork.getBatch', { paths });
result.artworks.forEach((art, i) => {
    if (art.available) {
        document.getElementById(`cover-${i}`).src = art.dataUrl;
    }
});
```
</div>
</div>

### artwork.getAvailableArtwork

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getAvailableArtwork</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ›²ç›®æ‰€æœ‰å¯ç”¨çš„å°é¢ç±»å‹åŠæ¥æºï¼ˆåµŒå…¥å¼æˆ–æ–‡ä»¶å¤¹å›¾ç‰‡ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `path` | string | âœ“ | æ›²ç›®è·¯å¾„ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "types": ["front", "back"],
    "sources": ["embedded", "folder:cover.jpg", "folder:folder.png"]
}
```

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `types` | string[] | åµŒå…¥å¼å°é¢ç±»å‹åˆ—è¡¨ |
| `sources` | string[] | å°é¢æ¥æºï¼ˆ`embedded` è¡¨ç¤ºåµŒå…¥å¼ï¼Œ`folder:xxx` è¡¨ç¤ºæ–‡ä»¶å¤¹ä¸­çš„å›¾ç‰‡ï¼‰ |

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('artwork.getAvailableArtwork', {
    path: 'C:/Music/album/track01.flac'
});
// { types: ["front"], sources: ["embedded", "folder:cover.jpg"] }
```
</div>
</div>

### artwork.getFolderImages

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getFolderImages</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰å›¾ç‰‡æ–‡ä»¶çš„åˆ—è¡¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `directory` | string | âœ“ | æ–‡ä»¶å¤¹è·¯å¾„ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "images": [
        {
            "name": "cover.jpg",
            "path": "C:/Music/album/cover.jpg",
            "size": 123456
        },
        {
            "name": "back.png",
            "path": "C:/Music/album/back.png",
            "size": 98765
        }
    ]
}
```

**æ”¯æŒçš„å›¾ç‰‡æ ¼å¼**: `.jpg`, `.jpeg`, `.png`, `.gif`, `.bmp`, `.webp`

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('artwork.getFolderImages', {
    directory: 'C:/Music/album'
});

result.images.forEach(img => {
    console.log(`${img.name}: ${img.size} bytes`);
});
```
</div>
</div>

### artwork.getLyrics

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getLyrics</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ›²ç›®çš„æ­Œè¯ï¼ˆä»å…ƒæ•°æ®æ ‡ç­¾ä¸­è¯»å–ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `path` | string | âœ— | æ›²ç›®è·¯å¾„ï¼ˆé»˜è®¤ä½¿ç”¨å½“å‰æ’­æ”¾æ›²ç›®ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "found": true,
    "tag": "LYRICS",
    "lyrics": "[00:12.34]First line of lyrics\n[00:15.67]Second line...",
    "synced": false
}
```

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `found` | boolean | æ˜¯å¦æ‰¾åˆ°æ­Œè¯ |
| `tag` | string | æ­Œè¯æ¥æºçš„æ ‡ç­¾å |
| `lyrics` | string | æ­Œè¯å†…å®¹ |
| `synced` | boolean | æ˜¯å¦ä¸ºåŒæ­¥æ­Œè¯ï¼ˆLRC æ ¼å¼ï¼‰ |

**æ”¯æŒçš„æ­Œè¯æ ‡ç­¾**: `LYRICS`, `UNSYNCED LYRICS`, `UNSYNCEDLYRICS`, `SYNCEDLYRICS`, `SYNCED LYRICS`

**ç¤ºä¾‹**:
```javascript
const lyrics = await fb2k.invoke('artwork.getLyrics');
if (lyrics.found) {
    if (lyrics.synced) {
        // è§£æ LRC æ ¼å¼æ­Œè¯
        parseLrcLyrics(lyrics.lyrics);
    } else {
        // çº¯æ–‡æœ¬æ­Œè¯
        displayPlainLyrics(lyrics.lyrics);
    }
}
```
</div>
</div>

### artwork.getMetadata

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">artwork.getMetadata</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ›²ç›®çš„åŸºæœ¬å…ƒæ•°æ®ä¿¡æ¯ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `path` | string | âœ— | æ›²ç›®è·¯å¾„ï¼ˆé»˜è®¤ä½¿ç”¨å½“å‰æ’­æ”¾æ›²ç›®ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "title": "Let It Be",
    "artist": "The Beatles",
    "album": "Let It Be",
    "album_artist": "The Beatles",
    "year": "1970",
    "genre": "Rock",
    "track_number": "6",
    "disc_number": "1",
    "has_lyrics": true
}
```

**ç¤ºä¾‹**:
```javascript
// è·å–å½“å‰æ›²ç›®å…ƒæ•°æ®
const meta = await fb2k.invoke('artwork.getMetadata');
console.log(`${meta.artist} - ${meta.title}`);

// è·å–æŒ‡å®šæ›²ç›®å…ƒæ•°æ®
const meta2 = await fb2k.invoke('artwork.getMetadata', {
    path: 'C:/Music/song.flac'
});
```
</div>
</div>

</section>

<!-- ==================== CONFIG API ==================== -->
<section id="config-api">

## Config API - é…ç½®ç®¡ç†

### config.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.get</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–é…ç½®å€¼ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `key` | string | âœ“ | é…ç½®é”®å |
| `default` | any | âœ— | é»˜è®¤å€¼ |

**è¿”å›å€¼**:
```json
{
    "key": "theme",
    "value": "dark",
    "exists": true
}
```

**ç¤ºä¾‹**:
```javascript
const theme = await fb2k.invoke('config.get', { key: 'theme', default: 'light' });
```
</div>
</div>

### config.set

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.set</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®é…ç½®å€¼ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `key` | string | âœ“ | é…ç½®é”®å |
| `value` | any | âœ“ | é…ç½®å€¼ |

**è¿”å›å€¼**:
```json
{ "success": true }
```

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('config.set', { key: 'volume', value: 0.8 });
await fb2k.invoke('config.set', { key: 'lastPlayed', value: Date.now() });
```
</div>
</div>

### config.remove

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">config.remove</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ é™¤é…ç½®é¡¹ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `key` | string | âœ“ | é…ç½®é”®å |

**è¿”å›å€¼**:
```json
{ "success": true, "existed": true }
```
</div>
</div>

### config.getAll

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getAll</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ‰€æœ‰é…ç½®é¡¹ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "config": {
        "theme": "dark",
        "volume": 0.8,
        "lastPlayed": 1704067200000
    }
}
```
</div>
</div>

### config.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">config.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ¸…ç©ºæ‰€æœ‰é…ç½®é¡¹ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

### config.keys

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.keys</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ‰€æœ‰é…ç½®é”®åã€‚</div>

**è¿”å›å€¼**:
```json
{
    "keys": ["theme", "volume", "lastPlayed"]
}
```
</div>
</div>

### config.has

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.has</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ£€æŸ¥é…ç½®é¡¹æ˜¯å¦å­˜åœ¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `key` | string | âœ“ | é…ç½®é”®å |

**è¿”å›å€¼**:
```json
{ "exists": true }
```
</div>
</div>

### config.setMultiple / config.getMultiple

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.setMultiple</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ‰¹é‡è®¾ç½®/è·å–é…ç½®ã€‚</div>

**æ‰¹é‡è®¾ç½®**:
```javascript
await fb2k.invoke('config.setMultiple', {
    values: {
        theme: 'dark',
        volume: 0.8,
        shuffle: true
    }
});
```

**æ‰¹é‡è·å–**:
```javascript
const result = await fb2k.invoke('config.getMultiple', {
    keys: ['theme', 'volume', 'shuffle']
});
// result.values = { theme: 'dark', volume: 0.8, shuffle: true }
```
</div>
</div>

### config.export / config.import

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">config.export</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¯¼å‡º/å¯¼å…¥é…ç½®ã€‚</div>

**å¯¼å‡º**:
```javascript
const exported = await fb2k.invoke('config.export');
// exported.data = "base64_encoded_json..."
localStorage.setItem('fb2k_backup', exported.data);
```

**å¯¼å…¥**:
```javascript
const backup = localStorage.getItem('fb2k_backup');
await fb2k.invoke('config.import', { data: backup });
```
</div>
</div>

### config.getVersionInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getVersionInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å– foobar2000 ç‰ˆæœ¬ä¿¡æ¯ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "version": "2.0",
    "versionFull": "foobar2000 v2.0",
    "architecture": "x64",
    "portable": false
}
```
</div>
</div>

### config.getComponents

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getComponents</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å·²å®‰è£…çš„ç»„ä»¶åˆ—è¡¨ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "items": [
        { "name": "foo_ui_webview2", "version": "1.1.0", "filename": "foo_ui_webview2.dll" }
    ],
    "count": 15
}
```
</div>
</div>

### config.getOutputDevices

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getOutputDevices</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å¯ç”¨çš„éŸ³é¢‘è¾“å‡ºè®¾å¤‡ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "items": [
        { "id": "...", "name": "Speakers (Realtek)", "active": true }
    ],
    "count": 3
}
```
</div>
</div>

### config.setOutputDevice

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.setOutputDevice</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®éŸ³é¢‘è¾“å‡ºè®¾å¤‡ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| id | string | âœ… | è®¾å¤‡ ID |
    </div>
</div>

### config.getOutputConfig

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getOutputConfig</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–éŸ³é¢‘è¾“å‡ºé…ç½®ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "bufferLength": 1000,
    "device": "...",
    "deviceName": "Speakers"
}
```
</div>
</div>

### config.setOutputBuffer

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.setOutputBuffer</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®éŸ³é¢‘è¾“å‡ºç¼“å†²åŒºå¤§å°ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| bufferLength | number | âœ… | ç¼“å†²åŒºå¤§å°(æ¯«ç§’) |
    </div>
</div>

### config.getDspPresets

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getDspPresets</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å– DSP é¢„è®¾åˆ—è¡¨ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "items": [
        { "id": "...", "name": "Default", "active": true }
    ],
    "count": 3
}
```
</div>
</div>

### config.getActiveDspPreset

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getActiveDspPreset</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ¿€æ´»çš„ DSP é¢„è®¾ã€‚</div>
    </div>
</div>

### config.setActiveDspPreset

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.setActiveDspPreset</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®æ¿€æ´»çš„ DSP é¢„è®¾ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| id | string | âœ… | é¢„è®¾ ID |
    </div>
</div>

### config.getAdvancedConfig

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getAdvancedConfig</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–é«˜çº§é…ç½®åˆ—è¡¨ã€‚</div>
    </div>
</div>

### config.getAdvancedConfigValue

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getAdvancedConfigValue</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æŒ‡å®šé«˜çº§é…ç½®é¡¹çš„å€¼ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| key | string | âœ… | é…ç½®é”®å |
    </div>
</div>

### config.setAdvancedConfigValue

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">config.setAdvancedConfigValue</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®é«˜çº§é…ç½®é¡¹çš„å€¼ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| key | string | âœ… | é…ç½®é”®å |
| value | any | âœ… | é…ç½®å€¼ |
    </div>
</div>

### config.resetAdvancedConfig

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">config.resetAdvancedConfig</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é‡ç½®é«˜çº§é…ç½®åˆ°é»˜è®¤å€¼ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| key | string | âœ… | é…ç½®é”®å |
    </div>
</div>

### config.getLibraryStatus

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getLibraryStatus</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–åª’ä½“åº“çŠ¶æ€ä¿¡æ¯ã€‚</div>
    </div>
</div>

### config.getLibraryFilePatterns

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getLibraryFilePatterns</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–åª’ä½“åº“æ–‡ä»¶åŒ¹é…æ¨¡å¼ã€‚</div>
    </div>
</div>

### config.showLibraryPreferences

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">config.showLibraryPreferences</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ‰“å¼€åª’ä½“åº“åå¥½è®¾ç½®é¡µé¢ã€‚</div>
    </div>
</div>

### config.getPreferencesPages

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getPreferencesPages</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–åå¥½è®¾ç½®é¡µé¢åˆ—è¡¨ã€‚</div>
    </div>
</div>

### config.getPreferencesStandardGuids

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">config.getPreferencesStandardGuids</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ ‡å‡†åå¥½è®¾ç½®é¡µé¢ GUID åˆ—è¡¨ã€‚</div>
    </div>
</div>

</section>

<!-- ==================== WINDOW API ==================== -->
<section id="window-api">

## Window API - çª—å£æ§åˆ¶

### çª—å£åŸºæœ¬æ“ä½œ

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.minimize / window.maximize / window.restore / window.close</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åŸºæœ¬çª—å£æ“ä½œã€‚</div>

```javascript
await fb2k.invoke('window.minimize');  // æœ€å°åŒ–
await fb2k.invoke('window.maximize');  // æœ€å¤§åŒ–
await fb2k.invoke('window.restore');   // è¿˜åŸ
await fb2k.invoke('window.close');     // å…³é—­
```
</div>
</div>

### window.getState

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getState</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–çª—å£çŠ¶æ€ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "isMaximized": false,
    "isMinimized": false,
    "isFullscreen": false,
    "isFocused": true,
    "width": 1280,
    "height": 720,
    "x": 100,
    "y": 100
}
```
</div>
</div>

### window.isMaximized / window.isMinimized / window.isFullscreen

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.isMaximized / window.isMinimized / window.isFullscreen</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ†åˆ«è·å–çª—å£æœ€å¤§åŒ–/æœ€å°åŒ–/å…¨å±çŠ¶æ€ã€‚</div>

```javascript
const { maximized } = await fb2k.invoke('window.isMaximized');
const { minimized } = await fb2k.invoke('window.isMinimized');
const { fullscreen } = await fb2k.invoke('window.isFullscreen');
```
</div>
</div>

### window.startResize

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.startResize</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¼€å§‹è°ƒæ•´çª—å£å¤§å°ã€‚ç”¨äºè‡ªå®šä¹‰çª—å£è¾¹æ¡†ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `edge` | string | âœ— | è¾¹ç¼˜æ–¹å‘ï¼šleft, right, top, bottom, topleft, topright, bottomleft, bottomright |

**ç¤ºä¾‹**:
```javascript
// åœ¨è¾¹æ¡†åŒºåŸŸçš„ mousedown äº‹ä»¶ä¸­è°ƒç”¨
borderElement.onmousedown = (e) => {
    fb2k.invoke('window.startResize', { edge: 'bottomright' });
};
```
</div>
</div>

### window.setSize

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setSize</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®çª—å£å¤§å°ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `width` | number | âœ“ | å®½åº¦ |
| `height` | number | âœ“ | é«˜åº¦ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setSize', { width: 1920, height: 1080 });
```
</div>
</div>

### window.setPosition

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setPosition</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®çª—å£ä½ç½®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `x` | number | âœ“ | X åæ ‡ |
| `y` | number | âœ“ | Y åæ ‡ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setPosition', { x: 0, y: 0 });
```
</div>
</div>

### window.center

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.center</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å°†çª—å£å±…ä¸­æ˜¾ç¤ºã€‚</div>

```javascript
await fb2k.invoke('window.center');
```
</div>
</div>

### window.setAlwaysOnTop

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setAlwaysOnTop</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®çª—å£ç½®é¡¶ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `enabled` | boolean | âœ— | æ˜¯å¦ç½®é¡¶ï¼ˆé»˜è®¤ trueï¼‰ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setAlwaysOnTop', { enabled: true });
```

**å…¶ä»–ç›¸å…³ API**:
- `window.isAlwaysOnTop` - è·å–ç½®é¡¶çŠ¶æ€
- `window.toggleAlwaysOnTop` - åˆ‡æ¢ç½®é¡¶çŠ¶æ€
    </div>
</div>

### window.setFullscreen

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setFullscreen</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®å…¨å±æ¨¡å¼ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `enabled` | boolean | âœ— | æ˜¯å¦å…¨å±ï¼ˆé»˜è®¤ trueï¼‰ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setFullscreen', { fullscreen: true });
```
</div>
</div>

### window.setMinSize / window.getMinSize ğŸ†•

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setMinSize</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®çª—å£æœ€å°å°ºå¯¸é™åˆ¶ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `width` | number | âœ“ | æœ€å°å®½åº¦ |
| `height` | number | âœ“ | æœ€å°é«˜åº¦ |

**ç¤ºä¾‹**:
```javascript
// è®¾ç½®æœ€å°å°ºå¯¸
await fb2k.invoke('window.setMinSize', { width: 800, height: 600 });

// è·å–æœ€å°å°ºå¯¸
const minSize = await fb2k.invoke('window.getMinSize');
console.log(minSize); // { width: 800, height: 600 }
```
</div>
</div>

### window.setMaxSize / window.getMaxSize ğŸ†•

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setMaxSize</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®çª—å£æœ€å¤§å°ºå¯¸é™åˆ¶ã€‚è®¾ç½®ä¸º 0 è¡¨ç¤ºæ— é™åˆ¶ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `width` | number | âœ“ | æœ€å¤§å®½åº¦ (0=æ— é™åˆ¶) |
| `height` | number | âœ“ | æœ€å¤§é«˜åº¦ (0=æ— é™åˆ¶) |

**ç¤ºä¾‹**:
```javascript
// è®¾ç½®æœ€å¤§å°ºå¯¸
await fb2k.invoke('window.setMaxSize', { width: 1920, height: 1080 });

// ç§»é™¤æœ€å¤§å°ºå¯¸é™åˆ¶
await fb2k.invoke('window.setMaxSize', { width: 0, height: 0 });

// è·å–æœ€å¤§å°ºå¯¸
const maxSize = await fb2k.invoke('window.getMaxSize');
console.log(maxSize); // { width: 1920, height: 1080 }
```
</div>
</div>

### window.setResizable / window.isResizable ğŸ†•

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setResizable</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¯ç”¨æˆ–ç¦ç”¨çª—å£å¤§å°è°ƒæ•´ã€‚ç¦ç”¨åçª—å£è¾¹æ¡†å°†æ— æ³•æ‹–åŠ¨è°ƒæ•´å¤§å°ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `resizable` | boolean | âœ“ | æ˜¯å¦å…è®¸è°ƒæ•´å¤§å° |

**ç¤ºä¾‹**:
```javascript
// ç¦ç”¨çª—å£å¤§å°è°ƒæ•´
await fb2k.invoke('window.setResizable', { resizable: false });

// å¯ç”¨çª—å£å¤§å°è°ƒæ•´
await fb2k.invoke('window.setResizable', { resizable: true });

// æŸ¥è¯¢å½“å‰çŠ¶æ€
const state = await fb2k.invoke('window.isResizable');
console.log(state.resizable); // true æˆ– false
```
</div>
</div>

### window.setCornerPreference / window.getCornerPreference ğŸ†•

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setCornerPreference</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®çª—å£åœ†è§’æ¨¡å¼ï¼ˆä»… Windows 11 æœ‰æ•ˆï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `mode` | string | âœ“ | åœ†è§’æ¨¡å¼ï¼š`"default"` / `"none"` / `"round"` / `"small"` |

**åœ†è§’æ¨¡å¼è¯´æ˜**:
| å€¼ | æè¿° |
|------|------|
| `"default"` | ç³»ç»Ÿé»˜è®¤ï¼ˆæ ¹æ®çª—å£æ ·å¼è‡ªåŠ¨é€‰æ‹©ï¼‰ |
| `"none"` | æ— åœ†è§’ï¼ˆç›´è§’çª—å£ï¼‰ |
| `"round"` | å¤§åœ†è§’ï¼ˆçº¦ 8pxï¼‰ |
| `"small"` | å°åœ†è§’ï¼ˆçº¦ 4pxï¼‰ |

**ç¤ºä¾‹**:
```javascript
// è®¾ç½®å¤§åœ†è§’
await fb2k.invoke('window.setCornerPreference', { mode: 'round' });

// è®¾ç½®ç›´è§’çª—å£
await fb2k.invoke('window.setCornerPreference', { mode: 'none' });

// æŸ¥è¯¢å½“å‰æ¨¡å¼
const result = await fb2k.invoke('window.getCornerPreference');
console.log(result.mode); // "default" / "none" / "round" / "small"
```
</div>
</div>

### window.getBounds

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getBounds</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–çª—å£è¾¹ç•Œä¿¡æ¯ã€‚</div>

**è¿”å›å€¼**:
```json
{ "x": 100, "y": 100, "width": 1280, "height": 720 }
```
</div>
</div>

### window.setBounds

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setBounds</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®çª—å£è¾¹ç•Œã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `x` | number | âœ— | X åæ ‡ |
| `y` | number | âœ— | Y åæ ‡ |
| `width` | number | âœ— | å®½åº¦ |
| `height` | number | âœ— | é«˜åº¦ |
    </div>
</div>

### window.getDpiScale

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getDpiScale</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å– DPI ç¼©æ”¾ä¿¡æ¯ã€‚</div>

**è¿”å›å€¼**:
```json
{ "dpi": 144, "scale": 1.5 }
```
</div>
</div>

### window.getTitle

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getTitle</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–çª—å£æ ‡é¢˜ã€‚</div>

**è¿”å›å€¼**:
```json
{ "title": "foobar2000" }
```
</div>
</div>

### window.focus

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.focus</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å°†çª—å£ç½®äºå‰å°å¹¶è·å–ç„¦ç‚¹ã€‚</div>
    </div>
</div>

### window.blur

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.blur</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ç§»é™¤çª—å£ç„¦ç‚¹ã€‚</div>
    </div>
</div>

### window.flash

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.flash</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é—ªçƒçª—å£å’Œä»»åŠ¡æ æŒ‰é’®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `enabled` | boolean | âœ— | æ˜¯å¦å¯ç”¨ï¼ˆé»˜è®¤ trueï¼‰ |
| `count` | number | âœ— | é—ªçƒæ¬¡æ•°ï¼ˆé»˜è®¤ 3ï¼‰ |
    </div>
</div>

### window.flashTaskbar

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.flashTaskbar</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é—ªçƒä»»åŠ¡æ æŒ‰é’®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `count` | number | âœ— | é—ªçƒæ¬¡æ•°ï¼ˆé»˜è®¤ 3ï¼‰ |
    </div>
</div>

### window.enterFullscreen / window.exitFullscreen

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.enterFullscreen / window.exitFullscreen</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è¿›å…¥/é€€å‡ºå…¨å±æ¨¡å¼ã€‚</div>

```javascript
await fb2k.invoke('window.enterFullscreen');
await fb2k.invoke('window.exitFullscreen');
```
</div>
</div>

### window.toggleFullscreen

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.toggleFullscreen</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ‡æ¢å…¨å±çŠ¶æ€ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true, "fullscreen": true }
```
</div>
</div>

### window.setBlur

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setBlur</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¯ç”¨/ç¦ç”¨çª—å£æ¨¡ç³Šæ•ˆæœã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `enabled` | boolean | âœ— | æ˜¯å¦å¯ç”¨ï¼ˆé»˜è®¤ trueï¼‰ |
    </div>
</div>

</section>

<!-- ==================== WINDOW TITLEBAR ==================== -->
<section id="window-titlebar">

## Window API - æ ‡é¢˜æ 

### window.setTitle

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setTitle</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®çª—å£æ ‡é¢˜ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `title` | string | âœ“ | çª—å£æ ‡é¢˜ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setTitle', { title: 'Now Playing: Let It Be' });
```
</div>
</div>

### window.getTitlebarHeight

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getTitlebarHeight</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ ‡é¢˜æ é«˜åº¦ã€‚</div>

**è¿”å›å€¼**:
```json
{ "height": 32 }
```
</div>
</div>

### window.setTitlebarHeight

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setTitlebarHeight</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®æ ‡é¢˜æ é«˜åº¦ï¼ˆè‡ªå®šä¹‰æ ‡é¢˜æ ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `height` | number | âœ“ | é«˜åº¦ï¼ˆåƒç´ ï¼‰ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setTitlebarHeight', { height: 48 });
```
</div>
</div>

### window.setDragRegion

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setDragRegion</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®å¯æ‹–æ‹½åŒºåŸŸã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `x` | number | âœ“ | X åæ ‡ |
| `y` | number | âœ“ | Y åæ ‡ |
| `width` | number | âœ“ | å®½åº¦ |
| `height` | number | âœ“ | é«˜åº¦ |

**ç¤ºä¾‹**:
```javascript
// è®¾ç½®é¡¶éƒ¨ 48px ä¸ºæ‹–æ‹½åŒºåŸŸ
await fb2k.invoke('window.setDragRegion', {
    x: 0, y: 0, width: window.innerWidth, height: 48
});
```
</div>
</div>

### window.setDragRegions

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setDragRegions</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®å¤šä¸ªå¯æ‹–æ‹½åŒºåŸŸã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `regions` | array | âœ“ | åŒºåŸŸæ•°ç»„ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setDragRegions', {
    regions: [
        { x: 0, y: 0, width: 200, height: 48 },
        { x: 400, y: 0, width: 200, height: 48 }
    ]
});
```
</div>
</div>

### window.clearDragRegions

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.clearDragRegions</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ¸…é™¤æ‰€æœ‰æ‹–æ‹½åŒºåŸŸã€‚</div>
    </div>
</div>

### window.setNoDragRegions

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setNoDragRegions</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®ä¸å¯æ‹–æ‹½åŒºåŸŸï¼ˆåœ¨æ‹–æ‹½åŒºåŸŸå†…æ’é™¤ç‰¹å®šåŒºåŸŸï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `regions` | array | âœ“ | åŒºåŸŸæ•°ç»„ |
    </div>
</div>

### window.getCaptionButtonsWidth

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getCaptionButtonsWidth</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–ç³»ç»Ÿæ ‡é¢˜æ æŒ‰é’®å®½åº¦ã€‚</div>

**è¿”å›å€¼**:
```json
{ "width": 138, "buttonWidth": 46 }
```
</div>
</div>

### window.getTitlebarInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getTitlebarInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ ‡é¢˜æ å®Œæ•´ä¿¡æ¯ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "height": 32,
    "captionButtonsWidth": 138,
    "captionButtonWidth": 46,
    "isMaximized": false
}
```
</div>
</div>

### ğŸ¨ è‡ªå®šä¹‰æ ‡é¢˜æ å®Œæ•´æŒ‡å—

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method guide">GUIDE</span>
        <span class="api-card-name">è‡ªå®šä¹‰æ ‡é¢˜æ å®ç°</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å®ç°å®Œæ•´çš„è‡ªå®šä¹‰æ ‡é¢˜æ ï¼ŒåŒ…æ‹¬æ‹–æ‹½ã€çª—å£æ§åˆ¶æŒ‰é’®å’Œè¾¹æ¡†è°ƒæ•´ã€‚</div>

**HTML ç»“æ„**:
```html
<div class="titlebar" data-webview-drag="true">
    <!-- å·¦ä¾§ï¼šåº”ç”¨å›¾æ ‡å’Œæ ‡é¢˜ -->
    <div class="titlebar-left">
        <img src="icon.png" class="app-icon" data-webview-drag="false">
        <span class="app-title">My foobar2000</span>
    </div>
    
    <!-- ä¸­é—´ï¼šå¯ä»¥æ”¾æœç´¢æ¡†ç­‰ -->
    <div class="titlebar-center" data-webview-drag="false">
        <input type="text" placeholder="æœç´¢..." class="search-box">
    </div>
    
    <!-- å³ä¾§ï¼šçª—å£æ§åˆ¶æŒ‰é’® -->
    <div class="titlebar-buttons" data-webview-drag="false">
        <button id="btn-minimize" class="titlebar-btn">â”€</button>
        <button id="btn-maximize" class="titlebar-btn">â–¡</button>
        <button id="btn-close" class="titlebar-btn close">âœ•</button>
    </div>
</div>
```

**CSS æ ·å¼**:
```css
.titlebar {
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: transparent;
    -webkit-app-region: drag; /* å…è®¸æ‹–æ‹½ */
    user-select: none;
}

.titlebar-left, .titlebar-center, .titlebar-buttons {
    display: flex;
    align-items: center;
    -webkit-app-region: no-drag; /* è¿™äº›åŒºåŸŸä¸å¯æ‹–æ‹½ */
}

.titlebar-btn {
    width: 46px;
    height: 32px;
    border: none;
    background: transparent;
    color: white;
    font-size: 12px;
    cursor: pointer;
    transition: background 0.15s;
}

.titlebar-btn:hover {
    background: rgba(255, 255, 255, 0.1);
}

.titlebar-btn.close:hover {
    background: #e81123;
}

/* çª—å£æœªæ¿€æ´»æ—¶çš„æ ·å¼ */
.window-inactive .titlebar {
    opacity: 0.7;
}
```

**JavaScript é€»è¾‘**:
```javascript
// ========== çª—å£æ§åˆ¶ ==========
document.getElementById('btn-minimize').onclick = () => 
    fb2k.invoke('window.minimize');

document.getElementById('btn-maximize').onclick = () => 
    fb2k.invoke('window.maximize');

document.getElementById('btn-close').onclick = () => 
    fb2k.invoke('window.close');

// ========== åŒæ­¥æœ€å¤§åŒ–æŒ‰é’®çŠ¶æ€ ==========
fb2k.on('window:stateChanged', (data) => {
    const btn = document.getElementById('btn-maximize');
    if (data.isMaximized) {
        btn.textContent = 'â';  // è¿˜åŸå›¾æ ‡
        btn.title = 'è¿˜åŸ';
    } else {
        btn.textContent = 'â–¡';  // æœ€å¤§åŒ–å›¾æ ‡
        btn.title = 'æœ€å¤§åŒ–';
    }
});

// ========== çª—å£èšç„¦çŠ¶æ€ ==========
fb2k.on('window:focusChanged', (data) => {
    document.body.classList.toggle('window-inactive', !data.focused);
});

// ========== è®¾ç½®æ ‡é¢˜æ é«˜åº¦ ==========
fb2k.invoke('window.setTitlebarHeight', { height: 32 });
```

**é‡è¦æç¤º**:
- ä½¿ç”¨ `data-webview-drag="true"` æ ‡è®°å¯æ‹–æ‹½åŒºåŸŸ
- ä½¿ç”¨ `data-webview-drag="false"` æ’é™¤æŒ‰é’®ç­‰äº¤äº’å…ƒç´ 
- çª—å£è°ƒæ•´è¾¹æ¡†ç”±æ’ä»¶è‡ªåŠ¨å¤„ç†ï¼ˆ5px è§¦å‘åŒºåŸŸï¼Œ1px è§†è§‰è¾¹æ¡†ï¼‰
- è°ƒç”¨ `window.setTitlebarHeight` è®©ç³»ç»ŸçŸ¥é“æ ‡é¢˜æ åŒºåŸŸ
    </div>
</div>

</section>

<!-- ==================== WINDOW DWM ==================== -->
<section id="window-dwm">

## Window API - DWM æ•ˆæœ

> DWM (Desktop Window Manager) æ•ˆæœå…è®¸åº”ç”¨ç°ä»£ Windows è§†è§‰æ•ˆæœã€‚

### ğŸ¨ DWM æ•ˆæœå®Œæ•´æŒ‡å—

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method guide">GUIDE</span>
        <span class="api-card-name">Windows è§†è§‰æ•ˆæœ</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é…ç½®ç°ä»£ Windows è§†è§‰æ•ˆæœçš„æœ€ä½³å®è·µã€‚</div>

**æ•ˆæœå¯¹æ¯”**:

| æ•ˆæœ | Windows ç‰ˆæœ¬ | ç‰¹ç‚¹ |
|------|-------------|------|
| **Mica** | Windows 11+ | åŸºäºæ¡Œé¢å£çº¸çš„åŠ¨æ€æ¨¡ç³Šï¼Œæ€§èƒ½æœ€ä½³ |
| **Mica Alt** | Windows 11+ | Mica çš„æ·±è‰²å˜ä½“ï¼Œå¯¹æ¯”åº¦æ›´é«˜ |
| **Acrylic** | Windows 10/11 | çª—å£åæ–¹å†…å®¹æ¨¡ç³Šï¼Œæ›´é€æ˜ |

**æ¨èé…ç½®**:

```javascript
// ========== åˆå§‹åŒ–è§†è§‰æ•ˆæœ ==========
async function initVisualEffects() {
    // æ£€æµ‹ Windows ç‰ˆæœ¬
    const sysInfo = await fb2k.invoke('system.getInfo');
    
    // è®¾ç½®æš—è‰²æ¨¡å¼ï¼ˆå½±å“ç³»ç»Ÿæ§ä»¶ï¼‰
    await fb2k.invoke('window.setDarkMode', { enabled: true });
    
    // Windows 11: ä½¿ç”¨ Mica
    if (sysInfo.windowsBuild >= 22000) {
        await fb2k.invoke('window.setMica', { 
            enabled: true, 
            variant: 'mica-alt'  // æˆ– 'standard'
        });
        
        // è®¾ç½®åœ†è§’
        await fb2k.invoke('window.setCornerPreference', { 
            mode: 'round'  // 'none', 'round', 'small'
        });
    } 
    // Windows 10: ä½¿ç”¨ Acrylic
    else {
        await fb2k.invoke('window.setAcrylic', { 
            enabled: true,
            tintColor: '#1a1a1aCC'  // å¸¦é€æ˜åº¦çš„ç€è‰²
        });
    }
    
    // å¯é€‰ï¼šè‡ªå®šä¹‰è¾¹æ¡†é¢œè‰²
    await fb2k.invoke('window.setBorderColor', { 
        color: '#0078D4'  // å¼ºè°ƒè‰²
    });
}

// ========== ä¸»é¢˜åˆ‡æ¢ ==========
async function setTheme(isDark) {
    await fb2k.invoke('window.setDarkMode', { enabled: isDark });
    
    // æ›´æ–°è¾¹æ¡†é¢œè‰²
    await fb2k.invoke('window.setBorderColor', { 
        color: isDark ? '#3a3a3a' : '#cccccc' 
    });
    
    // æ›´æ–°æ ‡é¢˜æ é¢œè‰²
    await fb2k.invoke('window.setCaptionColor', { 
        color: isDark ? '#1a1a1a' : '#f0f0f0' 
    });
}
```

**CSS é…åˆ**ï¼ˆè®©ç½‘é¡µèƒŒæ™¯é€æ˜ä»¥æ˜¾ç¤ºæ•ˆæœï¼‰:
```css
html, body {
    background: transparent !important;
}

/* æˆ–ä½¿ç”¨åŠé€æ˜èƒŒæ™¯ */
body {
    background: rgba(0, 0, 0, 0.3);
}

/* å¯ä»¥æ·»åŠ è‡ªå·±çš„æ¨¡ç³Šå±‚æ¥å¢å¼ºæ•ˆæœ */
.content-area {
    background: rgba(30, 30, 30, 0.7);
    backdrop-filter: blur(10px);
}
```

> âš ï¸ **æ³¨æ„**: Mica/Acrylic æ•ˆæœéœ€è¦ç½‘é¡µèƒŒæ™¯é€æ˜æ‰èƒ½æ˜¾ç¤ºã€‚ç¡®ä¿ CSS ä¸­ `body` èƒŒæ™¯è®¾ç½®ä¸º `transparent` æˆ–åŠé€æ˜è‰²ã€‚
    </div>
</div>

### window.setMica

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setMica</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åº”ç”¨ Windows 11 Mica æ•ˆæœã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `enabled` | boolean | âœ“ | æ˜¯å¦å¯ç”¨ |
| `variant` | string | âœ— | "mica" æˆ– "mica-alt" |
| `darkMode` | boolean | âœ— | æ·±è‰²æ¨¡å¼ (true) æˆ–æµ…è‰²æ¨¡å¼ (false) |

**ç¤ºä¾‹**:
```javascript
// å¯ç”¨æ ‡å‡† Micaï¼ˆæ·±è‰²æ¨¡å¼ï¼‰
await fb2k.invoke('window.setMica', { enabled: true, darkMode: true });

// ä½¿ç”¨ Mica Altï¼ˆæµ…è‰²æ¨¡å¼ï¼‰
await fb2k.invoke('window.setMica', { enabled: true, variant: 'mica-alt', darkMode: false });
```
</div>
</div>

### window.setAcrylic

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setAcrylic</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åº”ç”¨äºšå…‹åŠ›æ¨¡ç³Šæ•ˆæœã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `enabled` | boolean | âœ“ | æ˜¯å¦å¯ç”¨ |
| `darkMode` | boolean | âœ— | æ·±è‰²æ¨¡å¼ (true) æˆ–æµ…è‰²æ¨¡å¼ (false) |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setAcrylic', {
    enabled: true,
    tintColor: '#000000AA'
});
```
</div>
</div>

### window.setBackgroundTransparency

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setBackgroundTransparency</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ§åˆ¶ WebView èƒŒæ™¯é€æ˜åº¦ã€‚è¿™æ˜¯è®© DWM æ•ˆæœï¼ˆMica/Acrylicï¼‰ç©¿é€ WebView æ˜¾ç¤ºçš„å…³é”® APIã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `transparent` | boolean | âœ— | æ˜¯å¦é€æ˜ï¼ˆé»˜è®¤ trueï¼‰|

**è¿”å›**:
```json
{
    "success": true,
    "transparent": true,
    "description": "WebView background is now transparent - DWM effects will show through"
}
```

**ç¤ºä¾‹**:
```javascript
// å¯ç”¨é€æ˜èƒŒæ™¯ï¼ˆè®© DWM æ•ˆæœç©¿é€ï¼‰
await fb2k.invoke('window.setBackgroundTransparency', { transparent: true });

// æ¢å¤ä¸é€æ˜èƒŒæ™¯
await fb2k.invoke('window.setBackgroundTransparency', { transparent: false });
```

> ğŸ’¡ **æç¤º**: è°ƒç”¨ `window.setMica`ã€`window.setAcrylic`ã€`window.setBlur` æ—¶ä¼šè‡ªåŠ¨å¯ç”¨é€æ˜èƒŒæ™¯ã€‚
    </div>
</div>

### window.refreshWebView

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.refreshWebView</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ·æ–° WebView æ¸²æŸ“ã€‚åœ¨ DWM æ•ˆæœå˜æ›´åè°ƒç”¨ä»¥ç¡®ä¿æ•ˆæœæ­£ç¡®æ˜¾ç¤ºã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›**:
```json
{ "success": true }
```

**ç¤ºä¾‹**:
```javascript
// DWM æ•ˆæœæœªæ˜¾ç¤ºæ—¶æ‰‹åŠ¨åˆ·æ–°
await fb2k.invoke('window.refreshWebView');
```
</div>
</div>

### window.setBorderColor

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setBorderColor</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®çª—å£è¾¹æ¡†é¢œè‰²ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `color` | string | âœ“ | é¢œè‰²å€¼ (å¦‚ "#0078D4") |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setBorderColor', { color: '#0078D4' });
```
</div>
</div>

### window.setCaptionColor

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setCaptionColor</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®æ ‡é¢˜æ é¢œè‰²ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `color` | string | âœ“ | é¢œè‰²å€¼ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setCaptionColor', { color: '#1a1a1a' });
```
</div>
</div>

### window.setDarkMode

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setDarkMode</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®çª—å£æš—è‰²æ¨¡å¼ï¼ˆå½±å“æ ‡é¢˜æ æŒ‰é’®é¢œè‰²ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `enabled` | boolean | âœ“ | æ˜¯å¦å¯ç”¨æš—è‰²æ¨¡å¼ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setDarkMode', { enabled: true });
```
</div>
</div>

### window.setCornerPreference

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setCornerPreference</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®çª—å£åœ†è§’æ ·å¼ (Windows 11)ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `corner` | string | âœ“ | "default", "doNotRound", "round", "roundSmall" |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.setCornerPreference', { corner: 'round' });
```
</div>
</div>

</section>

<!-- ==================== WINDOW ZOOM CONTROL ==================== -->
<section id="window-zoom">

## Window API - ç¼©æ”¾æ§åˆ¶ ğŸ†• v1.1.5

> è¿™äº› API ç”¨äºæ§åˆ¶ WebView çš„ç¼©æ”¾çº§åˆ«å’Œ DPI é€‚é…ã€‚å½“çª—å£åœ¨ä¸åŒ DPI çš„æ˜¾ç¤ºå™¨ä¹‹é—´ç§»åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å‘é€ `window:dpiChanged` äº‹ä»¶ã€‚

### window.setZoom

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setZoom</span>
        <span class="badge badge-green">v1.1.5 æ–°å¢</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½® WebView ç¼©æ”¾æ¯”ä¾‹ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `zoom` | number | âœ“ | ç¼©æ”¾æ¯”ä¾‹ (0.25 - 4.0)ï¼Œ1.0 = 100% |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "zoom": 1.5
}
```

**ç¤ºä¾‹**:
```javascript
// æ”¾å¤§åˆ° 150%
await fb2k.invoke('window.setZoom', { zoom: 1.5 });

// ç¼©å°åˆ° 80%
await fb2k.invoke('window.setZoom', { zoom: 0.8 });
```
    </div>
</div>

### window.getZoom

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">window.getZoom</span>
        <span class="badge badge-green">v1.1.5 æ–°å¢</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰ç¼©æ”¾æ¯”ä¾‹å’Œ DPI ä¿¡æ¯ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{
    "zoom": 1.0,
    "dpi": 144,
    "dpiScale": 1.5
}
```

| å­—æ®µ | ç±»å‹ | æè¿° |
|------|------|------|
| `zoom` | number | å½“å‰ç¼©æ”¾æ¯”ä¾‹ |
| `dpi` | number | å½“å‰ DPI å€¼ (96 = 100%) |
| `dpiScale` | number | DPI ç¼©æ”¾æ¯”ä¾‹ (1.0, 1.25, 1.5, 2.0 ç­‰) |

**ç¤ºä¾‹**:
```javascript
const info = await fb2k.invoke('window.getZoom');
console.log(`Zoom: ${info.zoom * 100}%, DPI: ${info.dpi}`);
```
    </div>
</div>

### window.resetZoom

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.resetZoom</span>
        <span class="badge badge-green">v1.1.5 æ–°å¢</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é‡ç½®ç¼©æ”¾æ¯”ä¾‹ä¸ºé»˜è®¤å€¼ (1.0 = 100%)ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{
    "success": true,
    "zoom": 1.0
}
```

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('window.resetZoom');
```
    </div>
</div>

### window.setZoomForDpi

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method set">SET</span>
        <span class="api-card-name">window.setZoomForDpi</span>
        <span class="badge badge-green">v1.1.5 æ–°å¢</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ ¹æ® DPI è‡ªåŠ¨è®¾ç½®ç¼©æ”¾æ¯”ä¾‹ã€‚å¦‚æœæœªæŒ‡å®š DPIï¼Œå°†ä½¿ç”¨å½“å‰çª—å£çš„ DPIã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `dpi` | number | âœ— | DPI å€¼ï¼Œä¸å¡«åˆ™ä½¿ç”¨å½“å‰çª—å£ DPI |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "dpi": 144,
    "zoom": 1.5
}
```

**ç¤ºä¾‹**:
```javascript
// ä½¿ç”¨å½“å‰çª—å£ DPI è‡ªåŠ¨è®¾ç½®ç¼©æ”¾
await fb2k.invoke('window.setZoomForDpi');

// æŒ‡å®š DPI è®¾ç½®ç¼©æ”¾
await fb2k.invoke('window.setZoomForDpi', { dpi: 192 }); // 200%
```
    </div>
</div>

### window:dpiChanged äº‹ä»¶

DPI å˜åŒ–æ—¶è‡ªåŠ¨è§¦å‘ï¼ˆä¾‹å¦‚æ‹–åŠ¨çª—å£åˆ°ä¸åŒ DPI çš„æ˜¾ç¤ºå™¨ï¼‰ï¼š

```javascript
fb2k.on('window:dpiChanged', (data) => {
    console.log('DPI å˜åŒ–:', data.dpi, 'ç¼©æ”¾:', data.dpiScale);
    
    // äº‹ä»¶æ•°æ®:
    // data.dpi - å½“å‰ DPI å€¼
    // data.dpiScale - ç¼©æ”¾æ¯”ä¾‹
    // data.titlebarHeight - æ ‡é¢˜æ é«˜åº¦ï¼ˆåƒç´ ï¼‰
    // data.captionButtonWidth - ç³»ç»ŸæŒ‰é’®å®½åº¦
    // data.captionButtonsWidth - ä¸‰ä¸ªæŒ‰é’®æ€»å®½åº¦
});
```

**è‡ªåŠ¨æ³¨å…¥çš„ CSS å˜é‡**:

DPI å˜åŒ–æ—¶ï¼Œä»¥ä¸‹ CSS å˜é‡ä¼šè‡ªåŠ¨æ³¨å…¥åˆ° `:root`ï¼š

```css
:root {
    --dpi: 144;              /* å½“å‰ DPI */
    --dpi-scale: 1.5;        /* ç¼©æ”¾æ¯”ä¾‹ */
    --titlebar-height: 48px; /* æ ‡é¢˜æ é«˜åº¦ */
    --caption-button-width: 69px; /* ç³»ç»ŸæŒ‰é’®å®½åº¦ */
}
```

</section>

<!-- ==================== WINDOW DRAG & MENU ==================== -->
<section id="window-interaction">

## Window API - æ‹–æ‹½ä¸èœå•

### window.startDrag

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.startDrag</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¼€å§‹æ‹–æ‹½çª—å£ã€‚åœ¨è‡ªå®šä¹‰æ ‡é¢˜æ çš„ mousedown äº‹ä»¶ä¸­è°ƒç”¨ï¼Œå®ç°æ‹–æ‹½ç§»åŠ¨çª—å£ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{ "success": true }
```

**ç¤ºä¾‹**:
```javascript
// åœ¨æ ‡é¢˜æ çš„ mousedown äº‹ä»¶ä¸­è°ƒç”¨
document.getElementById('titlebar').onmousedown = function(e) {
    if (e.button !== 0 || e.detail > 1) return; // åªå“åº”å·¦é”®å•å‡»
    if (e.target.closest('.titlebar-buttons')) return; // æ’é™¤æŒ‰é’®åŒºåŸŸ
    fb2k.invoke('window.startDrag');
};
```
</div>
</div>

### window.toggleMaximize

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.toggleMaximize</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ‡æ¢çª—å£æœ€å¤§åŒ–çŠ¶æ€ã€‚å¦‚æœå½“å‰æ˜¯æœ€å¤§åŒ–åˆ™è¿˜åŸï¼Œå¦åˆ™æœ€å¤§åŒ–ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{ "success": true, "maximized": true }
```

**ç¤ºä¾‹**:
```javascript
// åŒå‡»æ ‡é¢˜æ åˆ‡æ¢æœ€å¤§åŒ–
document.getElementById('titlebar').ondblclick = function(e) {
    if (e.target.closest('.titlebar-buttons')) return;
    fb2k.invoke('window.toggleMaximize');
};
```
</div>
</div>

### window.showSystemMenu

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">window.showSystemMenu</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ˜¾ç¤º Windows åŸç”Ÿç³»ç»Ÿèœå•ï¼ˆåŒ…å«è¿˜åŸã€ç§»åŠ¨ã€å¤§å°ã€æœ€å°åŒ–ã€æœ€å¤§åŒ–ã€å…³é—­ç­‰é€‰é¡¹ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `x` | number | âœ“ | å±å¹• X åæ ‡ |
| `y` | number | âœ“ | å±å¹• Y åæ ‡ |

**è¿”å›å€¼**:
```json
{ "success": true }
```

**ç¤ºä¾‹**:
```javascript
// ä½¿ç”¨ Alt+Space æˆ–ç‰¹å®šæƒ…å†µä¸‹æ˜¾ç¤ºç³»ç»Ÿèœå•
await fb2k.invoke('window.showSystemMenu', {
    x: window.screenX + 10,
    y: window.screenY + 30
});
```
</div>
</div>

### ui.showContextMenu

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">ui.showContextMenu</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ˜¾ç¤º foobar2000 é£æ ¼çš„ä¸Šä¸‹æ–‡èœå•ï¼ŒåŒ…å«æ‰“å¼€æ–‡ä»¶ã€æ·»åŠ æ–‡ä»¶å¤¹ã€å¼€å‘å·¥å…·ã€åå¥½è®¾ç½®ç­‰é€‰é¡¹ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `x` | number | âœ“ | å±å¹• X åæ ‡ |
| `y` | number | âœ“ | å±å¹• Y åæ ‡ |

**è¿”å›å€¼**:
```json
{ "success": true }
```

**èœå•é¡¹**:
- Open File(s)... - æ‰“å¼€æ–‡ä»¶
- Add Folder... - æ·»åŠ æ–‡ä»¶å¤¹
- Reload - é‡æ–°åŠ è½½ WebView
- Developer Tools - æ‰“å¼€å¼€å‘è€…å·¥å…·
- foobar2000 Console - æ‰“å¼€æ§åˆ¶å°
- Preferences... - æ‰“å¼€åå¥½è®¾ç½®
- About foobar2000... - å…³äº

**ç¤ºä¾‹**:
```javascript
// å³é”®æ ‡é¢˜æ æ˜¾ç¤º foobar2000 èœå•
document.getElementById('titlebar').oncontextmenu = function(e) {
    e.preventDefault();
    fb2k.invoke('ui.showContextMenu', {
        x: e.screenX,
        y: e.screenY
    });
};
```
</div>
</div>

</section>

<!-- ==================== SYSTEM API ==================== -->
<section id="system-api">

## System API

System API æä¾› API å‘ç°æœºåˆ¶å’Œå¤–éƒ¨æ’ä»¶æ³¨å†Œç®¡ç†åŠŸèƒ½ã€‚

### system.listAvailableApis

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.listAvailableApis</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ—å‡ºæ‰€æœ‰å¯ç”¨çš„ APIï¼ŒåŒ…æ‹¬å†…ç½® API å’Œå¤–éƒ¨æ’ä»¶æ³¨å†Œçš„ APIã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `namespace` | string | âœ— | æŒ‰å‘½åç©ºé—´è¿‡æ»¤ |
| `includeInternal` | boolean | âœ— | æ˜¯å¦åŒ…å«å†…éƒ¨ APIï¼ˆé»˜è®¤ falseï¼‰ |

**è¿”å›å€¼**:
```json
{
    "apis": [
        {
            "method": "playback.play",
            "namespace": "playback",
            "description": "å¼€å§‹æ’­æ”¾",
            "isExternal": false
        },
        {
            "method": "my_plugin.doSomething",
            "namespace": "my_plugin",
            "description": "æ‰§è¡ŒæŸæ“ä½œ",
            "isExternal": true,
            "pluginId": "my_plugin"
        }
    ],
    "total": 128
}
```

**ç¤ºä¾‹**:
```javascript
// è·å–æ‰€æœ‰ API
const result = await fb2k.system.listAvailableApis();
console.log(`å…±æœ‰ ${result.total} ä¸ª API`);

// æŒ‰å‘½åç©ºé—´è¿‡æ»¤
const playbackApis = await fb2k.system.listAvailableApis({ namespace: 'playback' });
```
</div>
</div>

### system.getApisByNamespace

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getApisByNamespace</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æŒ‡å®šå‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰ APIã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `namespace` | string | âœ“ | å‘½åç©ºé—´åç§° |

**è¿”å›å€¼**:
```json
{
    "namespace": "playback",
    "apis": [
        { "method": "playback.play", "description": "å¼€å§‹æ’­æ”¾" },
        { "method": "playback.pause", "description": "æš‚åœæ’­æ”¾" }
    ],
    "count": 21
}
```

**ç¤ºä¾‹**:
```javascript
const playbackApis = await fb2k.system.getApisByNamespace({ namespace: 'playback' });
playbackApis.apis.forEach(api => console.log(api.method));
```
</div>
</div>

### system.searchApis

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.searchApis</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æœç´¢ APIï¼ˆæ”¯æŒæ–¹æ³•åå’Œæè¿°çš„æ¨¡ç³ŠåŒ¹é…ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `query` | string | âœ“ | æœç´¢å…³é”®è¯ |
| `limit` | number | âœ— | æœ€å¤§è¿”å›æ•°é‡ï¼ˆé»˜è®¤ 50ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "query": "volume",
    "results": [
        { "method": "playback.getVolume", "description": "è·å–å½“å‰éŸ³é‡" },
        { "method": "playback.setVolume", "description": "è®¾ç½®éŸ³é‡" }
    ],
    "count": 2
}
```

**ç¤ºä¾‹**:
```javascript
const results = await fb2k.system.searchApis({ query: 'playlist' });
console.log(`æ‰¾åˆ° ${results.count} ä¸ªç›¸å…³ API`);
```
</div>
</div>

### system.getApiStats

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getApiStats</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å– API ç»Ÿè®¡ä¿¡æ¯ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{
    "totalApis": 128,
    "builtinApis": 122,
    "externalApis": 6,
    "registeredPlugins": 1,
    "namespaces": ["playback", "playlist", "library", "artwork", "config", "window", "ui", "system", "test", "my_plugin"]
}
```

**ç¤ºä¾‹**:
```javascript
const stats = await fb2k.system.getApiStats();
console.log(`å†…ç½® API: ${stats.builtinApis}, å¤–éƒ¨ API: ${stats.externalApis}`);
```
</div>
</div>

</section>

<section id="system-plugins">

### system.getRegisteredPlugins

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getRegisteredPlugins</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ‰€æœ‰å·²æ³¨å†Œçš„å¤–éƒ¨æ’ä»¶åˆ—è¡¨ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{
    "plugins": [
        {
            "id": "my_plugin",
            "name": "My Plugin",
            "version": "1.0.0",
            "author": "Author Name",
            "description": "Plugin description",
            "apiCount": 5
        }
    ],
    "count": 1
}
```

**ç¤ºä¾‹**:
```javascript
const plugins = await fb2k.system.getRegisteredPlugins();
plugins.plugins.forEach(p => {
    console.log(`${p.name} v${p.version} - ${p.apiCount} APIs`);
});
```
</div>
</div>

### system.isPluginRegistered

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.isPluginRegistered</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ£€æŸ¥æŒ‡å®šæ’ä»¶æ˜¯å¦å·²æ³¨å†Œã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| `pluginId` | string | âœ“ | æ’ä»¶ ID |

**è¿”å›å€¼**:
```json
{
    "pluginId": "my_plugin",
    "registered": true
}
```

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.system.isPluginRegistered({ pluginId: 'my_plugin' });
if (result.registered) {
    // æ’ä»¶å¯ç”¨ï¼Œå¯ä»¥è°ƒç”¨å…¶ API
    await fb2k.invoke('my_plugin.doSomething');
}
```
</div>
</div>

### system.getTheme

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getTheme</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–ç³»ç»Ÿä¸»é¢˜ä¿¡æ¯ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{
    "darkMode": true,
    "isDark": true,
    "accentColor": "#0078D4",
    "transparency": true
}
```

**ç¤ºä¾‹**:
```javascript
const theme = await fb2k.invoke('system.getTheme');
if (theme.darkMode) {
    document.body.classList.add('dark');
}
document.documentElement.style.setProperty('--accent', theme.accentColor);
```
</div>
</div>

### system.getDPI

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getDPI</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–ç³»ç»Ÿ DPI ç¼©æ”¾ä¿¡æ¯ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{
    "dpi": 120,
    "scale": 1.25
}
```

**ç¤ºä¾‹**:
```javascript
const dpi = await fb2k.invoke('system.getDPI');
console.log(`DPI: ${dpi.dpi}, Scale: ${dpi.scale * 100}%`);
```
</div>
</div>

### system.getLocale

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">system.getLocale</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–ç³»ç»Ÿè¯­è¨€åŒºåŸŸä¿¡æ¯ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{
    "locale": "zh-CN",
    "language": "ä¸­æ–‡(ç®€ä½“)",
    "country": "ä¸­å›½"
}
```

**ç¤ºä¾‹**:
```javascript
const locale = await fb2k.invoke('system.getLocale');
console.log(`å½“å‰è¯­è¨€: ${locale.language}`);
```
</div>
</div>

</section>

<!-- ==================== NEW APIs v0.2.0 ==================== -->

<section id="file-api">

## File API - æ–‡ä»¶ç³»ç»Ÿ

æä¾›æ–‡ä»¶è¯»å†™å’Œç›®å½•æ“ä½œåŠŸèƒ½ã€‚

### file.read

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">file.read</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">ğŸ“ å—é™</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è¯»å–æ–‡ä»¶å†…å®¹ã€‚<br>ğŸ“ **å®‰å…¨é™åˆ¶**: ç³»ç»Ÿç›˜ä¿æŠ¤ç›®å½•ï¼ˆWindows/System32/Program Filesï¼‰ç¦æ­¢è®¿é—®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | æ–‡ä»¶è·¯å¾„ |
| encoding | string | - | ç¼–ç ï¼Œé»˜è®¤ utf-8 |

**è¿”å›å€¼**:
```json
{ "success": true, "content": "æ–‡ä»¶å†…å®¹" }
```

**ç¤ºä¾‹**:
```javascript
// âœ… å…è®¸ - éç³»ç»Ÿç›˜
const result = await fb2k.invoke('file.read', { path: 'D:/Music/playlist.m3u' });

// âŒ æ‹’ç» - ç³»ç»Ÿç›®å½•
await fb2k.invoke('file.read', { path: 'C:/Windows/System32/config/SAM' });
// è¿”å›: { success: false, error: "Access denied: protected system path" }
```

è¯¦è§ [å®‰å…¨é™åˆ¶](#security) ç« èŠ‚ã€‚
    </div>
</div>

### file.write

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">file.write</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">ğŸ“ å—é™</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å†™å…¥æ–‡ä»¶å†…å®¹ã€‚<br>ğŸ“ **å®‰å…¨é™åˆ¶**: ä»…å…è®¸å†™å…¥ foobar2000 é…ç½®ç›®å½•å’Œä¸´æ—¶ç›®å½•ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | æ–‡ä»¶è·¯å¾„ï¼ˆä»…é™é…ç½®ç›®å½•/ä¸´æ—¶ç›®å½•ï¼‰ |
| content | string | âœ… | è¦å†™å…¥çš„å†…å®¹ |
| append | boolean | - | è¿½åŠ æ¨¡å¼ï¼Œé»˜è®¤ false |

**ç¤ºä¾‹**:
```javascript
// âœ… å…è®¸ - é…ç½®ç›®å½•
await fb2k.invoke('file.write', {
    path: '%APPDATA%/foobar2000/foo_ui_webview2/config.json',
    content: JSON.stringify(config)
});

// âŒ æ‹’ç» - ä»»æ„è·¯å¾„
await fb2k.invoke('file.write', { path: 'D:/test.txt', content: 'test' });
// è¿”å›: { success: false, error: "Access denied: write not allowed to this path" }
```

è¯¦è§ [å®‰å…¨é™åˆ¶](#security) ç« èŠ‚ã€‚
    </div>
</div>

### file.exists

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">file.exists</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ£€æŸ¥æ–‡ä»¶æˆ–ç›®å½•æ˜¯å¦å­˜åœ¨ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | è·¯å¾„ |

**è¿”å›å€¼**:
```json
{ "exists": true, "isDirectory": false }
```
</div>
</div>

### file.list

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">file.list</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ—å‡ºç›®å½•å†…å®¹ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | ç›®å½•è·¯å¾„ |
| pattern | string | - | è¿‡æ»¤æ¨¡å¼ï¼Œå¦‚ *.mp3 |
| limit | number | - | æœ€å¤§è¿”å›æ•°é‡ |

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('file.list', { 
    path: 'C:/Music', 
    pattern: '*.mp3',
    limit: 100 
});
```
</div>
</div>

### file.mkdir / file.delete

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">file.mkdir / file.delete</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ›å»ºç›®å½•æˆ–åˆ é™¤æ–‡ä»¶ã€‚</div>

**ç¤ºä¾‹**:
```javascript
// åˆ›å»ºç›®å½•
await fb2k.invoke('file.mkdir', { path: 'C:/NewFolder' });

// åˆ é™¤æ–‡ä»¶
await fb2k.invoke('file.delete', { path: 'C:/temp.txt' });
```
    </div>
</div>

### file.copy ğŸ†•

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">file.copy</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">ğŸ“ å—é™</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¤åˆ¶æ–‡ä»¶æˆ–ç›®å½•ã€‚æ”¯æŒé€’å½’å¤åˆ¶ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| source | string | âœ… | æºè·¯å¾„ |
| destination | string | âœ… | ç›®æ ‡è·¯å¾„ |
| overwrite | boolean | - | æ˜¯å¦è¦†ç›–å·²å­˜åœ¨çš„æ–‡ä»¶ï¼Œé»˜è®¤ false |

**è¿”å›å€¼**:
```json
{ "success": true, "source": "D:/Music/file.mp3", "destination": "D:/Backup/file.mp3" }
```

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('file.copy', {
    source: 'D:/Music/song.mp3',
    destination: 'D:/Backup/song.mp3',
    overwrite: true
});
```
    </div>
</div>

### file.move ğŸ†•

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">file.move</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">ğŸ“ å—é™</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ç§»åŠ¨æ–‡ä»¶æˆ–ç›®å½•åˆ°æ–°ä½ç½®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| source | string | âœ… | æºè·¯å¾„ |
| destination | string | âœ… | ç›®æ ‡è·¯å¾„ |

**è¿”å›å€¼**:
```json
{ "success": true, "source": "D:/Music/file.mp3", "destination": "D:/Archive/file.mp3" }
```

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('file.move', {
    source: 'D:/Downloads/new_song.mp3',
    destination: 'D:/Music/new_song.mp3'
});
```
    </div>
</div>

### file.rename ğŸ†•

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">file.rename</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">ğŸ“ å—é™</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é‡å‘½åæ–‡ä»¶æˆ–ç›®å½•ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | åŸè·¯å¾„ |
| newName | string | âœ… | æ–°åç§°ï¼ˆä»…æ–‡ä»¶åï¼Œä¸å«è·¯å¾„ï¼‰ |

**è¿”å›å€¼**:
```json
{ "success": true, "oldPath": "D:/Music/old.mp3", "newPath": "D:/Music/new.mp3" }
```

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('file.rename', {
    path: 'D:/Music/track01.mp3',
    newName: 'My Favorite Song.mp3'
});
```
    </div>
</div>

### file.getInfo ğŸ†•

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">file.getInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ–‡ä»¶æˆ–ç›®å½•çš„è¯¦ç»†ä¿¡æ¯ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | æ–‡ä»¶æˆ–ç›®å½•è·¯å¾„ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "path": "D:/Music/song.mp3",
    "exists": true,
    "isDirectory": false,
    "size": 5242880,
    "createdTime": "2025-01-01T12:00:00Z",
    "modifiedTime": "2025-01-02T15:30:00Z",
    "accessedTime": "2025-01-10T08:00:00Z",
    "isReadOnly": false,
    "isHidden": false
}
```

**ç¤ºä¾‹**:
```javascript
const info = await fb2k.invoke('file.getInfo', { path: 'D:/Music/song.mp3' });
console.log(`æ–‡ä»¶å¤§å°: ${info.size} bytes`);
```
    </div>
</div>

</section>

<section id="dialog-api">

## Dialog API - å¯¹è¯æ¡†

ç³»ç»ŸåŸç”Ÿå¯¹è¯æ¡†ã€‚

### dialog.openFile

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dialog.openFile</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| title | string | - | å¯¹è¯æ¡†æ ‡é¢˜ |
| filters | array | - | æ–‡ä»¶è¿‡æ»¤å™¨ |
| multiple | boolean | - | å…è®¸å¤šé€‰ |

**è¿”å›å€¼**:
```json
{ "canceled": false, "filePaths": ["C:/song.mp3"] }
```

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('dialog.openFile', {
    title: 'é€‰æ‹©éŸ³é¢‘æ–‡ä»¶',
    filters: [{ name: 'Audio', extensions: ['mp3', 'flac', 'wav'] }],
    multiple: true
});
```
</div>
</div>

### dialog.saveFile

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dialog.saveFile</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ‰“å¼€æ–‡ä»¶ä¿å­˜å¯¹è¯æ¡†ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| title | string | - | å¯¹è¯æ¡†æ ‡é¢˜ |
| defaultName | string | - | é»˜è®¤æ–‡ä»¶å |
| filters | array | - | æ–‡ä»¶è¿‡æ»¤å™¨ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('dialog.saveFile', {
    title: 'ä¿å­˜æ’­æ”¾åˆ—è¡¨',
    defaultName: 'playlist.m3u8'
});
```
</div>
</div>

### dialog.openFolder

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dialog.openFolder</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ‰“å¼€æ–‡ä»¶å¤¹é€‰æ‹©å¯¹è¯æ¡†ã€‚</div>

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('dialog.openFolder', { title: 'é€‰æ‹©éŸ³ä¹æ–‡ä»¶å¤¹' });
```
</div>
</div>

### dialog.confirm

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dialog.confirm</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| title | string | - | å¯¹è¯æ¡†æ ‡é¢˜ |
| message | string | âœ… | æç¤ºæ¶ˆæ¯ |
| type | string | - | ç±»å‹: info, warning, error, question |

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('dialog.confirm', {
    title: 'ç¡®è®¤',
    message: 'ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ',
    type: 'warning'
});
```
</div>
</div>

</section>

<section id="clipboard-api">

## Clipboard API - å‰ªè´´æ¿

### clipboard.read

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">clipboard.read</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è¯»å–å‰ªè´´æ¿æ–‡æœ¬ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true, "text": "å‰ªè´´æ¿å†…å®¹" }
```
</div>
</div>

### clipboard.write

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">clipboard.write</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å†™å…¥æ–‡æœ¬åˆ°å‰ªè´´æ¿ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| text | string | âœ… | è¦å†™å…¥çš„æ–‡æœ¬ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('clipboard.write', { text: 'Hello!' });
```
</div>
</div>

### clipboard.writeHTML

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">clipboard.writeHTML</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å†™å…¥ HTML åˆ°å‰ªè´´æ¿ã€‚</div>

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('clipboard.writeHTML', { html: '<b>Bold</b>' });
```
</div>
</div>

### clipboard.writeFiles

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">clipboard.writeFiles</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å†™å…¥æ–‡ä»¶åˆ—è¡¨åˆ°å‰ªè´´æ¿ï¼ˆå¯ç”¨äºç²˜è´´åˆ°èµ„æºç®¡ç†å™¨ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| paths | string[] | âœ… | æ–‡ä»¶è·¯å¾„æ•°ç»„ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('clipboard.writeFiles', { 
    paths: ['C:/Music/song1.mp3', 'C:/Music/song2.mp3'] 
});
```
</div>
</div>

</section>

<section id="shell-api">

## Shell API - ç³»ç»Ÿé›†æˆ

### shell.showInExplorer

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">shell.showInExplorer</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åœ¨èµ„æºç®¡ç†å™¨ä¸­æ˜¾ç¤ºæ–‡ä»¶ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | æ–‡ä»¶è·¯å¾„ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('shell.showInExplorer', { path: 'C:/Music/song.mp3' });
```
</div>
</div>

### shell.openExternal

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">shell.openExternal</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ç”¨é»˜è®¤ç¨‹åºæ‰“å¼€ URL æˆ–æ–‡ä»¶ã€‚</div>

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('shell.openExternal', { url: 'https://www.foobar2000.org' });
```
</div>
</div>

### shell.exec

<div class="api-card" style="border-color: #f85149; opacity: 0.7;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #f85149;">DISABLED</span>
        <span class="api-card-name">shell.exec</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc" style="color: #f85149;">â›” **å·²ç¦ç”¨** - ä»»æ„å‘½ä»¤æ‰§è¡Œé£é™©è¿‡é«˜ï¼Œæ­¤ API å·²è¢«ç§»é™¤ã€‚è°ƒç”¨å°†è¿”å› "Method not found" é”™è¯¯ã€‚</div>

**æ›¿ä»£æ–¹æ¡ˆ**: è¯·ä½¿ç”¨ `shell.openExternal`ï¼ˆæ‰“å¼€ URLï¼‰æˆ– `shell.openWith`ï¼ˆæ‰“å¼€æ–‡ä»¶ï¼‰ã€‚

è¯¦è§ [å®‰å…¨é™åˆ¶](#security) ç« èŠ‚ã€‚
    </div>
</div>

### shell.openWith

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">shell.openWith</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">ğŸš« å—é™</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ä½¿ç”¨ç³»ç»Ÿé»˜è®¤ç¨‹åºæ‰“å¼€æ–‡ä»¶ã€‚<br>ğŸš« **å®‰å…¨é™åˆ¶**: ç¦æ­¢æ‰“å¼€å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆ.exe/.bat/.cmd ç­‰ 30+ ç§ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | æ–‡ä»¶è·¯å¾„ï¼ˆä¸èƒ½æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼‰ |

**ç¤ºä¾‹**:
```javascript
// âœ… å…è®¸
await fb2k.invoke('shell.openWith', { path: 'D:/Music/song.mp3' });

// âŒ æ‹’ç»
await fb2k.invoke('shell.openWith', { path: 'C:/app.exe' });
// è¿”å›: { success: false, error: "Executable files cannot be opened..." }
```

è¯¦è§ [å®‰å…¨é™åˆ¶](#security) ç« èŠ‚ã€‚
    </div>
</div>

</section>

<section id="http-api">

## HTTP API - ç½‘ç»œè¯·æ±‚

ä½¿ç”¨ WinHTTP è¿›è¡Œç½‘ç»œè¯·æ±‚ã€‚æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§æ¨¡å¼ã€‚

> ğŸ’¡ **æ€§èƒ½æç¤º**: é»˜è®¤åŒæ­¥æ¨¡å¼ä¼šé˜»å¡ UIã€‚å¦‚éœ€é¿å…é˜»å¡ï¼Œæ¨èå‰ç«¯ç›´æ¥ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ `fetch()` APIï¼Œæˆ–è®¾ç½® `async: true` ä½¿ç”¨å¼‚æ­¥æ¨¡å¼ã€‚

### http.get

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">http.get</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">ğŸŒ SSRF é˜²æŠ¤</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å‘é€ HTTP GET è¯·æ±‚ã€‚<br>ğŸŒ **å®‰å…¨é™åˆ¶**: é»˜è®¤ç¦æ­¢è®¿é—®å†…ç½‘åœ°å€ï¼ˆlocalhost/192.168.x.x/10.x.x.x ç­‰ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| url | string | âœ… | è¯·æ±‚ URLï¼ˆå†…ç½‘åœ°å€éœ€å¼€å¯é«˜çº§è®¾ç½®ï¼‰ |
| headers | object | - | è¯·æ±‚å¤´ |
| timeout | number | - | è¶…æ—¶æ—¶é—´(ms)ï¼Œé»˜è®¤ 30000 |
| async | boolean | - | æ˜¯å¦å¼‚æ­¥ï¼Œé»˜è®¤ `false`ã€‚è®¾ä¸º `true` æ—¶ä¸é˜»å¡ UIï¼Œç»“æœé€šè¿‡ `http:response` äº‹ä»¶è¿”å› |

**è¿”å›å€¼ï¼ˆåŒæ­¥æ¨¡å¼ async=falseï¼Œé»˜è®¤ï¼‰**:
```json
{ "success": true, "status": 200, "body": "...", "headers": {...} }
```

**è¿”å›å€¼ï¼ˆå¼‚æ­¥æ¨¡å¼ async=trueï¼‰**:
```json
{ "success": true, "requestId": "http_1", "async": true }
```
ç»“æœé€šè¿‡ `http:response` äº‹ä»¶è¿”å›ï¼š
```json
{ "requestId": "http_1", "success": true, "status": 200, "body": "...", "headers": {...} }
```

**ç¤ºä¾‹**:
```javascript
// ğŸ”’ åŒæ­¥æ¨¡å¼ï¼ˆé»˜è®¤ï¼Œä¼šé˜»å¡ UIï¼‰
const result = await fb2k.invoke('http.get', {
    url: 'https://api.example.com/data',
    headers: { 'Authorization': 'Bearer token' }
});
console.log('Body:', result.body);

// âš¡ å¼‚æ­¥æ¨¡å¼ï¼ˆä¸é˜»å¡ UIï¼‰
fb2k.on('http:response', (data) => {
    if (data.requestId === myRequestId) {
        console.log('Response:', data.body);
    }
});
const asyncResult = await fb2k.invoke('http.get', {
    url: 'https://api.example.com/data',
    async: true
});
const myRequestId = asyncResult.requestId;

// âœ… æ¨èï¼šä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ fetch()ï¼ˆå®Œå…¨ä¸é˜»å¡ï¼‰
const response = await fetch('https://api.example.com/data');
const data = await response.json();
```

> ğŸ’¡ å¯ç”¨å†…ç½‘è®¿é—®: **Preferences â†’ Advanced â†’ Tools â†’ WebView UI â†’ Allow local network access**
    </div>
</div>

### http.post

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">http.post</span>
        <span style="background: #d29922; color: #000; padding: 2px 8px; border-radius: 4px; font-size: 11px; margin-left: 8px;">ğŸŒ SSRF é˜²æŠ¤</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å‘é€ HTTP POST è¯·æ±‚ã€‚<br>ğŸŒ **å®‰å…¨é™åˆ¶**: é»˜è®¤ç¦æ­¢è®¿é—®å†…ç½‘åœ°å€ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| url | string | âœ… | è¯·æ±‚ URL |
| body | string | - | è¯·æ±‚ä½“ |
| headers | object | - | è¯·æ±‚å¤´ |
| timeout | number | - | è¶…æ—¶æ—¶é—´(ms)ï¼Œé»˜è®¤ 30000 |
| async | boolean | - | æ˜¯å¦å¼‚æ­¥ï¼Œé»˜è®¤ `false` |

**ç¤ºä¾‹**:
```javascript
// åŒæ­¥æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
const result = await fb2k.invoke('http.post', {
    url: 'https://api.example.com/submit',
    body: JSON.stringify({ key: 'value' }),
    headers: { 'Content-Type': 'application/json' }
});

// æ¨èï¼šä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ fetch()
const response = await fetch('https://api.example.com/submit', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ key: 'value' })
});
```
</div>
</div>

### http.head

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">http.head</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å‘é€ HTTP HEAD è¯·æ±‚ï¼Œè·å–å“åº”å¤´ä¿¡æ¯ï¼ˆä¸ä¸‹è½½å†…å®¹ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| url | string | âœ… | è¯·æ±‚ URL |
| headers | object | - | è¯·æ±‚å¤´ |
| timeout | number | - | è¶…æ—¶æ—¶é—´(ms)ï¼Œé»˜è®¤ 30000 |
| async | boolean | - | æ˜¯å¦å¼‚æ­¥ï¼Œé»˜è®¤ `false` |

**è¿”å›å€¼ï¼ˆåŒæ­¥æ¨¡å¼ï¼Œé»˜è®¤ï¼‰**:
```json
{
    "success": true,
    "status": 200,
    "headers": { "Content-Length": "12345", "Content-Type": "audio/mpeg" },
    "contentLength": 12345
}
```

**ç¤ºä¾‹**:
```javascript
// æ£€æŸ¥æ–‡ä»¶å¤§å°
const result = await fb2k.invoke('http.head', {
    url: 'https://example.com/file.mp3'
});
console.log(`æ–‡ä»¶å¤§å°: ${result.contentLength} bytes`);
```
</div>
</div>

### http.download

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">http.download</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ä¸‹è½½æ–‡ä»¶åˆ°æœ¬åœ°ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| url | string | âœ… | ä¸‹è½½ URL |
| saveTo | string | âœ… | ä¿å­˜è·¯å¾„ (æ”¯æŒ %profile%) |
| timeout | number | - | è¶…æ—¶æ—¶é—´(ms)ï¼Œé»˜è®¤ 60000 |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "status": 200,
    "bytesWritten": 12345,
    "path": "C:\\path\\to\\file.mp3"
}
```

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('http.download', {
    url: 'https://example.com/cover.jpg',
    saveTo: '%profile%\\covers\\album.jpg'
});
```
</div>
</div>

</section>

<section id="ui-api">

## UI API - ç•Œé¢äº¤äº’

### ui.showCustomMenu

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">ui.showCustomMenu</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ˜¾ç¤ºè‡ªå®šä¹‰å³é”®èœå•ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| items | array | âœ… | èœå•é¡¹æ•°ç»„ |
| x | number | - | X åæ ‡ |
| y | number | - | Y åæ ‡ |
| suppressDefault | boolean | - | æ˜¯å¦å¼ºåˆ¶ç¦ç”¨é»˜è®¤å³é”®èœå• (é»˜è®¤ false) |

**è¿”å›å€¼**:
```json
{ "success": true, "selectedId": "play" }
```

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('ui.showCustomMenu', {
    items: [
        { id: 'play', label: 'æ’­æ”¾' },
        { type: 'separator' },
        { id: 'delete', label: 'åˆ é™¤' }
    ],
    x: event.clientX,
    y: event.clientY,
    suppressDefault: true // ç¡®ä¿ä¸æ˜¾ç¤ºåŸç”Ÿ/fb2k é»˜è®¤èœå•
});
```
</div>
</div>

### ui.showToast

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">ui.showToast</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ˜¾ç¤º Toast æç¤ºã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| message | string | âœ… | æç¤ºæ¶ˆæ¯ |
| duration | number | - | æ˜¾ç¤ºæ—¶é•¿(æ¯«ç§’) |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('ui.showToast', { 
    message: 'æ“ä½œæˆåŠŸ', 
    duration: 3000 
});
```
</div>
</div>

### ui.showNotification

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">ui.showNotification</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ˜¾ç¤ºç³»ç»Ÿé€šçŸ¥ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| title | string | âœ… | é€šçŸ¥æ ‡é¢˜ |
| message | string | âœ… | é€šçŸ¥å†…å®¹ |
| timeout | number | - | è¶…æ—¶æ—¶é—´(æ¯«ç§’) |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('ui.showNotification', {
    title: 'foobar2000',
    message: 'æ­£åœ¨æ’­æ”¾: Song Title',
    timeout: 5000
});
```
</div>
</div>

### ui.hideNotification

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">ui.hideNotification</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">éšè—å½“å‰æ˜¾ç¤ºçš„ç³»ç»Ÿé€šçŸ¥ã€‚</div>

**å‚æ•°**: æ— 

**è¿”å›å€¼**:
```json
{
    "success": true
}
```

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('ui.hideNotification');
```
</div>
</div>

</section>

<section id="keyboard-api">

## Keyboard API - å¿«æ·é”®

### keyboard.registerHotkey

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">keyboard.registerHotkey</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ³¨å†Œå…¨å±€çƒ­é”®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| id | string | âœ… | çƒ­é”® ID |
| key | string | âœ… | æŒ‰é”®åç§° |
| modifiers | array | - | ä¿®é¥°é”®: ctrl, alt, shift |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('keyboard.registerHotkey', {
    id: 'play_pause',
    key: 'Space',
    modifiers: ['ctrl', 'alt']
});

// ç›‘å¬çƒ­é”®äº‹ä»¶
fb2k.on('keyboard:hotkeyPressed', (data) => {
    if (data.id === 'play_pause') {
        fb2k.invoke('playback.playOrPause');
    }
});
```
</div>
</div>

### keyboard.unregisterHotkey

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">keyboard.unregisterHotkey</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ³¨é”€çƒ­é”®ã€‚</div>

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('keyboard.unregisterHotkey', { id: 'play_pause' });
```
</div>
</div>

### keyboard.registerShortcut

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">keyboard.registerShortcut</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ³¨å†Œåº”ç”¨å†…å¿«æ·é”®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| id | string | âœ… | å¿«æ·é”® ID |
| key | string | âœ… | æŒ‰é”®åç§° |
| modifiers | array | - | ä¿®é¥°é”® |
    </div>
</div>

### keyboard.getRegisteredHotkeys

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">keyboard.getRegisteredHotkeys</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ‰€æœ‰å·²æ³¨å†Œçš„çƒ­é”®åˆ—è¡¨ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "hotkeys": [
        { "id": "play_pause", "key": "Space", "modifiers": ["ctrl", "alt"] }
    ],
    "count": 1
}
```
</div>
</div>

</section>

<section id="lyrics-api">

## Lyrics API - æ­Œè¯

### lyrics.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">lyrics.get</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ›²ç›®æ­Œè¯ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true, "lyrics": "[00:00.00]æ­Œè¯...", "type": "lrc" }
```
</div>
</div>

### lyrics.save

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">lyrics.save</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ä¿å­˜æ­Œè¯ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| lyrics | string | âœ… | æ­Œè¯å†…å®¹ |
| embedded | boolean | - | true åµŒå…¥æ–‡ä»¶ï¼Œfalse ä¿å­˜ä¸º .lrc |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('lyrics.save', { 
    lyrics: '[00:00.00]æ­Œè¯å†…å®¹',
    embedded: true
});
```
</div>
</div>

### lyrics.exists

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">lyrics.exists</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ£€æŸ¥æ­Œè¯æ˜¯å¦å­˜åœ¨ã€‚</div>

**è¿”å›å€¼**:
```json
{ "exists": true, "embedded": false, "external": true }
```
</div>
</div>

</section>

<section id="metadata-api">

## Metadata API - å…ƒæ•°æ®

### metadata.read

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">metadata.read</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è¯»å–æŒ‡å®šæ–‡ä»¶çš„å…ƒæ•°æ®ï¼ˆç»“æ„åŒ–æ ¼å¼ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "path": "E:\\Music\\song.flac",
    "tags": {
        "TITLE": "Song Title",
        "ARTIST": "Artist Name",
        "ALBUM": "Album Name"
    },
    "info": {
        "duration": 180.5,
        "bitrate": 1411,
        "sampleRate": 44100,
        "channels": 2,
        "codec": "FLAC"
    }
}
```
</div>
</div>

### metadata.readByPath

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">metadata.readByPath</span>
        <span class="badge badge-green">v1.1.0</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è¯»å–æŒ‡å®šæ–‡ä»¶çš„æ‰€æœ‰å…ƒæ•°æ®ï¼ˆæ‰å¹³æ ¼å¼ï¼‰ã€‚è¿”å›æ‰€æœ‰æ ‡ç­¾å’ŒæŠ€æœ¯ä¿¡æ¯åœ¨åŒä¸€å±‚çº§ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "path": "E:\\Music\\song.flac",
    "TITLE": "Song Title",
    "ARTIST": "Artist Name",
    "ALBUM": "Album Name",
    "TRACKNUMBER": "1",
    "DATE": "2024",
    "GENRE": "Electronic",
    "BITRATE": "1411",
    "SAMPLERATE": "44100",
    "CHANNELS": "2",
    "CODEC": "FLAC",
    "ENCODING": "lossless",
    "DURATION": "180.500",
    "FILESIZE": "35000000"
}
```

**ç¤ºä¾‹**:
```javascript
const meta = await fb2k.invoke('metadata.readByPath', {
    path: 'E:\\Music\\song.flac'
});
console.log(meta.TITLE, meta.ARTIST, meta.DURATION);
```

> ğŸ’¡ **æç¤º**: ä¸ `metadata.read` ä¸åŒï¼Œæ­¤ API è¿”å›æ‰å¹³ç»“æ„ï¼Œæ‰€æœ‰æ ‡ç­¾é”®åè½¬ä¸ºå¤§å†™ï¼Œæ–¹ä¾¿ç›´æ¥è®¿é—®ã€‚
    </div>
</div>

### metadata.write

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">metadata.write</span>
        <span class="badge badge-blue">v1.1.6 å¢å¼º</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å†™å…¥å…ƒæ•°æ®æ ‡ç­¾åˆ°æ–‡ä»¶ã€‚<br>
        <strong>v1.1.6</strong>: ç°å·²å®ç°çœŸæ­£çš„æ ‡ç­¾å†™å…¥åŠŸèƒ½ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ |
| tags | object | âœ… | æ ‡ç­¾é”®å€¼å¯¹ï¼Œå€¼ä¸º null åˆ™åˆ é™¤è¯¥æ ‡ç­¾ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('metadata.write', {
    path: 'E:\\Music\\song.flac',
    tags: {
        TITLE: 'New Title',
        ARTIST: 'New Artist',
        RATING: '5'
    }
});
```
    </div>
</div>

### metadata.removeTag

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">metadata.removeTag</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ç§»é™¤æŒ‡å®šæ ‡ç­¾ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ |
| tags | array | âœ… | è¦ç§»é™¤çš„æ ‡ç­¾åæ•°ç»„ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('metadata.removeTag', {
    path: 'E:\\Music\\song.flac',
    tags: ['COMMENT', 'RATING']
});
```
    </div>
</div>

### metadata.writeBatch

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">metadata.writeBatch</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ‰¹é‡å†™å…¥å¤šä¸ªæ–‡ä»¶çš„å…ƒæ•°æ®ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| items | array | âœ… | åŒ…å« path å’Œ tags çš„æ•°ç»„ |
    </div>
</div>

### metadata.embedArtwork

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">metadata.embedArtwork</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å°†å°é¢å›¾åµŒå…¥åˆ°éŸ³é¢‘æ–‡ä»¶ã€‚æ”¯æŒå¤šç§å°é¢ç±»å‹ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ |
| imageData | string | âœ… | Base64 ç¼–ç çš„å›¾ç‰‡æ•°æ® |
| type | string | âŒ | å°é¢ç±»å‹ï¼Œé»˜è®¤ "front" |

**æ”¯æŒçš„å°é¢ç±»å‹**:
| ç±»å‹ | æè¿° |
|------|------|
| `front` / `cover_front` | å‰å°é¢ï¼ˆé»˜è®¤ï¼‰ |
| `back` / `cover_back` | åå°é¢ |
| `disc` | å…‰ç¢Ÿå›¾ç‰‡ |
| `icon` | ä¸“è¾‘å›¾æ ‡ |
| `artist` | è‰ºæœ¯å®¶å›¾ç‰‡ |

**è¿”å›å€¼**:
```json
{
  "success": true,
  "path": "E:\\Music\\song.flac",
  "type": "front",
  "size": 45678
}
```

**ç¤ºä¾‹**:
```javascript
// åµŒå…¥å‰å°é¢
await fb2k.invoke('metadata.embedArtwork', {
  path: 'E:\\Music\\song.flac',
  imageData: 'base64EncodedImageData...',
  type: 'front'
});

// åµŒå…¥è‰ºæœ¯å®¶å›¾ç‰‡
await fb2k.invoke('metadata.embedArtwork', {
  path: 'E:\\Music\\song.flac',
  imageData: 'base64EncodedImageData...',
  type: 'artist'
});
```

> âš ï¸ **æ³¨æ„**: å¹¶éæ‰€æœ‰éŸ³é¢‘æ ¼å¼éƒ½æ”¯æŒåµŒå…¥å°é¢ã€‚FLACã€MP3ã€M4A ç­‰å¸¸è§æ ¼å¼é€šå¸¸æ”¯æŒã€‚

    </div>
</div>

### metadata.removeEmbeddedArt

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">metadata.removeEmbeddedArt</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ä»éŸ³é¢‘æ–‡ä»¶ç§»é™¤åµŒå…¥çš„å°é¢å›¾ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ |
| type | string | âŒ | è¦ç§»é™¤çš„å°é¢ç±»å‹ï¼ˆç•™ç©ºç§»é™¤å…¨éƒ¨ï¼‰ |
| removeAll | boolean | âŒ | è®¾ç½®ä¸º true ç§»é™¤æ‰€æœ‰å°é¢ |

**è¿”å›å€¼**:
```json
{
  "success": true,
  "path": "E:\\Music\\song.flac",
  "removedTypes": ["front", "back", "disc", "icon", "artist"]
}
```

**ç¤ºä¾‹**:
```javascript
// ç§»é™¤æŒ‡å®šç±»å‹å°é¢
await fb2k.invoke('metadata.removeEmbeddedArt', {
  path: 'E:\\Music\\song.flac',
  type: 'back'
});

// ç§»é™¤æ‰€æœ‰å°é¢
await fb2k.invoke('metadata.removeEmbeddedArt', {
  path: 'E:\\Music\\song.flac',
  removeAll: true
});
```
    </div>
</div>

### rating.set

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">rating.set</span>
        <span class="badge badge-green">v1.1.6</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®æ›²ç›®è¯„åˆ† (1-5 æ˜Ÿ)ã€‚è¯„åˆ†å°†å†™å…¥æ–‡ä»¶çš„ RATING æ ‡ç­¾ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ |
| rating | number | âœ… | è¯„åˆ†å€¼ (0-5)ï¼Œ0 = æ¸…é™¤è¯„åˆ† |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "path": "E:\\Music\\song.flac",
    "rating": 5
}
```

**ç¤ºä¾‹**:
```javascript
// è®¾ç½® 5 æ˜Ÿè¯„åˆ†
await fb2k.invoke('rating.set', {
    path: 'E:\\Music\\song.flac',
    rating: 5
});

// æ¸…é™¤è¯„åˆ†
await fb2k.invoke('rating.set', {
    path: 'E:\\Music\\song.flac',
    rating: 0
});
```

> ğŸ’¡ **æç¤º**: è¯„åˆ†å€¼ 0 ä¼šä»æ–‡ä»¶ä¸­ç§»é™¤ RATING æ ‡ç­¾ã€‚è¯„åˆ†å°†æŒä¹…åŒ–åˆ°æ–‡ä»¶ä¸­ï¼Œä¸å…¶ä»– foobar2000 ç»„ä»¶å…¼å®¹ã€‚
    </div>
</div>

### rating.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">rating.get</span>
        <span class="badge badge-green">v1.1.6</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ›²ç›®è¯„åˆ†ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "path": "E:\\Music\\song.flac",
    "rating": 4
}
```

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('rating.get', {
    path: 'E:\\Music\\song.flac'
});
console.log(`Rating: ${result.rating}/5`);  // Rating: 4/5
```
    </div>
</div>

</section>

<section id="audio-api">

## Audio API - éŸ³é¢‘åˆ†æ (12)

### audio.subscribeSpectrum

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">audio.subscribeSpectrum</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¢é˜…å®æ—¶é¢‘è°±æ•°æ®ã€‚ä½¿ç”¨ foobar2000 çš„ visualisation_stream API è·å– FFT é¢‘è°±ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| fftSize | number | - | FFT å¤§å°ï¼Œå¿…é¡»æ˜¯ 2 çš„å¹‚ (256-8192)ï¼Œé»˜è®¤ 1024 |
| fps | number | - | åˆ·æ–°ç‡ (1-60)ï¼Œé»˜è®¤ 30 |
| event | string | - | äº‹ä»¶åç§°ï¼Œé»˜è®¤ "audio:spectrum" |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "subscriptionId": "spectrum_main",
    "fftSize": 1024,
    "fps": 30,
    "event": "audio:spectrum"
}
```

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('audio.subscribeSpectrum', {
    fftSize: 1024,
    fps: 30
});

// æ¥æ”¶é¢‘è°±æ•°æ®
fb2k.on('audio:spectrum', (data) => {
    // data.spectrum = [0.5, 0.8, 0.3, ...] (å½’ä¸€åŒ–å€¼)
    renderVisualizer(data.spectrum);
});
```
</div>
</div>

### audio.unsubscribeSpectrum

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">audio.unsubscribeSpectrum</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å–æ¶ˆè®¢é˜…é¢‘è°±æ•°æ®ï¼Œé‡Šæ”¾å¯è§†åŒ–èµ„æºã€‚</div>
    </div>
</div>

### audio.getSpectrum

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">audio.getSpectrum</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ‰‹åŠ¨è·å–å½“å‰é¢‘è°±æ•°æ®ï¼ˆè½®è¯¢æ¨¡å¼ï¼‰ã€‚éœ€è¦å…ˆè°ƒç”¨ subscribeSpectrumã€‚</div>

**è¿”å›å€¼**:
```json
{
    "success": true,
    "spectrum": [0.1, 0.3, 0.8, ...],
    "fftSize": 1024
}
```
</div>
</div>

### audio.getWaveform

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">audio.getWaveform</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ’­æ”¾çš„æ³¢å½¢æ•°æ®ç‰‡æ®µï¼ˆå®æ—¶ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| duration | number | - | æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 0.05 |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "waveform": [-0.1, 0.3, -0.5, ...],
    "duration": 0.05
}
```
</div>
</div>

### audio.setChannelMode

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">audio.setChannelMode</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®é¢‘è°±åˆ†æçš„å£°é“æ¨¡å¼ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| mode | string | - | "default", "mono", "front", "back" |
</div>
</div>

### audio.subscribeStream

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">audio.subscribeStream</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¢é˜…éŸ³é¢‘æµæ•è·ï¼ˆç”¨äºå½•éŸ³/æµåª’ä½“ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| event | string | - | äº‹ä»¶åç§°ï¼Œé»˜è®¤ "audio:stream" |
| interval | number | - | å›è°ƒé—´éš”ï¼ˆç§’ï¼‰ï¼Œé»˜è®¤ 0.05 |

**æ³¨æ„**: æ­¤åŠŸèƒ½éœ€è¦ playback_stream_capture é›†æˆã€‚
</div>
</div>

### audio.unsubscribeStream

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">audio.unsubscribeStream</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å–æ¶ˆè®¢é˜…éŸ³é¢‘æµæ•è·ã€‚</div>
    </div>
</div>

### audio.analyzeBPM

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method query">QUERY</span>
        <span class="api-card-name">audio.analyzeBPM</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åˆ†ææ›²ç›®çš„ BPMã€‚é¦–å…ˆä»å…ƒæ•°æ®è¯»å–ï¼Œè‹¥ä¸å­˜åœ¨åˆ™å°è¯•æµæ´¾ä¼°ç®—ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ |
| forceAnalysis | boolean | - | å¼ºåˆ¶é‡æ–°åˆ†æï¼ˆè·³è¿‡å…ƒæ•°æ®ï¼‰ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "bpm": 128,
    "source": "metadata",  // "metadata", "estimate"
    "confidence": 1.0      // 1.0=å…ƒæ•°æ®, 0.3=æµæ´¾ä¼°ç®—
}
```

**æµæ´¾ BPM ä¼°ç®—**:
- Drum & Bass: 174
- Dubstep: 140
- House: 128
- Techno: 130
- Trance: 138
- Hip-Hop: 90
- Rock/Pop: 120
</div>
</div>

### audio.generateWaveform

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method query">QUERY</span>
        <span class="api-card-name">audio.generateWaveform</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ç”Ÿæˆæ³¢å½¢å¯è§†åŒ–æ•°æ®ï¼ˆéœ€è¦éŸ³é¢‘è§£ç ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| path | string | âœ… | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ |
| resolution | number | - | æ•°æ®ç‚¹æ•°é‡ (50-4000)ï¼Œé»˜è®¤ 800 |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "peaks": [0.8, 0.6, 0.9, ...],
    "rms": [0.3, 0.2, 0.4, ...],
    "duration": 234.5,
    "sampleRate": 44100,
    "channels": 2,
    "resolution": 800
}
```
</div>
</div>

### audio.getOutputInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">audio.getOutputInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰éŸ³é¢‘è¾“å‡ºä¿¡æ¯ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "success": true,
    "volume": -10.0,
    "volumePercent": 31.6
}
```
</div>
</div>

### audio.getStreamInfo

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">audio.getStreamInfo</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ’­æ”¾æµçš„è¯¦ç»†ä¿¡æ¯ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "success": true,
    "playing": true,
    "sampleRate": 44100,
    "channels": 2,
    "bitrate": 320,
    "codec": "MP3",
    "duration": 234.5
}
```
</div>
</div>

### audio.isVisualizationAvailable

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">audio.isVisualizationAvailable</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ£€æŸ¥å¯è§†åŒ–åŠŸèƒ½æ˜¯å¦å¯ç”¨ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "success": true,
    "available": true
}
```
</div>
</div>

</section>

<section id="console-api">

## Console API - æ—¥å¿—

### console.log / console.warn / console.error

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">console.log / warn / error</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è¾“å‡ºåˆ° foobar2000 æ§åˆ¶å°ã€‚</div>

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('console.log', { message: 'æ™®é€šæ—¥å¿—' });
await fb2k.invoke('console.warn', { message: 'è­¦å‘Šä¿¡æ¯' });
await fb2k.invoke('console.error', { message: 'é”™è¯¯ä¿¡æ¯' });
```
</div>
</div>

### log.write

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">log.write</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å†™å…¥æ—¥å¿—æ–‡ä»¶ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| message | string | âœ… | æ—¥å¿—å†…å®¹ |
| level | string | - | æ—¥å¿—çº§åˆ«: info, warn, error |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('log.write', { 
    message: 'æ—¥å¿—å†…å®¹',
    level: 'info'
});
```
</div>
</div>

### log.read

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">log.read</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è¯»å–æ—¥å¿—æ–‡ä»¶ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| lines | number | - | è¿”å›è¡Œæ•°ï¼Œé»˜è®¤ 100 |
    </div>
</div>

### log.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">log.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ¸…ç©ºæ—¥å¿—æ–‡ä»¶ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true }
```
</div>
</div>

</section>

<section id="dnd-api">

## DnD API - æ‹–æ”¾

### dnd.registerDropZone

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dnd.registerDropZone</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ³¨å†Œæ‹–æ”¾åŒºåŸŸã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| elementId | string | âœ… | DOM å…ƒç´  ID |
| accepts | array | - | æ¥å—çš„ MIME ç±»å‹ |

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('dnd.registerDropZone', {
    elementId: 'playlist-area',
    accepts: ['audio/*', 'application/x-foobar2000-playlist']
});

// ç›‘å¬æ‹–æ”¾äº‹ä»¶
fb2k.on('dnd:drop', (data) => {
    console.log('Dropped files:', data.files);
});
```
</div>
</div>

### dnd.unregisterDropZone

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dnd.unregisterDropZone</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ³¨é”€æ‹–æ”¾åŒºåŸŸã€‚</div>

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('dnd.unregisterDropZone', { elementId: 'playlist-area' });
```
</div>
</div>

### dnd.getDropZones

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">dnd.getDropZones</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ‰€æœ‰å·²æ³¨å†Œçš„æ‹–æ”¾åŒºåŸŸã€‚</div>

**è¿”å›å€¼**:
```json
{
    "zones": [
        { "elementId": "playlist-area", "accepts": ["audio/*"] }
    ],
    "count": 1
}
```
</div>
</div>

### dnd.startDrag

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dnd.startDrag</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¯åŠ¨æ‹–æ‹½æ“ä½œï¼ˆç”¨äºä» WebView æ‹–å‡ºå†…å®¹ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| type | string | âœ… | æ•°æ®ç±»å‹ |
| data | any | âœ… | æ‹–æ‹½æ•°æ® |
    </div>
</div>

</section>

<!-- ==================== QUEUE API ==================== -->
<section id="queue-api">

## Queue API - æ’­æ”¾é˜Ÿåˆ— ğŸ†•

foobar2000 åŸç”Ÿæ’­æ”¾é˜Ÿåˆ—ç®¡ç†ã€‚æ”¯æŒ"ä¸‹ä¸€é¦–æ’­æ”¾"åŠŸèƒ½ï¼Œå¯æ··åˆæœ¬åœ°æ–‡ä»¶å’Œæµåª’ä½“ URLã€‚

### queue.addPaths ğŸ†•

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">queue.addPaths</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ä¸€æ­¥æ·»åŠ  URL/æœ¬åœ°è·¯å¾„åˆ°æ’­æ”¾é˜Ÿåˆ—ã€‚è¿™æ˜¯å®ç°"ä¸‹ä¸€é¦–æ’­æ”¾"çš„æ ¸å¿ƒ APIï¼Œè‡ªåŠ¨å¤„ç†æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨å’Œå…¥é˜Ÿæ“ä½œã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| paths | array | âœ… | æ–‡ä»¶è·¯å¾„æˆ– URL æ•°ç»„ |
| playlist | number | - | ç›®æ ‡æ’­æ”¾åˆ—è¡¨ç´¢å¼•ï¼ˆé»˜è®¤ä½¿ç”¨ä¸“ç”¨é˜Ÿåˆ—æ’­æ”¾åˆ—è¡¨ï¼‰ |
| useQueuePlaylist | boolean | - | ä½¿ç”¨ä¸“ç”¨ "[WebView Queue]" æ’­æ”¾åˆ—è¡¨ï¼ˆé»˜è®¤ trueï¼‰ |

**è¿”å›å€¼**:
```json
{
    "success": true,
    "addedCount": 2,
    "playlist": 3,
    "queueCount": 5
}
```

**ç¤ºä¾‹**:
```javascript
// ä¸‹ä¸€é¦–æ’­æ”¾ - æœ€ç®€å•çš„ç”¨æ³•
await fb2k.invoke('queue.addPaths', { 
    paths: ['C:/Music/song.mp3', 'http://stream.example.com/audio.mp3']
});

// æ·»åŠ åˆ°æŒ‡å®šæ’­æ”¾åˆ—è¡¨
await fb2k.invoke('queue.addPaths', { 
    paths: ['D:/Music/album/*.flac'],
    playlist: 0,
    useQueuePlaylist: false
});
```
</div>
</div>

### queue.add

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">queue.add</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å°†æ’­æ”¾åˆ—è¡¨ä¸­çš„æ›²ç›®æ·»åŠ åˆ°é˜Ÿåˆ—ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| playlist | number | - | æ’­æ”¾åˆ—è¡¨ç´¢å¼•ï¼ˆé»˜è®¤å½“å‰æ´»åŠ¨æ’­æ”¾åˆ—è¡¨ï¼‰ |
| track | number | - | å•ä¸ªæ›²ç›®ç´¢å¼• |
| tracks | array | - | æ›²ç›®ç´¢å¼•æ•°ç»„ |

**ç¤ºä¾‹**:
```javascript
// æ·»åŠ å•ä¸ªæ›²ç›®
await fb2k.invoke('queue.add', { playlist: 0, track: 5 });

// æ·»åŠ å¤šä¸ªæ›²ç›®
await fb2k.invoke('queue.add', { playlist: 0, tracks: [3, 5, 7] });
```
</div>
</div>

### queue.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">queue.get</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ’­æ”¾é˜Ÿåˆ—å†…å®¹ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "items": [
        {
            "queueIndex": 0,
            "path": "C:/Music/song.mp3",
            "title": "Song Title",
            "artist": "Artist Name",
            "album": "Album Name",
            "duration": 245.5,
            "playlist": 0,
            "playlistItem": 15
        }
    ],
    "count": 3
}
```

**ç¤ºä¾‹**:
```javascript
const queue = await fb2k.invoke('queue.get');
console.log(`é˜Ÿåˆ—ä¸­æœ‰ ${queue.count} é¦–æ­Œ`);
queue.items.forEach(item => {
    console.log(`${item.title} - ${item.artist}`);
});
```
</div>
</div>

### queue.remove

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">queue.remove</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ä»é˜Ÿåˆ—ä¸­ç§»é™¤æŒ‡å®šé¡¹ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| index | number | - | è¦ç§»é™¤çš„é˜Ÿåˆ—ç´¢å¼• |
| indices | array | - | è¦ç§»é™¤çš„å¤šä¸ªé˜Ÿåˆ—ç´¢å¼• |

**ç¤ºä¾‹**:
```javascript
// ç§»é™¤ç¬¬ä¸€é¡¹
await fb2k.invoke('queue.remove', { index: 0 });

// ç§»é™¤å¤šé¡¹
await fb2k.invoke('queue.remove', { indices: [0, 2, 4] });
```
</div>
</div>

### queue.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">queue.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ¸…ç©ºæ•´ä¸ªæ’­æ”¾é˜Ÿåˆ—ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true, "clearedCount": 5 }
```

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('queue.clear');
```
</div>
</div>

### queue.getCount

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">queue.getCount</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–é˜Ÿåˆ—é¡¹æ•°é‡ã€‚</div>

**è¿”å›å€¼**:
```json
{ "count": 3, "hasItems": true }
```
</div>
</div>

### queue.moveToTop

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">queue.moveToTop</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å°†é˜Ÿåˆ—ä¸­çš„æŒ‡å®šé¡¹ç§»åŠ¨åˆ°é˜Ÿé¦–ï¼ˆä¸‹ä¸€é¦–æ’­æ”¾ï¼‰ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| index | number | âœ… | è¦ç§»åŠ¨çš„é˜Ÿåˆ—ç´¢å¼• |

**ç¤ºä¾‹**:
```javascript
// å°†ç¬¬3é¡¹ç§»åˆ°é˜Ÿé¦–
await fb2k.invoke('queue.moveToTop', { index: 2 });
```
</div>
</div>

</section>

<!-- ==================== JIT QUEUE API ==================== -->
<section id="jit-queue-api">

## JIT Queue APIï¼ˆæµåª’ä½“å³æ—¶é˜Ÿåˆ—ï¼‰ğŸ†•

JIT Queueï¼ˆJust-In-Time Queueï¼‰æ˜¯ä¸“ä¸ºæµåª’ä½“è®¾è®¡çš„åŒå±‚é˜Ÿåˆ—æ¶æ„ã€‚ä¸åŸç”Ÿ Queue API ä¸åŒï¼ŒJIT Queue é‡‡ç”¨"å‰ç«¯è´Ÿè´£é€»è¾‘ï¼Œåç«¯è´Ÿè´£æ‰§è¡Œ"çš„æ¨¡å¼ï¼Œè§£å†³äº†æµåª’ä½“ URL æ—¶æ•ˆæ€§é—®é¢˜ã€‚

### æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Frontend (Web/Vue3)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  é€»è¾‘é˜Ÿåˆ— (Pinia Store)                                 â”‚  â”‚
â”‚  â”‚  - tracks: Track[] (å®Œæ•´å…ƒæ•°æ®ï¼Œ1000+ é¦–)               â”‚  â”‚
â”‚  â”‚  - playMode: 'list' | 'shuffle' | 'repeat'            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                          â†“ fb2k.call()                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    C++ Backend                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  QueueManager (å½±å­æ’­æ”¾åˆ—è¡¨)                           â”‚  â”‚
â”‚  â”‚  - åªç»´æŠ¤ 2-3 é¦–æ­Œçš„ç¼“å†²åŒº                              â”‚  â”‚
â”‚  â”‚  - URL å³æ—¶è§£æï¼Œæ°¸ä¸è¿‡æœŸ                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- **URL æ°¸ä¸è¿‡æœŸ**ï¼šæ¯é¦–æ­Œåœ¨æ’­æ”¾å‰æ‰è§£æ URL
- **å†…å­˜æä½**ï¼šåç«¯åªç»´æŠ¤ 2-3 é¦–æ­Œçš„ç¼“å†²åŒº
- **é€»è¾‘çµæ´»**ï¼šéšæœºã€å¾ªç¯ã€å¿ƒåŠ¨æ¨¡å¼å®Œå…¨ç”±å‰ç«¯æ§åˆ¶
- **æ— ç¼è¡”æ¥**ï¼šä¸‹ä¸€é¦–åœ¨å½“å‰æ­Œæ›²æ’­æ”¾æœŸé—´é¢„åŠ è½½

### jitQueue.playNow

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.playNow</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ç«‹å³æ’­æ”¾æŒ‡å®šæ›²ç›®ã€‚æ¸…ç©ºç¼“å†²åŒºå¹¶å¼€å§‹æ–°çš„æ’­æ”¾ä¼šè¯ã€‚<strong>v1.1.3+ï¼šåŒæ—¶æ”¯æŒ HTTP æµåª’ä½“ URL å’Œæœ¬åœ°æ–‡ä»¶è·¯å¾„ã€‚</strong></div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| trackId | string | âœ… | å‰ç«¯å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå¦‚ `netease_12345` æˆ– `local_xxx`ï¼‰ |
| title | string | âŒ | æ›²ç›®æ ‡é¢˜ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰ |
| url | string | âœ… | æµåª’ä½“ URL **æˆ–** æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼ˆè‡ªåŠ¨æ£€æµ‹ç±»å‹ï¼‰ |

**URL ç±»å‹è‡ªåŠ¨æ£€æµ‹**:
- `http://` æˆ– `https://` å¼€å¤´ â†’ æµåª’ä½“æ¨¡å¼ï¼ˆshadow playlistï¼‰
- Windows ç»å¯¹è·¯å¾„ï¼ˆå¦‚ `E:\Music\song.flac`ï¼‰â†’ æœ¬åœ°æ–‡ä»¶æ¨¡å¼
- UNC è·¯å¾„ï¼ˆå¦‚ `\\server\share\song.mp3`ï¼‰â†’ æœ¬åœ°æ–‡ä»¶æ¨¡å¼

**ç¤ºä¾‹**:
```javascript
// æµåª’ä½“ URL
const url = await fetchRealUrl(track.id);
const result = await fb2k.invoke('jitQueue.playNow', {
    trackId: 'netease_12345',
    title: 'è®©æˆ‘ç•™åœ¨ä½ èº«è¾¹',
    url: url  // http://...
});

// æœ¬åœ°æ–‡ä»¶è·¯å¾„ (v1.1.3+)
const result = await fb2k.invoke('jitQueue.playNow', {
    trackId: 'local_001',
    title: 'Song Title',
    url: 'E:\\Music\\song.flac'  // æœ¬åœ°è·¯å¾„
});
// { success: true, trackId: "...", shadowPlaylist: 5 }
```
</div>
</div>

### jitQueue.enqueueNext

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.enqueueNext</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é¢„åŠ è½½ä¸‹ä¸€é¦–æ›²ç›®åˆ°ç¼“å†²åŒºã€‚å“åº” `jitQueue:needNext` äº‹ä»¶æ—¶è°ƒç”¨ã€‚<strong>v1.1.3+ï¼šåŒæ—¶æ”¯æŒ HTTP æµåª’ä½“ URL å’Œæœ¬åœ°æ–‡ä»¶è·¯å¾„ã€‚</strong></div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| trackId | string | âœ… | å‰ç«¯å”¯ä¸€æ ‡è¯†ç¬¦ |
| title | string | âŒ | æ›²ç›®æ ‡é¢˜ |
| url | string | âœ… | æµåª’ä½“ URL **æˆ–** æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼ˆè‡ªåŠ¨æ£€æµ‹ç±»å‹ï¼‰ |

**ç¤ºä¾‹**:
```javascript
// å“åº” needNext äº‹ä»¶
fb2k.on('jitQueue:needNext', async ({ currentTrackId }) => {
    const nextTrack = getNextTrack(currentTrackId);
    if (nextTrack) {
        const url = await fetchRealUrl(nextTrack.id);
        await fb2k.invoke('jitQueue.enqueueNext', {
            trackId: nextTrack.id,
            title: nextTrack.title,
            url: url
        });
    }
});
```

**è¿”å›å€¼**:
```json
{ "success": true, "trackId": "netease_67890", "bufferSize": 2 }
```
</div>
</div>

### jitQueue.skip

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.skip</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·³åˆ°ç¼“å†²åŒºä¸­çš„ä¸‹ä¸€é¦–æ›²ç›®ã€‚</div>

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('jitQueue.skip');
// { success: true, currentTrackId: "netease_67890" }
```
</div>
</div>

### jitQueue.stop

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.stop</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åœæ­¢æ’­æ”¾å¹¶å¯é€‰æ¸…ç©ºç¼“å†²åŒºã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| clearBuffer | boolean | âŒ | æ˜¯å¦æ¸…ç©ºç¼“å†²åŒºï¼ˆé»˜è®¤ trueï¼‰ |

**ç¤ºä¾‹**:
```javascript
// åœæ­¢å¹¶æ¸…ç©º
await fb2k.invoke('jitQueue.stop');

// åœæ­¢ä½†ä¿ç•™ç¼“å†²åŒº
await fb2k.invoke('jitQueue.stop', { clearBuffer: false });
```
</div>
</div>

### jitQueue.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ¸…ç©ºå½±å­æ’­æ”¾åˆ—è¡¨ç¼“å†²åŒºã€‚</div>

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('jitQueue.clear');
// { success: true }
```
</div>
</div>

### jitQueue.getState

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method getter">GETTER</span>
        <span class="api-card-name">jitQueue.getState</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å– JIT é˜Ÿåˆ—çš„å½“å‰çŠ¶æ€ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "isActive": true,
    "currentTrackId": "netease_12345",
    "nextTrackId": "netease_67890",
    "bufferSize": 2,
    "shadowPlaylist": 5
}
```
</div>
</div>

### jitQueue.notifyEmpty

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">jitQueue.notifyEmpty</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">é€šçŸ¥åç«¯å‰ç«¯å·²æ— æ›´å¤šæ›²ç›®å¯æä¾›ã€‚å¯ç”¨äºè§¦å‘æ¨èç®—æ³•ã€‚</div>

**ç¤ºä¾‹**:
```javascript
fb2k.on('jitQueue:needNext', async ({ currentTrackId }) => {
    const nextTrack = getNextTrack(currentTrackId);
    if (!nextTrack) {
        // æ— æ›´å¤šæ›²ç›®ï¼Œé€šçŸ¥åç«¯
        await fb2k.invoke('jitQueue.notifyEmpty');
    }
});
```
</div>
</div>

### JIT Queue äº‹ä»¶

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">jitQueue:needNext</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">åç«¯è¯·æ±‚å‰ç«¯æä¾›ä¸‹ä¸€é¦–æ›²ç›®ã€‚åœ¨å½“å‰æ›²ç›®å¼€å§‹æ’­æ”¾æˆ–æ¥è¿‘ç»“æŸæ—¶è§¦å‘ã€‚</div>

```javascript
fb2k.on('jitQueue:needNext', async ({ currentTrackId }) => {
    console.log('Backend needs next track, current:', currentTrackId);
    
    // æ ¹æ®æ’­æ”¾æ¨¡å¼è®¡ç®—ä¸‹ä¸€é¦–
    const nextTrack = calculateNextTrack(currentTrackId, playMode);
    
    if (nextTrack) {
        const url = await fetchRealUrl(nextTrack.id);
        await fb2k.invoke('jitQueue.enqueueNext', {
            trackId: nextTrack.id,
            title: nextTrack.title,
            url: url
        });
    }
});
```

**äº‹ä»¶æ•°æ®**:
```json
{ "currentTrackId": "netease_12345" }
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">jitQueue:trackChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">JIT é˜Ÿåˆ—å½“å‰æ’­æ”¾æ›²ç›®å˜åŒ–æ—¶è§¦å‘ã€‚ç”¨äºæ›´æ–° UI é«˜äº®ã€‚</div>

```javascript
fb2k.on('jitQueue:trackChanged', ({ trackId, title }) => {
    console.log('Now playing:', trackId, title);
    highlightTrack(trackId);
});
```

**äº‹ä»¶æ•°æ®**:
```json
{ "trackId": "netease_12345", "title": "è®©æˆ‘ç•™åœ¨ä½ èº«è¾¹" }
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">jitQueue:listExhausted</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ç¼“å†²åŒºè€—å°½ä¸”æ²¡æœ‰æ›´å¤šæ›²ç›®æ—¶è§¦å‘ã€‚å¯ç”¨äºæ‹‰å–æ¨èæ­Œæ›²ã€‚</div>

```javascript
fb2k.on('jitQueue:listExhausted', async ({ lastTrackId }) => {
    console.log('Queue exhausted, last track was:', lastTrackId);
    
    // è·å–æ¨èæ­Œæ›²
    const recommendations = await fetchRecommendations(lastTrackId);
    addToLogicalQueue(recommendations);
});
```

**äº‹ä»¶æ•°æ®**:
```json
{ "lastTrackId": "netease_12345" }
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">jitQueue:error</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">URL è§£æå¤±è´¥æˆ–å…¶ä»–é”™è¯¯æ—¶è§¦å‘ã€‚</div>

```javascript
fb2k.on('jitQueue:error', ({ trackId, error, url }) => {
    console.error('Failed to play:', trackId, error);
    showErrorToast(`æ’­æ”¾å¤±è´¥: ${error}`);
});
```

**äº‹ä»¶æ•°æ®**:
```json
{
    "trackId": "netease_12345",
    "error": "Failed to resolve URL",
    "url": "https://..."
}
```
</div>
</div>

### å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

```javascript
// stores/jitQueue.ts
import { defineStore } from 'pinia';

export const useJitQueueStore = defineStore('jitQueue', {
    state: () => ({
        tracks: [],           // å®Œæ•´çš„é€»è¾‘é˜Ÿåˆ—
        currentIndex: -1,
        playMode: 'list'      // 'list' | 'shuffle' | 'repeat'
    }),

    actions: {
        // æ’­æ”¾æŒ‡å®šæ›²ç›®
        async play(index) {
            this.currentIndex = index;
            const track = this.tracks[index];
            
            // è·å–çœŸå® URLï¼ˆè°ƒç”¨æµåª’ä½“å¹³å° APIï¼‰
            const url = await fetchRealUrl(track.id);
            
            // å‘é€ç»™ C++ ç«‹å³æ’­æ”¾
            await fb2k.invoke('jitQueue.playNow', {
                trackId: track.id,
                title: track.title,
                url: url
            });
        },

        // è®¡ç®—ä¸‹ä¸€é¦–
        getNextTrack(currentId) {
            const currentIdx = this.tracks.findIndex(t => t.id === currentId);
            if (currentIdx === -1) return null;

            let nextIdx;
            switch (this.playMode) {
                case 'shuffle':
                    nextIdx = Math.floor(Math.random() * this.tracks.length);
                    break;
                case 'repeat':
                    nextIdx = currentIdx;
                    break;
                default:
                    nextIdx = currentIdx + 1;
            }

            return nextIdx < this.tracks.length ? this.tracks[nextIdx] : null;
        }
    }
});

// App.vue - å…¨å±€äº‹ä»¶ç›‘å¬
const jitQueueStore = useJitQueueStore();

fb2k.on('jitQueue:needNext', async ({ currentTrackId }) => {
    const nextTrack = jitQueueStore.getNextTrack(currentTrackId);
    
    if (nextTrack) {
        const url = await fetchRealUrl(nextTrack.id);
        await fb2k.invoke('jitQueue.enqueueNext', {
            trackId: nextTrack.id,
            title: nextTrack.title,
            url: url
        });
    } else {
        await fb2k.invoke('jitQueue.notifyEmpty');
    }
});

fb2k.on('jitQueue:trackChanged', ({ trackId }) => {
    jitQueueStore.currentIndex = jitQueueStore.tracks.findIndex(t => t.id === trackId);
});

fb2k.on('jitQueue:listExhausted', async ({ lastTrackId }) => {
    // å¿ƒåŠ¨æ¨¡å¼ï¼šè‡ªåŠ¨æ‹‰å–æ¨è
    const recommendations = await fetchRecommendations(lastTrackId);
    jitQueueStore.tracks.push(...recommendations);
});
```

</section>

<!-- ==================== DISCOVERY API ==================== -->
<section id="discovery-api">

## Discovery API (ä¸»åŠ¨æœåŠ¡å‘ç°) ğŸ†•

> **çŠ¶æ€**: 11 ä¸ª API å·²å®ç°  
> **ç‰ˆæœ¬**: 1.1.3+

ä¸»åŠ¨å‘ç° foobar2000 ä¸­å…¶ä»–ç»„ä»¶æ³¨å†Œçš„æœåŠ¡ï¼ŒåŒ…æ‹¬ä¸»èœå•å‘½ä»¤ã€è¾“å…¥æ ¼å¼ã€DSPã€UIå…ƒç´ ç­‰ã€‚ä¸ PluginRegistry çš„è¢«åŠ¨æ³¨å†Œæ¨¡å¼ä¸åŒï¼ŒDiscovery API ä¸»åŠ¨æšä¸¾ç³»ç»Ÿä¸­æ‰€æœ‰å·²æ³¨å†Œçš„æœåŠ¡ã€‚

---

### discovery.getAllServices

è·å–æ‰€æœ‰å¯å‘ç°æœåŠ¡çš„ç»Ÿè®¡æ‘˜è¦ã€‚

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getAllServices</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è¿”å›å„ç±»æœåŠ¡çš„æ•°é‡ç»Ÿè®¡ï¼Œå¯ç”¨äºäº†è§£ foobar2000 å½“å‰åŠ è½½çš„ç»„ä»¶å’ŒåŠŸèƒ½è§„æ¨¡ã€‚</div>
        <p><strong>è¯·æ±‚</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getAllServices', {});</code></pre>
        <p><strong>å“åº”</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "services": {
        "mainMenuCommands": 156,
        "mainMenuGroups": 42,
        "inputFormats": 30,
        "uiElements": 25,
        "dspEntries": 18,
        "outputDevices": 5,
        "preferencePages": 35,
        "components": 32
    },
    "totalServices": 324
}</code></pre>
    </div>
</div>

---

### discovery.getComponents

è·å–æ‰€æœ‰å·²å®‰è£…ç»„ä»¶çš„ä¿¡æ¯ã€‚

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getComponents</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æšä¸¾ foobar2000 ä¸­æ‰€æœ‰å·²å®‰è£…çš„ç»„ä»¶ï¼ŒåŒ…æ‹¬æ’ä»¶åç§°ã€ç‰ˆæœ¬å’Œç®€ä»‹ã€‚</div>
        <p><strong>è¯·æ±‚</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getComponents', {});</code></pre>
        <p><strong>å“åº”</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 32,
    "components": [
        {
            "filename": "foo_ui_webview2.dll",
            "name": "WebView UI",
            "version": "1.1.3",
            "about": "Modern WebView2-based UI for foobar2000"
        },
        {
            "filename": "foo_input_sacd.dll",
            "name": "SACD Decoder",
            "version": "1.2.0",
            "about": "Super Audio CD decoder"
        },
        {
            "filename": "ESLyric.dll",
            "name": "ESLyric",
            "version": "0.5.4",
            "about": "Enhanced lyrics display and search"
        }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getMainMenuCommands

è·å–æ‰€æœ‰ä¸»èœå•å‘½ä»¤ï¼ˆæ¥è‡ªæ‰€æœ‰ç»„ä»¶ï¼‰ã€‚

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getMainMenuCommands</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æšä¸¾ foobar2000 ä¸»èœå•ä¸­çš„æ‰€æœ‰å‘½ä»¤ï¼ŒåŒ…æ‹¬å…¶ä»–ç»„ä»¶æ³¨å†Œçš„å‘½ä»¤ã€‚</div>
        <p><strong>è¯·æ±‚</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getMainMenuCommands', {});</code></pre>
        <p><strong>å“åº”</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 156,
    "commands": [
        {
            "name": "Play",
            "description": "Start playback",
            "guid": "{A7A5E4F1-...}",
            "parentGuid": "{00000000-...}",
            "index": 0
        },
        {
            "name": "Search Lyrics",
            "description": "Search lyrics for current track",
            "guid": "{B8C6D7E2-...}",
            "parentGuid": "{ESLyric-GUID}",
            "index": 0
        }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.executeMainMenuCommand

é€šè¿‡ GUID æ‰§è¡Œä¸»èœå•å‘½ä»¤ã€‚

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method post">POST</span>
        <span class="api-card-name">discovery.executeMainMenuCommand</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ‰§è¡Œä»»æ„ä¸»èœå•å‘½ä»¤ï¼Œå¯ç”¨äºè°ƒç”¨å…¶ä»–ç»„ä»¶æä¾›çš„åŠŸèƒ½ã€‚</div>
        <p><strong>è¯·æ±‚</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.executeMainMenuCommand', {
    guid: '{A7A5E4F1-1234-5678-9ABC-DEF012345678}'
});</code></pre>
        <p><strong>å“åº”</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "guid": "{A7A5E4F1-1234-5678-9ABC-DEF012345678}"
}</code></pre>
        <p><strong>ç¤ºä¾‹ - æœç´¢æ­Œè¯</strong>:</p>
        <pre><code class="language-javascript">// å…ˆæœç´¢æ­Œè¯å‘½ä»¤
const result = await fb2k.invoke('discovery.searchCommands', { query: 'lyric' });
const lyricCommand = result.results[0];

// æ‰§è¡Œè¯¥å‘½ä»¤
if (lyricCommand) {
    await fb2k.invoke('discovery.executeMainMenuCommand', { 
        guid: lyricCommand.guid 
    });
}</code></pre>
    </div>
</div>

---

### discovery.searchCommands

æŒ‰åç§°/æè¿°æœç´¢èœå•å‘½ä»¤ã€‚

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.searchCommands</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ¨¡ç³Šæœç´¢ä¸»èœå•å‘½ä»¤ï¼Œæ”¯æŒæŒ‰åç§°æˆ–æè¿°åŒ¹é…ã€‚</div>
        <p><strong>è¯·æ±‚</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.searchCommands', {
    query: 'lyric'  // æœç´¢å…³é”®è¯ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
});</code></pre>
        <p><strong>å“åº”</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "query": "lyric",
    "count": 3,
    "results": [
        {
            "name": "Search Lyrics",
            "description": "Search lyrics online",
            "guid": "{...}",
            "type": "mainmenu"
        },
        {
            "name": "Save Lyrics",
            "description": "Save lyrics to file",
            "guid": "{...}",
            "type": "mainmenu"
        }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getInputFormats

è·å–æ”¯æŒçš„éŸ³é¢‘è¾“å…¥æ ¼å¼ã€‚

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getInputFormats</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æšä¸¾ foobar2000 æ”¯æŒçš„æ‰€æœ‰éŸ³é¢‘æ ¼å¼ï¼ŒåŒ…æ‹¬ç¬¬ä¸‰æ–¹è§£ç å™¨æä¾›çš„æ ¼å¼ã€‚</div>
        <p><strong>è¯·æ±‚</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getInputFormats', {});</code></pre>
        <p><strong>å“åº”</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 30,
    "fileTypes": [
        { "name": "FLAC Audio", "mask": "*.flac", "index": 0 },
        { "name": "MP3 Audio", "mask": "*.mp3", "index": 1 },
        { "name": "SACD ISO", "mask": "*.iso", "index": 2 },
        { "name": "DSD Audio", "mask": "*.dsf;*.dff", "index": 3 }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getMainMenuGroups

è·å–ä¸»èœå•ç»„ç»“æ„ã€‚

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getMainMenuGroups</span>
    </div>
    <div class="api-card-body">
        <p><strong>è¯·æ±‚</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getMainMenuGroups', {});</code></pre>
        <p><strong>å“åº”</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 42,
    "groups": [
        { "guid": "{...}", "parentGuid": "{...}", "name": "File", "sortPriority": 0 },
        { "guid": "{...}", "parentGuid": "{...}", "name": "View", "sortPriority": 1 }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getUIElements

è·å– UI å…ƒç´ åˆ—è¡¨ã€‚

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getUIElements</span>
    </div>
    <div class="api-card-body">
        <p><strong>è¯·æ±‚</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getUIElements', {});</code></pre>
        <p><strong>å“åº”</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 25,
    "elements": [
        {
            "guid": "{...}",
            "subclassGuid": "{...}",
            "name": "Playlist View",
            "description": "Standard playlist viewer",
            "isUserAddable": true
        }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getDspEntries

è·å– DSP å¤„ç†å™¨åˆ—è¡¨ã€‚

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getDspEntries</span>
    </div>
    <div class="api-card-body">
        <p><strong>è¯·æ±‚</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getDspEntries', {});</code></pre>
        <p><strong>å“åº”</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 18,
    "entries": [
        { "guid": "{...}", "name": "Resampler (PPHS)" },
        { "guid": "{...}", "name": "Equalizer" },
        { "guid": "{...}", "name": "ReplayGain" }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getOutputDevices

è·å–è¾“å‡ºè®¾å¤‡åˆ—è¡¨ã€‚

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getOutputDevices</span>
    </div>
    <div class="api-card-body">
        <p><strong>è¯·æ±‚</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getOutputDevices', {});</code></pre>
        <p><strong>å“åº”</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 5,
    "devices": [
        { "guid": "{...}" },
        { "guid": "{...}" }
    ]
}</code></pre>
    </div>
</div>

---

### discovery.getPreferencePages

è·å–åå¥½è®¾ç½®é¡µé¢åˆ—è¡¨ã€‚

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">discovery.getPreferencePages</span>
    </div>
    <div class="api-card-body">
        <p><strong>è¯·æ±‚</strong>:</p>
        <pre><code class="language-javascript">await fb2k.invoke('discovery.getPreferencePages', {});</code></pre>
        <p><strong>å“åº”</strong>:</p>
        <pre><code class="language-json">{
    "success": true,
    "count": 35,
    "pages": [
        { "guid": "{...}", "parentGuid": "{...}", "name": "Playback" },
        { "guid": "{...}", "parentGuid": "{...}", "name": "Output" },
        { "guid": "{...}", "parentGuid": "{...}", "name": "WebView UI" }
    ]
}</code></pre>
    </div>
</div>

</section>

<!-- ==================== DSP API ==================== -->
<section id="dsp-api">

## DSP API - æ•ˆæœå™¨ç®¡ç† (8) ğŸ†•

DSP (æ•°å­—ä¿¡å·å¤„ç†) æ•ˆæœå™¨é“¾ç®¡ç†ã€‚

### dsp.getPresets

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">dsp.getPresets</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ‰€æœ‰ DSP é¢„è®¾åˆ—è¡¨ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "success": true,
    "presets": [
        { "index": 0, "name": "Flat" },
        { "index": 1, "name": "Loudness" }
    ]
}
```
    </div>
</div>

### dsp.getActivePreset

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">dsp.getActivePreset</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰æ¿€æ´»çš„ DSP é¢„è®¾ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true, "index": 0, "name": "Flat" }
```
    </div>
</div>

### dsp.setActivePreset

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dsp.setActivePreset</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½®æ¿€æ´»çš„ DSP é¢„è®¾ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| index | number | âœ… | é¢„è®¾ç´¢å¼• |
    </div>
</div>

### dsp.getChain

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">dsp.getChain</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰ DSP æ•ˆæœå™¨é“¾ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "success": true,
    "chain": [
        { "guid": "{...}", "name": "Equalizer", "index": 0 },
        { "guid": "{...}", "name": "Compressor", "index": 1 }
    ]
}
```
    </div>
</div>

### dsp.setChain

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dsp.setChain</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½® DSP æ•ˆæœå™¨é“¾ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| chain | array | âœ… | DSP é…ç½®æ•°ç»„ |
    </div>
</div>

### dsp.addDsp / dsp.removeDsp / dsp.moveDsp

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">dsp.addDsp / removeDsp / moveDsp</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ·»åŠ ã€ç§»é™¤æˆ–ç§»åŠ¨ DSP æ•ˆæœå™¨ã€‚</div>

**ç¤ºä¾‹**:
```javascript
// æ·»åŠ  DSP
await fb2k.invoke('dsp.addDsp', { guid: '{...}' });

// ç§»é™¤ DSP
await fb2k.invoke('dsp.removeDsp', { index: 0 });

// ç§»åŠ¨ DSP
await fb2k.invoke('dsp.moveDsp', { fromIndex: 0, toIndex: 1 });
```
    </div>
</div>

</section>

<!-- ==================== OUTPUT API ==================== -->
<section id="output-api">

## Output API - éŸ³é¢‘è¾“å‡º (3) ğŸ†•

éŸ³é¢‘è¾“å‡ºè®¾å¤‡ç®¡ç†ã€‚

### output.getDevices

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">output.getDevices</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ‰€æœ‰å¯ç”¨çš„éŸ³é¢‘è¾“å‡ºè®¾å¤‡ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "success": true,
    "devices": [
        { "name": "WASAPI: Speakers", "id": "{...}", "isCurrent": true },
        { "name": "DirectSound: Headphones", "id": "{...}", "isCurrent": false }
    ]
}
```
    </div>
</div>

### output.getSettings

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">output.getSettings</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰è¾“å‡ºè®¾ç½®ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "success": true,
    "outputId": "{...}",
    "deviceId": "{...}",
    "bufferLength": 1.0,
    "bitDepth": 16
}
```
    </div>
</div>

### output.getEntries

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">output.getEntries</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–è¾“å‡ºæ¨¡å—åˆ—è¡¨ï¼ˆWASAPI, DirectSound ç­‰ï¼‰ã€‚</div>
    </div>
</div>

</section>

<!-- ==================== REPLAYGAIN API ==================== -->
<section id="replaygain-api">

## ReplayGain API (5) ğŸ†•

ReplayGain éŸ³é‡æ ‡å‡†åŒ–è®¾ç½®ã€‚

### replaygain.getSettings

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">replaygain.getSettings</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å– ReplayGain è®¾ç½®ã€‚</div>

**è¿”å›å€¼**:
```json
{
    "success": true,
    "mode": "track",
    "preamp": 0.0,
    "preampWithRg": 0.0
}
```
    </div>
</div>

### replaygain.getMode

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">replaygain.getMode</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–å½“å‰ ReplayGain æ¨¡å¼ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": true, "mode": "track" }  // "none", "track", "album"
```
    </div>
</div>

### replaygain.setMode

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">replaygain.setMode</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è®¾ç½® ReplayGain æ¨¡å¼ã€‚</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| mode | string | âœ… | "none", "track", "album" |
    </div>
</div>

### replaygain.getPreamp / setPreamp

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">replaygain.getPreamp / setPreamp</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æˆ–è®¾ç½®å‰ç½®æ”¾å¤§å¢ç›Š (dB)ã€‚</div>

**å‚æ•° (setPreamp)**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| preamp | number | âœ… | å¢ç›Šå€¼ (dB) |

**ç¤ºä¾‹**:
```javascript
// è·å–å‰ç½®æ”¾å¤§
const result = await fb2k.invoke('replaygain.getPreamp', {});
console.log(result.preamp); // 0.0

// è®¾ç½®å‰ç½®æ”¾å¤§
await fb2k.invoke('replaygain.setPreamp', { preamp: 3.0 });
```
    </div>
</div>

### replaygain.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">replaygain.get</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ–‡ä»¶çš„ ReplayGain ä¿¡æ¯ï¼ˆtrackGain, trackPeak, albumGain, albumPeakï¼‰ã€‚ğŸ†• v1.1.12</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| paths | string[] | âœ… | æ–‡ä»¶è·¯å¾„æ•°ç»„ |

**è¿”å›å€¼**:
```json
{
  "success": true,
  "count": 1,
  "results": [
    {
      "path": "E:\\Music\\track.flac",
      "success": true,
      "hasReplayGain": true,
      "trackGain": "-6.50 dB",
      "trackGainRaw": -6.5,
      "trackPeak": "0.988000",
      "trackPeakRaw": 0.988,
      "albumGain": "-6.25 dB",
      "albumGainRaw": -6.25,
      "albumPeak": "0.995000",
      "albumPeakRaw": 0.995
    }
  ]
}
```

**ç¤ºä¾‹**:
```javascript
const rg = await fb2k.invoke('replaygain.get', {
  paths: ["E:\\Music\\track1.flac", "E:\\Music\\track2.flac"]
});
console.log(rg.results[0].trackGain); // "-6.50 dB"
```
    </div>
</div>

### replaygain.scan

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">replaygain.scan</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è§¦å‘ ReplayGain æ‰«æã€‚é€šè¿‡è°ƒç”¨ foobar2000 ä¸Šä¸‹æ–‡èœå•å®ç°ã€‚ğŸ†• v1.1.12</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| paths | string[] | âœ… | æ–‡ä»¶è·¯å¾„æ•°ç»„ |
| mode | string | âŒ | æ‰«ææ¨¡å¼: "track" (é»˜è®¤) æˆ– "album" |

**è¿”å›å€¼**:
```json
{ "success": true }
```

**ç¤ºä¾‹**:
```javascript
// æ‰«æå•ä¸ªæ–‡ä»¶ (track æ¨¡å¼)
await fb2k.invoke('replaygain.scan', {
  paths: ["E:\\Music\\track.flac"],
  mode: "track"
});

// æ‰«æä¸“è¾‘
await fb2k.invoke('replaygain.scan', {
  paths: ["E:\\Music\\album\\*.flac"],
  mode: "album"
});
```

> âš ï¸ **æ³¨æ„**: æ­¤ API ä¼šæ‰“å¼€ foobar2000 çš„ ReplayGain æ‰«æå¯¹è¯æ¡†ã€‚

    </div>
</div>

### replaygain.clear

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method action">ACTION</span>
        <span class="api-card-name">replaygain.clear</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ¸…é™¤æ–‡ä»¶çš„ ReplayGain ä¿¡æ¯ã€‚ğŸ†• v1.1.12</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| paths | string[] | âœ… | æ–‡ä»¶è·¯å¾„æ•°ç»„ |

**è¿”å›å€¼**:
```json
{ "success": true, "clearedCount": 2 }
```

**ç¤ºä¾‹**:
```javascript
await fb2k.invoke('replaygain.clear', {
  paths: ["E:\\Music\\track1.flac", "E:\\Music\\track2.flac"]
});
```
    </div>
</div>

</section>

<!-- ==================== PLAYCOUNT API ==================== -->
<section id="playcount-api">

## Playcount API - æ’­æ”¾ç»Ÿè®¡ (4)

è·å– foo_playcount ç»„ä»¶æä¾›çš„æ’­æ”¾ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ’­æ”¾æ¬¡æ•°ã€é¦–æ¬¡æ’­æ”¾æ—¶é—´ã€æœ€åæ’­æ”¾æ—¶é—´ã€æ·»åŠ æ—¶é—´ç­‰ã€‚

> âš ï¸ **ä¾èµ–**: éœ€è¦å®‰è£… foo_playcount ç»„ä»¶ã€‚

### playcount.get

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playcount.get</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–æ–‡ä»¶çš„æ’­æ”¾ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ¥è‡ª foo_playcountï¼‰ã€‚ğŸ†• v1.1.12</div>

**å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | æè¿° |
|------|------|------|------|
| paths | string[] | âœ… | æ–‡ä»¶è·¯å¾„æ•°ç»„ |

**è¿”å›å€¼**:
```json
{
  "success": true,
  "count": 1,
  "results": [
    {
      "path": "E:\\Music\\track.flac",
      "success": true,
      "playCount": 15,
      "rating": 4,
      "firstPlayed": "2023-01-15 10:30:00",
      "lastPlayed": "2024-01-10 15:45:00",
      "added": "2022-08-20 14:00:00",
      "inLibrary": true
    }
  ]
}
```

**ç¤ºä¾‹**:
```javascript
const result = await fb2k.invoke('playcount.get', {
  paths: ["E:\\Music\\track1.flac", "E:\\Music\\track2.flac"]
});
console.log(result.results[0].playCount); // 15
console.log(result.results[0].lastPlayed); // "2024-01-10 15:45:00"
```
    </div>
</div>

### playcount.getBatch

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playcount.getBatch</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ‰¹é‡è·å–æ’­æ”¾ç»Ÿè®¡ï¼ˆä¸ get ç›¸åŒï¼Œä¸º API ä¸€è‡´æ€§æä¾›ï¼‰ã€‚ğŸ†• v1.1.12</div>

**å‚æ•°**: åŒ `playcount.get`

    </div>
</div>

### playcount.getStats

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">GET</span>
        <span class="api-card-name">playcount.getStats</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">è·å–åª’ä½“åº“æ•´ä½“æ’­æ”¾ç»Ÿè®¡ã€‚ğŸ†• v1.1.12</div>

**è¿”å›å€¼**:
```json
{
  "success": true,
  "totalTracks": 5000,
  "playedTracks": 3200,
  "unplayedTracks": 1800,
  "ratedTracks": 500,
  "totalPlayCount": 45000,
  "maxPlayCount": 150,
  "averagePlayCount": 14.0625,
  "averageRating": 4.2
}
```

**ç¤ºä¾‹**:
```javascript
const stats = await fb2k.invoke('playcount.getStats', {});
console.log(`å·²æ’­æ”¾ ${stats.playedTracks}/${stats.totalTracks} é¦–`);
console.log(`å¹³å‡æ’­æ”¾æ¬¡æ•°: ${stats.averagePlayCount.toFixed(1)}`);
```
    </div>
</div>

### playcount.set

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #f85149;">DISABLED</span>
        <span class="api-card-name">playcount.set</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å ä½ç¬¦ APIã€‚foo_playcount ä¸æ”¯æŒç›´æ¥ä¿®æ”¹æ’­æ”¾æ¬¡æ•°ï¼Œè¯·ä½¿ç”¨ `rating.set` è®¾ç½®è¯„åˆ†ã€‚</div>

**è¿”å›å€¼**:
```json
{ "success": false, "error": "Direct playcount modification not supported. Use rating.set for ratings." }
```
    </div>
</div>

</section>

<!-- ==================== EVENTS ==================== -->
<section id="events">

## äº‹ä»¶ç³»ç»Ÿ

æ’ä»¶ä¼šæ¨é€å®æ—¶äº‹ä»¶åˆ°å‰ç«¯ï¼Œä½¿ç”¨ `fb2k.on()` è®¢é˜…äº‹ä»¶ã€‚

### æ’­æ”¾äº‹ä»¶

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playback:trackChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å½“å‰æ›²ç›®æ”¹å˜æ—¶è§¦å‘ã€‚ğŸ†• v1.1.2 å¢åŠ  id å’Œ absolutePath å­—æ®µ</div>

```javascript
fb2k.on('playback:trackChanged', (data) => {
    console.log('Track ID:', data.id);  // å”¯ä¸€æ ‡è¯†ï¼ˆä¼˜å…ˆä½¿ç”¨ absolutePathï¼‰
    console.log('New track:', data.title, '-', data.artist);
    updateUI(data);
});
```

**äº‹ä»¶æ•°æ®**:
```json
{
    "id": "E:\\Music\\Album\\song.flac",   // ğŸ†• å”¯ä¸€æ ‡è¯†ï¼ˆç»å¯¹è·¯å¾„ï¼‰
    "title": "Let It Be",
    "artist": "The Beatles",
    "album": "Let It Be",
    "duration": 243.5,
    "path": "file-relative://../../song.flac",  // åŸå§‹ foobar è·¯å¾„
    "absolutePath": "E:\\Music\\Album\\song.flac"  // ğŸ†• ç»å¯¹è·¯å¾„
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playback:stateChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ’­æ”¾çŠ¶æ€æ”¹å˜æ—¶è§¦å‘ï¼ˆæ’­æ”¾ã€æš‚åœã€åœæ­¢ï¼‰ã€‚ğŸ†• v1.1.2 å¢å¼º</div>

```javascript
fb2k.on('playback:stateChanged', (data) => {
    console.log('State:', data.state); // "playing", "paused", "stopped"
    console.log('Position:', data.position);
    console.log('Duration:', data.duration);
    updatePlayPauseButton(data.state);
});
```

**äº‹ä»¶æ•°æ®**:
```json
{
    "state": "playing",   // "playing", "paused", "stopped"
    "position": 45.2,     // å½“å‰æ’­æ”¾ä½ç½®ï¼ˆç§’ï¼‰
    "duration": 300.0     // æ€»æ—¶é•¿ï¼ˆç§’ï¼‰
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playback:time</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ’­æ”¾ä½ç½®æ”¹å˜æ—¶è§¦å‘ï¼ˆçº¦æ¯ 0.5 ç§’ä¸€æ¬¡ï¼‰ã€‚</div>

```javascript
fb2k.on('playback:time', (data) => {
    updateProgressBar(data.position);
});
```

**äº‹ä»¶æ•°æ®**:
```json
{
    "position": 45.2
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playback:volumeChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">éŸ³é‡æ”¹å˜æ—¶è§¦å‘ã€‚</div>

```javascript
fb2k.on('playback:volumeChanged', (data) => {
    updateVolumeSlider(data.volume);
});
```

**äº‹ä»¶æ•°æ®**:
```json
{
    "volume": 75,
    "volumeDb": -25.0,
    "muted": false
}
```
</div>
</div>

### çª—å£äº‹ä»¶

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">window:stateChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">çª—å£çŠ¶æ€æ”¹å˜æ—¶è§¦å‘ï¼ˆæœ€å¤§åŒ–/è¿˜åŸ/æœ€å°åŒ–ï¼‰ã€‚ç”¨äºæ›´æ–°è‡ªå®šä¹‰æ ‡é¢˜æ æŒ‰é’®å›¾æ ‡ã€‚</div>

```javascript
fb2k.on('window:stateChanged', (data) => {
    const maxBtn = document.getElementById('btn-max');
    if (data.isMaximized) {
        maxBtn.innerHTML = '&#xE923;'; // è¿˜åŸå›¾æ ‡
        maxBtn.title = 'Restore';
    } else {
        maxBtn.innerHTML = '&#xE922;'; // æœ€å¤§åŒ–å›¾æ ‡
        maxBtn.title = 'Maximize';
    }
});
```

**äº‹ä»¶æ•°æ®**:
```json
{
    "isMaximized": true,
    "isMinimized": false
}
```
</div>
</div>

### æ’­æ”¾åˆ—è¡¨äº‹ä»¶

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playlist.changed</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ’­æ”¾åˆ—è¡¨å†…å®¹æ”¹å˜æ—¶è§¦å‘ã€‚</div>

```javascript
fb2k.on('playlist.changed', (data) => {
    if (data.playlist === currentPlaylist) {
        refreshPlaylistView();
    }
});
```

**äº‹ä»¶æ•°æ®**:
```json
{
    "playlist": 0,
    "changeType": "items_added",  // "items_added", "items_removed", "reordered", "cleared"
    "trackCount": 151
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">playlist.activeChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">æ¿€æ´»çš„æ’­æ”¾åˆ—è¡¨æ”¹å˜æ—¶è§¦å‘ã€‚</div>

```javascript
fb2k.on('playlist.activeChanged', (data) => {
    switchToPlaylist(data.playlist);
});
```
</div>
</div>

### HTTP äº‹ä»¶ï¼ˆå¼‚æ­¥æ¨¡å¼ï¼‰

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">http:response</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¼‚æ­¥ HTTP è¯·æ±‚å®Œæˆæ—¶è§¦å‘ã€‚ä»…å½“ä½¿ç”¨ `async: true` å‚æ•°è°ƒç”¨ `http.get`, `http.post`, `http.head` æ—¶ï¼Œç»“æœé€šè¿‡æ­¤äº‹ä»¶è¿”å›ã€‚</div>

```javascript
// ç›‘å¬å¼‚æ­¥å“åº”
fb2k.on('http:response', (data) => {
    console.log(`Request ${data.requestId} completed`);
    if (data.success) {
        console.log('Status:', data.status);
        console.log('Body:', data.body);
    } else {
        console.error('Error:', data.error);
    }
});

// å‘èµ·å¼‚æ­¥è¯·æ±‚ï¼ˆå¿…é¡»è®¾ç½® async: trueï¼‰
const result = await fb2k.invoke('http.get', { 
    url: 'https://api.example.com/data',
    async: true  // å¯ç”¨å¼‚æ­¥æ¨¡å¼
});
console.log('Request started, ID:', result.requestId);  // "http_1"
```

**äº‹ä»¶æ•°æ®ï¼ˆæˆåŠŸï¼‰**:
```json
{
    "requestId": "http_1",
    "success": true,
    "status": 200,
    "body": "{\"data\": \"...\"}",
    "headers": {
        "Content-Type": "application/json",
        "Content-Length": "1234"
    }
}
```

**äº‹ä»¶æ•°æ®ï¼ˆå¤±è´¥ï¼‰**:
```json
{
    "requestId": "http_1",
    "success": false,
    "error": "Connection timeout"
}
```

> ğŸ’¡ **æç¤º**: ä½¿ç”¨ `requestId` åŒ¹é…è¯·æ±‚å’Œå“åº”ï¼Œæ”¯æŒå¹¶å‘å¤šä¸ªå¼‚æ­¥è¯·æ±‚ã€‚
</div>
</div>

### æ’ä»¶äº‹ä»¶

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">plugin:registered</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¤–éƒ¨æ’ä»¶æ³¨å†Œæ—¶è§¦å‘ã€‚</div>

```javascript
fb2k.on('plugin:registered', (data) => {
    console.log(`æ–°æ’ä»¶å·²æ³¨å†Œ: ${data.name} v${data.version}`);
    // å¯ä»¥åˆ·æ–° API åˆ—è¡¨æˆ–å¯ç”¨ç›¸å…³åŠŸèƒ½
});
```

**äº‹ä»¶æ•°æ®**:
```json
{
    "id": "my_plugin",
    "name": "My Plugin",
    "version": "1.0.0",
    "author": "Author Name",
    "description": "Plugin description"
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">plugin:unregistered</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¤–éƒ¨æ’ä»¶æ³¨é”€æ—¶è§¦å‘ã€‚</div>

```javascript
fb2k.on('plugin:unregistered', (data) => {
    console.log(`æ’ä»¶å·²æ³¨é”€: ${data.id}`);
    // ç¦ç”¨ç›¸å…³åŠŸèƒ½
});
```

**äº‹ä»¶æ•°æ®**:
```json
{
    "id": "my_plugin"
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">api:registered</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¤–éƒ¨ API æ³¨å†Œæ—¶è§¦å‘ã€‚</div>

```javascript
fb2k.on('api:registered', (data) => {
    console.log(`æ–° API å·²æ³¨å†Œ: ${data.method}`);
});
```

**äº‹ä»¶æ•°æ®**:
```json
{
    "method": "my_plugin.doSomething",
    "namespace": "my_plugin",
    "description": "æ‰§è¡ŒæŸæ“ä½œ"
}
```
</div>
</div>

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">api:unregistered</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">å¤–éƒ¨ API æ³¨é”€æ—¶è§¦å‘ã€‚</div>

```javascript
fb2k.on('api:unregistered', (data) => {
    console.log(`API å·²æ³¨é”€: ${data.method}`);
});
```

**äº‹ä»¶æ•°æ®**:
```json
{
    "method": "my_plugin.doSomething"
}
```
</div>
</div>

### çª—å£äº‹ä»¶

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method event">EVENT</span>
        <span class="api-card-name">window:stateChanged</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">çª—å£çŠ¶æ€æ”¹å˜æ—¶è§¦å‘ã€‚</div>

```javascript
fb2k.on('window:stateChanged', (data) => {
    if (data.isMaximized) {
        hideMaximizeButton();
    } else {
        showMaximizeButton();
    }
});
```
</div>
</div>

### äº‹ä»¶ç®¡ç†

```javascript
// è®¢é˜…äº‹ä»¶
const unsubscribe = fb2k.on('playback:trackChanged', handler);

// å–æ¶ˆè®¢é˜…
unsubscribe();

// æˆ–ä½¿ç”¨ off
fb2k.off('playback:trackChanged', handler);

// ä¸€æ¬¡æ€§äº‹ä»¶
fb2k.once('playback:trackChanged', (data) => {
    console.log('First track change:', data.title);
});
```

</section>

<!-- ==================== SECURITY ==================== -->
<section id="security">

## ğŸ”’ å®‰å…¨é™åˆ¶

ä¸ºä¿æŠ¤ç”¨æˆ·ç³»ç»Ÿå®‰å…¨ï¼Œä»¥ä¸‹ API æœ‰å®‰å…¨é™åˆ¶ã€‚å¼€å‘è€…åœ¨ä½¿ç”¨æ—¶éœ€æ³¨æ„è¿™äº›é™åˆ¶ã€‚

### é™åˆ¶æ¦‚è§ˆ

| API | é™åˆ¶ç±»å‹ | è¯´æ˜ |
|-----|----------|------|
| `shell.exec` | â›” **å·²ç¦ç”¨** | ä»»æ„å‘½ä»¤æ‰§è¡Œé£é™©è¿‡é«˜ï¼Œå·²å®Œå…¨ç§»é™¤ |
| `shell.openWith` | ğŸš« å¯æ‰§è¡Œé»‘åå• | ç¦æ­¢æ‰“å¼€ .exe/.bat/.cmd/.ps1/.vbs ç­‰ 30+ ç§å¯æ‰§è¡Œæ–‡ä»¶ |
| `file.read` | ğŸ“ è·¯å¾„å®‰å…¨ | ç³»ç»Ÿç›˜ä¿æŠ¤ç›®å½•ç¦æ­¢è®¿é—® |
| `file.write` | ğŸ“ å†™å…¥é™åˆ¶ | ä»…å…è®¸å†™å…¥ foobar2000 é…ç½®ç›®å½•å’Œä¸´æ—¶ç›®å½• |
| `file.delete` | ğŸ“ å†™å…¥é™åˆ¶ | ä»…å…è®¸åˆ é™¤ foobar2000 é…ç½®ç›®å½•å’Œä¸´æ—¶ç›®å½•ä¸­çš„æ–‡ä»¶ |
| `http.get/post` | ğŸŒ SSRF é˜²æŠ¤ | é»˜è®¤ç¦æ­¢è®¿é—®å†…ç½‘åœ°å€ |
| DevTools | ğŸ”§ é»˜è®¤å…³é—­ | éœ€åœ¨é«˜çº§è®¾ç½®ä¸­æ‰‹åŠ¨å¼€å¯ |

### shell.exec - å·²ç¦ç”¨

<div class="api-card" style="border-color: #f85149; background: rgba(248, 81, 73, 0.1);">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #f85149;">DISABLED</span>
        <span class="api-card-name">shell.exec</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc" style="color: #f85149;">â›” æ­¤ API å·²è¢«ç¦ç”¨ï¼Œè°ƒç”¨å°†è¿”å›é”™è¯¯ã€‚</div>

**åŸå› **: å…è®¸æ‰§è¡Œä»»æ„å‘½ä»¤ä¼šå¯¼è‡´ä¸¥é‡çš„å®‰å…¨é£é™©ï¼ˆè¿œç¨‹ä»£ç æ‰§è¡Œ RCEï¼‰ã€‚

**æ›¿ä»£æ–¹æ¡ˆ**: 
- ä½¿ç”¨ `shell.openExternal` æ‰“å¼€ URL
- ä½¿ç”¨ `shell.showInExplorer` åœ¨èµ„æºç®¡ç†å™¨ä¸­æ˜¾ç¤ºæ–‡ä»¶
- ä½¿ç”¨ `shell.openWith` ç”¨å…³è”ç¨‹åºæ‰“å¼€æ–‡ä»¶ï¼ˆå—é»‘åå•é™åˆ¶ï¼‰
    </div>
</div>

### shell.openWith - å¯æ‰§è¡Œé»‘åå•

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #d29922; color: #000;">RESTRICTED</span>
        <span class="api-card-name">shell.openWith</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ğŸš« ç¦æ­¢æ‰“å¼€å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåªèƒ½æ‰“å¼€åª’ä½“/æ–‡æ¡£ç±»æ–‡ä»¶ã€‚</div>

**è¢«ç¦æ­¢çš„æ‰©å±•å** (30+ ç§):
```
.exe .com .cmd .bat .ps1 .vbs .vbe .js .jse .wsf .wsh .msc
.scr .pif .hta .cpl .msi .msp .msu .dll .ocx .sys .drv
.lnk .url .reg .inf .jar .application
```

**å…è®¸çš„ç¤ºä¾‹**:
```javascript
// âœ… å…è®¸ - åª’ä½“æ–‡ä»¶
await fb2k.invoke('shell.openWith', { path: 'D:/Music/song.mp3' });

// âœ… å…è®¸ - æ–‡æ¡£
await fb2k.invoke('shell.openWith', { path: 'C:/docs/readme.txt' });

// âŒ æ‹’ç» - å¯æ‰§è¡Œæ–‡ä»¶
await fb2k.invoke('shell.openWith', { path: 'C:/app.exe' });
// è¿”å›: { success: false, error: "Executable files cannot be opened for security reasons" }
```
</div>
</div>

### file.read - è·¯å¾„å®‰å…¨

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #d29922; color: #000;">RESTRICTED</span>
        <span class="api-card-name">file.read</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ğŸ“ ç³»ç»Ÿç›˜ä¿æŠ¤ç›®å½•ç¦æ­¢è®¿é—®ï¼Œéç³»ç»Ÿç›˜é»˜è®¤æ”¾è¡Œã€‚</div>

**ç¦æ­¢è®¿é—®çš„ç›®å½•** (ç³»ç»Ÿç›˜):
- `C:\Windows\` åŠå­ç›®å½•
- `C:\Program Files\` åŠå­ç›®å½•
- `C:\Program Files (x86)\` åŠå­ç›®å½•
- `C:\ProgramData\` åŠå­ç›®å½•

**å…è®¸çš„ç¤ºä¾‹**:
```javascript
// âœ… å…è®¸ - éç³»ç»Ÿç›˜
await fb2k.invoke('file.read', { path: 'D:/Music/playlist.m3u' });

// âœ… å…è®¸ - ç”¨æˆ·ç›®å½•
await fb2k.invoke('file.read', { path: 'C:/Users/Name/Music/song.txt' });

// âŒ æ‹’ç» - ç³»ç»Ÿç›®å½•
await fb2k.invoke('file.read', { path: 'C:/Windows/System32/config/SAM' });
// è¿”å›: { success: false, error: "Access denied: protected system path" }
```

> ğŸ’¡ **è¯´æ˜**: éç³»ç»Ÿç›˜ï¼ˆD:ã€E: ç­‰ï¼‰é»˜è®¤æ”¾è¡Œï¼Œæ”¯æŒ NAS å’Œä¾¿æºç‰ˆä½¿ç”¨åœºæ™¯ã€‚
    </div>
</div>

### file.write - å†™å…¥é™åˆ¶

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #d29922; color: #000;">RESTRICTED</span>
        <span class="api-card-name">file.write</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ğŸ“ ä»…å…è®¸å†™å…¥ foobar2000 é…ç½®ç›®å½•å’Œä¸´æ—¶ç›®å½•ã€‚</div>

**å…è®¸å†™å…¥çš„ç›®å½•**:
- foobar2000 é…ç½®ç›®å½• (`%APPDATA%\foobar2000\` æˆ–ä¾¿æºç‰ˆ profile ç›®å½•)
- ç³»ç»Ÿä¸´æ—¶ç›®å½• (`%TEMP%`)

**ç¤ºä¾‹**:
```javascript
// âœ… å…è®¸ - é…ç½®ç›®å½•
await fb2k.invoke('file.write', { 
    path: fb2k.getProfilePath() + '/mytheme/config.json',
    content: JSON.stringify(config)
});

// âŒ æ‹’ç» - ä»»æ„è·¯å¾„
await fb2k.invoke('file.write', { path: 'D:/test.txt', content: 'test' });
// è¿”å›: { success: false, error: "Access denied: write not allowed to this path" }
```
</div>
</div>

### http.get/post - SSRF é˜²æŠ¤

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #d29922; color: #000;">RESTRICTED</span>
        <span class="api-card-name">http.get / http.post</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ğŸŒ é»˜è®¤ç¦æ­¢è®¿é—®å†…ç½‘åœ°å€ï¼Œé˜²æ­¢ SSRF æ”»å‡»ã€‚</div>

**è¢«ç¦æ­¢çš„åœ°å€**:
- `localhost` / `127.x.x.x`
- `192.168.x.x` (ç§æœ‰ç½‘ç»œ)
- `10.x.x.x` (ç§æœ‰ç½‘ç»œ)
- `172.16-31.x.x` (ç§æœ‰ç½‘ç»œ)
- `169.254.x.x` (é“¾è·¯æœ¬åœ°)
- `::1` (IPv6 localhost)

**ç¤ºä¾‹**:
```javascript
// âœ… å…è®¸ - å¤–ç½‘
await fb2k.invoke('http.get', { url: 'https://api.example.com/data' });

// âŒ æ‹’ç» - æœ¬åœ°æœåŠ¡å™¨ (é»˜è®¤)
await fb2k.invoke('http.get', { url: 'http://localhost:3000/api' });
// è¿”å›: { success: false, error: "Access to local network is disabled..." }
```

> ğŸ’¡ **å¯ç”¨å†…ç½‘è®¿é—®**: åœ¨ foobar2000 é«˜çº§è®¾ç½®ä¸­å¯ç”¨  
> **Preferences â†’ Advanced â†’ Tools â†’ WebView UI â†’ Allow local network access**
    </div>
</div>

### DevTools - å¼€å‘è€…å·¥å…·

<div class="api-card" style="border-color: #d29922;">
    <div class="api-card-header">
        <span class="api-card-method" style="background: #d29922; color: #000;">RESTRICTED</span>
        <span class="api-card-name">DevTools (F12)</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ğŸ”§ å¼€å‘è€…å·¥å…·é»˜è®¤ç¦ç”¨ï¼Œéœ€æ‰‹åŠ¨å¼€å¯ã€‚</div>

**å¯ç”¨æ–¹æ³•**:
1. æ‰“å¼€ foobar2000 Preferences
2. è¿›å…¥ **Advanced â†’ Tools â†’ WebView UI**
3. å‹¾é€‰ **Enable DevTools**
4. é‡å¯ foobar2000
5. æŒ‰ F12 æˆ–å³é”®èœå•æ‰“å¼€ DevTools

> âš ï¸ **æ³¨æ„**: å¼€å¯ DevTools ä¼šå¢åŠ è¢«æ¶æ„è„šæœ¬åˆ©ç”¨çš„é£é™©ï¼Œä»…å»ºè®®å¼€å‘æ—¶ä½¿ç”¨ã€‚
    </div>
</div>

### CSP ç­–ç•¥

<div class="api-card">
    <div class="api-card-header">
        <span class="api-card-method get">INFO</span>
        <span class="api-card-name">Content-Security-Policy</span>
    </div>
    <div class="api-card-body">
        <div class="api-card-desc">ğŸ›¡ï¸ å‰ç«¯é¡µé¢å— CSP ä¿æŠ¤ï¼Œä½†å…è®¸ä»å¸¸ç”¨ CDN åŠ è½½èµ„æºã€‚</div>

**å…è®¸çš„å¤–éƒ¨æ¥æº**:

| ç±»å‹ | å…è®¸çš„æ¥æº |
|------|-----------|
| è„šæœ¬ (`script-src`) | `cdnjs.cloudflare.com`, `unpkg.com`, `cdn.jsdelivr.net` |
| æ ·å¼ (`style-src`) | ä¸Šè¿° CDN + `fonts.googleapis.com` |
| å­—ä½“ (`font-src`) | `fonts.gstatic.com`, ä¸Šè¿° CDN |
| å›¾ç‰‡ (`img-src`) | æ‰€æœ‰ `https:` æ¥æº |
| è¿æ¥ (`connect-src`) | `https:`, `localhost:*`, `127.0.0.1:*`, WebSocket |

**ç¤ºä¾‹ - åŠ è½½ CDN åº“**:
```html
<!-- âœ… å…è®¸ - cdnjs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

<!-- âœ… å…è®¸ - Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<!-- âœ… å…è®¸ - unpkg -->
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
```

> ğŸ’¡ **è¯´æ˜**: å†…è”è„šæœ¬ (`'unsafe-inline'`) å’Œ eval (`'unsafe-eval'`) å·²å…è®¸ï¼Œä»¥æ”¯æŒ Vite/Vue å¼€å‘æ¨¡å¼ã€‚
    </div>
</div>

</section>

<!-- ==================== API SUMMARY ==================== -->
<section id="api-summary">

## API ç»Ÿè®¡æ‘˜è¦

| åˆ†ç±» | API æ•°é‡ | æè¿° |
|------|----------|------|
| **playback** | 25 | æ’­æ”¾æ§åˆ¶ã€éŸ³é‡ã€è·¯å¾„æ’­æ”¾ã€é˜Ÿåˆ—ä½ç½® |
| **playlist** | 42 | æ’­æ”¾åˆ—è¡¨ç®¡ç†ã€æ›²ç›®æ“ä½œã€æ™ºèƒ½åˆ—è¡¨ |
| **library** | 22 | åª’ä½“åº“æµè§ˆã€æœç´¢ã€è·¯å¾„æŸ¥æ‰¾ã€ç¼“å­˜æ§åˆ¶ |
| **artwork** | 12 | å°é¢ã€æ‰¹é‡è·å–ã€æ–‡ä»¶å¤¹å›¾ç‰‡ï¼ˆå«åˆ«åï¼‰ |
| **config** | 20 | é…ç½®å­˜å‚¨ã€å¯¼å…¥å¯¼å‡º |
| **window** | 55 | çª—å£æ§åˆ¶ã€DWM æ•ˆæœã€ç¼©æ”¾æ§åˆ¶ |
| **system** | 9 | ä¸»é¢˜/DPI/è¯­è¨€ã€API å‘ç°ã€æ’ä»¶æ³¨å†Œ |
| **file** | 10 | æ–‡ä»¶è¯»å†™ã€å¤åˆ¶ã€ç§»åŠ¨ã€ç›®å½•æ“ä½œ ğŸ”„ |
| **dialog** | 4 | æ–‡ä»¶/æ–‡ä»¶å¤¹å¯¹è¯æ¡† |
| **clipboard** | 4 | å‰ªè´´æ¿è¯»å†™ |
| **shell** | 3 | èµ„æºç®¡ç†å™¨ã€å¤–éƒ¨ç¨‹åºï¼ˆ`shell.exec` å·²ç¦ç”¨ï¼‰|
| **http** | 4 | HTTP GET/POST/HEAD/ä¸‹è½½ |
| **ui** | 5 | è‡ªå®šä¹‰èœå•ã€Toastã€é€šçŸ¥ |
| **keyboard** | 4 | å…¨å±€å¿«æ·é”®æ³¨å†Œ |
| **lyrics** | 3 | æ­Œè¯è·å–ä¸ä¿å­˜ |
| **metadata** | 7 | å…ƒæ•°æ®è¯»å†™ã€æ‰¹é‡å†™å…¥ |
| **audio** | 12 | é¢‘è°±ã€æ³¢å½¢ã€éŸ³é¢‘åˆ†æ |
| **console** | 6 | æ§åˆ¶å°æ—¥å¿—ã€æ–‡ä»¶æ—¥å¿— |
| **dnd** | 4 | æ‹–æ”¾åŒºåŸŸæ³¨å†Œ |
| **queue** | 8 | æ’­æ”¾é˜Ÿåˆ—ç®¡ç† |
| **jitQueue** | 7 | æµåª’ä½“å³æ—¶é˜Ÿåˆ— |
| **discovery** | 15 | ä¸»åŠ¨æœåŠ¡å‘ç° ğŸ”„ |
| **dsp** | 8 | DSP æ•ˆæœå™¨ç®¡ç† ğŸ†• |
| **output** | 3 | éŸ³é¢‘è¾“å‡ºè®¾å¤‡ ğŸ†• |
| **replaygain** | 5 | ReplayGain è®¾ç½® ğŸ†• |
| **test** | 2 | æµ‹è¯• API |
| **æ€»è®¡** | **289** | |

### v1.1.9 æ›´æ–°å†…å®¹ (2026-01-12)

**æ–°å¢äº‹ä»¶ - å®æ—¶å…ƒæ•°æ®å˜åŒ–**:
- ğŸ†• `metadb:changed` äº‹ä»¶ - å½“è¯„åˆ†ã€æ ‡ç­¾ã€æ’­æ”¾ç»Ÿè®¡ç­‰å…ƒæ•°æ®å˜åŒ–æ—¶å®æ—¶æ¨é€

**æŠ€æœ¯äº®ç‚¹**:
- ğŸ“¡ ç±»ä¼¼ SMP çš„ `on_metadb_changed` å›è°ƒæœºåˆ¶
- âš¡ æ— éœ€è½®è¯¢ï¼Œè¯„åˆ†è®¾ç½®åç«‹å³æ”¶åˆ°é€šçŸ¥
- ğŸ¯ æ”¯æŒ foo_playcount è¯„åˆ†å˜åŒ–æ£€æµ‹

**äº‹ä»¶æ•°æ®ç»“æ„**:
```javascript
fb2k.on('metadb:changed', (data) => {
    // data.tracks: å˜åŒ–çš„æ›²ç›®åˆ—è¡¨ï¼ˆæœ€å¤š50æ¡ï¼‰
    // data.count: å˜åŒ–çš„æ›²ç›®æ€»æ•°
    // data.fromHook: true=å†…éƒ¨ä¿®æ”¹(å¦‚foo_playcount), false=å¤–éƒ¨ä¿®æ”¹
    // data.timestamp: æ—¶é—´æˆ³
    
    for (const track of data.tracks) {
        console.log(`${track.path}: rating=${track.rating}`);
    }
});
```

**rating.set API é‡æ„**:
- ğŸ”„ `rating.set` ç°åœ¨ä¼˜å…ˆä½¿ç”¨ foo_playcount ä¸Šä¸‹æ–‡èœå•è®¾ç½®è¯„åˆ†
- âš ï¸ **ä¾èµ–è¯´æ˜**: éœ€è¦å®‰è£… [foo_playcount](https://www.foobar2000.org/components/view/foo_playcount) æ’ä»¶æ‰èƒ½æ­£å¸¸å·¥ä½œ
- ğŸ”„ å¦‚æœ foo_playcount ä¸å¯ç”¨ï¼Œè‡ªåŠ¨å›é€€åˆ°å†™å…¥æ–‡ä»¶ RATING æ ‡ç­¾
- ğŸ†• æ”¯æŒä¸­è‹±æ–‡èœå•è·¯å¾„è‡ªåŠ¨é€‚é…

**rating.set ä½¿ç”¨ç¤ºä¾‹**:
```javascript
// è®¾ç½®è¯„åˆ† (éœ€è¦ foo_playcount æ’ä»¶)
await fb2k.invoke('rating.set', { 
    path: 'E:\\Music\\song.flac',  // å¯é€‰ï¼Œé»˜è®¤å½“å‰æ’­æ”¾æ›²ç›®
    rating: 5                       // 0-5, 0 = å–æ¶ˆè¯„åˆ†
});

// è¿”å›å€¼åŒ…å« storage å­—æ®µæŒ‡ç¤ºå­˜å‚¨ä½ç½®
// storage: "stats" = foo_playcount æ•°æ®åº“ (æ¨è)
// storage: "file" = æ–‡ä»¶æ ‡ç­¾ (å›é€€)
```

---

### v1.1.8 æ›´æ–°å†…å®¹ (2026-01-11)

**æ–°å¢ API - foo_playcount è¯„åˆ†é›†æˆ**:
- ğŸ†• `discovery.executeContextMenuByPath` - é€šè¿‡è·¯å¾„æ‰§è¡Œä¸Šä¸‹æ–‡èœå•å‘½ä»¤ï¼ˆæ”¯æŒåŠ¨æ€å­èœå•ï¼‰
- ğŸ†• `discovery.getContextMenuTree` - è·å–å®Œæ•´ä¸Šä¸‹æ–‡èœå•æ ‘ç»“æ„

**Discovery API æ›´æ–°**:
- ğŸ”„ æ›´æ–° API æ€»æ•°ï¼šä» 287 å¢è‡³ **289** ä¸ª
- ğŸ”„ Discovery API æ•°é‡ï¼š13 â†’ **15**
- ğŸ› ä¿®å¤ UTF-8 ç¼–ç é—®é¢˜ï¼Œç°åœ¨å¯ä»¥æ­£ç¡®å¤„ç†å«æœ‰ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ â˜…ï¼‰çš„å‘½ä»¤åç§°

**ä½¿ç”¨åœºæ™¯ - foo_playcount è¯„åˆ†**:
```javascript
// è®¾ç½® 5 æ˜Ÿè¯„åˆ†ï¼ˆä¸­æ–‡ç‰ˆï¼‰
await fb2k.invoke('discovery.executeContextMenuByPath', { 
    path: 'æ’­æ”¾ç»Ÿè®¡ä¿¡æ¯/ç­‰çº§/5' 
});

// è‹±æ–‡ç‰ˆ
await fb2k.invoke('discovery.executeContextMenuByPath', { 
    path: 'Playback Statistics/Rating/5' 
});

// å–æ¶ˆè¯„åˆ†
await fb2k.invoke('discovery.executeContextMenuByPath', { 
    path: 'æ’­æ”¾ç»Ÿè®¡ä¿¡æ¯/ç­‰çº§/<æœªè®¾ç½®>' 
});

// è·å–å®Œæ•´èœå•æ ‘ç»“æ„
const result = await fb2k.invoke('discovery.getContextMenuTree');
console.log(result.tree); // æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„ä¸Šä¸‹æ–‡èœå•
```

---

### v1.1.6 æ›´æ–°å†…å®¹ (2026-01-10)

**æ–‡æ¡£æ›´æ–° - API æ ¸å¯¹ä¸è¡¥å…¨**:
- ğŸ”„ æ›´æ–° API æ€»æ•°ï¼šä» 274 å¢è‡³ **287** ä¸ª
- ğŸ†• æ–°å¢ **File API** æ–‡æ¡£ï¼š`file.copy`ã€`file.move`ã€`file.rename`ã€`file.getInfo`
- ğŸ†• æ–°å¢ **DSP API** æ¨¡å— (8 ä¸ª API)ï¼šDSP æ•ˆæœå™¨é“¾ç®¡ç†
- ğŸ†• æ–°å¢ **Output API** æ¨¡å— (3 ä¸ª API)ï¼šéŸ³é¢‘è¾“å‡ºè®¾å¤‡ç®¡ç†
- ğŸ†• æ–°å¢ **ReplayGain API** æ¨¡å— (5 ä¸ª API)ï¼šéŸ³é‡æ ‡å‡†åŒ–è®¾ç½®
- ğŸ”„ ä¿®æ­£ **Shell API** æ•°é‡ï¼š4 â†’ 3ï¼ˆ`shell.exec` å·²ç¦ç”¨ï¼‰
- ğŸ”„ ä¿®æ­£ **Metadata API** æ•°é‡ï¼š6 â†’ 7ï¼ˆè¡¥å…… `metadata.writeBatch`ï¼‰
- ğŸ”„ ä¿®æ­£ **Queue API** æ•°é‡ï¼š7 â†’ 8
- ğŸ”„ ä¿®æ­£ **Discovery API** æ•°é‡ï¼š11 â†’ 13
- æ›´æ–°ä¾§è¾¹å¯¼èˆªæ å’Œç»Ÿè®¡æ‘˜è¦è¡¨æ ¼

---

### v1.1.5 æ›´æ–°å†…å®¹ (2026-01-07)

**Bug ä¿®å¤ - æ›²ç›®æŠ€æœ¯ä¿¡æ¯**:
- ä¿®å¤ `bitrate`ã€`sampleRate`ã€`channels`ã€`codec` ç­‰å­—æ®µè¿”å› 0 æˆ–ç©ºå€¼çš„é—®é¢˜
- åŸå› ï¼šä½¿ç”¨äº†è¿‡æ—¶çš„ `get_info()` æ–¹æ³•ï¼Œæ”¹ç”¨ SDK æ¨èçš„ `get_info_ref()` æ–¹æ³•
- æ‰€æœ‰æ›²ç›®ä¿¡æ¯ API ç°åœ¨ç»Ÿä¸€è¿”å› `codec` å­—æ®µï¼ˆå¦‚ "FLAC"ã€"MP3"ã€"AAC"ï¼‰
- å½±å“èŒƒå›´ï¼š`playback.getCurrentTrack`ã€`playlist.getTracks`ã€`library.search`ã€`queue.get` ç­‰æ‰€æœ‰è¿”å›æ›²ç›®ä¿¡æ¯çš„ API

**åå¥½è®¾ç½®ç•Œé¢ä¼˜åŒ–**:
- ä¿®å¤åå¥½å‚æ•°ç•Œé¢ä¸­é…ç½®é¡¹ä¸èƒ½æŒä¹…åŒ–ä¿å­˜çš„é—®é¢˜
- æ–°å¢ DWM èƒŒæ™¯æ•ˆæœçƒ­é‡è½½åŠŸèƒ½ï¼Œåˆ‡æ¢ Mica/Acrylic/None æ•ˆæœåç«‹å³ç”Ÿæ•ˆ
- é€šè¿‡ `SetWindowPos + SWP_FRAMECHANGED` é€šçŸ¥ Windows é‡ç»˜çª—å£æ¡†æ¶
- æ–°å¢ `MainWindow::RefreshBackdropEffect()` æ–¹æ³•

**Bug ä¿®å¤ - å³é”®èœå•åæ ‡**:
- ä¿®å¤å³é”®èœå•ä¸åœ¨é¼ æ ‡ä½ç½®æ˜¾ç¤ºçš„é—®é¢˜
- å¢åŠ  DPI æ„ŸçŸ¥åæ ‡éªŒè¯ï¼Œå½“ WebView2 åæ ‡ä¸çœŸå®é¼ æ ‡ä½ç½®å·®å¼‚è¿‡å¤§æ—¶è‡ªåŠ¨å›é€€
- é€‚é…è¿è¡Œæ—¶ DPI ç¼©æ”¾å˜åŒ–åœºæ™¯

**Bug ä¿®å¤ - æ‹–æ‹½åŒºåŸŸ DPI ç¼©æ”¾**:
- ä¿®å¤ `window.setDragRegions` / `window.setNoDragRegions` åœ¨é«˜ DPIï¼ˆ125%ã€150% ç­‰ï¼‰ä¸‹å¤±æ•ˆçš„é—®é¢˜
- åŸå› ï¼šJS ä¼ é€’ CSS åƒç´ åæ ‡ï¼ŒC++ ä½¿ç”¨ç‰©ç†åƒç´ ï¼Œæœªåš DPI è½¬æ¢
- ç°åœ¨ API ä¼šè‡ªåŠ¨æ ¹æ® `GetDpiForWindow()` è½¬æ¢åæ ‡

**Bug ä¿®å¤ - CSS app-region æ”¯æŒ**:
- ä¿®å¤ `-webkit-app-region: drag/no-drag` CSS å±æ€§ä¸ç”Ÿæ•ˆçš„é—®é¢˜
- åŸå› ï¼š`WM_NCHITTEST` æœªè°ƒç”¨ WebView2 çš„ `GetNonClientRegionAtPoint` API
- è§£å†³ Vue Teleport åˆ° body çš„å…ƒç´ æ— æ³•è¢«æ­£ç¡®æ£€æµ‹çš„é—®é¢˜
- ç°åœ¨ CSS å±æ€§å¯ç›´æ¥ç”Ÿæ•ˆï¼Œæ— è®ºå…ƒç´ æ˜¯å¦é€šè¿‡ Teleport ç§»åŠ¨

**Bug ä¿®å¤ - åœ†è§’è®¾ç½®**:
- ä¿®å¤ `window.setCornerPreference` è®¾ç½®åœ†è§’å Mica/Acrylic æ•ˆæœæ¶ˆå¤±çš„é—®é¢˜
- è®¾ç½®åœ†è§’åè‡ªåŠ¨è°ƒç”¨ `RefreshBackdropEffect()` é‡æ–°åº”ç”¨èƒŒæ™¯æ•ˆæœ

---

### v1.1.3 æ›´æ–°å†…å®¹ (2026-01-05)

**æ–°å¢ Discovery API - ä¸»åŠ¨æœåŠ¡å‘ç°** ğŸ†•:
- `discovery.getAllServices` - è·å–æ‰€æœ‰å¯å‘ç°æœåŠ¡çš„ç»Ÿè®¡æ‘˜è¦
- `discovery.getMainMenuCommands` - è·å–æ‰€æœ‰ä¸»èœå•å‘½ä»¤ï¼ˆæ¥è‡ªæ‰€æœ‰ç»„ä»¶ï¼‰
- `discovery.getMainMenuGroups` - è·å–ä¸»èœå•ç»„ç»“æ„
- `discovery.executeMainMenuCommand` - é€šè¿‡ GUID æ‰§è¡Œä¸»èœå•å‘½ä»¤
- `discovery.getInputFormats` - è·å–æ”¯æŒçš„éŸ³é¢‘è¾“å…¥æ ¼å¼
- `discovery.getComponents` - è·å–æ‰€æœ‰å·²å®‰è£…ç»„ä»¶ä¿¡æ¯ï¼ˆå¦‚ ESLyricã€foo_input_sacd ç­‰ï¼‰
- `discovery.getUIElements` - è·å– UI å…ƒç´ 
- `discovery.getDspEntries` - è·å– DSP å¤„ç†å™¨
- `discovery.getOutputDevices` - è·å–è¾“å‡ºè®¾å¤‡
- `discovery.getPreferencePages` - è·å–åå¥½è®¾ç½®é¡µé¢
- `discovery.searchCommands` - æŒ‰åç§°/æè¿°æœç´¢èœå•å‘½ä»¤

**JIT Queue æœ¬åœ°æ–‡ä»¶æ”¯æŒ**:
- `jitQueue.playNow` å’Œ `jitQueue.enqueueNext` ç°åœ¨æ”¯æŒæœ¬åœ°æ–‡ä»¶è·¯å¾„
- è‡ªåŠ¨æ£€æµ‹ URL ç±»å‹ï¼šHTTP/HTTPS â†’ æµåª’ä½“æ¨¡å¼ï¼Œæœ¬åœ°è·¯å¾„ â†’ ç›´æ¥æ’­æ”¾
- æ”¯æŒ Windows ç»å¯¹è·¯å¾„ï¼ˆå¦‚ `E:\Music\song.flac`ï¼‰å’Œ UNC è·¯å¾„

**playback.playPath CUE å­æ›²ç›®ä¿®å¤**:
- ä½¿ç”¨ `process_locations()` æ­£ç¡®è§£æ CUE å­æ›²ç›®
- ä¿®å¤ subsong ç´¢å¼•æ ¼å¼é—®é¢˜ï¼ˆç§»é™¤é”™è¯¯çš„ `/subsong,N` åç¼€ï¼‰
- å‰ç«¯å‘é€çš„ `|subsong:N` ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€è½¬æ¢ï¼ˆå·²æ˜¯ 0-basedï¼‰

**å¼‚æ­¥ HTTP API**:
- `http.get/post/head` æ–°å¢ `async` å‚æ•°
- å¼‚æ­¥æ¨¡å¼é€šè¿‡ `http:response` äº‹ä»¶è¿”å›ç»“æœ
- æ¨èï¼šå‰ç«¯ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ `fetch()` API è·å¾—æœ€ä½³æ€§èƒ½

**API æ€§èƒ½è¿½è¸ªå™¨**:
- è‡ªåŠ¨æ£€æµ‹é˜»å¡ä¸»çº¿ç¨‹çš„ API è°ƒç”¨
- æ§åˆ¶å°è¾“å‡º `[Perf]` æ—¥å¿—ï¼Œæ˜¾ç¤º API æ‰§è¡Œæ—¶é—´
- é˜ˆå€¼ï¼š50ms è®°å½•, 200ms è­¦å‘Š, 500ms é˜»å¡è­¦å‘Š

### v1.1.2 æ›´æ–°å†…å®¹ (2026-01-04)

**æ–°å¢åŠŸèƒ½ - åå°æ¨¡å¼**:
- æ”¯æŒåœ¨ä½¿ç”¨ Default UI æˆ–å…¶ä»– UI æ—¶åå°è¿è¡Œ WebView UI
- API åœ¨åå°æ¨¡å¼ä¸‹ä»ç„¶å¯ç”¨
- è®¾ç½®ä½ç½®ï¼šPreferences â†’ Advanced â†’ Tools â†’ WebView UI â†’ Enable background mode
- èœå•è®¿é—®ï¼šView â†’ WebView UI â†’ Show/Hide Window
- é»˜è®¤å…³é—­ï¼Œéœ€è¦é‡å¯ foobar2000 ç”Ÿæ•ˆ

**æ–°å¢åŠŸèƒ½ - å¼‚æ­¥ HTTP API**:
- `http.get/post/head` æ–°å¢ `async` å‚æ•°ï¼Œè®¾ä¸º `true` æ—¶åœ¨åå°çº¿ç¨‹æ‰§è¡Œï¼Œä¸é˜»å¡ UI
- å¼‚æ­¥æ¨¡å¼ç«‹å³è¿”å› `{ requestId, async: true }`ï¼Œç»“æœé€šè¿‡ `http:response` äº‹ä»¶è¿”å›
- é»˜è®¤åŒæ­¥æ¨¡å¼ï¼ˆ`async: false`ï¼‰ï¼Œä¿æŒå‘åå…¼å®¹
- æ¨èï¼šå‰ç«¯ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ `fetch()` API è·å¾—æœ€ä½³æ€§èƒ½

**æ–°å¢åŠŸèƒ½ - API æ€§èƒ½è¿½è¸ªå™¨**:
- è‡ªåŠ¨æ£€æµ‹é˜»å¡ä¸»çº¿ç¨‹çš„ API è°ƒç”¨
- æ§åˆ¶å°è¾“å‡º `[Perf]` æ—¥å¿—ï¼Œæ˜¾ç¤º API æ‰§è¡Œæ—¶é—´
- é˜ˆå€¼ï¼š50ms è®°å½•, 200ms è­¦å‘Š, 500ms é˜»å¡è­¦å‘Š
- ç”¨äºè°ƒè¯•å’Œä¼˜åŒ–ä¸»é¢˜æ€§èƒ½

**æ–°å¢äº‹ä»¶ - HTTP**:
- `http:response` - å¼‚æ­¥ HTTP è¯·æ±‚å®Œæˆæ—¶è§¦å‘ï¼ˆä»… `async: true` æ¨¡å¼ï¼‰

**æ–°å¢äº‹ä»¶ - Playback**:
- `playback:stateChanged` - ç»Ÿä¸€çš„æ’­æ”¾çŠ¶æ€å˜åŒ–äº‹ä»¶ï¼ŒåŒ…å« stateï¼ˆplaying/paused/stoppedï¼‰ã€positionã€duration

**æ–°å¢ API - JIT Queueï¼ˆæµåª’ä½“å³æ—¶é˜Ÿåˆ—ï¼‰**:
- `jitQueue.playNow` - **æ ¸å¿ƒ API**ï¼šç«‹å³æ’­æ”¾æŒ‡å®š URL æˆ–æœ¬åœ°è·¯å¾„ï¼ˆæ¸…ç©ºç¼“å†²åŒºï¼Œå¼€å§‹æ–°æ’­æ”¾ï¼‰
- `jitQueue.enqueueNext` - é¢„åŠ è½½ä¸‹ä¸€é¦–åˆ°ç¼“å†²åŒºï¼ˆå“åº” needNext äº‹ä»¶ï¼‰
- `jitQueue.skip` - è·³åˆ°ç¼“å†²åŒºä¸­çš„ä¸‹ä¸€é¦–
- `jitQueue.stop` - åœæ­¢æ’­æ”¾ï¼ˆå¯é€‰æ¸…ç©ºç¼“å†²åŒºï¼‰
- `jitQueue.clear` - æ¸…ç©ºå½±å­æ’­æ”¾åˆ—è¡¨ç¼“å†²åŒº
- `jitQueue.getState` - è·å– JIT é˜Ÿåˆ—å½“å‰çŠ¶æ€
- `jitQueue.notifyEmpty` - é€šçŸ¥åç«¯å‰ç«¯å·²æ— æ›²ç›®

**JIT Queue æœ¬åœ°æ–‡ä»¶æ”¯æŒ** (v1.1.3+):
- `jitQueue.playNow` å’Œ `jitQueue.enqueueNext` ç°åœ¨è‡ªåŠ¨æ£€æµ‹ URL ç±»å‹
- HTTP/HTTPS URL â†’ ä½¿ç”¨æµåª’ä½“æ¨¡å¼ï¼ˆshadow playlist + ç¼“å†²é…ç½®ï¼‰
- æœ¬åœ°æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ `E:\Music\song.flac`ï¼‰â†’ ä½¿ç”¨æœ¬åœ°æ–‡ä»¶æ¨¡å¼ï¼ˆç›´æ¥ metadb æ’å…¥ï¼‰
- UNC è·¯å¾„ï¼ˆå¦‚ `\\server\share\song.mp3`ï¼‰â†’ æœ¬åœ°æ–‡ä»¶æ¨¡å¼
- æ— éœ€å‰ç«¯ä¿®æ”¹ï¼Œåç«¯è‡ªåŠ¨è·¯ç”±åˆ°æ­£ç¡®çš„å¤„ç†é€»è¾‘

**æ–°å¢äº‹ä»¶ - JIT Queue**:
- `jitQueue:needNext` - åç«¯è¯·æ±‚å‰ç«¯æä¾›ä¸‹ä¸€é¦–
- `jitQueue:trackChanged` - å½“å‰æ’­æ”¾æ›²ç›®å˜åŒ–
- `jitQueue:listExhausted` - ç¼“å†²åŒºè€—å°½ï¼ˆå¯æ‹‰å–æ¨èï¼‰
- `jitQueue:error` - URL è§£æå¤±è´¥ç­‰é”™è¯¯

**æ–°å¢ API - Queueï¼ˆåŸç”Ÿæ’­æ”¾é˜Ÿåˆ—ï¼‰**:
- `queue.addPaths` - **æ ¸å¿ƒ API**ï¼šä¸€æ­¥æ·»åŠ  URL/æœ¬åœ°è·¯å¾„åˆ°æ’­æ”¾é˜Ÿåˆ—ï¼ˆè‡ªåŠ¨æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨+å…¥é˜Ÿï¼‰
- `queue.add` - å°†æ’­æ”¾åˆ—è¡¨ä¸­çš„æ›²ç›®æ·»åŠ åˆ°é˜Ÿåˆ—
- `queue.get` - è·å–å½“å‰æ’­æ”¾é˜Ÿåˆ—å†…å®¹
- `queue.remove` - ç§»é™¤é˜Ÿåˆ—ä¸­çš„æŒ‡å®šé¡¹
- `queue.clear` - æ¸…ç©ºæ•´ä¸ªæ’­æ”¾é˜Ÿåˆ—
- `queue.getCount` - è·å–é˜Ÿåˆ—é¡¹æ•°é‡
- `queue.moveToTop` - å°†é˜Ÿåˆ—é¡¹ç§»åŠ¨åˆ°é˜Ÿé¦–

**æ–°å¢ API - Playback**:
- `playback.getCurrentTrackIndex` - è·å–å½“å‰æ’­æ”¾æ›²ç›®çš„æ’­æ”¾åˆ—è¡¨ä½ç½®
- `playback.getPlayingPlaylist` - è·å–æ­£åœ¨æ’­æ”¾çš„æ’­æ”¾åˆ—è¡¨ä¿¡æ¯

**æ–°å¢ API - Playlist**:
- `playlist.replaceAllAndPlay` - ğŸ†• **åŸå­æ“ä½œ**ï¼šæ¸…ç©ºæ’­æ”¾åˆ—è¡¨ + æ·»åŠ è·¯å¾„ + æ’­æ”¾æŒ‡å®šæ›²ç›®ï¼ˆè§£å†³æ—¶åºé—®é¢˜ï¼‰

**API å¢å¼º**:
- `playlist.clear` - ç°åœ¨è¿”å› `clearedCount` å’Œ `remainingCount` ç”¨äºè°ƒè¯•éªŒè¯
- `playlist.addPaths` - ç°åœ¨è¿”å› `requestedPaths`ã€`countBefore`ã€`totalCount` ç”¨äºè°ƒè¯•
- `playback:trackChanged` äº‹ä»¶ - ğŸ†• æ–°å¢ `id` å’Œ `absolutePath` å­—æ®µï¼Œç»Ÿä¸€ä½¿ç”¨ç»å¯¹è·¯å¾„ä½œä¸ºå”¯ä¸€æ ‡è¯†
- `playback.getCurrentTrack` - ğŸ†• æ–°å¢ `id` å’Œ `absolutePath` å­—æ®µ

**æ–°å¢ API - Window**:
- `window.setNoDragRegions` - è®¾ç½®çª—å£å†…çš„éæ‹–æ‹½åŒºåŸŸï¼ˆå¦‚æŒ‰é’®ï¼‰ï¼Œä¼˜å…ˆçº§é«˜äºæ‹–æ‹½åŒºåŸŸ
- `window.getTitlebarInfo` - è·å–æ ‡é¢˜æ çš„å®Œæ•´ä¿¡æ¯ï¼ˆé«˜åº¦ã€æŒ‰é’®å®½åº¦ã€æœ€å¤§åŒ–çŠ¶æ€ç­‰ï¼‰
- `window.getCaptionButtonsWidth` - è·å–ç³»ç»Ÿæ ‡é¢˜æ æŒ‰é’®çš„æ€»å®½åº¦å’Œå•ä¸ªæŒ‰é’®å®½åº¦

**æ ¸å¿ƒä¿®å¤**:
- **ä¿®å¤ `window.setNoDragRegions`**: è§£å†³äº†éåŸå­æ›´æ–°å¯¼è‡´çš„ç«äº‰æ¡ä»¶é—®é¢˜ï¼Œç°åœ¨ API è°ƒç”¨æ›´åŠ ç¨³å®šã€‚
- **ä¿®å¤çª—å£æ‹–æ‹½é€»è¾‘**: ä¼˜åŒ–äº† `WM_NCHITTEST` å¤„ç†é¡ºåºï¼Œç¡®ä¿ `noDragRegions` ä¼˜å…ˆçº§é«˜äº `dragRegions`ã€‚
- **è‡ªå®šä¹‰æ‹–æ‹½åŒºåŸŸå¢å¼º**: å½“è®¾ç½®äº†è‡ªå®šä¹‰ `dragRegions` æ—¶ï¼Œç°åœ¨ä¼šå®Œå…¨è¦†ç›–é»˜è®¤çš„æ ‡é¢˜æ æ‹–æ‹½é€»è¾‘ï¼Œä¸å†å‡ºç°é‡å åˆ¤å®šé—®é¢˜ã€‚

**UI ä¸ä¸»é¢˜**:
- **æ·±è‰²æ¨¡å¼æ”¯æŒ**: æ’ä»¶çš„é¦–é€‰é¡¹é¡µé¢ï¼ˆPreferences Pageï¼‰å’Œå³é”®èœå•ç°åœ¨å®Œç¾æ”¯æŒ foobar2000 çš„æ·±è‰²/æµ…è‰²ä¸»é¢˜åˆ‡æ¢ã€‚
- **é¦–é€‰é¡¹é¡µé¢é‡æ„**:
  - æ–°å¢ "Open Data Folder"ï¼ˆæ‰“å¼€æ•°æ®æ–‡ä»¶å¤¹ï¼‰æŒ‰é’®ã€‚
  - æ–°å¢ "Reload Configuration"ï¼ˆé‡è½½é…ç½®ï¼‰æŒ‰é’®ã€‚
  - æ–°å¢ "Reset to Defaults"ï¼ˆé‡ç½®é»˜è®¤ï¼‰æŒ‰é’®ã€‚
  - ä¼˜åŒ–äº†å¸ƒå±€ï¼Œå¢åŠ äº†æ§ä»¶å®½åº¦ä»¥é˜²æ­¢æ–‡æœ¬æˆªæ–­ã€‚
  - å®ç°äº†çª—å£å¤§å°è‡ªé€‚åº”ï¼Œè§£å†³äº†éƒ¨åˆ†æ§ä»¶æ˜¾ç¤ºä¸å…¨çš„é—®é¢˜ã€‚
  - ä¿®å¤äº†æ§ä»¶èƒŒæ™¯è‰²åœ¨æ·±è‰²æ¨¡å¼ä¸‹çš„æ˜¾ç¤ºé—®é¢˜ã€‚

**åŠŸèƒ½æ”¹è¿›**:
- **é…ç½®ç®¡ç†**: å¢å¼ºäº†å¯¹ WebView2 è°ƒè¯•ã€CORS ç¦ç”¨ã€ç¼“å­˜å¯ç”¨çš„é…ç½®æ”¯æŒã€‚
- **é”®ç›˜å¯¼èˆª**: ä¸ºé¦–é€‰é¡¹é¡µé¢æ§ä»¶æ·»åŠ äº† `WS_TABSTOP` æ”¯æŒï¼Œç°åœ¨å¯ä»¥ä½¿ç”¨ Tab é”®åˆ‡æ¢ç„¦ç‚¹ã€‚

### v1.1.1 æ›´æ–°å†…å®¹ (2026-01-03)

**æ–°å¢ API**:
- `metadata.readByPath` - è¯»å–æŒ‡å®šæ–‡ä»¶è·¯å¾„çš„æ‰€æœ‰å…ƒæ•°æ®ï¼ˆæ‰å¹³æ ¼å¼ï¼‰

**CSP ç­–ç•¥ä¼˜åŒ–**:
- å…è®¸ä» `cdnjs.cloudflare.com`ã€`unpkg.com`ã€`cdn.jsdelivr.net` åŠ è½½è„šæœ¬å’Œæ ·å¼
- å…è®¸ä» `fonts.googleapis.com` / `fonts.gstatic.com` åŠ è½½å­—ä½“
- å…è®¸åŠ è½½æ‰€æœ‰ HTTPS å›¾ç‰‡
- æ”¯æŒ WebSocket çƒ­æ›´æ–°è¿æ¥ (`wss://`)

### v1.1.0 æ›´æ–°å†…å®¹

**æ–°å¢ API**:
- `library.getByPath` - é€šè¿‡æ–‡ä»¶è·¯å¾„æœç´¢æ›²ç›®

**API æ ¼å¼æ ‡å‡†åŒ–**:
- åˆ—è¡¨ API æ–°å¢ `items` å­—æ®µï¼ˆä¿ç•™åŸæœ‰å­—æ®µå¦‚ `tracks`ï¼‰
- å¯ç”¨æ€§ API æ–°å¢ `available` å­—æ®µï¼ˆä¿ç•™åŸæœ‰å­—æ®µå¦‚ `found`ï¼‰

**å‚æ•°å…¼å®¹æ€§å¢å¼º**:
| API | æ ‡å‡†å‚æ•° | å…¼å®¹åˆ«å |
|-----|---------|---------|
| `playlist.*` | `playlist` | `playlistIndex` |
| `library.search/getAll` | `offset`, `limit` | `start`, `count` |
| `config.setOutputBuffer` | `bufferLength` | `milliseconds` |

**æµ‹è¯•è¦†ç›–ç‡**:
- 287 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- 100% é€šè¿‡ç‡

</section>

<!-- ==================== CHANGELOG ==================== -->
<section id="changelog">

## ğŸ“ æ›´æ–°æ—¥å¿—

å®Œæ•´çš„ç‰ˆæœ¬æ›´æ–°å†å²ï¼ŒæŒ‰æ—¶é—´ä»æ–°åˆ°æ—§æ’åºã€‚

### v1.1.12 (2026-01-14)

**æ–°å¢åŠŸèƒ½**
- âœ¨ æ–°å¢ `replaygain.get` - è·å–æ–‡ä»¶çš„ ReplayGain ä¿¡æ¯ï¼ˆtrackGain, trackPeak, albumGain, albumPeakï¼‰
- âœ¨ æ–°å¢ `replaygain.scan` - è§¦å‘ ReplayGain æ‰«æï¼ˆé€šè¿‡ä¸Šä¸‹æ–‡èœå•ï¼‰
- âœ¨ æ–°å¢ `replaygain.clear` - æ¸…é™¤æ–‡ä»¶çš„ ReplayGain ä¿¡æ¯
- âœ¨ æ–°å¢ `playcount.get` - è·å–æ’­æ”¾ç»Ÿè®¡ä¿¡æ¯ï¼ˆæ¥è‡ª foo_playcountï¼‰
- âœ¨ æ–°å¢ `playcount.getBatch` - æ‰¹é‡è·å–æ’­æ”¾ç»Ÿè®¡
- âœ¨ æ–°å¢ `playcount.getStats` - è·å–åª’ä½“åº“æ•´ä½“æ’­æ”¾ç»Ÿè®¡
- âœ¨ æ–°å¢ `playcount.set` - å ä½ç¬¦ï¼ˆfoo_playcount ä¸æ”¯æŒç›´æ¥ä¿®æ”¹ï¼‰
- âœ¨ å®Œå–„ `metadata.embedArtwork` å’Œ `metadata.removeEmbeddedArt` æ–‡æ¡£

**Bug ä¿®å¤**
- ğŸ”§ ä¿®å¤ `replaygain.get` è¿”å›å€¼ä¸å®Œæ•´ - ä½¿ç”¨ `input_info_reader` å¼ºåˆ¶ä»æ–‡ä»¶è¯»å–

**API æ€»æ•°**: 299 ä¸ª

---

### v1.1.11 (2026-01-13)

**æ–°å¢åŠŸèƒ½**
- âœ¨ æ–°å¢ `metadata.readBatch` - æ‰¹é‡è¯»å–å¤šä¸ªæ–‡ä»¶å…ƒæ•°æ®ï¼Œæ€§èƒ½æå‡
- âœ¨ æ–°å¢ `metadata.removeField` - ç§»é™¤æŒ‡å®šæ ‡ç­¾å­—æ®µï¼ˆ`removeTag` åˆ«åï¼‰

**Bug ä¿®å¤**
- ğŸ”§ ä¿®å¤ `rating.set(0)` æ¸…é™¤è¯„åˆ† - ç›´æ¥éå† foo_playcount èœå•ï¼Œç»•è¿‡ç¼–ç åŒ¹é…é—®é¢˜
- ğŸ”§ ä¿®å¤ `metadata.readByPath` å­—æ®µä¸å®Œæ•´ - ä½¿ç”¨ `input_info_reader` å¼ºåˆ¶ä»æ–‡ä»¶è¯»å–
- ğŸ”§ ä¿®å¤å­—æ®µåå¤§å°å†™ä¸ä¸€è‡´ - æ‰€æœ‰å…ƒæ•°æ®å­—æ®µç»Ÿä¸€ä¸ºå¤§å†™ (TITLE, ARTIST, ALBUM ç­‰)
- ğŸ”§ è‡ªåŠ¨ä»æ–‡ä»¶åæå–æ›²ç›®å· - æ”¯æŒ `01. Song`ã€`01 - Song`ã€`(01) Song` ç­‰æ ¼å¼

**API æ€»æ•°**: 291 ä¸ª

---

### v1.1.10 (2026-01-11)

**Bug ä¿®å¤**
- ğŸ”§ **Unicode è·¯å¾„ä¿®å¤** - ä¿®å¤ `metadata.readByPath` ç­‰ API åœ¨è·¯å¾„åŒ…å«æ—¥æ–‡å¼•å· `ã€Œã€`ã€å…¨è§’ç¬¦å· `â€”ï¼œï¼ï½œ` æ—¶å¤±è´¥çš„é—®é¢˜
- ğŸ› ï¸ **DLL åˆå§‹åŒ–ä¿®å¤** - ä¿®å¤ç»„ä»¶åŠ è½½æ—¶å¯èƒ½å‡ºç°çš„ "DLLåˆå§‹åŒ–ä¾‹ç¨‹å¤±è´¥" é”™è¯¯
- ğŸ“ ä¿®å¤æ¶‰åŠ 7 å¤„ APIï¼š`metadata.readByPath`ã€`metadata.read`ã€`metadata.remove`ã€`lyrics.get`ã€`lyrics.exists`ã€`artwork.getByPath`

---

### v1.1.9 (2026-01-10)

**æ–°å¢åŠŸèƒ½**
- ğŸ“¡ **å®æ—¶å…ƒæ•°æ®äº‹ä»¶** - æ–°å¢ `metadb:changed` äº‹ä»¶ï¼Œå®æ—¶æ¨é€è¯„åˆ†/æ ‡ç­¾å˜åŒ–
- âœ¨ ç±»ä¼¼ SMP çš„ `on_metadb_changed` å›è°ƒï¼Œæ— éœ€è½®è¯¢å³å¯è·å–æ›´æ–°
- ğŸš€ è¯„åˆ†è®¾ç½®åç«‹å³æ”¶åˆ°äº‹ä»¶é€šçŸ¥ï¼Œå®ç°å³æ—¶ UI æ›´æ–°

---

### v1.1.8 (2026-01-09)

**æ–°å¢åŠŸèƒ½**
- âœ¨ **foo_playcount è¯„åˆ†é›†æˆ** - é€šè¿‡ `discovery.executeContextMenuByPath` å¯ç›´æ¥è°ƒç”¨ foo_playcount è®¾ç½®è¯„åˆ†
- ğŸ” `discovery.getContextMenuTree` - è·å–å®Œæ•´ä¸Šä¸‹æ–‡èœå•æ ‘ç»“æ„
- ğŸ”§ `discovery.executeContextMenuByPath` - é€šè¿‡è·¯å¾„æ‰§è¡Œä¸Šä¸‹æ–‡èœå•å‘½ä»¤ï¼ˆæ”¯æŒåŠ¨æ€å­èœå•ï¼‰

**Bug ä¿®å¤**
- ğŸ› ä¿®å¤ UTF-8 ç¼–ç é—®é¢˜å¯¼è‡´ç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ â˜…ï¼‰æ— æ³•æ­£ç¡®æ˜¾ç¤º

---

### v1.1.7 (2026-01-08)

**æ–°å¢åŠŸèƒ½**
- âœ¨ `ui.showCustomMenu` æ–°å¢ `suppressDefault` å‚æ•°ï¼Œæä¾›æ›´å¼ºçš„åŸç”Ÿèœå•æ§åˆ¶èƒ½åŠ›

---

### v1.1.6 (2026-01-07)

**æ–°å¢åŠŸèƒ½**
- âœ¨ `artwork.getForTrack` æ–°å¢ `maxSize` å‚æ•°ï¼Œæ”¯æŒæœåŠ¡ç«¯ç¼©æ”¾
- ğŸ“ å°é¢ API è¿”å› `width`/`height` å°ºå¯¸ä¿¡æ¯
- â­ æ–°å¢ `rating.set` å’Œ `rating.get` APIï¼Œæ”¯æŒæ­Œæ›²è¯„åˆ† (1-5 æ˜Ÿ)
- ğŸ“ `metadata.write` å®ç°çœŸæ­£çš„æ ‡ç­¾å†™å…¥åŠŸèƒ½
- ğŸµ `library.getAll` è¿”å›å€¼æ–°å¢ `rating` å­—æ®µ

**æ”¹è¿›**
- ğŸš€ WebView2 SDK æ›´æ–°è‡³ 1.0.3650.58

---

### v1.1.5 åŠæ›´æ—©ç‰ˆæœ¬

æ›´æ—©çš„ç‰ˆæœ¬æ›´æ–°æ—¥å¿—è¯·å‚è€ƒ [GitHub Releases](https://github.com/user/foo_ui_webview2/releases)ã€‚

</section>

---

<div style="text-align: center; padding: 40px 0; color: #666;">
    <p>foo_ui_webview2 Plugin API Documentation</p>
    <p>Generated: 2026-01-14 | Version: 1.1.12</p>
    <p><a href="https://github.com/user/foo_ui_webview2" style="color: #0078D4;">GitHub Repository</a></p>
</div>

            </article>
        </main>
    </div>
    
    <script>
        // é…ç½® marked
        marked.setOptions({
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    try {
                        return hljs.highlight(code, { language: lang }).value;
                    } catch (e) {}
                }
                return hljs.highlightAuto(code).value;
            },
            breaks: false,
            gfm: true
        });
        
        // ç­‰å¾… DOM åŠ è½½å®Œæˆ  
        document.addEventListener('DOMContentLoaded', function() {
            const article = document.querySelector('.markdown-body');
            if (article) {
                let content = article.innerHTML;
                
                // ========== é¢„å¤„ç†ï¼šè§£å†³ HTML+Markdown æ··åˆæ¸²æŸ“é—®é¢˜ ==========
                // é—®é¢˜ï¼šç¼©è¿›çš„ HTML æ ‡ç­¾ï¼ˆå¦‚ "    </div>"ï¼‰ä¼šè¢« marked è¯†åˆ«ä¸ºä»£ç å—
                // è§£å†³ï¼šåœ¨è§£æå‰ç§»é™¤ HTML æ ‡ç­¾å‰çš„ç¼©è¿›
                
                // 1. ç§»é™¤è¡Œé¦–ç¼©è¿›åç´§è·Ÿ HTML é—­åˆæ ‡ç­¾çš„ç¼©è¿›
                //    åŒ¹é…ï¼šè¡Œé¦–ç©ºç™½ + </xxx> æˆ– <xxx> æˆ– <xxx ...>
                content = content.replace(/^[ \t]+(<\/?[a-zA-Z][^>]*>)/gm, '$1');
                
                // 2. ç§»é™¤ HTML æ ‡ç­¾ä¹‹é—´å¤šä½™çš„ç©ºè¡Œï¼ˆä¿ç•™1ä¸ªç©ºè¡Œç”¨äº Markdown åˆ†æ®µï¼‰
                content = content.replace(/(>)\s*\n\s*\n\s*\n+\s*(<)/g, '$1\n\n$2');
                
                // 3. æ¸…ç† HTML æ ‡ç­¾å†…éƒ¨çš„å¤šä½™ç©ºç™½ï¼ˆä½†ä¿ç•™ä»£ç å—å†…çš„ï¼‰
                //    è¿™é˜²æ­¢ api-card-body å†…çš„ç©ºç™½å¯¼è‡´é—®é¢˜
                content = content.replace(/<div class="api-card-body">\s+\n/g, '<div class="api-card-body">\n');
                content = content.replace(/\n\s+<\/div>\s*<\/div>/g, '\n</div>\n</div>');
                
                // ç”¨ marked è§£æå¤„ç†åçš„å†…å®¹
                article.innerHTML = marked.parse(content);
            }
            
            // å¯¹æ‰€æœ‰ä»£ç å—åº”ç”¨è¯­æ³•é«˜äº®
            document.querySelectorAll('pre code').forEach((block) => {
                // æ·»åŠ è¯­è¨€æ ‡ç­¾
                const pre = block.parentElement;
                const langClass = Array.from(block.classList).find(c => c.startsWith('language-'));
                if (langClass && pre) {
                    const lang = langClass.replace('language-', '');
                    if (lang && lang !== 'plaintext') {
                        pre.setAttribute('data-lang', lang);
                    }
                }
                
                if (!block.classList.contains('hljs')) {
                    hljs.highlightElement(block);
                }
            });
        });
        
        // Navigation active state
        document.querySelectorAll('.nav-section a').forEach(link => {
            link.addEventListener('click', function() {
                document.querySelectorAll('.nav-section a').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Search filter
        function filterNav() {
            const search = document.getElementById('search').value.toLowerCase();
            document.querySelectorAll('.nav-section a').forEach(link => {
                const text = link.textContent.toLowerCase();
                link.style.display = text.includes(search) ? 'block' : 'none';
            });
        }
        
        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });
        });
        
        // è¿”å›é¡¶éƒ¨æŒ‰é’®
        const backToTopBtn = document.getElementById('backToTop');
        window.addEventListener('scroll', function() {
            if (window.scrollY > 300) {
                backToTopBtn.classList.add('visible');
            } else {
                backToTopBtn.classList.remove('visible');
            }
            
            // æ»šåŠ¨æ—¶æ›´æ–°ä¾§è¾¹æ é«˜äº®
            updateActiveNavOnScroll();
        });
        
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // æ»šåŠ¨æ—¶è‡ªåŠ¨é«˜äº®å½“å‰ section çš„å¯¼èˆªé¡¹
        function updateActiveNavOnScroll() {
            const sections = document.querySelectorAll('section[id]');
            const navLinks = document.querySelectorAll('.nav-section a[href^="#"]');
            
            let currentSection = '';
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                if (window.scrollY >= sectionTop) {
                    currentSection = section.getAttribute('id');
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === '#' + currentSection) {
                    link.classList.add('active');
                }
            });
        }
    </script>
</body>
</html>
